/**************************************************************************** 
 * Copyright (C) 2021, Bitmovin, Inc., All Rights Reserved 
 * 
 * This source code and its use and distribution, is subject to the terms 
 * and conditions of the applicable license agreement. 
 * 
 * Bitmovin Player Version 8.60.0 
 * 
 ****************************************************************************/
(function() {
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.mserenderer=t():(e.bitmovin=e.bitmovin||{},e.bitmovin.player=e.bitmovin.player||{},e.bitmovin.player.mserenderer=t())}(this,function(){return webpackJsonpbitmovin_player__name_([15],{157:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,i=r(46),o=r(6),s=r(7),u=r(20),a=r(18),d=r(1),f=r(119),c=r(19),h=r(35),p=r(11),l=r(5),m=r(83),g=r(547);!function(e){e.closed="closed",e.open="open",e.ended="ended"}(n=t.MediaSourceReadyState||(t.MediaSourceReadyState={}));var v=function(){function e(e){var t=this;this.waitForBuffer=function(e){return t.sourceBuffers.hasOwnProperty(e)?t.mseReady().then(function(){return t.sourceBuffers[e].ready()}):Promise.reject("No SourceBuffer for '"+e+"' available")},e.videoElement&&(this.context=e,this.logger=e.logger,this.video=e.videoElement,this.negativeDTSCorrectionOffset=0,this.sourceBuffers={},this.isInit=!1,this.updateEndListeners=new h.ArrayMap)}return e.prototype.getBufferedRanges=function(e){return this.sourceBuffers.hasOwnProperty(e)?this.sourceBuffers[e].bufferedRanges:[]},e.prototype.printDetailedBufferRange=function(e,t){var r;try{r=e.buffered}catch(n){return}for(var i=0;i<r.length;i++)this.logger.debug(t+" buffer range ["+i+"]: "+r.start(i)+" - "+r.end(i))},e.prototype.getBufferStartTime=function(){var e=this,t=Object.keys(this.sourceBuffers).map(function(t){return 0===e.sourceBuffers[t].bufferedRanges.length?0:e.sourceBuffers[t].bufferedRanges[0].start});return Math.max.apply(null,t)},e.prototype.onBufferChanged=function(e,t){if(t&&"target"in t&&t.target){var r=t.target;this.printDetailedBufferRange(r,e)}},e.prototype.addBuffer=function(e,t){if(this.isInit&&!this.sourceBuffers.hasOwnProperty(e))try{var r=this.mediaSource.addSourceBuffer(e+"; codecs="+t);this.sourceBuffers[e]=new g.SourceBufferWrapper(r),this.addBufferChangedUpdateEndCallback(e)}catch(n){return this.logger.debug("Could not add SourceBuffer for "+e+" with codecs "+t+":"+n),this.context.eventHandler.dispatchEvent(d.PlayerEvent.Warning,new u.PlayerWarning(a.WarningCode.SOURCE_CODEC_OR_FILE_FORMAT_NOT_SUPPORTED)),null}return this.logger.debug("Added SourceBuffer for "+e+" with codecs "+t),isNaN(this.mediaSource.duration)||(this.sourceBuffers[e].appendWindowEnd=this.mediaSource.duration),this.sourceBuffers[e].buffer},e.prototype.updateTimestampOffset=function(e,t){var r=this.sourceBuffers[e];r&&(this.logger.debug("setting new source buffer ["+e+"] offset from "+r.buffer.timestampOffset+" to "+t),r.buffer.timestampOffset=t)},e.prototype.setTimestampOffset=function(e,t){return this.sourceBuffers.hasOwnProperty(e)?(t&&!isNaN(t)||(this.logger.debug("source buffer ["+e+"] offset is "+t+", setting it to 0"),t=0),this.queueTimestampOffsetUpdate(e,t)):(this.logger.debug("no such source buffer found (mime type="+e+")"),Promise.resolve())},e.prototype.queueTimestampOffsetUpdate=function(e,t){var r=this;return this.queueActionOnBuffer(e,function(){return r.updateTimestampOffset(e,t)})["catch"](function(t){r.logger.debug("Failed to set timestamp offset for",e,":",t)})},e.prototype.getBufferRangeStart=function(e,t){return t||e.buffered.start(0)},e.prototype.getBufferRangeEnd=function(e,t){return t||e.buffered.end(e.buffered.length-1)},e.prototype.getBufferRemovalRange=function(e,t,r){var n=this.sourceBuffers[e].buffer,i=this.getBufferRangeStart(n,t),o=this.getBufferRangeEnd(n,r);return{start:i,end:o}},e.prototype.postBufferRemoval=function(e,t,r){this.logger.debug("successfully removed buffer for "+e+" (from  "+t+" to "+r+")")},e.prototype.preBufferRemoval=function(e,t,r){this.logger.debug("removing buffer for "+e+" (from "+t+" to "+r+")")},e.prototype.removeBufferRange=function(e,t,r){this.preBufferRemoval(e,t,r),this.sourceBuffers[e].buffer.remove(t,r)},e.prototype.removeFromBuffer=function(e,t,r){var i=this;return this.queueActionOnBuffer(e,function(){var o,s,f;try{if(i.video.currentTime>=0&&(null===(f=null===(s=null===(o=i.sourceBuffers[e])||void 0===o?void 0:o.buffer)||void 0===s?void 0:s.buffered)||void 0===f?void 0:f.length)>0){var c=i.getBufferRemovalRange(e,t,r),h=c.start,p=c.end;if(h>=0&&p>h){if(i.sourceBuffers[e].removalPending=!0,i.sourceBuffers[e].rangePendingRemoval={start:h,end:p},i.mediaSource.readyState===n.open){var l=i.sourceBuffers[e].onUpdateEnded().then(function(){i.sourceBuffers[e]&&(i.sourceBuffers[e].rangePendingRemoval=null,i.sourceBuffers[e].removalPending=!1,i.postBufferRemoval(e,h,p))});return i.removeBufferRange(e,h,p),l}i.logger.debug("cannot remove buffer for "+e+" (from "+h+" to "+p+"): MediaSource is not open"),i.addOneSourceOpenCallback(function(){i.removeFromBuffer(e,h,p)["catch"](function(t){i.logger.debug("Couldn't remove buffer from "+h+" to "+p+" for "+e,t)})})}}}catch(m){var g=a.WarningCode[a.WarningCode.PLAYBACK_WARNING]+". Exception: "+JSON.stringify(m);i.context.eventHandler.dispatchEvent(d.PlayerEvent.Warning,new u.PlayerWarning(a.WarningCode.PLAYBACK_WARNING,g))}})},e.prototype.removeBuffer=function(e){var t=this;if(this.sourceBuffers[e]){if(this.isMediaSourceOpen()&&this.queueActionOnBuffer(e,function(){var r;null===(r=t.sourceBuffers[e])||void 0===r?void 0:r.buffer.abort()}),l.MimeTypeHelper.isSubtitle(e))this.removeFromBuffer(e)["catch"](function(e){t.logger.debug("Error removing buffer data",e)});else try{(this.updateEndListeners.get(e)||[]).slice().forEach(function(r){t.removeUpdateEndCallback(e,r)}),this.mediaSource.removeSourceBuffer(this.sourceBuffers[e].buffer)}catch(r){this.logger.debug("Error while trying to remove source buffer.",r)}this.deleteSourceBuffer(e)}},e.prototype.deleteSourceBuffer=function(e){return this.sourceBuffers[e]?(this.sourceBuffers[e].dispose(),delete this.sourceBuffers[e],void this.logger.debug("Removed SourceBuffer for "+e)):void this.logger.debug("No source buffer to remove for mimeType="+e)},e.prototype.isMediaSourceOpen=function(){var e;return(null===(e=this.mediaSource)||void 0===e?void 0:e.readyState)===n.open},e.prototype.resetAllBuffers=function(){if(null!==this.mediaSource){for(var e in this.sourceBuffers)this.sourceBuffers.hasOwnProperty(e)&&this.removeBuffer(e);this.sourceBuffers={},this.logger.debug("Removed all SourceBuffers")}},e.prototype.tearDownMediaSource=function(){if(this.mediaSource&&null!==this.video.getWrappedElement()){if(this.resetAllBuffers(),window&&window.URL&&"function"==typeof window.URL.revokeObjectURL&&""!==this.video.src)try{window.URL.revokeObjectURL(this.video.src)}catch(e){}this.mediaSourceReadyDeferred&&this.mediaSourceReadyDeferred.reject("MediaSource is being destroyed."),this.mediaSourceReadyDeferred=null,this.mediaSourceReadyPromise=null,m.VideoElementUtil.removeSource(this.video),this.video.load(),this.mediaSource=null,this.isInit=!1,this.updateEndListeners.clear(),this.updateEndListeners=null,this.logger.debug("Detached video element and MSE")}},e.prototype.removeUpdateEndCallback=function(e,t){this.sourceBuffers.hasOwnProperty(e)&&this.sourceBuffers[e].buffer.removeEventListener("updateend",t)},e.prototype.addUpdateEndCallback=function(e,t){this.sourceBuffers.hasOwnProperty(e)&&this.sourceBuffers[e].buffer.addEventListener("updateend",t)},e.prototype.addOneUpdateEndCallback=function(e,t){return this.sourceBuffers[e].onUpdateEnded()["catch"](function(){}).then(t)},e.prototype.addSourceOpenCallback=function(e){this.mediaSource&&this.mediaSource.addEventListener("sourceopen",e)},e.prototype.removeSourceOpenCallback=function(e){this.mediaSource&&this.mediaSource.removeEventListener("sourceopen",e)},e.prototype.addOneSourceOpenCallback=function(e){var t=this,r=function(n){t.removeSourceOpenCallback(r),e(n)};this.addSourceOpenCallback(r)},e.prototype.isAnyBufferUpdating=function(){var e=this;return 0!==Object.keys(this.sourceBuffers).filter(function(t){return e.sourceBuffers[t].buffer.updating}).length},e.prototype.setDuration=function(e){var t=this;this.queueActionOnBuffers(function(){void 0===e||isNaN(e)||e<=0?t.mediaSource.duration=1/0:t.mediaSource.duration=e})["catch"](function(e){t.logger.debug("Could not set the duration of the MSE!",e)})},e.prototype.getDuration=function(){return this.mediaSource&&!isNaN(this.mediaSource.duration)?this.mediaSource.duration:0},e.prototype.isInitialized=function(){return this.isInit},Object.defineProperty(e.prototype,"readyState",{get:function(){return this.mediaSource?this.mediaSource.readyState:null},enumerable:!0,configurable:!0}),e.prototype.isBufferRemovalPending=function(){var e=this;return Object.keys(this.sourceBuffers).some(function(t){return e.sourceBuffers[t].removalPending})},e.prototype.getRangePendingRemoval=function(e){return this.sourceBuffers.hasOwnProperty(e)?this.sourceBuffers[e].rangePendingRemoval:null},e.prototype.getBufferSizeInSeconds=function(e){return this.getBufferedRanges(e).reduce(function(e,t){return e+(t.end-t.start)},0)},e.prototype.addToBuffer=function(e){var t=this,r=e.getMimeType(),c=e.getPlaybackTime();return!e.isInit()&&c<0&&c<this.negativeDTSCorrectionOffset?(this.context.eventHandler.dispatchEvent(d.PlayerEvent.Warning,new u.PlayerWarning(a.WarningCode.PLAYBACK_NEGATIVE_DECODING_TIMESTAMP_ENCOUNTERED)),this.logger.debug("Encountered negative DTS "+c+" for "+r+" segment ("+e.getUrl()+"), attempting to correct PTO...',"),this.negativeDTSCorrectionOffset=c,Promise.all(Object.keys(this.sourceBuffers).map(function(e){return t.setTimestampOffset(e,t.sourceBuffers[e].buffer.timestampOffset-t.negativeDTSCorrectionOffset)})).then(function(){return t.addToBuffer(e)})):this.queueActionOnBuffer(r,function(){if(!t.mediaSource)return t.logger.debug("Could not queue action on SourceBuffer: MediaSource has been destroyed"),Promise.reject(i.SOURCE_BUFFER_APPEND_STATUS.FAILURE);if(t.mediaSource.readyState!==n.open)return t.logger.warn("MediaSource is not open (readyState="+t.mediaSource.readyState+")"),Promise.reject(i.SOURCE_BUFFER_APPEND_STATUS.FAILURE);if(!t.sourceBuffers.hasOwnProperty(r))return t.logger.log("sourceBuffers has no entry for "+r),Promise.reject(i.SOURCE_BUFFER_APPEND_STATUS.FAILURE);var u=e.getRepresentationId().representationId;try{t.logger.debug("[MSEWrapper]["+u+"] Adding segment to buffer ["+e.getUrl()+"]"),t.sourceBuffers[r].buffer.appendBuffer(e.getData())}catch(a){return a.name&&"QuotaExceededError"===a.name?(t.logger.debug("QuotaExceededError, trying to remove old data from buffers..."),t.context.store.dispatch(f.setBufferMaxSize(r,t.getBufferSizeInSeconds(r))),Promise.reject(i.SOURCE_BUFFER_APPEND_STATUS.QUOTA_EXCEEDED)):(t.video.error||t.context.eventHandler.fireError(new s.PlayerError(o.ErrorCode.UNKNOWN,{exception:a})),t.logger.debug("[MSEWrapper]["+u+"] Failed appending segment to SouceBuffer",a),Promise.reject(i.SOURCE_BUFFER_APPEND_STATUS.FAILURE))}})},e.prototype.endOfStream=function(){var e=this;return this.queueActionOnBuffers(function(){e.isMediaSourceOpen()?(e.logger.debug("Signaled mse end of stream"),e.mediaSource.endOfStream()):e.logger.debug("Skipped signaling EOS as the mse is not open")})["catch"](function(t){e.logger.debug("Unable to signal EOS on media source",t)})},e.prototype.waitForBuffers=function(){var e=Object.keys(this.sourceBuffers).map(this.waitForBuffer);return this.mseReady().then(function(){return Promise.all(e).then(function(){})})},e.prototype.queueActionOnBuffers=function(e){var t=this,r=new Promise(function(e,n){var i=Object.keys(t.sourceBuffers).map(function(e){var n=t.queueActionOnBuffer(e,function(){});return t.queueActionOnBuffer(e,function(){return r}).then()["catch"](),n});Promise.all(i).then(function(){return e()},n)}).then(function(){return e()}).then(function(){return Promise.all(Object.keys(t.sourceBuffers).map(function(e){return t.sourceBuffers[e].ready()})).then(function(){})});return r},e.prototype.queueActionOnBuffer=function(e,t){return this.sourceBuffers.hasOwnProperty(e)?this.sourceBuffers[e].queueAction(t):Promise.reject("No SourceBuffer for '"+e+"' available")},e.prototype.mseReady=function(){var e=this;if(this.mediaSourceReadyPromise)return this.mediaSourceReadyPromise;this.mediaSourceReadyDeferred=new p.Deferred,this.mediaSourceReadyPromise=this.mediaSourceReadyDeferred.promise;var t=function(t){n(),e.mediaSourceReadyDeferred.reject(t)},r=function(){var t;n(),e.isInit=!0,null===(t=e.mediaSourceReadyDeferred)||void 0===t?void 0:t.resolve()},n=function(){e.mediaSource&&(e.mediaSource.removeEventListener("error",t),e.mediaSource.removeEventListener("sourceopen",r),e.mediaSource.removeEventListener("webkitsourceopen",r))};return this.mediaSource.addEventListener("error",t),this.mediaSource.addEventListener("sourceopen",r,!1),this.mediaSource.addEventListener("webkitsourceopen",r,!1),window&&window.URL&&"function"==typeof window.URL.createObjectURL?this.video.src=window.URL.createObjectURL(this.mediaSource):(this.logger.debug("Could not use window.URL.createObjectURL(mediaSource) as the browser claims the function does not exist."),this.mediaSourceReadyDeferred.reject("Could not create Object URL")),this.mediaSourceReadyPromise.then(function(){return e.mediaSourceReadyDeferred=null})},e.prototype.createNewMSE=function(){return this.tearDownMediaSource(),this.mediaSource=new window.MediaSource,this.mseReady()},e.prototype.isChangeTypeSupported=function(){var e,t;return!!(null===(t=null===(e=window.SourceBuffer)||void 0===e?void 0:e.prototype)||void 0===t?void 0:t.changeType)&&!c.getCapabilities().isTizen},e.prototype.addBufferChangedUpdateEndCallback=function(e){var t=this,r=function(r){return t.onBufferChanged(e,r)};this.addUpdateEndCallback(e,r),this.updateEndListeners.add(e,r)},e.prototype.updateSourceBufferKey=function(e){var t=this,r=l.MimeTypeHelper.getMediaType(e),n=Object.keys(this.sourceBuffers).find(function(n){var i=l.MimeTypeHelper.getMediaType(n);return t.sourceBuffers.hasOwnProperty(n)&&i===r&&n!==e});n&&(this.removeAllUpdateEndCallbacks(n),this.sourceBuffers[e]=this.sourceBuffers[n],delete this.sourceBuffers[n],this.addBufferChangedUpdateEndCallback(e))},e.prototype.removeAllUpdateEndCallbacks=function(e){var t=this,r=this.updateEndListeners.get(e);r.forEach(function(r){t.removeUpdateEndCallback(e,r)}),this.updateEndListeners["delete"](e)},e.prototype.changeBufferType=function(e,t){var r=this;return this.updateSourceBufferKey(e),this.queueActionOnBuffer(e,function(){r.sourceBuffers[e].changeType(e+"; codecs="+t),r.context.logger.debug("Changed "+e+" SourceBuffer type with codec="+t)})},e.prototype.dispose=function(){this.resetAllBuffers(),this.tearDownMediaSource(),this.sourceBuffers=null,this.video=null},e}();t.MSEWrapper=v},158:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.filterRanges=function(t,r){var n=[];if(t&&t.length)for(var i=0;i<t.length;i++)r(t.start(i),t.end(i))&&n.push([t.start(i),t.end(i)]);return e.createTimeRanges(n)},e.createTimeRangesObj=function(e){var t=function(e,t){return e>=0&&e<=t},r=function(e,r,n){return t(n,r.length-1)?r[n][e]:null};return void 0===e||0===e.length?{length:0,start:function(){return 0},end:function(){return 0}}:{length:e.length,start:function(t){return r(0,e,t)},end:function(t){return r(1,e,t)}}},e.createTimeRanges=function(t,r){return Array.isArray(t)?e.createTimeRangesObj(t):void 0===t||void 0===r?e.createTimeRangesObj():e.createTimeRangesObj([[t,r]])},e.findNextRange=function(t,r){return e.filterRanges(t,function(t,n){return t-e.TIME_FUDGE_FACTOR>=r&&n-t>e.MIN_RANGE_DURATION})},e.findGaps=function(t){if(t.length<2)return e.createTimeRanges();for(var r=[],n=1;n<t.length;n++){var i=t.end(n-1),o=t.start(n);o-i>0&&r.push([i,o])}return e.createTimeRanges(r)},e.TIME_FUDGE_FACTOR=1/30,e.MIN_RANGE_DURATION=.2,e}();t.Ranges=n},276:function(e,t,r){"use strict";function n(e,t){var r=!1;return e.forEach(function(e){return r=r||t(e)}),r}Object.defineProperty(t,"__esModule",{value:!0});var i=r(29),o=r(46),s=r(6),u=r(7),a=r(3),d=r(1),f=r(9),c=r(51),h=r(11),p=r(5),l=r(4),m=r(14),g=r(119),v=r(86),y=r(543),S=r(544),E=r(157),T=r(548),R=function(){function e(e){var t=this;this.consecutiveErrorCount=0,this.waitingForSeekedPromise=null,this.onSeek=function(e){t.setCurrentTimeDelayedContext&&t.setCurrentTimeDelayedContext.time!==e.seekTarget&&Math.abs(t.setCurrentTimeDelayedContext.time-e.seekTarget)>=t.context.settings.GAP_TOLERANCE&&t.cancelSetCurrentTimeDelayed(e.seekTarget)},this.onPeriodSwitch=function(){t.periodSwitchOngoing=!0},this.onPeriodSwitched=function(){t.periodSwitchOngoing=!1},this.reOpenMse=function(){var e=t.segmentQueueMimeTypes;if(e.length<1)return Promise.resolve();var r=e.find(function(e){return t.timestampOffset.hasOwnProperty(e)});return r?t.setTimestampOffset(r,t.timestampOffset[r]):t.setTimestampOffset(e[0],0)},this.firePictureInPictureEvent=function(){var e=t.video.isPictureInPicture()?f.ViewMode.PictureInPicture:f.ViewMode.Inline;t.context.store.dispatch(c.setPlayerViewMode(e))},this.resetConsecutiveErrorCountCallback=function(e){e.time&&e.time>0&&(t.consecutiveErrorCount=0)},this.context=e,this.logger=e.logger,this.video=e.videoElement,this.settings=e.settings,this.readyPromise=Promise.resolve(),this.eventHandler=null,this.timestampOffset={},this.sourceBufferMimeCodecMap=new y.BufferMimeCodecMap(e.store,e.settings),this.currentTime=0,this.playerEventHandler=e.eventHandler,this.periodSwitchOngoing=!1,this.init()}return e.prototype.getSourceStore=function(){return this.context.serviceManager.get(a.ServiceName.SourceStoreService,this.context.sourceContext.sourceIdentifier)},e.prototype.createMSEWrapper=function(){return new E.MSEWrapper(this.context)},e.prototype.init=function(){var e=this;this.segmentQueueProcessingPromise=Promise.resolve(),this.mse=this.createMSEWrapper(),this.readyPromise=this.readyPromise["catch"](function(t){return e.context.logger.debug("Caught error during MSE recreation",t)}).then(function(){return e.mse.createNewMSE()}).then(function(){e.isShutdownForPeriodSwitch=!1}),this.needsInitialSeek=!0,this.segmentQueues={},this.setCurrentTimeContext=null,this.setCurrentTimeDelayedContext=null,this.quotaExceededMap=new Map,this.quotaExceededDeferredMap=new Map,this.gapHandler=new S.GapHandler(this.context),null==this.eventHandler&&(this.eventHandler=new T.VideoEventHandler(this.video),this.eventHandler.on(m.MediaElementEvent.timeupdate,this.resetConsecutiveErrorCountCallback)),this.on(m.MediaElementEvent.webkitpresentationmodechanged,this.firePictureInPictureEvent),this.playerEventHandler.on(d.PlayerEvent.PeriodSwitch,this.onPeriodSwitch),this.playerEventHandler.on(d.PlayerEvent.Seek,this.onSeek),this.playerEventHandler.on(d.PlayerEvent.PeriodSwitched,this.onPeriodSwitched)},e.prototype.trackRendererError=function(){this.consecutiveErrorCount++,this.consecutiveErrorCount>=this.settings.MAX_CONSECUTIVE_RENDERER_ERRORS&&this.context.eventHandler.fireError(new u.PlayerError(s.ErrorCode.PLAYBACK_VIDEO_DECODING_ERROR))},e.prototype.hasSourceBuffers=function(){return this.segmentQueueMimeTypes.length>0},e.prototype.hasDataInSourceBuffers=function(){var e=this,t=this.segmentQueueMimeTypes;return this.hasSourceBuffers()&&t.every(function(t){return e.mse.getBufferedRanges(t).length>0})},e.prototype.addBuffer=function(e,t){var r=this;if(null===this.mse)return!1;this.sourceBufferMimeCodecMap.add(e,t);var n=Boolean(this.mse.addBuffer(e,t));return n&&(this.mse.addUpdateEndCallback(e,function(){return r.quotaExceededMap.set(e,!1)}),this.addUpdateEndListenerToUpdateRendererRanges(e),this.segmentQueues[e]=[],this.getSourceStore().dispatch(g.setRendererRanges(e,[]))),n},e.prototype.addDrmInitData=function(e){var t,r=this;if(null===(t=e)||void 0===t?void 0:t.length)return this.drmService?void e.forEach(function(e){return r.drmService.addInitData(e)}):void this.context.logger.debug("PSSH data found but DRM is not configured")},e.prototype.appendData=function(e){var t=this;return this.addDrmInitData(e.getDrmInitData()),this.addSegmentToSegmentQueue(e),this.segmentQueueProcessingPromise=this.segmentQueueProcessingPromise["catch"](function(){}).then(function(){return t.processSegmentQueues()}),this.segmentQueueProcessingPromise},e.prototype.addSegmentToSegmentQueue=function(e){var t=e.getMimeType();return this.segmentQueues[t]?(this.segmentQueues[t].push(e),void this.getSourceStore().dispatch(g.setRendererRanges(t,this.getOverallBufferedRanges(t)))):void this.logger.debug("Renderer missing segment queue for mimeType("+t+") but trying to push segment.(url="+e.getUrl()+")")},e.prototype.getMSEBufferedRanges=function(e){return this.mse.getBufferedRanges(e)},e.prototype.getOverallBufferedRanges=function(e){if(null===this.mse||!this.segmentQueues.hasOwnProperty(e))return[];var t=i.BufferRangeHelper.getRangesFromQueue(this.segmentQueues[e],this.settings.GAP_TOLERANCE);return t=t.concat(this.getMSEBufferedRanges(e)),t=i.BufferRangeHelper.mergeRanges(t,this.settings.GAP_TOLERANCE)},e.prototype.isDataBeingAppended=function(e){if(null===this.mse)return!1;var t=this.segmentQueues&&this.segmentQueues[e]&&this.segmentQueues[e].length>0;return t||this.mse.isAnyBufferUpdating()},e.prototype.getRangesFromStore=function(e){var t=v.getBufferState(this.getSourceStore().getState());return v.getRendererBufferedRanges(t,e)},e.prototype.getEndOfBufferTime=function(){var e=this,t=[];return this.segmentQueueMimeTypes.forEach(function(r){var n=e.getRangesFromStore(r);if(n.length>0){var i=n[n.length-1].end;t.push(i)}}),0===t.length?null:Math.min.apply(Math,t)},e.prototype.removeDataFromSegmentQueues=function(e,t,r){var n=this;void 0===t&&(t=-(1/0)),void 0===r&&(r=1/0),this.segmentQueues.hasOwnProperty(e)&&(this.segmentQueues[e]=this.segmentQueues[e].filter(function(e){var i=e.getDuration(),o=e.getPlaybackTime(),s=e.getRepresentationId().representationId,u=e.isInit()||o<t||o+i>r;return n.logger.debug("[MSERenderer]["+s+"] Removing segment from queue ["+!u+"]. "+("Clearing from "+t+" to "+r+". Segment: [playbackTime="+e.getPlaybackTime()+", ")+("duration="+e.getDuration()+", url="+e.getUrl()+"]")),u}),this.getSourceStore().dispatch(g.setRendererRanges(e,this.getOverallBufferedRanges(e))))},e.prototype.removeData=function(e,t,r){if(null===this.mse)return Promise.reject(null);var n=void 0===t&&void 0===r;return n&&this.saveCurrentTime(),this.removeDataFromSegmentQueues(e,t,r),this.mse.removeFromBuffer(e,t,r)},e.prototype.getDroppedVideoFrames=function(){return this.video.droppedVideoFrames},e.prototype.setPlaybackSpeed=function(e){!isNaN(e)&&e>0&&e!==this.video.playbackRate&&(this.video.playbackRate=e)},e.prototype.getPlaybackSpeed=function(){return this.video.playbackRate||1},e.prototype.setVolume=function(e){isNaN(e)||(this.video.volume=Math.min(e/100,1))},e.prototype.getVolume=function(){return 100*this.video.volume},e.prototype.mute=function(){this.video.muted=!0},e.prototype.unmute=function(){this.video.muted=!1},e.prototype.isMuted=function(){return this.video.muted},e.prototype.play=function(){var e=this;return this.video.play()["catch"](function(t){if(e.isShutdownForPeriodSwitch)return e.ready();throw t})},e.prototype.pause=function(){this.video.pause()},e.prototype.end=function(){this.pause(),this.cancelSetCurrentTimeDelayed()},e.prototype.isPaused=function(){return this.video.paused},e.prototype.setDuration=function(e){null!==this.mse&&(e=Math.floor(1e4*e)/1e4,this.duration=e,this.mse.setDuration(e))},e.prototype.getDuration=function(){return this.video.duration},e.prototype.setCurrentTime=function(e){var t=this;if(null===this.mse)return Promise.reject("MSE is not open");if(e=Math.ceil(100*e)/100,this.setCurrentTimeContext){if(this.setCurrentTimeContext.time===e)return this.setCurrentTimeContext.promise;this.cancelSetCurrentTimeDelayed()}var r=Promise.resolve();this.isMSEOpen()||this.isInBufferSeek(e)||(this.logger.debug("reopen MSE on setCurrentTime"),r=this.reOpenMse());var n=r.then(function(){return t.setCurrentTimeInternal(e)["catch"](function(r){return t.logger.debug("could not set time "+e+" on video element",r),t.getCurrentTime()})["finally"](function(){return t.needsInitialSeek=!1})});return this.setCurrentTimeContext={time:e,isInitialSeek:this.needsInitialSeek,promise:n},n},e.prototype.getCurrentVideoTime=function(){return this.video.currentTime},e.prototype.getCurrentFallbackTime=function(){var e,t=this.setCurrentTimeContext;return t&&t.isInitialSeek&&t.time!==-1?this.setCurrentTimeContext.time:this.hasDataInSourceBuffers()||(null===(e=this.mse)||void 0===e?void 0:e.isBufferRemovalPending())?this.getCurrentVideoTime():this.currentTime},e.prototype.getCurrentTime=function(e){return e?this.getCurrentVideoTime():this.getCurrentFallbackTime()},e.prototype.getSnapshotData=function(e,t){void 0===t&&(t=1);try{var r=this.video.videoWidth,n=this.video.videoHeight;this.snapshotCanvas||(this.snapshotCanvas=document.createElement("canvas"),this.snapshotCanvas.id="snapshotHiddenCanvas"),this.snapshotCanvas.width=r,this.snapshotCanvas.height=n;var i=this.snapshotCanvas.getContext("2d");i.drawImage(this.video.getWrappedElement(),0,0,r,n);var o=void 0;return"image/jpeg"===e||"image/webp"===e?(t=Math.max(t,0),t=Math.min(t,1),o=this.snapshotCanvas.toDataURL(e,t)):o=this.snapshotCanvas.toDataURL(e,t),{height:n,width:r,data:o}}catch(s){return s&&s.message?this.logger.debug("Snapshot acquisition failed: "+s.message):this.logger.debug("Snapshot acquisition failed"),null}},e.prototype.getDrmShutdownPromise=function(){return this.drmService?this.drmService.shutdownPromise:Promise.resolve()},e.prototype.ready=function(){var e=this;return this.getDrmShutdownPromise().then(function(){return e.video.eventHandler.clearEventSuppression(m.MediaElementEvent.error),null===e.mse&&e.init(),e.readyPromise})},e.prototype.setTimestampOffset=function(e,t){var r=this;return null===this.mse?Promise.resolve():this.mse.setTimestampOffset(e,t).then(function(){r.timestampOffset[e]=t})},e.prototype.shutdown=function(e){if(void 0===e&&(e=!1),!this.mse)return this.readyPromise;this.isShutdownForPeriodSwitch=e,this.waitingForSeekedPromise=null,this.saveCurrentTime();for(var t in this.segmentQueues)this.segmentQueues.hasOwnProperty(t)&&(delete this.segmentQueues[t],this.getSourceStore().dispatch(g.setRendererRanges(t,[])));return this.mse.tearDownMediaSource(),this.mse=null,this.cancelSetCurrentTimeDelayed(),this.gapHandler&&(this.gapHandler.shutdown(),this.gapHandler=null),this.eventHandler&&!e&&(this.eventHandler.dispose(),this.eventHandler=null),this.quotaExceededMap.clear(),this.quotaExceededDeferredMap.clear(),this.readyPromise},e.prototype.release=function(){for(var e in this.segmentQueues)this.segmentQueues.hasOwnProperty(e)&&null!==this.mse&&(delete this.segmentQueues[e],this.getSourceStore().dispatch(g.setRendererRanges(e,[])));return this.sourceBufferMimeCodecMap.dispose(),this.mse&&this.mse.dispose(),this.readyPromise=Promise.resolve(),this.timestampOffset={},this.cancelSetCurrentTimeDelayed(),this.gapHandler&&(this.gapHandler.shutdown(),this.gapHandler=null),this.off(m.MediaElementEvent.webkitpresentationmodechanged,this.firePictureInPictureEvent),this.eventHandler&&(this.eventHandler.off(m.MediaElementEvent.timeupdate,this.resetConsecutiveErrorCountCallback),this.eventHandler.dispose(),this.eventHandler=null),this.waitingForSeekedPromise=null,this.playerEventHandler.off(d.PlayerEvent.PeriodSwitch,this.onPeriodSwitch),this.playerEventHandler.off(d.PlayerEvent.PeriodSwitched,this.onPeriodSwitched),this.playerEventHandler.off(d.PlayerEvent.Seek,this.onSeek),this.getDrmShutdownPromise()},e.prototype.on=function(e,t){this.eventHandler.on(e,t)},e.prototype.off=function(e,t){this.eventHandler&&this.eventHandler.off(e,t)},Object.defineProperty(e.prototype,"drmService",{get:function(){return this.context.serviceManager.get(a.ServiceName.DrmService)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentQueueMimeTypes",{get:function(){return Object.keys(this.segmentQueues)},enumerable:!0,configurable:!0}),e.prototype.setDrmConfig=function(e,t){return this.drmService.updateDrmConfig(e,t)},e.prototype.isMediaTypeSupported=function(e,t){return"MediaSource"in window&&MediaSource.isTypeSupported(e+'; codecs="'+t+'"')},e.prototype.cancelPendingEndOfStream=function(){this.setEndOfStreamDeferred&&(this.setEndOfStreamDeferred.reject(new Error("Cancelled pending end of stream.")),this.setEndOfStreamDeferred=null)},e.prototype.deferSetEndOfStream=function(){var e=this;return this.setEndOfStreamDeferred=this.setEndOfStreamDeferred||new h.Deferred,this.setEndOfStreamDeferred.promise.then(function(){return e.mse.endOfStream()})["catch"](function(t){e.context&&e.context.logger.debug(t)})},e.prototype.setEndOfStream=function(e){return void 0===e&&(e=!0),e?this.hasSourceBuffers()&&null!==this.mse?(this.setCurrentTimeDelayedContext&&this.setCurrentTimeDelayedContext.time>=this.duration&&this.cancelSetCurrentTimeDelayed(this.setCurrentTimeInternal(this.getEndOfBufferTime())),this.setCurrentTimeDelayedContext?this.deferSetEndOfStream():this.mse.endOfStream()):(this.logger.debug("Cannot signal EOS as no buffers have been added yet"),Promise.resolve()):(this.cancelPendingEndOfStream(),this.isMSEOpen()?Promise.resolve():this.reOpenMse())},e.prototype.isInBufferSeek=function(e){var t=this.getRangesInSourceBuffers(),r=this.getRangesPendingRemoval();for(var n in r){var o=r[n];if(o.start<=e&&o.end>=e)return!1}return!!t&&i.BufferRangeHelper.isInBufferedRange(t,e)},e.prototype.adjustTimeToNextCommonBufferStart=function(e){if(this.isInBufferSeek(e))return e;var t=this.getFutureBufferStarts(e);return 0===t.length?NaN:(e=Math.min.apply(null,t),this.logger.debug("adjust current time to buffer start: "+e),e)},e.prototype.getFutureBufferStarts=function(e){return i.BufferRangeHelper.getCommonBufferedRanges(this.getRangesInSourceBuffers()).filter(function(t){return t.getEnd()>=e&&!isNaN(t.getStart())}).map(function(e){return e.getStart()})},e.prototype.getRangesInSourceBuffers=function(){if(null===this.mse)return null;var e={};for(var t in this.segmentQueues)if(this.segmentQueues.hasOwnProperty(t)&&(e[t]=this.mse.getBufferedRanges(t),e[t].length<1))return null;return e},e.prototype.getRangesPendingRemoval=function(){if(null===this.mse||!this.mse.isBufferRemovalPending())return{};var e={};for(var t in this.segmentQueues)this.segmentQueues.hasOwnProperty(t)&&(e[t]=this.mse.getRangePendingRemoval(t)||{});return e},e.prototype.processSegmentQueues=function(){var e=this,t=this.segmentQueueMimeTypes.filter(function(t){return e.segmentQueues[t].length>0}).map(function(t){return e.addSegmentFromQueueToMse(t)});return 0===t.length?Promise.resolve():Promise.all(t).then(function(){return e.processSegmentQueues()})["catch"](function(e){if(e!==o.SOURCE_BUFFER_APPEND_STATUS.SUSPENDED)throw e})},e.prototype.getHeadOfQueue=function(e){return this.segmentQueues[e][0]},e.prototype.isMSEOpen=function(){return this.mse.readyState===E.MediaSourceReadyState.open},e.prototype.addSegmentFromQueueToMse=function(e){var t=this;if(null===this.mse)return Promise.resolve();this.isMSEOpen()||this.reOpenMse();var r=this.getHeadOfQueue(e),n=r.getRepresentationId().representationId,i=r.getUrl();return this.logger.debug("[MSERenderer]["+n+"] Scheduling appendage to buffer [url="+i+"]"),this.mse.addToBuffer(r).then(function(){var o=t.getHeadOfQueue(e),s=o!==r;if(t.logger.debug("[MSERenderer]["+n+"] Appended segment to buffer [url="+i+"]"),s){var u=t.segmentQueues[e][0],a=u?u.getUrl():"none";t.logger.debug("[MSERenderer]["+n+"] Skipping removal of [url="+i+"] "+("from segment queue as the queue head has unexpectedly changed to [url="+a+"]"))}else t.segmentQueues[e].shift();t.drmService&&t.hasDataInSourceBuffers()&&!t.periodSwitchOngoing&&t.drmService.signalInitDataShouldBeAvailable()})["catch"](function(r){if(r===o.SOURCE_BUFFER_APPEND_STATUS.FAILURE&&t.trackRendererError(),t.mse&&r===o.SOURCE_BUFFER_APPEND_STATUS.QUOTA_EXCEEDED){t.quotaExceededMap.set(e,!0),t.quotaExceededDeferredMap.has(e)||t.quotaExceededDeferredMap.set(e,new h.Deferred);
var n=t.quotaExceededDeferredMap.get(e);return t.mse.addOneUpdateEndCallback(e,n.resolve).then(function(){t.quotaExceededDeferredMap["delete"](e),t.context.logger.debug("Appending segment after quota has been exceeded...")}),n.promise.then(function(){return t.processSegmentQueues()})}return t.mse?t.mse.queueActionOnBuffer(e,function(){return t.processSegmentQueues()}):Promise.reject(r)})},e.prototype.cancelSetCurrentTimeDelayed=function(e){void 0===e&&(e=this.getCurrentTime()),this.setCurrentTimeDelayedContext&&(clearTimeout(this.setCurrentTimeDelayedContext.timeoutId),this.setCurrentTimeDelayedContext.promiseResolve(e),this.setCurrentTimeDelayedContext=null)},e.prototype.recoverFromExceededQuota=function(e){var t=this;this.segmentQueueMimeTypes.forEach(function(r){t.segmentQueues[r]=t.segmentQueues[r].filter(function(t){return t.getPlaybackTime()+t.getDuration()>=e}),t.getSourceStore().dispatch(g.setRendererRanges(r,t.getOverallBufferedRanges(r))),t.quotaExceededMap.set(r,!1)}),this.quotaExceededDeferredMap.forEach(function(e){return e.reject()}),this.quotaExceededDeferredMap.clear()},e.prototype.setCurrentTimeDelayed=function(e){var t=this;return this.logger.debug("delayed set time "+e+" on video element"),this.cancelSetCurrentTimeDelayed(),new Promise(function(r,n){t.setCurrentTimeDelayedContext={time:e,promiseReject:n,promiseResolve:r,timeoutId:setTimeout(function(){r(t.setCurrentTimeInternal(e))},l.toMilliSeconds(t.settings.SYNC_ON_SEEK_TIMEOUT))}})},e.prototype.resolvePendingEndOfStream=function(){this.setEndOfStreamDeferred&&(this.setEndOfStreamDeferred.resolve(),this.setEndOfStreamDeferred=null)},e.prototype.setCurrentTimeInternal=function(e){var t=this;if(null===this.mse)return Promise.reject("Couldn't set current time, MSE is not open");n(this.quotaExceededMap,function(e){return e})&&this.recoverFromExceededQuota(e);var r=this.mse.waitForBuffers().then(function(){return t.waitingForSeekedPromise}).then(function(){if(t.setCurrentTimeContext){if(t.setCurrentTimeContext.time!==e)return Promise.reject("A newer setting of change time has been scheduled.")}else t.setCurrentTimeContext={time:e,isInitialSeek:!1,promise:r};var n=t.adjustTimeToNextCommonBufferStart(e);return isNaN(n)?t.setCurrentTimeDelayed(e):(t.logger.debug("set time on video element to "+n),t.seekOnVideoElement(n).then(function(e){return t.cancelSetCurrentTimeDelayed(),t.resolvePendingEndOfStream(),e})["catch"](function(e){return t.handleVideoSetCurrentTimeError(n,e)})["finally"](function(){t.waitingForSeekedPromise=null,t.setCurrentTimeContext=null}))});return r},e.prototype.handleVideoSetCurrentTimeError=function(e,t){return this.logger.debug("failed to set current time",t),this.waitingForSeekedPromise=null,this.setCurrentTimeDelayed(e)},e.prototype.seekOnVideoElement=function(e){var t=this;return this.waitingForSeekedPromise=new Promise(function(r){t.video.currentTime=e,r(t.video.currentTime)}),this.waitingForSeekedPromise},e.prototype.saveCurrentTime=function(){this.setCurrentTimeContext?this.currentTime=this.setCurrentTimeContext.time:this.currentTime=this.getCurrentVideoTime()},e.prototype.recreateSourceBuffers=function(e){var t=this;return void 0===e&&(e=this.getCurrentTime()),this.shutdown().then(function(){return t.ready()}).then(function(){t.sourceBufferMimeCodecMap.forEach(function(e,r){var n=t.addBuffer(e,r);n||(t.context.logger.debug("Failed to create source buffer "+e),t.sourceBufferMimeCodecMap.remove(e))})}).then(function(){t.setCurrentTime(e).then(function(){return t.context.serviceManager.get(a.ServiceName.PlayerStateService).isPlaying()?t.play():Promise.resolve()})})},e.prototype.updateSegmentQueueMimeType=function(e){var t=this,r=p.MimeTypeHelper.getMediaType(e);this.segmentQueueMimeTypes.forEach(function(e){var n=p.MimeTypeHelper.getMediaType(e);n===r&&(delete t.segmentQueues[e],t.getSourceStore().dispatch(g.setRendererRanges(e,[])))}),this.segmentQueues[e]=[],this.getSourceStore().dispatch(g.setRendererRanges(e,[]))},e.prototype.addUpdateEndListenerToUpdateRendererRanges=function(e){var t=this;this.mse.addUpdateEndCallback(e,function(){return t.getSourceStore().dispatch(g.setRendererRanges(e,t.getOverallBufferedRanges(e)))})},e.prototype.changeBufferType=function(e,t){var r=this;return this.sourceBufferMimeCodecMap.has(e,t)?Promise.resolve({}):(this.sourceBufferMimeCodecMap.update(e,t),this.updateSegmentQueueMimeType(e),this.mse.isChangeTypeSupported()?this.mse.changeBufferType(e,t).then(function(){return r.addUpdateEndListenerToUpdateRendererRanges(e)}).then(function(){var r;return r={},r[e]=t,r}):this.recreateSourceBuffers().then(function(){return r.sourceBufferMimeCodecMap.entries()}))},e}();t.MSERenderer=R},277:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(9),i=function(){function e(){}return e.prototype.getSupportedTechnologies=function(){return[{player:n.PlayerType.Html5,streaming:n.StreamType.Dash},{player:n.PlayerType.Html5,streaming:n.StreamType.Hls},{player:n.PlayerType.Html5,streaming:n.StreamType.Smooth}]},e}();t.TechnologyChecker=i},543:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(21),i=r(22),o=r(16),s=r(5),u=function(){function e(e,t){this.mimeCodeMap={},this.store=e,this.settings=t}return e.prototype.ensureMetricsForMimeType=function(e){var t=i.getMetricsState(this.store.getState());t[e]||this.store.dispatch(n.initializeMetricsForMimeType(e,this.settings))},e.prototype.removeMetrics=function(e){this.store.dispatch(n.removeMetricsForMimeType(e))},e.prototype.add=function(e,t){this.mimeCodeMap[e]=t,this.ensureMetricsForMimeType(e),this.store.dispatch(n.addMetricsValue(e,o.MetricType.StalledSeconds,0))},e.prototype.remove=function(e){var t=this,r=s.MimeTypeHelper.getMediaType(e);Object.keys(this.mimeCodeMap).forEach(function(e){var n=s.MimeTypeHelper.getMediaType(e);n===r&&(t.removeMetrics(e),delete t.mimeCodeMap[e])})},e.prototype.has=function(e,t){var r=this,n=s.MimeTypeHelper.getMediaType(e),i=s.MimeTypeHelper.extractContainerType(e);return Object.keys(this.mimeCodeMap).some(function(o){var u=s.MimeTypeHelper.getMediaType(o),a=s.MimeTypeHelper.extractContainerType(o);return u===n&&a===i&&t===r.mimeCodeMap[e]})},e.prototype.update=function(e,t){this.remove(e),this.add(e,t)},e.prototype.forEach=function(e){var t=this;Object.keys(this.entries()).forEach(function(r){return e(r,t.entries()[r])})},e.prototype.entries=function(){return this.mimeCodeMap},e.prototype.dispose=function(){this.mimeCodeMap={},this.store=null,this.settings=null},e}();t.BufferMimeCodecMap=u},544:function(e,t,r){"use strict";function n(e,t){return e>t.start}function i(e,t,r){return!(e<=0)&&(r.start>t&&r.start-e<t)}function o(e,t){for(var r=0;r<e.length-1;r++)if(e.end(r)>t)return{start:e.end(r),end:e.start(r+1)};return null}Object.defineProperty(t,"__esModule",{value:!0});var s=r(1),u=r(23),a=r(47),d=r(14),f=r(158),c=[d.MediaElementEvent.seeking,d.MediaElementEvent.seeked,d.MediaElementEvent.pause,d.MediaElementEvent.playing,d.MediaElementEvent.error],h=5,p=10,l=250,m=.01,g=function(){function e(e){var t=this;this.checkIfWaiting=function(){t.context.isDisposed||t.video.paused||t.video.seeking&&!t.isAtEndOfBufferedRange(t.video.currentTime)||t.lastTimeupdate&&!(Date.now()-t.lastTimeupdate>1e3)||(t.consecutiveWaiting++,t.waiting())},this.waiting=function(){var e=a.getPlayerState(t.context.store.getState()),r=a.getIsSeeking(e)||t.video.seeking;r&&!t.isAtEndOfBufferedRange(t.video.currentTime)||t.setTimer()},this.onSeek=function(){t.gapAhead=null},this.timeupdate=function(){if(t.lastTimeupdate=Date.now(),!t.video.paused&&!t.video.seeking){t.hasPlayedAnythingYet=!0;var e=t.video.currentTime;if(t.shouldSkipGap(e))return t.skipGap(),void(t.gapAhead=null);var r=t.video.buffered;r.length>1&&!t.gapAhead?t.gapAhead=o(r,e):t.shouldTriggerWaitingEvent(e)?(t.consecutiveUpdates++,t.waiting()):e===t.lastRecordedTime?t.consecutiveUpdates++:(t.consecutiveUpdates=0,t.consecutiveWaiting=0,t.lastRecordedTime=e)}},this.cancelTimer=function(){t.consecutiveUpdates=0,t.consecutiveWaiting=0,clearTimeout(t.timer),t.timer=null},this.skipTheGap=function(e){var r=t.video.buffered,n=t.video.currentTime,i=f.Ranges.findNextRange(r,n);t.consecutiveUpdates=0,t.consecutiveWaiting=0,t.timer=null,0!==i.length&&n===e&&(t.context.logger.debug("skipTheGap: currentTime: "+n+" scheduled currentTime: "+e+" nextRange start: "+i.start(0)),t.setCurrentTime(i.start(0)+f.Ranges.TIME_FUDGE_FACTOR))},this.onPlaying=function(){t.hasPlayedAnythingYet=!0,t.context.eventHandler.off(s.PlayerEvent.Playing,t.onPlaying)},this.context=e,this.video=e.videoElement,this.consecutiveUpdates=0,this.consecutiveWaiting=0,this.hasPlayedAnythingYet=!1,this.gapAhead=null,this.video.addEventListener(d.MediaElementEvent.waiting,this.waiting),this.video.addEventListener(d.MediaElementEvent.timeupdate,this.timeupdate),this.context.eventHandler.on(s.PlayerEvent.Playing,this.onPlaying),this.context.eventHandler.on(s.PlayerEvent.Seek,this.onSeek);for(var r=0,n=c;r<n.length;r++){var i=n[r];this.video.addEventListener(i,this.cancelTimer)}this.timeupdateIntervalId=window.setInterval(this.checkIfWaiting,l)}return e.prototype.shouldSkipGap=function(e){return!!this.gapAhead&&(n(e,this.gapAhead)||i(this.context.settings.PROACTIVE_GAP_SKIP_DISTANCE_SECONDS,e,this.gapAhead))},e.prototype.shouldTriggerWaitingEvent=function(e){return this.consecutiveUpdates===h&&e===this.lastRecordedTime},e.prototype.skipGap=function(){var e=this.video.currentTime,t=Math.max(e+m,this.gapAhead.end);this.setCurrentTime(t),this.context.logger.debug("jumped buffer gap from "+e+" to "+t)},e.prototype.gapFromVideoUnderflow=function(e,t){for(var r=f.Ranges.findGaps(e),n=0;n<r.length;n++){var i=r.start(n),o=r.end(n);if(t-i<4&&t-i>2)return{start:i,end:o}}return null},e.prototype.setTimer=function(){if(!this.timer&&this.hasPlayedAnythingYet){var e=this.video.buffered,t=this.video.currentTime,r=f.Ranges.findNextRange(e,t);if(0!==r.length){var n=r.start(0)-t;this.context.logger.debug("setTimer: stopped at: "+t+", setting timer for:"+n+", seeking to:"+r.start(0)),this.timer=window.setTimeout(this.skipTheGap.bind(this),n,t)}else{var i=this.gapFromVideoUnderflow(e,t);if(i)this.context.logger.debug("setTimer: Encountered a gap in video from "+i.start+" to "+i.end+", seeking to current time "+t),this.consecutiveWaiting=0,this.setCurrentTime(t);else if(this.consecutiveWaiting>p){this.context.logger.debug("currentTime not advancing although the video element is neither paused nor seeking"),this.context.eventHandler.dispatchEvent(u.InternalEvent.CurrentTimeNotAdvancing,void 0,!0);var o=this.video.buffered,s=!1,a=1/0;this.consecutiveWaiting=0;for(var d=0;d<o.length;d++){var c=o.start(d),h=o.end(d),l=t+2*f.Ranges.TIME_FUDGE_FACTOR;if(s&&!isFinite(a)){a=c;break}c<t&&h>t&&l>h&&(s=!0)}s&&isFinite(a)?(this.context.logger.debug("playback stalled at very small gap, skipping it by seeking to "+a),this.setCurrentTime(a)):this.context.settings.QJY_BROWSER_WORKAROUND?this.setCurrentTime(t+m):t>this.video.duration?this.setCurrentTime(this.video.duration):this.setCurrentTime(t)}}}},e.prototype.isAtEndOfBufferedRange=function(e){for(var t=this.video.buffered,r=0;r<t.length;r++)if(t.end(r)===e)return!0;return!1},e.prototype.shutdown=function(){this.video.removeEventListener(d.MediaElementEvent.waiting,this.waiting),this.video.removeEventListener(d.MediaElementEvent.timeupdate,this.timeupdate),this.context.eventHandler.off(s.PlayerEvent.Playing,this.onPlaying),this.context.eventHandler.off(s.PlayerEvent.Seek,this.onSeek);for(var e=0,t=c;e<t.length;e++){var r=t[e];this.video.removeEventListener(r,this.cancelTimer)}clearInterval(this.timeupdateIntervalId),this.cancelTimer(),this.waiting=null,this.timeupdate=null},e.prototype.setCurrentTime=function(e){if(this.video.currentTime!==e)try{this.video.currentTime=e}catch(t){this.context.logger.debug("GapHandler failed to set currentTime on video element to "+e,t)}},e}();t.GapHandler=g},545:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),i=r(276),o=r(157),s=r(158),u=r(277);t.MSERendererModuleDefinition={name:n.ModuleName.RendererMse,module:{MSEWrapper:o.MSEWrapper,MSERenderer:i.MSERenderer,Ranges:s.Ranges,technologyChecker:new u.TechnologyChecker}},t["default"]=t.MSERendererModuleDefinition},546:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.value=e}return e}(),i=function(){function e(){this.count=0}return Object.defineProperty(e.prototype,"length",{get:function(){return this.count},enumerable:!0,configurable:!0}),e.prototype.dequeue=function(){if(0!==this.count){var e=this.last;return this.last=e.previous,e.previous=null,e.next=null,this.count--,e.value}},e.prototype.enqueue=function(e){if(0===this.count){var t=new n(e);this.first=t,this.last=t}else{var r=this.first;this.first=new n(e),this.first.next=r,r.previous=this.first}this.count++},e.prototype.isEmpty=function(){return 0===this.length},e}();t.LinkedListQueue=i},547:function(e,t,r){"use strict";function n(e){for(var t=[],r=0;r<e.length;r++)t.push({start:e.start(r),end:e.end(r)});return t}Object.defineProperty(t,"__esModule",{value:!0});var i=r(11),o=r(546),s=function(){function e(e){var t=this;this.onUpdateSuccess=function(){t.updateExposedBufferRanges();for(var e;null!=(e=t.pendingUpdateEndedPromises.dequeue());)e.resolve()},this.onUpdateError=function(e){for(var r;null!=(r=t.pendingUpdateEndedPromises.dequeue());)r.reject(e)},this.ready=function(){return t.buffer.updating?t.onUpdateEnded():Promise.resolve()},this.buffer=e,this.bufferedRanges=[],this.queuePromise=Promise.resolve(),this.pendingUpdateEndedPromises=new o.LinkedListQueue,["error","abort","sourceended","sourceclose"].forEach(function(e){t.buffer.addEventListener(e,t.onUpdateError)}),this.buffer.addEventListener("updateend",this.onUpdateSuccess)}return e.prototype.updateExposedBufferRanges=function(){try{this.bufferedRanges=n(this.buffer.buffered)}catch(e){}},e.prototype.onUpdateEnded=function(){var e=new i.Deferred;return this.pendingUpdateEndedPromises.enqueue(e),e.promise},e.prototype.queueAction=function(e){var t=this,r=this.queuePromise.then(function(){return t.ready()}).then(function(){return Promise.resolve(e()).then(function(){return t.ready()})});return this.queuePromise=r["catch"](function(){}),r},e.prototype.changeType=function(e){this.buffer.changeType(e)},e.prototype.dispose=function(){var e=this;["error","abort","sourceended","sourceclose"].forEach(function(t){e.buffer.removeEventListener(t,e.onUpdateError)}),this.buffer.removeEventListener("updateend",this.onUpdateSuccess)},e}();t.SourceBufferWrapper=s},548:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){var t=this;this.addTimeToEvent=function(e){return e.time=t.video&&t.video.currentTime||0,e},this.video=e}return e.prototype.on=function(e,t){this.video&&this.video.addEventListener(e,t,this.addTimeToEvent)},e.prototype.off=function(e,t){this.video&&this.video.removeEventListener(e,t)},e.prototype.fire=function(e,t){this.video&&this.video.eventHandler.triggerEvent(e,t)},e.prototype.dispose=function(){},e}();t.VideoEventHandler=n}},[545])});
})();
