/**************************************************************************** 
 * Copyright (C) 2021, Bitmovin, Inc., All Rights Reserved 
 * 
 * This source code and its use and distribution, is subject to the terms 
 * and conditions of the applicable license agreement. 
 * 
 * Bitmovin Player Version 8.60.0 
 * 
 ****************************************************************************/
(function() {
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.subtitles=t():(e.bitmovin=e.bitmovin||{},e.bitmovin.player=e.bitmovin.player||{},e.bitmovin.player.subtitles=t())}(this,function(){return webpackJsonpbitmovin_player__name_([9],{104:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(1),i=n(2),o=n(0),a=n(548),s=function(){function e(){}return e.createInstance=function(e,t){var n;if(t.indexOf("<?")>-1||t.indexOf("<tt")>-1)if(i.ModuleManager.has(o.ModuleName.SubtitlesTTML)){var s=i.ModuleManager.get(o.ModuleName.SubtitlesTTML).TTMLParser;n=new s(e)}else e.eventHandler.dispatchEvent(r.PlayerEvent.Warning,new a.ModuleMissingWarning(o.ModuleName.SubtitlesTTML));else if(i.ModuleManager.has(o.ModuleName.SubtitlesWebVTT)){var u=i.ModuleManager.get(o.ModuleName.SubtitlesWebVTT);n=new u.WebVttParser}else e.eventHandler.dispatchEvent(r.PlayerEvent.Warning,new a.ModuleMissingWarning(o.ModuleName.SubtitlesWebVTT));return n},e}();t.SubtitleParserFactory=s},128:function(e,t,n){"use strict";function r(e,t){var n=i({subtitleId:t,start:e.start,end:e.end},e.content);return n}var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(1),s=n(116),u=n(2),l=n(0),c=function(){function e(e,t,n){var i=this;void 0===n&&(n=null),this.onCueEnter=function(e){i.context.eventHandler.dispatchEvent(a.PlayerEvent.CueEnter,r(e,i.getSubtitle().id))},this.onCueExit=function(e){i.context.eventHandler&&i.context.eventHandler.dispatchEvent(a.PlayerEvent.CueExit,r(e,i.getSubtitle().id))},this.onCueUpdate=function(e){i.context.eventHandler.dispatchEvent(a.PlayerEvent.CueUpdate,r(e,i.getSubtitle().id))},this.context=e,this.subtitle=t,this.subtitle.enabled=this.subtitle.enabled||!1,this.timeline=new s.Timeline(e,{onCueEnter:this.onCueEnter,onCueExit:this.onCueExit,onCueUpdate:this.onCueUpdate}),this.timeline.stopListening(),this.periodId=n,this.sourceStore=e.serviceManager.get(o.ServiceName.SourceStoreService,e.sourceContext.sourceIdentifier)}return e.prototype.fireOnCueParsedEvents=function(e,t){var n=this;e&&this.context.eventHandler&&e.forEach(function(e){n.context.eventHandler.dispatchEvent(a.PlayerEvent.CueParsed,i(i({subtitleId:n.getSubtitle().id},e),{periodId:t}))})},e.prototype.isActive=function(){return this.subtitle.enabled},e.prototype.activate=function(){return this.subtitle.enabled=!0,this.timeline.startListening(),this.timeline.show(),Promise.resolve()},e.prototype.deactivate=function(){return this.subtitle.enabled=!1,this.timeline.stopListening(),this.timeline.hide(),Promise.resolve()},e.prototype.getSubtitle=function(){return this.subtitle},e.prototype.clearBuffersUntil=function(e){this.timeline.removeCuesUntil(e)},e.prototype.dispose=function(){this.sourceStore=null,this.deactivate(),this.timeline.dispose()},e.prototype.isTsContainer=function(){var e=u.ModuleManager.get(l.ModuleName.EngineBitmovin),t=e.selectors,n=e.mseModuleTypes;return t.getContainerFormat(this.sourceStore.getState())===n.containerFormat.TS},e.prototype.isSegmentMissingPlaybackTime=function(e){return e&&null==e.getPlaybackTime()},e.prototype.applyVttOffset=function(e,t){return this.isTsContainer()||this.isSegmentMissingPlaybackTime(t)?e.map(function(e){return null!=e.offset?i(i({},e),{start:e.start+e.offset,end:e.end+e.offset,updates:e.updates.map(function(t){return i(i({},t),{updateTime:t.updateTime+e.offset})})}):e}):e},e}();t.AbstractSubtitleHandler=c},280:function(e,t,n){"use strict";function r(e){return i(e.replace(/<br\s*\/?>/g,"\n"))}function i(e){return e.replace(/<[^>]*>?/g,"")}Object.defineProperty(t,"__esModule",{value:!0}),t.htmlToText=r,t.stripHtmlTags=i},281:function(e,t,n){"use strict";var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var i=n(1),o=function(){function e(){}return e.build=function(e){return new(function(){function t(){}return t.prototype.add=function(t){e.addSubtitle(t)},t.prototype.remove=function(t){e.removeSubtitle(t)},t.prototype.list=function(){return e.listSubtitles()},t.prototype.enable=function(t,n){void 0===n&&(n=!0),e.enableSubtitle(t,n)},t.prototype.disable=function(t){e.disableSubtitle(t)},t.prototype.cueEnter=function(t){e.fireEvent(i.PlayerEvent.CueEnter,r(r({},t),{type:i.PlayerEvent.CueEnter}))},t.prototype.cueExit=function(t){e.fireEvent(i.PlayerEvent.CueExit,r(r({},t),{type:i.PlayerEvent.CueExit}))},t}())},e}();t.PlayerSubtitlesApiFactory=o},282:function(e,t,n){"use strict";function r(e){return e.type===s.PlayerEvent.Seek}var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=n(3),a=n(15),s=n(1),u=n(21),l=n(28),c=n(5),d=n(2),f=n(0),p=n(544),h=n(545),v=n(553),b=n(554),g=n(555),S=n(94),m=n(550),y=function(){function e(e){var t=this;this.getTransmuxer=function(){return t.transmuxer},this.onDiscontinuitySequenceNumberChanged=function(){t.resetCaptionExtractor()},this.onSeek=function(e){t.resetCaptionExtractor();var n=e.position,i=r(e)?e.seekTarget:e.target;Object.keys(t.subtitleHandlers).forEach(function(e){return t.subtitleHandlers[e].onSeek(n,i)})},this.handlePeriodUpdate=function(e,n){var r=t.manifestService.findPeriod(e);r&&(t.adjustSubtitleHandlersForNewPeriod(e,n),t.setupControllersForNextPeriod(r),t.reactivateAfterSwitched())},this.reset=function(){Object.keys(t.subtitleHandlers).forEach(function(e){return t.subtitleHandlers[e].dispose()}),t.subtitleHandlers={},t.cea608Extractor&&(t.cea608Extractor.dispose(),t.cea608Extractor=null),t.discontinuitySequenceNumberTracker&&t.discontinuitySequenceNumberTracker.reset()},this.context=e,this.subtitleHandlers={},this.eventHandler=e.eventHandler,this.manifestService=e.serviceManager.get(o.ServiceName.ManifestService,e.sourceContext.sourceIdentifier),this.transmuxer=null,this.enabledSubtitlesTracker=new p.EnabledSubtitlesTracker,this.forcedSubtitleController=new h.ForcedSubtitleController,this.eventHandler.on(s.PlayerEvent.Seek,this.onSeek),this.eventHandler.on(s.PlayerEvent.TimeShift,this.onSeek),this.eventHandler.on(s.PlayerEvent.SourceUnloaded,this.reset),this.subscribeToPeriodSwitch()}return e.prototype.shouldReactToPeriodUpdate=function(e,t){var n=e!==t,r=this.manifestService.isHlsManifest()&&!(t||!e);return n||r},e.prototype.subscribeToPeriodSwitch=function(){var e=this,t=this.context.serviceManager.get(o.ServiceName.SourceStoreService,this.context.sourceContext.sourceIdentifier);this.unsubscibeFromPeriodSwitch=l.subscribe(t)(d.ModuleManager.get(f.ModuleName.EngineBitmovin).selectors.getPlayingPeriodId,this.handlePeriodUpdate,function(t,n){return e.shouldReactToPeriodUpdate(t,n)})},e.prototype.setupControllersForNextPeriod=function(e){var t=this,n=d.ModuleManager.get(f.ModuleName.EngineBitmovin).getMimeTypeForAdaptationSet;e.AdaptationSet.forEach(function(e){var r=n(e),i=m.isSubtitleTrack(r,t.manifestService.isHlsManifest());i&&t.setupControllerForSubtitleAdaptationSet(e,r)})},e.prototype.setupControllerForSubtitleAdaptationSet=function(e,t){return m.isFragmentedAdaptationSet(e)?(this.context.store.dispatch(u.initializeMetricsForMimeType(t,this.context.settings)),void this.addFragmentedSubtitleTrack(e,t)):void this.addExternalSubtitleTrack(e,t)},e.prototype.addFragmentedSubtitleTrack=function(e,t){var n=this.context.sourceContext.sourceIdentifier,r={mimeType:t,codec:d.ModuleManager.get(f.ModuleName.EngineBitmovin).getCodecsFromAdaptationSet(e),isHls:this.manifestService.isHlsManifest(),manifestLoader:this.context.serviceManager.get(o.ServiceName.ManifestLoadingService,n),periodId:this.manifestService.getFirstPeriod()._id};this.addFragmentSubtitle(r,e)},e.prototype.addExternalSubtitleTrack=function(e,t){if(d.ModuleManager.has(f.ModuleName.DASH)){var n=d.ModuleManager.get(f.ModuleName.DASH),r=new n.SegmentTemplateMPDHandler(this.context),i=this.manifestService.toSubtitleTrack(e,t);r.setAdaptationSetId(e._internalId),i.url=r.getSubtitleUrl().toString(),this.addExternalSubtitle(i,e)}},e.prototype.setTransmuxer=function(e){this.transmuxer=e},e.prototype.hasSubtitle=function(e){return Boolean(this.subtitleHandlers[e])},e.prototype.enableSubtitle=function(e){var t=this,n=this.subtitleHandlers[e];return n&&!n.isActive()?n.activate().then(function(){return t.forcedSubtitleController.deactivate()}).then(function(){return t.enabledSubtitlesTracker.addSubtitle(n.getSubtitle()),!0})["catch"](function(){return!1}):Promise.resolve(!1)},e.prototype.addExternalSubtitle=function(e,t){void 0===t&&(t=null),e.id||(e.id=e.url);var n=new b.ExternalFileSubtitleHandler(this.context,e,t);return this.reactivateHandler(n),e},e.prototype.reactivateHandler=function(e){var t=e.getSubtitle(),n=this.context.config.playback.isForcedSubtitle,r="function"==typeof n?n(t):t.forced;if(r)return void this.forcedSubtitleController.addSubtitleHandler(e);var i=!1,o=t.id;this.subtitleHandlers[o]&&(i=this.subtitleHandlers[o].isActive(),this.removeSubtitleHandler(o)),this.addSubtitleHandler(e),i&&e.activate()},e.prototype.addSubtitleHandler=function(e){var t=e.getSubtitle();this.applyLabelFunctionForSubtitle(t),this.subtitleHandlers[t.id]=e,this.signalNewSubtitle(t)},e.prototype.applyLabelFunctionForSubtitle=function(e){var t,n,r,i,o=this.context.sourceContext.source.labeling,a=this.manifestService.isHlsManifest()?null===(n=null===(t=o)||void 0===t?void 0:t.hls)||void 0===n?void 0:n.subtitles:null===(i=null===(r=o)||void 0===r?void 0:r.dash)||void 0===i?void 0:i.subtitles;"function"==typeof a&&(e.label=a(e))},e.prototype.addFragmentSubtitle=function(e,t){if(!d.ModuleManager.has(f.ModuleName.EngineBitmovin))return null;var n=this.manifestService.toSubtitleTrack(t,e.mimeType);n.isFragmented=!0,n.url=null;var r=new g.FragmentedSubtitleHandler(this.context,e,n,this.getTransmuxer);return this.reactivateHandler(r),n},e.prototype.setupCea608CaptionExtractor=function(e){if(d.ModuleManager.has(f.ModuleName.SubtitlesCEA608)){this.cea608Extractor&&this.cea608Extractor.dispose();var t=d.ModuleManager.get(f.ModuleName.SubtitlesCEA608).Cea608Extractor;return this.cea608Extractor=new t(e),this.cea608Extractor}return null},e.prototype.resetCaptionExtractor=function(){this.cea608Extractor&&this.cea608Extractor.reset()},e.prototype.createDiscontinuitySequenceNumberTracker=function(){var e=d.ModuleManager.get(f.ModuleName.HLS);this.discontinuitySequenceNumberTracker=new e.DiscontinuitySequenceNumberTracker(c.MimeTypeHelper.isVideo),this.discontinuitySequenceNumberTracker.subscribe(this.onDiscontinuitySequenceNumberChanged)},e.prototype.trackDiscontinuitySequenceNumber=function(e){this.discontinuitySequenceNumberTracker||this.createDiscontinuitySequenceNumberTracker(),this.discontinuitySequenceNumberTracker.trackSegment(e)},e.prototype.shouldDiscontinuitySequenceNumberBeTracked=function(){return this.manifestService.getManifest()&&this.manifestService.isHlsManifest()&&d.ModuleManager.has(f.ModuleName.HLS)},e.prototype.handleClosedCaptions=function(e,t,n,r,i){return void 0===i&&(i=""),!r&&c.MimeTypeHelper.isVideo(t.getMimeType())&&i.toLowerCase().includes("avc")?this.extractCaptionsFromSegment(t,e.getTimestampOffset()):(this.addClosedCaptions(n,t.getPeriodId()),Promise.resolve())},e.prototype.extractCaptionsFromSegment=function(e,t){var n=this;return this.cea608Extractor?(this.shouldDiscontinuitySequenceNumberBeTracked()&&this.trackDiscontinuitySequenceNumber(e),this.cea608Extractor.extract(e).then(function(r){var i=r.map(function(e){return{start:e.startTime-t,end:e.endTime-t,text:e.text,channel:e.channel,position:e.position}});i.length>0&&n.addClosedCaptions(i,e.getPeriodId())})["catch"](function(e){})):Promise.resolve()},e.prototype.addClosedCaptions=function(e,t){if(e&&Array.isArray(e)&&0!==e.length)for(var n=this.manifestService.getClosedCaptionLabels(t),r=function(e){var r=e.channel,o=i.subtitleHandlers[r];if(!o){var a=n.find(function(e){return e.id===r}),s=a||{id:r,kind:"captions",lang:"unknown",label:"Captions ("+e.channel+")"};i.addSubtitleHandler(new v.Cea608Handler(i.context,s))}i.subtitleHandlers[r].addCaption(e,t)},i=this,o=0,a=e;o<a.length;o++){var s=a[o];r(s)}},e.prototype.signalNewSubtitle=function(e){this.eventHandler.dispatchEvent(s.PlayerEvent.SubtitleAdded,{subtitle:i({},e)})},e.prototype.disableSubtitle=function(e){var t=this,n=this.subtitleHandlers[e];return n?n.deactivate().then(function(){return t.enabledSubtitlesTracker.removeSubtitle(e),0===t.getActiveSubtitles().length&&t.forcedSubtitleController.activate()["catch"](function(){}),!0})["catch"](function(){return!1}):Promise.resolve(!1)},e.prototype.removeSubtitle=function(e){this.removeSubtitleHandler(e),this.enabledSubtitlesTracker.removeSubtitle(e)},e.prototype.getActiveSubtitles=function(){var e=this;return Object.keys(this.subtitleHandlers).filter(function(t){return e.subtitleHandlers[t].isActive()}).map(function(t){return e.subtitleHandlers[t].getSubtitle()})},e.prototype.getAvailableSubtitles=function(e){return Object.values(this.subtitleHandlers).filter(function(t){var n=t.periodId;return!n||e===n}).map(function(e){return e.getSubtitle()})},e.prototype.enableForcedSubtitle=function(e){this.forcedSubtitleController.activate(e)["catch"](function(){})},e.prototype.shouldRemoveSubtitleHandler=function(e,t,n){var r=e.getSubtitleType()===S.SubtitleType.FRAGMENTED&&e.periodId===n,i=e.getSubtitleType()===S.SubtitleType.EXTERNAL_FILE&&e.periodId&&e.periodId!==t;return r||i},e.prototype.adjustSubtitleHandlersForNewPeriod=function(e,t){var n=this;Object.keys(this.subtitleHandlers).forEach(function(r){var i=n.subtitleHandlers[r];n.shouldRemoveSubtitleHandler(i,e,t)&&n.removeSubtitleHandler(r)})},e.prototype.reactivateAfterSwitched=function(){var e=this;Object.keys(this.subtitleHandlers).forEach(function(t){var n=e.subtitleHandlers[t];if(!n.isActive()){var r=e.enabledSubtitlesTracker.shouldEnableSubtitle(n.getSubtitle(),e.subtitleHandlers);if(r){var i={subtitle:n.getSubtitle()};e.eventHandler.dispatchEvent(s.PlayerEvent.SubtitleEnable,i),n.activate().then(function(){e.eventHandler.dispatchEvent(s.PlayerEvent.SubtitleEnabled,i)})}}})},e.prototype.removeSubtitleHandler=function(e){if(this.subtitleHandlers[e]){var t=this.subtitleHandlers[e].getSubtitle();this.subtitleHandlers[e].dispose(),delete this.subtitleHandlers[e],this.eventHandler&&this.eventHandler.dispatchEvent(s.PlayerEvent.SubtitleRemoved,{subtitle:t})}},e.prototype.clearBuffersUntil=function(e){var t=this;Object.keys(this.subtitleHandlers).forEach(function(n){return t.subtitleHandlers[n].clearBuffersUntil(e)})},e.prototype.dispose=function(){this.reset(),this.enabledSubtitlesTracker=a.dispose(this.enabledSubtitlesTracker),this.forcedSubtitleController=a.dispose(this.forcedSubtitleController),this.discontinuitySequenceNumberTracker=a.dispose(this.discontinuitySequenceNumberTracker),this.transmuxer=null,this.manifestService=null,this.eventHandler.off(s.PlayerEvent.Seek,this.onSeek),this.eventHandler.off(s.PlayerEvent.TimeShift,this.onSeek),this.eventHandler.off(s.PlayerEvent.SourceUnloaded,this.reset),this.unsubscibeFromPeriodSwitch(),this.subtitleHandlers={},this.eventHandler=null,this.context=null},e}();t.SubtitleService=y,t.isSeekEvent=r},544:function(e,t,n){"use strict";function r(e,t){return Object.keys(t).find(function(n){var r=t[n].getSubtitle(),i=r.id,o=r.lang,a=r.isFragmented,s=r.kind,u=i===e.id,l=!e.isFragmented||a===e.isFragmented,c=o===e.lang;e.isPreferred&&e.lang&&(c=o.includes(e.lang)||e.lang.includes(o));var d=s===e.kind&&c&&l;return u||d})}var i=this&&this.__assign||function(){return i=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},i.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=function(){function e(){this.enabledSubtitles={},this.idCounter=0}return e.prototype.addSubtitle=function(e){this.removeSubtitle(e.id),this.enabledSubtitles[this.getNextId()]=i({isFragmented:!1},e)},e.prototype.removeSubtitle=function(e){var t=this;Object.keys(this.enabledSubtitles).forEach(function(n){t.enabledSubtitles[n].id===e&&delete t.enabledSubtitles[n]})},e.prototype.shouldEnableSubtitle=function(e,t){var n=this,r=Object.keys(this.enabledSubtitles).find(function(r){var i=n.getTargetSubtitleIdForPeriod(n.enabledSubtitles[r],t);return i===e.id});return Boolean(r)},e.prototype.getTargetSubtitleIdForPeriod=function(e,t){var n=e.id,i=e.kind,o=e.lang,a=e.isFragmented;return r({lang:o,kind:i,isFragmented:a,id:n},t)||r({lang:o,kind:i,isFragmented:a},t)||r({lang:o,kind:i},t)},e.prototype.getNextId=function(){return this.idCounter++,this.idCounter},e.prototype.dispose=function(){this.enabledSubtitles={},this.idCounter=0},e}();t.EnabledSubtitlesTracker=o},545:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.subtitleHandlers={}}return e.prototype.addSubtitleHandler=function(e){this.subtitleHandlers[e.getSubtitle().id]=e},e.prototype.deactivate=function(){return this.hasForcedSubtitles()?Promise.all(Object.values(this.subtitleHandlers).map(function(e){return e.deactivate()})).then(function(){}):Promise.resolve()},e.prototype.activate=function(e){var t=this;return void 0===e&&(e=this.currentLang),this.hasForcedSubtitles()?(this.currentLang=e,this.deactivate().then(function(){var e=Object.values(t.subtitleHandlers).find(function(e){return e.getSubtitle().lang===t.currentLang});if(e&&!e.isActive())return e.activate()["catch"](function(){})})):Promise.resolve()},e.prototype.dispose=function(){Object.values(this.subtitleHandlers).forEach(function(e){return e.dispose()}),this.subtitleHandlers=null},e.prototype.hasForcedSubtitles=function(){return Object.keys(this.subtitleHandlers).length>0},e}();t.ForcedSubtitleController=r},546:function(e,t,n){"use strict";function r(e,t){var n=e.getTimescale();if(void 0===n||!d.ModuleManager.has(f.ModuleName.ContainerMP4))return[];var r=d.ModuleManager.get(f.ModuleName.ContainerMP4),o=r.getMp4Fragments(e),a=o.flatMap(function(n){return r.getTrackSamples(n.moof,n.mdat,e,t)});return i(a,e,n)}function i(e,t,n){var r=0,i=[];return e.forEach(function(e){var a=l.CodecStringHelper.extractCodec(t.getCodec()),s=e.duration/n,u=t.getPlaybackTime()+r,c=u+s;r+=s;var d=o(e,a);d&&i.push({start:u,end:c,text:d})}),i}function o(e,t){return"wvtt"===t?s(e):"stpp"===t?a(e):void 0}function a(e){var t=new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength);return u.ArrayHelper.convertBufferSourceToUTF8(t,c.TextSegmentAnalyzer.detectEncoding(e.data))}function s(e){for(var t=e.data.buffer,n=e.data.byteOffset,r=0;r<e.data.byteLength;){var i=e.data.getUint32(r),o=n+r,a=u.ArrayHelper.convertBufferSourceToUTF8(new Uint8Array(t,o+4,4));if("payl"===a)return u.ArrayHelper.convertBufferSourceToUTF8(new Uint8Array(t,o+8,i-8));r+="vttc"!==a?i:8}}Object.defineProperty(t,"__esModule",{value:!0});var u=n(8),l=n(26),c=n(88),d=n(2),f=n(0);t.parseMP4WrappedSubtitles=r},547:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0),i=n(280),o=n(281),a=n(104),s=n(282);t.SubtitleModuleDefinition={name:r.ModuleName.Subtitles,module:function(){return{SubtitleService:s.SubtitleService,SubtitleParserFactory:a.SubtitleParserFactory,PlayerSubtitlesApiFactory:o.PlayerSubtitlesApiFactory,HtmlTransformer:i}},dependencies:[r.ModuleName.EngineBitmovin]},t["default"]=t.SubtitleModuleDefinition},548:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(20),o=n(18),a=function(e){function t(t){var n=e.call(this,o.WarningCode.MODULE_MISSING)||this;return n.message=o.WarningCode[n.code]+t,n}return r(t,e),t}(i.PlayerWarning);t.ModuleMissingWarning=a},549:function(e,t,n){"use strict";function r(e){var t,n,r=o.TextSegmentAnalyzer.detectEncoding(e.getData()),a=i.ArrayHelper.convertBufferSourceToUTF8(e.getData(),r),s=(t=e.getPlaybackTime(),null!==t&&void 0!==t?t:0),u=(n=e.getDuration(),null!==n&&void 0!==n?n:0),l=s+u;return[{start:s,end:l,text:a}]}Object.defineProperty(t,"__esModule",{value:!0});var i=n(8),o=n(88);t.parsePlainTextSubtitles=r},550:function(e,t,n){"use strict";function r(e,t){return(o.MimeTypeHelper.isText(e)||o.MimeTypeHelper.isTtmlXml(e))&&!t||o.MimeTypeHelper.isApplication(e)}function i(e){var t=[e];return e.Representation&&e.Representation.length>0&&t.push(e.Representation[0]),t.some(function(e){return e.SegmentList||e.SegmentTemplate||e.SegmentBase})}Object.defineProperty(t,"__esModule",{value:!0});var o=n(5);t.isSubtitleTrack=r,t.isFragmentedAdaptationSet=i},553:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(128),o=n(94),a=function(e){function t(t,n,r){return void 0===r&&(r=null),e.call(this,t,n,r)||this}return r(t,e),t.prototype.onSeek=function(e,t){var n=t<e,r=this.context.settings.CLEAR_BUFFERS_ON_SEEKING_BACKWARDS;n&&r&&this.clearBuffersUntil(this.context.renderer.getDuration())},t.prototype.addCaption=function(e,t){e&&(this.fireOnCueParsedEvents([e],t),this.timeline.addCues([e],0))},t.prototype.getSubtitleType=function(){return o.SubtitleType.IN_STREAM},t}(i.AbstractSubtitleHandler);t.Cea608Handler=a},554:function(e,t,n){"use strict";var r=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}();Object.defineProperty(t,"__esModule",{value:!0});var i=n(20),o=n(18),a=n(15),s=n(1),u=n(17),l=n(13),c=n(104),d=n(128),f=n(94),p=function(e){function t(n,r,i){var o=e.call(this,n,r,i&&i._internalId.periodId)||this;return o.onFileLoaded=function(e){if(o.timeline.removeCues(),e.body){o.isFileLoaded=!0;var t=o.parse(e.body.trim()),n=o.applyVttOffset(t);o.fireOnCueParsedEvents(n,null),o.timeline.addCues(n)}},i&&(r.id=i.Representation[0]._id),r.url?(o.externalFileUrl=t.enforceHTTPSForSecureOrigins(r.url.trim()),o.isFileLoaded=!1,o.subtitleLoader=new u.DefaultContentLoader(o.context,{maxRetries:o.context.settings.MAX_RETRIES,retryDelay:o.context.settings.RETRY_DELAY,requestType:l.HttpRequestType.MEDIA_SUBTITLES})):(o.isFileLoaded=!0,o.loadPromise=Promise.resolve()),o}return r(t,e),t.prototype.activate=function(){var t=this;return e.prototype.activate.call(this),Promise.resolve().then(function(){return t.loadPromise?t.loadPromise:t.isFileLoaded?void 0:(t.loadPromise=t.subtitleLoader.load(t.externalFileUrl).then(t.onFileLoaded)["catch"](function(e){throw t.context.eventHandler&&t.context.eventHandler.dispatchEvent(s.PlayerEvent.Warning,new i.PlayerWarning(o.WarningCode.NETWORK_COULD_NOT_LOAD_SUBTITLE)),t.deactivate(),t.loadPromise=null,"loading failed"}),t.loadPromise)})},t.prototype.parse=function(e){var t=c.SubtitleParserFactory.createInstance(this.context,e);return t.parse(e)},t.enforceHTTPSForSecureOrigins=function(e){var t=new RegExp("^(?:[a-z]+:)?//","i");return"https:"===location.protocol?e.replace(t,"//"):e},t.prototype.getSubtitleType=function(){return f.SubtitleType.EXTERNAL_FILE},t.prototype.clearBuffersUntil=function(){},t.prototype.onSeek=function(){},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.subtitleLoader=a.dispose(this.subtitleLoader)},t}(d.AbstractSubtitleHandler);t.ExternalFileSubtitleHandler=p},555:function(e,t,n){"use strict";function r(e){return p.TextSegmentAnalyzer.isPlainTextPayload(e.getData())}function i(e){var t=e.getCodec();return("wvtt"===t||""===t&&e.getMimeType().includes("vtt"))&&r(e)}function o(e){return f.MimeTypeHelper.isApplication(e.getMimeType())&&!r(e)}var a=this&&this.__extends||function(){var e=function(t,n){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(t,n)};return function(t,n){function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++){t=arguments[n];for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i])}return e},s.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var u=n(3),l=n(1),c=n(23),d=n(26),f=n(5),p=n(88),h=n(0),v=n(546),b=n(549),g=n(104),S=n(2),m=n(128),y=n(94),T=function(e){function t(t,n,r,o){var a=e.call(this,t,r,n.periodId)||this;a.onSegmentDataAvailable=function(e){return a.maybeInitTransmuxer().then(function(){a.updateBufferLevel(e);var t=i(e);a.addMetadataToSegment(e,t),a.addCues(e,t)})},a.onTimeUpdate=function(e){e&&(a.segmentBufferRange.start=e.time),a.segmentBufferRange.end-a.segmentBufferRange.start>=a.bufferSettings.getForwardTargetLevel()||a.segmentController.hasNext()&&(a.segmentController.getMPDHandler().resolvePendingSegmentInfoRequests(),a.segmentController.getNext())},a.onSeekFromEvent=function(e){var t=null!=e.seekTarget&&e.seekTarget||e.target;a.onSeek(0,t)},a.onSeeked=function(){a.targetTime=void 0},a.onMpdUpdated=function(){a.segmentController.updateMpd()};var s=t.sourceContext.sourceIdentifier;a.eventHandler=t.eventHandler,a.sourceStoreService=t.serviceManager.get(u.ServiceName.SourceStoreService,s),a.manifestUpdateScheduler=t.serviceManager.get(u.ServiceName.ManifestUpdateSchedulingService,s),a.getTransmuxer=o,a.isHls=n.isHls,a.bufferSettings=t.bufferSettings,a.segmentBufferRange={start:0,end:0};var d=S.ModuleManager.get(h.ModuleName.EngineBitmovin).SegmentController;return a.segmentController=new d(t,a.onSegmentDataAvailable,n.mimeType,n.codec,n.isHls,n.manifestLoader,n.periodId),a.segmentController.setCurrentLangObj(r),a.eventHandler.on(l.PlayerEvent.Seek,a.onSeekFromEvent),a.eventHandler.on(l.PlayerEvent.Seeked,a.onSeeked),a.eventHandler.on(l.PlayerEvent.TimeShift,a.onSeekFromEvent),a.eventHandler.on(l.PlayerEvent.TimeShifted,a.onSeeked),a.eventHandler.on(c.InternalEvent.MPDUpdated,a.onMpdUpdated,!0),a}return a(t,e),t.prototype.extractSubtitlesFromSegment=function(e,t){return t?b.parsePlainTextSubtitles(e):o(e)?v.parseMP4WrappedSubtitles(e,this.context.logger):e.getMetadata().subtitles},t.prototype.addMetadataToSegment=function(e,t){var n=e.getMetadata();n.subtitles=this.extractSubtitlesFromSegment(e,t),e.setMetadata(n)},t.prototype.maybeInitTransmuxer=function(){var e=Promise.resolve();return this.isHls&&this.getTransmuxer()&&(e=this.getTransmuxer().initialized()),e},t.prototype.updateBufferLevel=function(e){if(!e.isInit()){var t=this.getBufferdRange().end;e.getPlaybackTime()&&(t=e.getPlaybackTime()),e.getDuration()&&(this.segmentBufferRange.end=t+e.getDuration())}},t.prototype.getTimestampOffset=function(){var e=-this.segmentController.getMPDHandler().getTimestampOffset();return this.getTransmuxer&&this.getTransmuxer()&&(e+=this.getTransmuxer().getTimestampMappingOffset()),e},t.prototype.addCues=function(e,n){var r=e.getMetadata().subtitles;if(Array.isArray(r)&&0!==r.length){var i=this.getTimestampOffset(),o=n||"stpp"===d.CodecStringHelper.extractCodec(e.getCodec()),a=o?this.parseCues(r,i):r,s=this.applyVttOffset(a,e),u=t.ensureCueInSegmentRange(s,e.getPlaybackTime(),e.getDuration(),i,this.isTsContainer());this.fireOnCueParsedEvents(u,this.periodId),this.timeline.addCues(u)}},t.prototype.parseCues=function(e,t){var n=this;return e.flatMap(function(e){return n.parse(e.text,t)})},t.ensureCueInSegmentRange=function(e,t,n,r,i){if(void 0===i&&(i=!1),!t&&0!==t||t<0||!n)return e;if(e.length>0){var o=e.every(function(e){return e.start-r<n});if(o)return e.map(function(e){return i&&null!=e.offset?s(s({},e),{start:e.start+t-r-e.offset,end:e.end+t-r-e.offset}):s(s({},e),{start:e.start+t-r,end:e.end+t-r})})}return e},t.prototype.parse=function(e,t){var n=g.SubtitleParserFactory.createInstance(this.context,e);return t?n.parse(e,t):n.parse(e)},t.prototype.activate=function(){var t=this;return e.prototype.activate.call(this),this.prepareActivation().then(function(){if(t.isActive()){var e=t.segmentController.getMPDHandler();e.setAdaptationSetId(t.segmentController.getCurrentAdaptationSet()._internalId),isNaN(e.getTimestampOffset())&&e.setTimestampOffset(0),t.segmentController.seekTo(t.targetTime||t.context.renderer.getCurrentTime(!0)),t.segmentController.getNext(),t.eventHandler.on(l.PlayerEvent.TimeChanged,t.onTimeUpdate)}})},t.prototype.prepareActivation=function(){var e=this.segmentController.getCurrentAdaptationSet().Representation[0]._internalId,t=S.ModuleManager.get(h.ModuleName.EngineBitmovin).actions.setRepresentationIdAction(e);return this.sourceStoreService.dispatch(t),this.manifestUpdateScheduler.waitForRepUpdate(e)},t.prototype.deactivate=function(){return this.timeline.removeCues(),this.segmentBufferRange={start:0,end:0},this.eventHandler.off(l.PlayerEvent.TimeChanged,this.onTimeUpdate),this.sourceStoreService.dispatch(S.ModuleManager.get(h.ModuleName.EngineBitmovin).actions.removeActiveTrackAction(this.segmentController.getCurrentAdaptationSet()._internalId)),e.prototype.deactivate.call(this)},t.prototype.getSubtitleType=function(){return y.SubtitleType.FRAGMENTED},t.prototype.getBufferdRange=function(){return this.segmentBufferRange},t.prototype.clearBuffersUntil=function(t){e.prototype.clearBuffersUntil.call(this,t),this.segmentBufferRange.end<=t?(this.segmentBufferRange.start=0,this.segmentBufferRange.end=0):this.segmentBufferRange.start<t&&(this.segmentBufferRange.start=t)},t.prototype.onSeek=function(e,t){if(this.isActive()){this.targetTime=t;var n=t>=this.segmentBufferRange.start&&t<=this.segmentBufferRange.end;n||(this.timeline.removeCues(),this.segmentBufferRange.start=0,this.segmentBufferRange.end=0,this.segmentController.seekTo(t))}},t.prototype.dispose=function(){e.prototype.dispose.call(this),this.eventHandler.off(l.PlayerEvent.Seek,this.onSeekFromEvent),this.eventHandler.off(l.PlayerEvent.Seeked,this.onSeeked),this.eventHandler.off(l.PlayerEvent.TimeShift,this.onSeekFromEvent),this.eventHandler.off(l.PlayerEvent.TimeShifted,this.onSeeked),this.eventHandler.off(c.InternalEvent.MPDUpdated,this.onMpdUpdated),this.segmentController.dispose()},t}(m.AbstractSubtitleHandler);t.FragmentedSubtitleHandler=T},94:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;!function(e){e[e.EXTERNAL_FILE=0]="EXTERNAL_FILE",e[e.FRAGMENTED=1]="FRAGMENTED",e[e.IN_STREAM=2]="IN_STREAM"}(r=t.SubtitleType||(t.SubtitleType={}))}},[547])});
})();
