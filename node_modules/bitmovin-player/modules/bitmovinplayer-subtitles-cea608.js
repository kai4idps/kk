/**************************************************************************** 
 * Copyright (C) 2021, Bitmovin, Inc., All Rights Reserved 
 * 
 * This source code and its use and distribution, is subject to the terms 
 * and conditions of the applicable license agreement. 
 * 
 * Bitmovin Player Version 8.60.0 
 * 
 ****************************************************************************/
(function() {
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["subtitles-cea608"]=t():(e.bitmovin=e.bitmovin||{},e.bitmovin.player=e.bitmovin.player||{},e.bitmovin.player["subtitles-cea608"]=t())}(this,function(){return webpackJsonpbitmovin_player__name_([30],{160:function(e,t,o){"use strict";function s(e,t){return{nalUnitType:"sei_rbsp",escapedRBSP:new Uint8Array(e.data.buffer,e.data.byteOffset,e.data.byteLength),pts:t}}Object.defineProperty(t,"__esModule",{value:!0});var r=o(180),a=o(2),n=o(0),i=o(568);t.MPEG_TS_TIMESCALE=9e4;var u=function(){function e(e){this.logger=e,a.ModuleManager.has(n.ModuleName.ContainerMP4)&&(this.MP4Module=a.ModuleManager.get(n.ModuleName.ContainerMP4)),this.timeScale=1,this.defaultSampleDuration=0}return e.prototype.extract=function(e){var t=this;if(!this.MP4Module)return Promise.reject(new Error("no MP4 parser present"));var o=e.getParsedData().get("moov.trak.mdia.mdhd");o&&(this.timeScale=o.timescale);var a=e.getParsedData().get("moov.mvex.trex");a&&(this.defaultSampleDuration=a.default_sample_duration);var n=this.MP4Module.getMp4Fragments(e),i=n.flatMap(function(o){var a=o.moof.get("traf.tfdt"),n=t.MP4Module.getAvcSamples(o,e,[r.NalUnitType.SEI],t.logger),i=a?t.toSeconds(a.baseMediaDecodeTime):0;return n.flatMap(function(e){var o=e.nalus.map(function(o){return s(o,i+t.toSeconds(e.compositionTimeOffset))});return i+=Math.floor(t.toSeconds(e.duration||t.defaultSampleDuration)),o})});return this.parseCaptions(i)},e.prototype.toSeconds=function(e){return e/this.timeScale*t.MPEG_TS_TIMESCALE},e.prototype.parseCaptions=function(e){return 0===e.length?Promise.resolve([]):(this.cea608Processor||(this.cea608Processor=new i.WebWorkerCea608Processor),this.cea608Processor.getCaptions(e)["catch"](function(){return Promise.resolve([])}))},e.prototype.reset=function(){this.cea608Processor&&this.cea608Processor.reset()},e.prototype.dispose=function(){this.cea608Processor&&this.cea608Processor.dispose()},e}();t.Cea608Extractor=u},567:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o(0),r=o(160);t.CeaSubtitlesModuleDefinition={name:s.ModuleName.SubtitlesCEA608,module:function(){return{Cea608Extractor:r.Cea608Extractor}},dependencies:[s.ModuleName.Subtitles]},t["default"]=t.CeaSubtitlesModuleDefinition},568:function(e,t,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=o(2),r=o(0),a=o(160),n=function(){function e(){var e=this;this.handleTransmuxerEvent=function(t){if("caption"===t.data.action){var o=t.data.caption;o.startTime=o.startTime||o.startPts/a.MPEG_TS_TIMESCALE,o.endTime=o.endTime||o.endPts/a.MPEG_TS_TIMESCALE,e.captions.push(t.data.caption)}else if("done"===t.data.action&&"captions"===t.data.what)if(e.onCaptionsAvailable(e.captions),e.captions=[],e.jobQueue.length>0){var s=e.jobQueue[0];e.process(s.message)}else e.isProcessing=!1};var t=s.ModuleManager.get(r.ModuleName.ContainerTS).TransmuxerWorker;this.transmuxer=new t,this.transmuxer.onmessage=this.handleTransmuxerEvent,this.captions=[],this.jobQueue=[],this.isProcessing=!1,this.transmuxer.postMessage({action:"initCaptionParser"})}return e.prototype.getCaptions=function(e){var t=this;return new Promise(function(o,s){(!e||!Array.isArray(e)||e.length<1)&&s();var r={action:"pushCaptions",data:e};t.jobQueue.push({message:r,resolve:o,reject:s}),t.isProcessing||(t.isProcessing=!0,t.process(r))})},e.prototype.dispose=function(){this.transmuxer&&(this.transmuxer.postMessage({action:"dispose"}),this.transmuxer.terminate(),this.transmuxer=null)},e.prototype.process=function(e){this.transmuxer.postMessage(e),this.flush()},e.prototype.flush=function(){this.transmuxer.postMessage({action:"flushCaptions"})},e.prototype.reset=function(){this.transmuxer.postMessage({action:"resetCaptions"})},e.prototype.onCaptionsAvailable=function(e){var t=this.jobQueue.shift();t.resolve(e)},e}();t.WebWorkerCea608Processor=n}},[567])});
})();
