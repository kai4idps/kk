/**************************************************************************** 
 * Copyright (C) 2021, Bitmovin, Inc., All Rights Reserved 
 * 
 * This source code and its use and distribution, is subject to the terms 
 * and conditions of the applicable license agreement. 
 * 
 * Bitmovin Player Version 8.60.0 
 * 
 ****************************************************************************/
(function() {
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["engine-bitmovin"]=t():(e.bitmovin=e.bitmovin||{},e.bitmovin.player=e.bitmovin.player||{},e.bitmovin.player["engine-bitmovin"]=t())}(this,function(){return webpackJsonpbitmovin_player__name_([0],{103:function(e,t,i){"use strict";function n(e,t){var i=t.findIndex(function(t){return w.areSegmentsIdentical(t,e)});i>-1&&t.splice(i,1)}function r(e,t){return!t.isAvMuxedTogether||v.MimeTypeHelper.isVideo(e.getMimeType())}function o(e,t,i,n,r){var o=e.serviceManager.get(l.ServiceName.AdaptationService),a=e.serviceManager.get(l.ServiceName.ManifestService,e.sourceContext.sourceIdentifier),s=function(i,n){var s=o.shouldDownloadBeCancelled(t,i,n);return a.isHlsManifest()&&r.possiblyDependentSegments&&s?(e.logger.debug("Download should be cancelled, but this is disabled for segments not starting with key frames"),!1):s};return e.serviceManager.get(l.ServiceName.SegmentService).add({mimeType:t,shouldDownloadBeCancelledCallback:s},i,n)}function a(e){var t,i;return i=x.ContainerFormat[null===(t=e)||void 0===t?void 0:t.split("/")[1].toUpperCase()],null!==i&&void 0!==i?i:null}var s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},s.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var u,d=i(20),c=i(18),l=i(3),h=i(15),p=i(1),f=i(114),g=i(192),m=i(21),S=i(22),y=i(16),v=i(5),T=i(10),M=i(2),I=i(0),P=i(79),b=i(34),C=i(90),R=i(477),E=i(509),A=i(57),x=i(78),_=i(49),L=i(58),B=i(212),k=i(491),D=i(495),w=i(91),O=i(496),N=i(126),H=i(499),F=i(502);!function(e){e.Init="init",e.Data="data",e.Any="any"}(u=t.SegmentType||(t.SegmentType={}));var U=9e4,j="SegmentController",q=function(){function e(e,t,i,n,r,o,a){var s=this;this.context=e,this.onDataAvailableCallback=t,this.mimeType=i,this.manifestLoader=o,this.HLSModule=M.ModuleManager.get(I.ModuleName.HLS,!1),this.loadedAdaptationSetIds={},this.loadingDataSegmentInfos=[],this.isFirstSegment=!0,this.periodSwitch=!1,this.isBackupStreamSwitchOngoing=!1,this.hasDownloadError=!1,this.invalidateOngoingSegmentInfoRequest=!1,this.disableDownloadCancelingForNextSegment=!1,this.currentLangObj={id:null,lang:null,label:"off"},this.onSegmentInfoError=function(e){if(s.context){var t="Error obtaining "+s.mimeType+" segment info";Boolean(s.lastSegmentInfoError)&&s.lastSegmentInfoError.code===e.code?s.logger.insane(t,e):s.logger.debug(t,e),s.lastSegmentInfoError=e}},this.handleCancelLoadingError=function(e){s.logger.debug("Error in cancelLoading of segmentLoaderPool ",e)},this.getNext=function(){s.currentAdaptationSetId&&!s.isBackupStreamSwitchOngoing&&(!s.segmentManager.canLoad()||s.hasActiveTransmuxingJobs()||s.pendingSegmentInfoRequest||(s.hasValidSeekTarget?(s.hasJustSwitched=!1,s.hasValidSeekTarget=!1,s.getNextSegmentInfoOfType(u.Init)):s.periodSwitch?(s.getNextSegmentInfoOfType(u.Init),s.periodSwitch=!1):s.getNextSegmentInfoOfType(u.Any)))},this.onSegmentLoaded=function(e){var t,i=e.getData();if(i&&i.byteLength<1)return s.logger.debug("Warning: Loaded segment has size 0 bytes, skipping further processing! May cause gap!",e.getUrl()),void(s.hlsTimelineTracker&&s.hlsTimelineTracker.reset());var n=M.ModuleManager.has(I.ModuleName.ContainerMP4),r=M.ModuleManager.get(I.ModuleName.ContainerMP4,!1),o=r.isValidSegment,a=r.MP4Parser,u=n&&s.segmentParser instanceof a;if(s.context.settings.DROP_INVALID_SEGMENTS&&u&&!s.isTransmuxerRequired()&&!s.manifestService.isSmoothManifest()&&!o(e))return void s.logger.debug("Warning: Loaded MP4 segment is invalid, skipping further processing! May cause gap!",e.getUrl());if(s.isFirstSegment&&s.isTransmuxerRequired()&&(u&&o(e)?(s.logger.debug("Detected fMP4/CMAF container format for "+s.mimeType+", skipping transmuxing"),s.hls.isTransmuxingRequired=!1,s.hls.transmuxer.dispose(),s.context.serviceManager.maybeCall(l.ServiceName.SubtitleService,function(e){e.setTransmuxer(void 0)})):s.context.store.dispatch(x.setContainerFormat(x.ContainerFormat.TS))),s.isTransmuxerRequired()){if(isNaN(e.getSegmentInfo().presentationTimeOffset)&&(s.mpdHandler.setTimestampOffset(0),e.getSegmentInfo().presentationTimeOffset=0),!M.ModuleManager.has(I.ModuleName.ContainerTS))return void s.context.eventHandler.fireError(new P.PlayerModuleMissingError(I.ModuleName.ContainerTS));var d=null===(t=e.getSegmentInfo())||void 0===t?void 0:t.discontinuitySequenceNumber;void 0!==s.lastDiscoNumber&&d!==s.lastDiscoNumber&&s.resetTransmuxer(),s.lastDiscoNumber=d,s.transmux(e)}else{if(s.manifestService.isHlsManifest()&&!e.isInit()&&!e.isSelfInit()&&e.getSegmentInfo().init){var c=e.getSegmentInfo(),h=s.segmentManager.getCachedSegment(c.init);h&&e.setInitSegment(h)}s.segmentPreProcessor.onSegmentAvailable(e,null,s.currentAdaptationSetId,s.segmentManager,s.isFirstSegment,s.hasJustSwitched,function(e){return s.hasJustSwitched=e},function(e){return s.isFirstSegment=e}),e.getMimeType().indexOf("mp4")>-1&&(s.isLastSegment=e.isLastSegment())}},this.onShouldDownloadBeCancelled=function(e,t){var i=s.adaptationService.shouldDownloadBeCancelled(s.mimeType,e,t);return s.manifestService.isHlsManifest()&&s.hls.possiblyDependentSegments&&i?(s.logger.debug("Download should be cancelled, but this is disabled for segments not starting with key frames"),!1):i};var d=e.sourceContext.sourceIdentifier;this.currentPeriodId=a,this.sourceStore=e.serviceManager.get(l.ServiceName.SourceStoreService,d),this.manifestUpdateScheduler=e.serviceManager.get(l.ServiceName.ManifestUpdateSchedulingService,d),this.manifestService=this.context.serviceManager.get(l.ServiceName.ManifestService,d),this.segmentUnavailabilityHandler=new E.SegmentUnavailabilityHandler(this.context),this.adaptationService=this.context.serviceManager.get(l.ServiceName.AdaptationService),this.initSegmentStore=new k.InitSegmentStore,this.hls={isTransmuxingRequired:r&&!this.isSubtitleSegmentController,transmuxer:void 0,possiblyDependentSegments:this.manifestService.isHlsManifest()&&!this.manifestService.getManifest()._hasIndependentSegments,isAvMuxedTogether:!!n&&n.indexOf(",")>-1,discardNextSegment:!1,muxedAudioTrackIndex:0},e.settings.FORCE_KEY_FRAMES_ON_HLS_SEGMENT_START&&(this.hls.possiblyDependentSegments=!1),this.init()}return Object.defineProperty(e.prototype,"logger",{get:function(){return this.context.logger},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"settings",{get:function(){return this.context.settings},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"config",{get:function(){return this.context.config},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventHandler",{get:function(){return this.context.eventHandler},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"segmentManager",{get:function(){return o(this.context,this.mimeType,this.segmentParser,this.currentLangObj,this.hls)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSubtitleSegmentController",{get:function(){return v.MimeTypeHelper.isSubtitle(this.mimeType)},enumerable:!0,configurable:!0}),e.prototype.getUserFeedbackForAdaptation=function(e){var t=this.getAdaptationEventType();if(!t)return null;var i=this.getUserSelectedRepresentation(e.representationId),n=this.manifestService.getRepresentation(this.currentAdaptationSetId,i);return n?(this.logger.debug("user has overridden adaptation suggestion! suggested: "+e.representationId+", user: "+i),this.eventHandler.dispatchEvent(t,{representationID:n._internalId.representationId}),n._internalId):(this.eventHandler.dispatchEvent(t,{representationID:e.representationId}),null)},e.prototype.getUserSelectedRepresentation=function(e){var t=this.getAdaptationCallbackFn();if(!t)return null;var i=this.manifestService.getAdaptationSet(this.currentAdaptationSetId).Representation.map(function(e){return{bandwidth:e._bandwidth,id:e._id}}),n={suggested:e,isAd:this.context.sourceContext.isAd,representations:i};return t(n)},e.prototype.getAdaptationEventType=function(){return v.MimeTypeHelper.isAudio(this.mimeType)?p.PlayerEvent.AudioAdaptation:v.MimeTypeHelper.isVideo(this.mimeType)?p.PlayerEvent.VideoAdaptation:null},e.prototype.getAdaptationCallbackFn=function(){var e=null;return v.MimeTypeHelper.isAudio(this.mimeType)&&(e=this.config.adaptation.onAudioAdaptation),v.MimeTypeHelper.isVideo(this.mimeType)&&(e=this.config.adaptation.onVideoAdaptation),e},e.prototype.selectRepresentation=function(e,t){if(this.context.adRestorationOptimizationService.hasPrefetchedSegment(this.mimeType,this.lastSegmentInfo))return this.context.adRestorationOptimizationService.getRepresentationForPrefetchedSegment(this.mimeType);var i=g.getAdaptationState(this.sourceStore.getState()),n=g.getPreferredBitrate(i,this.mimeType),r=this.getSuggestedRepresentationId(e,n,t);return this.chooseRepresentationId(r)},e.prototype.chooseRepresentationId=function(e){var t,i=this.getUserFeedbackForAdaptation(e);if(i)return this.disableDownloadCancelingForNextSegment=!0,i;var n=null===(t=this.getCurrentAdaptationSet().Representation[0])||void 0===t?void 0:t._internalId;return e||n||this.currentRepresentationId},e.prototype.getSuggestedRepresentationId=function(e,t,i){var n,r;if(this.periodSwitch||!this.hasJustSwitched||void 0===this.currentRepresentationId){var o={hlsDependentSegments:this.hls.possiblyDependentSegments,segmentDuration:this.mpdHandler.getSegmentDuration(),segmentNumber:e};r=this.adaptationService.selectRepresentation(this.mimeType,o,this.getCurrentAdaptationSet().Representation)}else r=this.currentRepresentationId;var a=(null===(n=i)||void 0===n?void 0:n.periodId)===this.getCurrentPeriodId();return a&&!t&&(r=i),r},e.prototype.switchRepresentation=function(e){var t=this.currentRepresentationId?this.currentRepresentationId.representationId:null;this.logger.debug("switching representation from "+t+" to "+e.representationId+" ("+this.mimeType+")"),this.mpdHandler.setRepresentationId(e),this.currentRepresentationId=e,this.hasJustSwitched=!0},e.prototype.hasRequestedInitSegment=function(e){var t=this.context.store.getState();return S.getMetricsHistoryFromInstanceState(t,this.mimeType,y.MetricType.CachedInitSegments).map(function(e){var t,i;return null===(i=null===(t=e)||void 0===t?void 0:t.value)||void 0===i?void 0:i.internalRepId}).filter(Boolean).some(function(t){return t.equals(e)})},e.prototype.isInitSegmentNeeded=function(e,t,i){return e===u.Init||t||this.manifestService.isHlsManifest()||!this.hasRequestedInitSegment(i)},e.prototype.invalidateOngoingRequests=function(){this.invalidateOngoingSegmentInfoRequest=!0},e.prototype.fireQualityChangeEvent=function(e,t){var i,n,r,o,a=C.representationToQuality(this.manifestService.getRepresentationById(e),this.mimeType),s=C.representationToQuality(this.manifestService.getRepresentationById(t),this.mimeType),u={targetQuality:s,targetQualityId:(n=null===(i=s)||void 0===i?void 0:i.id,null!==n&&void 0!==n?n:null),sourceQuality:a,sourceQualityId:(o=null===(r=a)||void 0===r?void 0:r.id,null!==o&&void 0!==o?o:null)};v.MimeTypeHelper.isVideo(this.mimeType)?this.context.eventHandler.dispatchEvent(p.PlayerEvent.VideoDownloadQualityChange,u):v.MimeTypeHelper.isAudio(this.mimeType)&&this.context.eventHandler.dispatchEvent(p.PlayerEvent.AudioDownloadQualityChange,u)},e.prototype.getSegmentInfo=function(e,t,i){var n=this;void 0===i&&(i=this.currentPeriodId);var r=this.lastSegmentInfo&&this.lastSegmentInfo.segmentNumber+1||0,o=this.selectRepresentation(r,t),a=!o.equals(this.currentRepresentationId);return a&&(this.sourceStore.dispatch(A.setRepresentationIdAction(o)),v.MimeTypeHelper.isAV(this.mimeType)&&this.fireQualityChangeEvent(this.currentRepresentationId,o)),this.invalidateOngoingSegmentInfoRequest=!1,this.pendingSegmentInfoRequest=this.loadRepresentationInfo(o).then(function(){return n.mpdHandler.setAdaptationSetId(n.currentAdaptationSetId,o),a&&n.switchRepresentation(o),n.findNextSegmentInfo(e,a,o)}).then(function(e){var t,i,a=n.currentRepresentationId||o;if(n.shouldInvalidateSegmentInfo(e))throw null===(i=null===(t=n.context)||void 0===t?void 0:t.logger)||void 0===i?void 0:i.debug("[SegmentController]["+n.mimeType+"] invalidating ongoing SegmentInfo request for",s({},e)),"ongoing segment info request was invalidated";return n.addSegmentInfos(e,r,a),n.lastSegmentInfo=e,e})["catch"](function(t){n.pendingSegmentInfoRequest=null;var r=n.manifestService.getRepresentationById(o);if(r&&n.sourceStore.dispatch(_.setRepresentationFailedDownloadAction(r._internalId)),t===f.M3u8Error.COULD_NOT_LOAD){n.logger.debug("HLS playlist loading failed for representation "+o.representationId+" ("+t+")");var a=n.manifestService.getAdaptationSet(n.currentAdaptationSetId),s=a.Representation.find(function(e){return!e.hasFailedToLoad});if(s)return n.getSegmentInfo(e,s._internalId,i)}throw t})["finally"](function(){n.targetTimeAfterTimeShift=void 0}),this.pendingSegmentInfoRequest},e.prototype.shouldInvalidateSegmentInfo=function(e){return this.invalidateOngoingSegmentInfoRequest&&e&&!e.isInitSegment&&!this.isSegmentAfterTimeShift(e)},e.prototype.isSegmentAfterTimeShift=function(e){return void 0!==this.targetTimeAfterTimeShift&&"number"==typeof e.startTime&&"number"==typeof e.duration&&this.targetTimeAfterTimeShift>=e.startTime&&this.targetTimeAfterTimeShift<=e.startTime+e.duration},e.prototype.getInitSegmentInfo=function(){return this.currentRepresentationId&&this.currentRepresentationId.periodId===this.getCurrentPeriodId()?this.getSegmentInfo(u.Init,this.currentRepresentationId):this.getSegmentInfo(u.Init)},e.prototype.getDataSegmentInfo=function(){return this.currentRepresentationId&&this.currentRepresentationId.periodId===this.getCurrentPeriodId()?this.getSegmentInfo(u.Data,this.currentRepresentationId):this.getSegmentInfo(u.Data)},e.prototype.needToLoadInitSegment=function(e,t,i,n){var r=this.isTransmuxerRequired(),o=!r&&!this.manifestService.isSmoothManifest()&&!this.isSubtitleSegmentController;return e&&(o=this.isInitSegmentNeeded(t,i,n),o&&this.manifestService.isHlsManifest()&&(o=!this.segmentManager.hasCachedSegment(e))),o&&t!==u.Data},e.prototype.findNextSegmentInfo=function(e,t,i){var n=this,r=this.mpdHandler.getInitSegmentInfo(i),o=this.needToLoadInitSegment(r,e,t,i);return o&&r?Promise.resolve(r):this.mpdHandler.getNextSegmentInfo().then(function(a){return r=a.init&&s(s({},a.init),{isInitSegment:!0}),o=n.needToLoadInitSegment(r,e,t,i),o&&r?(n.mpdHandler.rewindOneSegment(),r):a})},e.prototype.addSegmentInfos=function(e,t,i){if(e){var n=this.manifestService.getRepresentationById(i);if(n)if(e.representationId=i.representationId,e.internalRepresentationId=i,e.mimeType=this.mimeType,e.bitrate=n._bandwidth,e.periodId=i.periodId,e.codec=this.getCodecs(),v.MimeTypeHelper.isAudio(this.mimeType))e.sampleRate=n._audioSamplingRate,e.width=void 0,e.height=void 0;else if(v.MimeTypeHelper.isVideo(this.mimeType)&&(e.width=n._width,e.height=n._height,e.frameRate=n._frameRate,!e.dateTime&&this.settings.AKAMAI_DATETIME_PARSING&&this.HLSModule)){var r=this.HLSModule.PlaylistUtils.getProgramDateTimeFromSegmentUrl(e.url,e.duration);r&&(e.dateTime=r)}var o=this.manifestService.getLowestBandwidthOfAdaptationSet(this.currentAdaptationSetId),a=e.bitrate;isFinite(a)&&a===o&&(e.preventDownloadCanceling=!0);var s=this.manifestService.getAvailableBaseURLsForRepresentation(i);e.availableBaseURLs=s,e.firstUsedBaseURLIndex=0,this.lastSegmentInfo&&this.lastSegmentInfo.lastUsedBaseURLIndex&&(e.firstUsedBaseURLIndex=this.lastSegmentInfo.lastUsedBaseURLIndex),e.lastUsedBaseURLIndex=e.firstUsedBaseURLIndex,e.duration||e.isInitSegment||(e.duration=this.mpdHandler.getSegmentDuration()),e.hasOwnProperty("segmentNumber")&&!isNaN(e.segmentNumber)||(e.segmentNumber=t),this.manifestService.isHlsManifest()?(e.baseURL="",e.mediaURL||(e.mediaURL=e.url)):(e.baseURL=s[e.firstUsedBaseURLIndex],e.mediaURL=e.mediaURL||e.url,delete e.url),e.url=T.URLHelper.concatBaseUrlWithPartial(e.baseURL,e.mediaURL),e.discardData=this.hls.discardNextSegment,this.hls.discardNextSegment=!1,this.disableDownloadCancelingForNextSegment&&(e.preventDownloadCanceling=!0,this.disableDownloadCancelingForNextSegment=!1),e.isTransmuxingRequired=this.isTransmuxerRequired()}},e.prototype.loadRepresentationInfo=function(e){var t=this;return this.manifestUpdateScheduler.waitForRepUpdate(e).then(function(){return t.mpdHandler.updateRepresentation(e)})},e.prototype.isTransmuxing=function(){return this.isTransmuxerRequired()&&this.hls.transmuxer&&this.hls.transmuxer.isTransmuxing()},e.prototype.hasActiveTransmuxingJobs=function(){return this.isTransmuxerRequired()&&this.hls.transmuxer&&this.hls.transmuxer.hasActiveJobs()},e.prototype.cancelLoading=function(){this.invalidateOngoingSegmentInfoRequest=!0,this.isTransmuxing()&&this.hls.transmuxer.discardCurrentJobs(),this.segmentManager.cancel()["catch"](this.handleCancelLoadingError)},e.prototype.seekTo=function(e){var t=this;null!==e&&this.currentAdaptationSetId&&(this.cancelLoading(),this.loadingDataSegmentInfos=[],this.hasDownloadError=!1,this.isLastSegment=!1,this.manifestService.isHlsManifest()&&this.hls.transmuxer&&this.hls.transmuxer.discardCurrentJobs(),this.hlsTimelineTracker&&this.hlsTimelineTracker.reset(),this.isTransmuxerRequired()&&this.hls.transmuxer&&this.hls.transmuxer.resetCaptionParser(),e>=0&&(this.hasValidSeekTarget=!0,this.mpdHandler.seekTo(e))),this.pendingSegmentInfoRequest&&"number"==typeof e&&this.pendingSegmentInfoRequest["catch"](function(e){return t.logger.debug("Error during getting a segment info",e)}).then(function(){return t.seekTo(e)})},e.prototype.getNextSegmentInfoOfType=function(e){var t=this;this.getSegmentInfo(e,null,this.currentPeriodId).then(function(e){return t.loadFromSegmentInfo(e)})["catch"](this.onSegmentInfoError)},e.prototype.hasNextVod=function(){var e;if(this.hasDownloadError)return this.currentRepresentationId!==this.adaptationService.selectRepresentation(this.mimeType)&&(this.mpdHandler.rewindOneSegment(),this.hasDownloadError=!1,this.hasJustSwitched=!1,!0);var t=this.manifestService.findPeriod(this.currentPeriodId),i=this.manifestService.getMediaPresentationDuration();if(t&&t.hasOwnProperty("_duration"))e=this.manifestService.getPeriodDuration(this.currentPeriodId);else{if(0===i)return!1;e=i}return this.mpdHandler.hasNext(e)},e.prototype.hasNextLive=function(){return this.manifestService.isAvailabilityEndTimeExceeded()?(this.logger.log("Stream ("+this.mimeType+") availability end time reached, stopping download of further segments."),this.isLastSegment=!0,!1):(this.manifestService.isLastPeriod(this.currentPeriodId)&&this.mpdHandler.resolvePendingSegmentInfoRequests(),this.hasDownloadError&&this.currentRepresentationId!==this.adaptationService.selectRepresentation(this.mimeType)&&(this.mpdHandler.rewindOneSegment(),this.hasDownloadError=!1,this.hasJustSwitched=!1),this.mpdHandler.hasNext(this.manifestService.getPeriodDuration(this.currentPeriodId)))},e.prototype.hasNext=function(){var e=this.isLastSegment&&this.manifestService.isLastPeriod(this.currentPeriodId);return!(e||!this.currentAdaptationSetId||!this.mpdHandler)&&(this.manifestService.isLive()?this.hasNextLive():this.hasNextVod())},e.prototype.onTransmuxed=function(e){var t=this,i=e.transmuxedSegments.every(function(e){return null!==e.getCodec()});if(!i){var n=e.originalSegment.getUrl();return void this.logger.debug("Discarding muxing because codecs were not available in the segment: "+n)}var r=e.transmuxedSegments.find(function(e){return"video/mp4"===e.getMimeType()}),o=e.transmuxedSegments.filter(function(e){return"audio/mp4"===e.getMimeType()}),a=o[this.hls.muxedAudioTrackIndex]||o[0],s=[r,a].filter(function(e){return Boolean(e)});s.forEach(function(e){return t.timestampOffsetService.maybeAdjustTimestampOffsetAtDiscontinuityChange(e,t.mpdHandler)}),this.segmentPreProcessor.cacheOrCallOnSegmentAvailable(e,s,this.currentAdaptationSetId,this.segmentManager,this.isFirstSegment,this.hasJustSwitched,function(e){return t.hasJustSwitched=e},function(e){return t.isFirstSegment=e});var u=s[s.length-1];u&&u.getMimeType().indexOf("mp4")>-1&&(this.isLastSegment=u.isLastSegment()),this.logger.debug("Transmuxing done",e.originalSegment.getUrl())},e.prototype.hasPendingSegments=function(e){var t=!1,i=!1;return e?(t=this.isTransmuxerRequired()&&this.hls.transmuxer&&this.hls.transmuxer.isTransmuxingSegmentsForPeriod(e),i=this.segmentManager.isLoading(e)):(t=this.isTransmuxing(),i=this.segmentManager.isLoading()),i||t||Boolean(this.pendingSegmentInfoRequest)},e.prototype.transmux=function(e){var t=this;if(!this.hls.transmuxer.isInitialBaseMediaDecodeTimeSet()){void 0===e.getSegmentInfo().startTime&&this.sourceStore.dispatch(this.HLSModule.actions.dropSegmentStartTimes()),B.initializeHlsSegmentStartTimes(e,this.context,this.mpdHandler);var i=e.getSegmentInfo(),n=Math.round(i.startTime*U);this.logger.debug("Setting initial BaseMediaDecodeTime at transmuxer to "+n/U+(" ("+n+")")),this.hls.transmuxer.setBaseMediaDecodeTime(n)}this.hls.transmuxer.transmuxSegment(e).then(function(e){return t.onTransmuxed(e)})["catch"](function(i){t.logger.debug("Transmuxing failed ",e.getUrl(),i.reason)})},e.prototype.loadFromSegmentInfo=function(e){return this.pendingSegmentInfoRequest=null,e?(e.isInitSegment||this.loadingDataSegmentInfos.push(e),this.lastSegmentInfoError=null,this.logger.debug("Loading "+JSON.stringify(e)),this.loadSegment(e)):Promise.resolve()},e.prototype.loadSegment=function(e){var t=this;return this.segmentManager.getSegment(e).then(function(e){return t.extractSegmentFromStream(e)})["catch"](function(i){return t.handleSegmentLoadingError(i,e)})},e.prototype.extractSegmentFromStream=function(e){var t=this;e.transform(function(e){n(e.getSegmentInfo(),t.loadingDataSegmentInfos),t.onSegmentLoaded(e)},function(){},function(e){return t.logger.debug("Error loading segment",e),e.message})},e.prototype.handleSegmentLoadingError=function(e,t){if(e.reason===N.SegmentLoadingErrorReason.CANCEL)this.onDownloadCancelled(t);else if(e.reason===N.SegmentLoadingErrorReason.ERROR_LOADING){var i=e.info?e.info.response.status:0;this.handleDownloadError(i,t)}else e.reason===N.SegmentLoadingErrorReason.ERROR_DECRYPTING?(this.logger.debug("Could not decrypt segment",t.url),this.eventHandler.dispatchEvent(p.PlayerEvent.Warning,new d.PlayerWarning(c.WarningCode.DRM_COULD_NOT_DECRYPT_SEGMENT))):this.logger.debug("Unexpected ERROR occurred when loading segment!",t.url)},e.prototype.switchToHlsBackupStream=function(e){var t=this;return this.HLSModule&&this.manifestLoader instanceof this.HLSModule.M3u8Loader&&this.manifestLoader.hasBackupStreams(e)?this.manifestLoader.switchToBackupStream(e).then(function(){return!0})["catch"](function(e){return t.logger.debug("Switching to HLS backup stream failed",e),Promise.resolve(!1)}):Promise.resolve(!1)},e.prototype.getFailedSegmentIndex=function(){var e=this.settings.CHUNKED_CMAF_STREAMING?1:this.loadingDataSegmentInfos.length;return this.mpdHandler.getIndex()-e},e.prototype.handleDownloadError=function(e,t){this.segmentUnavailabilityHandler.shouldTryAlternatives(e)?this.tryToFindAValidSegment(t,e):this.hasDownloadError=!0},e.prototype.tryToFindAValidSegment=function(e,t){var i=this;if(!this.currentRepresentationId||!this.currentRepresentationId.equals(e.internalRepresentationId))return void this.logger.debug("Ignoring download error of previous representation.");var n=this.manifestService.getRepresentation(this.currentAdaptationSetId,this.currentRepresentationId.representationId),r=!1;this.isBackupStreamSwitchOngoing=!0;var o=this.switchToHlsBackupStream(n).then(function(e){return r=e})["finally"](function(){return i.isBackupStreamSwitchOngoing=!1});o.then(function(){return i.segmentManager.cancel()}).then(function(){return i.tryToRecoverWithValidSegment(r,e,t)})},e.prototype.tryToRecoverWithValidSegment=function(e,t,i){var n,r=this,o=this.getFailedSegmentIndex();if(this.loadingDataSegmentInfos=[],e)this.mpdHandler.setIndex(Math.max(0,o));else if(n=this.segmentUnavailabilityHandler.switchBaseURL(t))this.loadFromSegmentInfo(n);else{var a=null;if(this.adaptationService.isAuto(this.mimeType)){var s=this.manifestService.getAdaptationSet(this.currentAdaptationSetId).Representation;a=this.segmentUnavailabilityHandler.switchQuality(s,this.currentRepresentationId)}a?this.getSegmentInfo(u.Any,a).then(function(e){return r.loadFromSegmentInfo(e)}):(this.hasDownloadError=!0,this.handleFailedSegmentDownload(t,i))}},e.prototype.handleFailedSegmentDownload=function(e,t){this.manifestService.isLive()?(this.logger.debug("Could not load current segment of any quality from any CDN (all retries failed), skipping it..."),this.continueWithNextSegment(e)):O.throwDownloadError(this.context,"Segment not available at any quality or location",t,e)},e.prototype.continueWithNextSegment=function(e){this.segmentUnavailabilityHandler.downloadSuccess(!1),e.hasDownloadFailed=!0,this.getNext()},e.prototype.onDownloadCancelled=function(e){var t=this;this.context&&(this.logger.debug("Download took too long, cancelled it."),this.hasJustSwitched=!1,!e.isInitSegment&&this.mpdHandler&&this.segmentManager.cancel().then(function(){if(t.mpdHandler){var e=t.getFailedSegmentIndex();t.loadingDataSegmentInfos=[],t.logger.debug("Trying to get the same segment with a lower bitrate."),t.mpdHandler.setIndex(Math.max(0,e))}}))},e.prototype.findAdaptationSetId=function(e,t,i){if(void 0===i&&(i=!1),this.isSubtitleSegmentController&&!e.id)return this.currentLangObj=e,this.segmentManager&&this.cancelLoading(),null;var n=this.manifestService.findAdaptationSet(t,this.mimeType,e,i);return n?(this.currentLangObj=this.manifestService.getLangObjectFromAdaptationSet(n,this.mimeType),n._internalId):null},e.prototype.getCurrentAdaptationSet=function(){return this.manifestService.getAdaptationSet(this.currentAdaptationSetId)},e.prototype.getAdaptationSetForPeriodId=function(e){var t=this.manifestService.getAdaptationSet(this.loadedAdaptationSetIds[e]);return t||this.getCurrentAdaptationSet()},e.prototype.updateMpd=function(){this.logger.debug("Caught a MPD update event");var e=!this.manifestService.findPeriod(this.currentPeriodId);this.currentAdaptationSetId=this.findAdaptationSetId(this.currentLangObj,this.currentPeriodId,!1),!e&&this.currentAdaptationSetId&&(this.loadedAdaptationSetIds[this.currentPeriodId]=this.currentAdaptationSetId,this.adaptationService.setAdaptationSetId(this.mimeType,this.currentAdaptationSetId),this.mpdHandler.setAdaptationSetId(this.currentAdaptationSetId,this.currentRepresentationId,{isPeriodSwitch:!1,isManifestUpdate:!0}));for(var t in this.loadedAdaptationSetIds){var i=this.manifestService.findPeriod(t);i||delete this.loadedAdaptationSetIds[t]}},e.prototype.setCurrentLangObj=function(e){if(this.hls.isAvMuxedTogether&&v.MimeTypeHelper.isVideo(this.mimeType)){var t=this.manifestService.getAdaptationSet(this.currentAdaptationSetId);if(t.ContentComponent){var i=t.ContentComponent.find(function(t){return"audio"===t._contentType&&t._id===e.id});if(i)return this.hls.muxedAudioTrackIndex=t.ContentComponent.filter(function(e){return"audio"===e._contentType}).indexOf(i),void(this.currentLangObj=e)}}e.id!==this.currentLangObj.id&&this.switchAdaptationSetId(e)},e.prototype.switchAdaptationSetId=function(e){var t=this.currentAdaptationSetId;this.currentAdaptationSetId&&this.sourceStore.dispatch(A.removeActiveTrackAction(this.currentAdaptationSetId)),this.currentAdaptationSetId=this.findAdaptationSetId(e,this.currentPeriodId),this.loadedAdaptationSetIds[this.currentPeriodId]=this.currentAdaptationSetId,this.currentAdaptationSetId&&!this.currentAdaptationSetId.equals(t)&&this.switchDependentToNewLanguageObject(e)},e.prototype.switchDependentToNewLanguageObject=function(e){this.currentLangObj=e,this.previousExplicitlySetLangObj=e,this.logger.debug(j+"["+this.mimeType+"]: Trying to set language to ID "+this.currentLangObj.id+(" (lang: "+this.currentLangObj.lang+") for mpd handler and adaption handler")),this.mpdHandler.setAdaptationSetId(this.currentAdaptationSetId),this.adaptationService.setAdaptationSetId(this.mimeType,this.currentAdaptationSetId)},e.prototype.getCurrentLangObj=function(){return this.currentLangObj},e.prototype.stop=function(){this.cancelLoading(),this.segmentManager.clearCache(),this.adaptationService.shutdown(this.mimeType)},e.prototype.init=function(){var e=this;if(this.currentPeriodId=this.currentPeriodId||this.manifestService.getFirstPeriod()._id,this.mpdHandler=D.MPDHandlerFactory.createInstance(this.context,this.mimeType,this.manifestLoader,this.currentPeriodId),this.mpdHandler){var t=a(this.mimeType);this.segmentParser=R.createSegmentParser(this.context,t),this.segmentParser||this.logger.debug("Could not create segment parser for container format: "+t),this.timestampOffsetService=new F.TimestampOffsetService(this.context,this.mimeType),this.segmentPreProcessor=new H.SegmentPreProcessor(this.context,this.mimeType,this.onDataAvailableCallback,this.hls,this.initSegmentStore,this.segmentUnavailabilityHandler,this.timestampOffsetService,this.segmentParser),this.segmentPreProcessor.setMpdHandler(this.mpdHandler),this.hasDownloadError=!1,this.currentAdaptationSetId=this.findAdaptationSetId(this.currentLangObj,this.currentPeriodId),this.loadedAdaptationSetIds[this.currentPeriodId]=this.currentAdaptationSetId,this.context.serviceManager.get(l.ServiceName.SegmentService).add({mimeType:this.mimeType,shouldDownloadBeCancelledCallback:this.onShouldDownloadBeCancelled},this.segmentParser,this.currentLangObj),this.manifestService.isHlsManifest()&&(this.hlsTimelineTracker=new this.HLSModule.HlsTimelineTracker(this.context,this.settings.GAP_TOLERANCE),this.segmentPreProcessor.setHlsTimelineTracker(this.hlsTimelineTracker)),v.MimeTypeHelper.isMP4(this.mimeType)&&this.context.serviceManager.maybeCall(l.ServiceName.SubtitleService,function(t){t.setupCea608CaptionExtractor(e.context.logger)}),this.hasJustSwitched=!1,this.currentAdaptationSetId&&(this.adaptationService.setAdaptationSetId(this.mimeType,this.currentAdaptationSetId),this.mpdHandler.setAdaptationSetId(this.currentAdaptationSetId,null,{isPeriodSwitch:!0}),this.manifestService.isLive()&&!this.settings.ENABLE_SEEK_FOR_LIVE&&this.mpdHandler.timeShift(0,this.currentPeriodId)),this.hasValidSeekTarget=!1,this.isLastSegment=!1}},e.prototype.getSegmentInfos=function(){var e=this.manifestService.getAvailableBaseURLsForRepresentation(this.currentRepresentationId)[0];return this.mpdHandler.getSegmentInfos(e)},e.prototype.getCurrentPeriodId=function(){return this.currentPeriodId},e.prototype.getTargetLanguageObject=function(e){if(!this.previousExplicitlySetLangObj)return this.currentLangObj;var t=this.manifestService.isLanguageAvailable(e,this.mimeType,this.previousExplicitlySetLangObj);return t?this.previousExplicitlySetLangObj:this.currentLangObj},e.prototype.switchPeriod=function(e){var t=this.getTargetLanguageObject(e);if(this.logger.debug(j+"["+this.mimeType+"]: switching period from "+this.currentPeriodId+" to "+e),this.initSegmentStore.clear(),this.removeCachedSegmentsOfPrecedingPeriods(),this.currentPeriodId=e,this.currentAdaptationSetId=this.findAdaptationSetId(t,e,!0),this.loadedAdaptationSetIds[e]=this.currentAdaptationSetId,this.manifestService.isHlsManifest()||(this.currentRepresentationId=void 0),this.currentAdaptationSetId){this.adaptationService.setAdaptationSetId(this.mimeType,this.currentAdaptationSetId);var i=this.mpdHandler.getPendingSegmentInfoRequest();this.mpdHandler.dispose(),this.mpdHandler=D.MPDHandlerFactory.createInstance(this.context,this.mimeType,this.manifestLoader,e,t),this.segmentPreProcessor.setMpdHandler(this.mpdHandler),this.mpdHandler.setPendingSegmentInfoRequest(i),this.mpdHandler.setAdaptationSetId(this.currentAdaptationSetId,null,{isPeriodSwitch:!0})}if(this.isTransmuxerRequired()){if(this.currentAdaptationSetId){var n=this.manifestService.findDownloadedHlsRepresentation(this.currentAdaptationSetId);
n&&this.mpdHandler.setRepresentationId(n._internalId)}this.hlsTimelineTracker&&this.hlsTimelineTracker.reset(),this.segmentManager.clearCache(!1)}this.hasDownloadError=!1,this.isLastSegment=!1,this.isFirstSegment=!0,this.periodSwitch=!0},e.prototype.getMPDHandler=function(){return this.mpdHandler},e.prototype.getIndex=function(){return this.mpdHandler?this.mpdHandler.getIndex()||0:0},e.prototype.getSourceBufferTypes=function(){var e=[];return this.isTransmuxerRequired()&&this.hls.isAvMuxedTogether?(e.push("video/mp4"),e.push("audio/mp4")):e.push(this.mimeType),e},e.prototype.getCodecs=function(){return b.getCodecsFromAdaptationSet(this.getCurrentAdaptationSet())},e.prototype.getLiveEdgeTime=function(){return this.manifestService.isLive()?this.mpdHandler.getLiveEdgeTime():-1},e.prototype.setAdaptionLogicStartupPhase=function(){this.adaptationService.setStartupPhase(this.mimeType)},e.prototype.getMimeType=function(){return this.mimeType},e.prototype.timeShift=function(e,t){this.isTransmuxerRequired()&&this.manifestService.isHlsManifest()&&this.hlsTimelineTracker&&(this.hlsTimelineTracker.reset(),this.hls.transmuxer&&this.hls.transmuxer.resetCaptionParser()),this.cancelLoading(),this.loadingDataSegmentInfos=[],this.mpdHandler.timeShift(e,this.currentPeriodId,t),this.targetTimeAfterTimeShift=t,this.isLastSegment=!1,this.invalidateOngoingSegmentInfoRequest=!0},e.prototype.removeCachedSegmentsOfPrecedingPeriods=function(){var e=this,t=S.getMetricsState(this.context.store.getState());if(this.segmentManager&&t){var i=L.getPlayingPeriodId(this.sourceStore.getState());this.segmentManager.removeCachedInitSegments(function(t){return e.manifestService.isPrecedingPeriod(i,t.getPeriodId())}),(S.getMetricsHistory(t,this.mimeType,y.MetricType.CachedInitSegments)||[]).filter(function(t){var n=t.value.internalRepId.periodId;return e.manifestService.isPrecedingPeriod(i,n)}).forEach(function(t){return e.context.store.dispatch(m.removeMetricsValue(e.mimeType,y.MetricType.CachedInitSegments,t))})}},e.prototype.canLoad=function(){return this.segmentManager.canLoad()},e.prototype.isTransmuxerRequired=function(){return this.hls.isTransmuxingRequired},e.prototype.setTransmuxer=function(e){this.hls.transmuxer=e},e.prototype.getTransmuxer=function(){return this.hls.transmuxer},e.prototype.resetTransmuxer=function(){this.hls.transmuxer&&this.hls.transmuxer.reset()},e.prototype.dispose=function(){this.mpdHandler=h.dispose(this.mpdHandler),this.timestampOffsetService=h.dispose(this.timestampOffsetService),this.segmentPreProcessor=h.dispose(this.segmentPreProcessor),this.segmentParser=null,this.initSegmentStore=h.dispose(this.initSegmentStore),this.adaptationService.release(this.mimeType),this.context&&this.context.serviceManager.get(l.ServiceName.SegmentService).disposeOfType(this.mimeType,this.currentLangObj),this.manifestService=null,this.context=null,this.segmentUnavailabilityHandler=null,this.lastSegmentInfo=null,this.currentLangObj=null,this.currentAdaptationSetId=null,this.loadedAdaptationSetIds=null,this.currentRepresentationId=null},e}();t.SegmentController=q,t.isSegmentOfMainStream=r,t.getSegmentManager=o},125:function(e,t,i){"use strict";function n(e,t,i){var n=r(e,t,i);return e[n]}function r(e,t,i){var n=!e||!e.length,r=t<e[0].startTime+e[0].duration;if(n||r)return 0;var s=e.length-1,u=e[s];if(t>=u.startTime)return s;var d=Math.max(t-e[0].startTime,0),c=Math.min(Math.floor(d/i),e.length-1);return o(e[0])&&o(e[c])?a(e,t,c):null}function o(e){return e&&"number"==typeof e.startTime}function a(e,t,i){for(var n=e.length-1;e[i].startTime>t||t>=e[i].startTime+e[i].duration;){if(t<e[i].startTime?i--:i++,i<=0)return 0;if(i>=n)return n;if(!o(e[i]))return null}return i}function s(e){var t=e._internalId;return{internalRepresentationId:t,representationId:t.representationId,periodId:t.periodId,mimeType:e._mimeType,isInitSegment:!0,downloaded:!1}}Object.defineProperty(t,"__esModule",{value:!0}),t.findSegmentForTime=n,t.findSegmentIndexForTime=r,t.createInitSegmentInfoBase=s},126:function(e,t,i){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r,o=i(46),a=i(6),s=i(7),u=i(1),d=i(23),c=i(41),l=i(13),h=i(21),p=i(22),f=i(16),g=i(27),m=i(5),S=i(4),y=i(2),v=i(0),T=i(127),M=i(492),I=i(493),P=i(494),b=i(77);!function(e){e.CANCEL="CANCEL",e.ERROR_LOADING="ERROR_LOADING",e.ERROR_DECRYPTING="ERROR_DECRYPTING",e.BUSY="BUSY",e.UNKNOWN="UNKNOWN"}(r=t.SegmentLoadingErrorReason||(t.SegmentLoadingErrorReason={}));var C;!function(e){e[e.IDLE=1]="IDLE",e[e.LOADING=2]="LOADING",e[e.CANCELLING=3]="CANCELLING",e[e.TERMINATED=4]="TERMINATED"}(C||(C={}));var R=408,E=function(){function e(e,t,i,n){var r=this;if(void 0===n&&(n=!1),this.cancelLoading=function(){clearTimeout(r.loadTimeoutID),r.loadTimeoutID=null,r.isLoading()&&(delete r.currentSegmentInfo[r.loadingUrl],r.state=C.CANCELLING,r.loader.cancel(),r.currentDownloadInfo&&(r.context.store.dispatch(h.addMetricsValue(r.mimeType,f.MetricType.DownloadInformation,{bytes:r.currentDownloadInfo.loadedBytes,time:r.currentDownloadInfo.elapsedTime,timeToFirstByte:r.currentDownloadInfo.timingInformation.headersReceivedTimestamp-r.currentDownloadInfo.timingInformation.openedTimestamp})),r.canceledSegmentRequestFinishedEvent={success:!1,httpStatus:R,downloadTime:r.currentDownloadInfo.elapsedTime,size:r.currentDownloadInfo.loadedBytes,duration:r.segmentDuration,isInit:r.isInit,mimeType:r.mimeType,uid:void 0}),r.currentDownloadInfo=null)},this.onQosRepresentationChanged=function(e){r.optimizedBitrate=e.optimizedBitrate,r.alternativeBitrate=e.originalBitrate},this.onQosDataAvailable=function(e){return r.qosData=e.r},this.context=e,this.logger=e.logger,this.eventHandler=e.eventHandler,this.customLoaderArgs=e.config.tweaks.segmentLoaderArgs||null,this.customLoader=e.config.tweaks.segmentLoader||null,this.segmentDuration=1,this.segmentNumber=0,this.state=C.IDLE,this.currentDownloadInfo=null,this.mimeType=t,this.alternativeBitrate=0,this.optimizedBitrate=0,this.keyStore=new I.KeyStore,this.keyLoader=new M.KeyLoader(this.context),this.onDownloadShouldBeCancelledCallback=i,this.currentLoadPromise=null,this.currentSegmentInfo={},this.canceledSegmentRequestFinishedEvent=null,this.isFetchSupported="function"==typeof window.fetch,this.isPrefetchingLoader=n,y.ModuleManager.has(v.ModuleName.ContainerMP4)){var o=y.ModuleManager.get(v.ModuleName.ContainerMP4);this.cmafChunkParser=new o.CmafChunkParser(this.context)}this.setupContentLoader()}return e.prototype.isLoading=function(){var e=Boolean(this.keyLoader&&this.keyLoader.isLoading());return this.state===C.LOADING||this.state===C.CANCELLING||this.loader&&this.loader.isLoading()||e},e.prototype.isRetrying=function(){return this.loader&&this.loader.isRetrying()},e.prototype.load=function(e){var t=this;if(this.isLoading())return this.logger.debug("Error loading segment, loader is busy!"+this.loadingUrl),Promise.reject({reason:r.BUSY});this.loader&&this.loader.dispose(),this.canceledSegmentRequestFinishedEvent=null,this.loader=P.getLoader(this.context,this.defaultLoaderArgs),this.state=C.LOADING,this.currentSegmentInfo[e.url]=e,this.encryptionInfo=e.key;var i=Promise.resolve();if(this.encryptionInfo&&!this.encryptionInfo.buffer)if(this.encryptionInfo.method===o.HlsEncryptionMethod.AES_128)i=this.getKey(e).then(function(e){return t.encryptionInfo.buffer=e});else if(this.encryptionInfo.method===o.HlsEncryptionMethod.SAMPLE_AES)return this.eventHandler.fireError(new s.PlayerError(a.ErrorCode.SOURCE_ENCRYPTION_METHOD_NOT_SUPPORTED,{"encryption-method":this.encryptionInfo.method})),Promise.reject({reason:r.ERROR_DECRYPTING});return this.currentLoadPromise=i.then(function(){return t.loadSegment(e.duration,e,e.isInitSegment)["catch"](function(e){throw t.state=C.IDLE,t.currentLoadPromise=null,e})}),this.currentLoadPromise},e.prototype.getCurrentLoadPromise=function(){return this.currentLoadPromise},e.prototype.getKey=function(e){var t=this,i=e.key.uri,n=this.keyStore.get(i);return n?Promise.resolve(n):this.keyLoader.load(i).then(function(e){return t.keyStore.put(i,e),e})["catch"](function(){throw{reason:r.ERROR_DECRYPTING}})},e.prototype.getPreFetchedSegment=function(e,t){return this.isPrefetchingLoader||!this.context.adRestorationOptimizationService.hasPrefetchedSegment(t)?null:(this.currentSegmentInfo[e]&&(this.currentSegmentInfo[e].wasPrefetched=!0),this.context.adRestorationOptimizationService.getPrefetchedSegment(t,this.onDownloadShouldBeCancelledCallback))},e.prototype.loadSegment=function(e,t,i){var n=this,r={};this.isInit=i||!1,this.segmentDuration=t.duration||e,this.segmentNumber=t.segmentNumber,this.loadingUrl=t.url,this.loadingUid=btoa(this.loadingUrl),this.currentDownloadInfo=null,t.byteRange&&(r.Range=["bytes=",t.byteRange.start,"-",t.byteRange.end].join(""));var o=this.context.sourceContext.source&&this.context.sourceContext.source.hasOwnProperty("options"),a=o&&Boolean(this.context.sourceContext.source.options.withCredentials);clearTimeout(this.loadTimeoutID),this.loadTimeoutID=void 0,this.isInit||t.preventDownloadCanceling||(this.loadTimeoutID=setTimeout(this.cancelLoading,S.toMilliSeconds(this.context.settings.XHR_TIMEOUT-1)));var s=this.getPreFetchedSegment(this.loadingUrl,t);if(s)return this.context.logger.debug("return prefetched segment for",this.loadingUrl),s.then(function(e){var t=new b.Stream;return n.loadingFinished(),t.add(e),e.getSegmentInfo().wasPrefetched=!0,t})["catch"](function(e){throw e});var u=Boolean(this.encryptionInfo)||Boolean(this.decrypter),d=t.mimeType.includes("mp4")&&m.MimeTypeHelper.isAV(t.mimeType)&&!t.isTransmuxingRequired,c=this.context.settings.CHUNKED_CMAF_STREAMING&&this.cmafChunkParser&&this.isFetchSupported&&d&&!t.isInitSegment&&!u;return this.loader.load(this.loadingUrl,l.HttpRequestMethod.GET,l.HttpResponseType.ARRAYBUFFER,null,r,a,this.mimeType,c).then(function(e){return n.handleResponse(e.body)})["catch"](function(e){throw n.createLoadingError(e)})},e.prototype.createLoadingError=function(e){var t;return this.state===C.CANCELLING?(this.logger.debug("Cancelled "+this.mimeType+" download ["+this.loadingUrl+"]"),this.canceledSegmentRequestFinishedEvent&&this.eventHandler.dispatchEvent(u.PlayerEvent.SegmentRequestFinished,this.canceledSegmentRequestFinishedEvent),t={reason:r.CANCEL}):this.state===C.LOADING&&(t={reason:r.ERROR_LOADING,info:{response:e,isInit:this.isInit}}),t},e.prototype.getAllLoadingPeriodIds=function(){var e=this;return Object.keys(this.currentSegmentInfo).map(function(t){return e.currentSegmentInfo[t].periodId})},e.prototype.getCurrentLoadingSegmentInfo=function(){return this.isLoading()&&this.currentSegmentInfo&&this.currentSegmentInfo[this.loadingUrl]?this.currentSegmentInfo[this.loadingUrl]:null},e.prototype.attachDecrypter=function(e){this.decrypter=this.decrypter||e},e.prototype.attachClearKeyLoader=function(e){this.clearKeyLoader=this.clearKeyLoader||e},e.prototype.terminate=function(){var e=this;this.isLoading()?(this.currentLoadPromise["catch"](function(){e.state=C.TERMINATED}),this.cancelLoading()):this.state=C.TERMINATED},e.prototype.createSegment=function(e){var t;t=this.isInit?T.SegmentInitType.INIT:T.SegmentInitType.NONE;var i=this.currentSegmentInfo[this.loadingUrl],n=new T.Segment(e,this.mimeType,i.codec,i.periodId,this.segmentDuration,t,(!0),e.byteLength,i.internalRepresentationId,i.startTime);return n.setUrl(this.loadingUrl),n.setSegmentInfo(i),n},e.prototype.decryptAes128=function(e){this.logger.debug("Decrypting AES-128-encryped segment "+this.loadingUrl+", KEY: 0x"+g.FormatHelper.bytesToHex(this.encryptionInfo.buffer)+", IV: 0x"+g.FormatHelper.bytesToHex(this.encryptionInfo.iv));var t=y.ModuleManager.get(v.ModuleName.Crypto).CryptoApi;return new t(this.context,"AES-CBC",this.encryptionInfo.buffer,this.encryptionInfo.iv,this.mimeType).decrypt(e).then(function(e){if(!e||0===e.byteLength)throw{reason:r.ERROR_DECRYPTING};return e})["catch"](function(){throw{reason:r.ERROR_DECRYPTING}})},e.prototype.decryptClearKey=function(e){var t=this,i=Promise.resolve(e);if(this.isInit)i=this.decrypter.parseInitSegment(e),this.clearKeyLoader&&(i=i.then(function(e){return t.clearKeyLoader.load(t.decrypter.getKeyIds()).then(function(i){return t.decrypter.addKeys(i),Promise.resolve(e)})}));else if(this.decrypter.isEncrypted()){var n=g.FormatHelper.bytesToHex(this.decrypter.getKey());this.logger.debug("Decrypting SAMPLE-AES-encrypted segment "+this.loadingUrl+", KEY: 0x"+n),i=this.decrypter.decryptDataSegment(e)}return i["catch"](function(){throw{reason:r.ERROR_DECRYPTING}})},e.prototype.handleResponse=function(e,t){var i=this;if(void 0===t&&(t=!1),e instanceof ArrayBuffer){this.segmentStream=new b.Stream;var n=Promise.resolve(e);this.encryptionInfo&&this.encryptionInfo.method===o.HlsEncryptionMethod.AES_128&&!t?n=this.decryptAes128(e):this.decrypter&&(n=this.decryptClearKey(e)),n.then(function(e){i.state===C.TERMINATED||i.state===C.CANCELLING?i.segmentStream.abort(r.CANCEL):(i.segmentStream.add(i.createSegment(e)),i.segmentStream.end()),i.loadingFinished()})}else this.segmentStream=e.transform(function(e){return i.cmafChunkParser.appendData(e),i.cmafChunkParser.getCompleteChunks()}).transform(function(e){return i.createSegment(e)},function(){return i.loadingFinished()},function(e){return i.logger.debug("Error handling fetch segment request",e),i.loadingFinished(),e.message===c.RequestError.Canceled?r.CANCEL:r.ERROR_LOADING});return Promise.resolve(this.segmentStream)},e.prototype.loadingFinished=function(){this.state=C.IDLE,this.currentLoadPromise=null,this.cmafChunkParser&&this.cmafChunkParser.reset(),this.currentSegmentInfo&&delete this.currentSegmentInfo[this.loadingUrl]},e.prototype.getIndexByBitrate=function(e){for(var t=0;t<this.qosData.length;t++)if(parseInt(this.qosData[t].b,10)===e)return t;return 0},e.prototype.dispose=function(){this.terminate(),clearTimeout(this.loadTimeoutID),this.loader&&this.loader.dispose&&this.loader.dispose(),this.keyLoader&&this.keyLoader.dispose(),this.keyStore&&this.keyStore.dispose(),y.ModuleManager.has(v.ModuleName.Crypto)&&y.ModuleManager.get(v.ModuleName.Crypto).WebWorkerCrypto.dispose(),this.eventHandler.off(d.InternalEvent.QOSRepresentationChanged,this.onQosRepresentationChanged),this.eventHandler.off(d.InternalEvent.QOSDataAvailable,this.onQosDataAvailable),this.loader=null,this.customLoader=null,this.customLoaderArgs=null,this.keyLoader=null,this.loadingUrl=null,this.loadingUid=null,this.encryptionInfo=null,this.currentSegmentInfo=null,this.currentDownloadInfo=null,this.decrypter=null,this.keyStore=null,this.context=null,this.eventHandler=null},e.prototype.setupContentLoader=function(){var e=this;this.eventHandler.one(d.InternalEvent.QOSDataAvailable,this.onQosDataAvailable,!0),this.eventHandler.on(d.InternalEvent.QOSRepresentationChanged,this.onQosRepresentationChanged,!0),this.defaultLoaderArgs=n(n({},P.getLoaderConfig(this.context,this.mimeType)),{onSuccess:function(t,i){var n=p.getMetricsState(e.context.store.getState());!e.isInit&&e.mimeType in n&&(e.context.store.dispatch(h.addMetricsValue(e.mimeType,f.MetricType.DownloadTime,i)),e.context.store.dispatch(h.addMetricsValue(e.mimeType,f.MetricType.DownloadSuccess,!0)),e.context.store.dispatch(h.addMetricsValue(e.mimeType,f.MetricType.DownloadInformation,{bytes:t.length,time:t.elapsedTime,timeToFirstByte:t.timeToFirstByte}))),clearTimeout(e.loadTimeoutID),e.loadTimeoutID=void 0;var r={success:!0,httpStatus:t.status,downloadTime:t.elapsedTime,size:t.length,duration:e.segmentDuration,isInit:e.isInit,mimeType:e.mimeType,uid:e.loadingUid};if(e.qosData){var o=e.getIndexByBitrate(e.optimizedBitrate),a=e.getIndexByBitrate(e.alternativeBitrate);r.qualityInformation={segmentNumber:e.segmentNumber,optimizedBitrate:e.optimizedBitrate,alternativeBitrate:e.alternativeBitrate,optimizedSize:e.qosData[o].s[e.segmentNumber],alternativeSize:e.qosData[a].s[e.segmentNumber],offset:e.qosData[a].o[e.segmentNumber]/e.qosData[a].t}}e.eventHandler.dispatchEvent(u.PlayerEvent.SegmentRequestFinished,r)},onProgress:function(t){var i=.5;if(!(e.isInit||t.elapsedTime<=i||e.state!==C.LOADING)&&(e.currentDownloadInfo=t,e.currentDownloadInfo.segmentDuration=e.segmentDuration,e.currentDownloadInfo.url=e.loadingUrl,e.onDownloadShouldBeCancelledCallback(t))){var n=(8*t.loadedBytes/1e3/t.elapsedTime).toFixed(2);e.logger.debug("cancel download "+e.currentDownloadInfo.url+" (measured bandwidth: "+n+" kbps"),e.context.store.dispatch(h.addMetricsValue(e.mimeType,f.MetricType.DownloadInformation,{bytes:t.loadedBytes,time:t.elapsedTime,timeToFirstByte:t.timingInformation.headersReceivedTimestamp-t.timingInformation.openedTimestamp})),e.cancelLoading()}},onFailure:function(t,i){e.context.store.dispatch(h.addMetricsValue(e.mimeType,f.MetricType.DownloadSuccess,!1)),clearTimeout(e.loadTimeoutID),e.loadTimeoutID=void 0,delete e.currentSegmentInfo[e.loadingUrl],e.eventHandler.dispatchEvent(u.PlayerEvent.SegmentRequestFinished,{success:!1,httpStatus:t&&t.status||0,downloadTime:-1,size:-1,duration:e.segmentDuration,isInit:e.isInit,mimeType:e.mimeType,uid:void 0})}})},e}();t.SegmentLoader=E},127:function(e,t,i){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},n.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var r=i(8),o=i(5),a=function(){function e(e,t,i,n,o,a,u,d,c,l){void 0===a&&(a=s.NONE),this.inbandEvents=[],this.data=e,this.mimeType=t,this.codec=i,this.periodId=n,this.duration=o,this.initType=a,this.isSegmentIndependentlyDecodable=u,this.encrypted=!1,this.metadata={subtitles:[]},this.networkRequestSize=d,this.representationId=c,this.playbackTime=l,this._isDirty=!1,this.drmInitData=null,e instanceof ArrayBuffer||"string"==typeof e&&(this.data=r.ArrayHelper.stringToArrayWithoutEncoding(e).buffer)}return e.prototype.setDrmKid=function(e){this.drmKid=e},e.prototype.hasDrmKid=function(){return Boolean(this.getDrmKid())},e.prototype.getDrmKid=function(){var e,t,i;return e=this.drmKid,i=null!==e&&void 0!==e?e:null===(t=this.initSegment)||void 0===t?void 0:t.getDrmKid(),null!==i&&void 0!==i?i:void 0},e.prototype.setDrmInitData=function(e){this.drmInitData=e},e.prototype.hasDrmInitData=function(){var e;return(null===(e=this.drmInitData)||void 0===e?void 0:e.length)>0},e.prototype.getDrmInitData=function(){return this.hasDrmInitData()?this.drmInitData:[]},e.prototype.getMimeType=function(){return this.mimeType},e.prototype.isInit=function(){return this.initType===s.INIT},e.prototype.isSelfInit=function(){return this.initType===s.SELF_INIT},e.prototype.isEncrypted=function(){return this.encrypted},e.prototype.setEncrypted=function(e){this.encrypted=e},e.prototype.setUrl=function(e){this.loadedUrl=e},e.prototype.getUrl=function(){return this.loadedUrl},e.prototype.getData=function(){return this.data},e.prototype.setData=function(e){this.data=e},e.prototype.getMetadata=function(){return this.metadata},e.prototype.setMetadata=function(e){this.metadata=e},e.prototype.getPlaybackTime=function(){return this.playbackTime},e.prototype.setPlaybackTime=function(e){this.playbackTime=e},e.prototype.getPlaybackEndTime=function(){return this.playbackTime+this.duration},e.prototype.getBaseMediaDecodeTime=function(){return this.baseMediaDecodeTime},e.prototype.setBaseMediaDecodeTime=function(e){this.baseMediaDecodeTime=e},e.prototype.getPresentationTimeOffset=function(){return this.presentationTimeOffset},e.prototype.setPresentationTimeOffset=function(e){this.presentationTimeOffset=e},e.prototype.getTFDTBoxOffset=function(){return this.tfdtBoxOffset},e.prototype.setTFDTBoxOffset=function(e){this.tfdtBoxOffset=e},e.prototype.getParserMetadataValue=function(e){var t;return this.getParserMetadata()&&this.getParserMetadata()[e]?this.getParserMetadata()[e]:(null===(t=this.getInitSegment())||void 0===t?void 0:t.getParserMetadata())?this.getInitSegment().getParserMetadata()[e]:void 0},e.prototype.getTimescale=function(){return this.getParserMetadataValue("timescale")},e.prototype.getIvSize=function(){return this.getParserMetadataValue("ivSize")},e.prototype.getDefaultSampleDuration=function(){return this.getParserMetadataValue("defaultSampleDuration")},e.prototype.getDefaultSampleSize=function(){return this.getParserMetadataValue("defaultSampleSize")},e.prototype.setTimescale=function(e){this.updateParserMetadata({timescale:e})},e.prototype.getPeriodId=function(){return this.periodId},e.prototype.getCodec=function(){return this.codec},e.prototype.setCodec=function(e){this.codec=e},e.prototype.getDuration=function(){return this.duration},e.prototype.setDuration=function(e){this.duration=e},e.prototype.getNetworkRequestSize=function(){return this.networkRequestSize},e.prototype.getRepresentationId=function(){return this.representationId},e.prototype.getParsedData=function(){return this.parsedData},e.prototype.setParsedData=function(e){this.parsedData=e},e.prototype.urlToUniqueId=function(e){return btoa(e)},e.prototype.getSegmentInfo=function(){return this.segmentInfo},e.prototype.getUid=function(){return this.segmentInfo?this.segmentInfo.uid:null},e.prototype.isIndependentlyDecodable=function(){return this.isSegmentIndependentlyDecodable},e.prototype.setSegmentInfo=function(e){this.segmentInfo=e,this.segmentInfo.uid=this.urlToUniqueId(this.segmentInfo.url)},e.prototype.getMediaInfo=function(){var e={};return this.segmentInfo&&this.segmentInfo.bitrate&&(e.bitrate=this.segmentInfo.bitrate),o.MimeTypeHelper.isAudio(this.mimeType)?this.segmentInfo&&this.segmentInfo.sampleRate&&(e.sampleRate=this.segmentInfo.sampleRate):o.MimeTypeHelper.isVideo(this.mimeType)&&(this.segmentInfo&&this.segmentInfo.width&&(e.width=this.segmentInfo.width),this.segmentInfo&&this.segmentInfo.height&&(e.height=this.segmentInfo.height),this.segmentInfo&&this.segmentInfo.frameRate&&(e.frameRate=this.segmentInfo.frameRate)),e},e.prototype.isDirty=function(){return this._isDirty},e.prototype.setDirty=function(e){this._isDirty=e},e.prototype.setInbandEvents=function(e){this.inbandEvents=e},e.prototype.getInbandEvents=function(){return this.inbandEvents},e.prototype.setLastSegment=function(e){this.lastSegment=e},e.prototype.isLastSegment=function(){return this.lastSegment},e.prototype.wasLoadedFrom=function(e){return this.getUrl().includes(e)},e.prototype.getParserMetadata=function(){return this.parserMetadata},e.prototype.setParserMetadata=function(e){this.parserMetadata=e},e.prototype.updateParserMetadata=function(e){this.parserMetadata=n(n({},this.parserMetadata),e)},e.prototype.setBufferBlockId=function(e){this.bufferBlockId=e},e.prototype.getBufferBlockId=function(){return this.bufferBlockId},e.prototype.setInitSegment=function(e){this.initSegment=e},e.prototype.getInitSegment=function(){return this.initSegment},e}();t.Segment=a;var s;!function(e){e[e.NONE=0]="NONE",e[e.INIT=1]="INIT",e[e.SELF_INIT=2]="SELF_INIT"}(s=t.SegmentInitType||(t.SegmentInitType={}))},155:function(e,t,i){"use strict";function n(e,t){return e.getCurrentPeriodId()!==t.targetPeriodId&&e.switchPeriod(t.targetPeriodId),e.seekTo(t.startTime),e.getCurrentAdaptationSet()?r(e,t):Promise.resolve([])}function r(e,t){return e.getInitSegmentInfo().then(function(i){return i.isInitSegment||(t.duration-=i.duration),o(e,t.duration).then(function(e){return[i].concat(e)})})}function o(e,t,i){return void 0===i&&(i=[]),t<=0||!e.hasNext()?Promise.resolve(i):e.getDataSegmentInfo().then(function(n){return t-=n.duration,i.push(n),o(e,t,i)})}function a(e){return e.url+(e.byteRange?","+JSON.stringify(e.byteRange):"")}Object.defineProperty(t,"__esModule",{value:!0});var s=i(3),u=function(){function e(){this.segmentControllers=[]}return e.prototype.updatePlayerContext=function(e){this.context=e},e.prototype.setSegmentControllers=function(e){this.segmentControllers=e},e.prototype.getSegmentControllerMimeTypes=function(){return this.segmentControllers.map(function(e){return e.getMimeType()})},e.prototype.getSegmentInfos=function(e,t){if(!this.context)return Promise.resolve([]);var i=this.context.serviceManager.get(s.ServiceName.ManifestService,this.context.sourceContext.sourceIdentifier),r=i.getPeriodIdForTime(e),o=this.segmentControllers.map(function(i){return n(i,{startTime:e,duration:t,targetPeriodId:r})});return Promise.all(o).then(function(e){return e.flatMap(function(e){return e})})},e.prototype.dispose=function(){this.context=null,this.segmentControllers=[]},e}();t.SegmentInfoService=u,t.getSegmentInfoId=a},156:function(e,t,i){"use strict";var n;Object.defineProperty(t,"__esModule",{value:!0});var r=i(25),o=i(78),a=null;t.getContainerFormat=function(e){return e.containerFormat},t.ContainerFormatReducer=r["default"](a,(n={},n[o.ContainerFormatActionKey.SetContainerFormat]=function(e,t){var i=t.payload;return i},n))},208:function(e,t,i){"use strict";function n(e,t,i){e.hasOwnProperty(t)&&i(e[t])}Object.defineProperty(t,"__esModule",{value:!0});var r,o=i(29),a=i(5),s=i(517);!function(e){e.Encrypted="encrypted",e.Clear="clear"}(r=t.EncryptionState||(t.EncryptionState={}));var u=.1,d=function(){function e(e){this.id=e,this.cachedSegments=[],this.blockStateMap=new Map}return e.prototype.addSegment=function(e){var t=e.getMimeType();e.isInit()&&this.removeLastInitSegment(t),void 0===this.periodId&&(this.periodId=e.getPeriodId());var i=e.isInit()?0:e.getDuration();this.cachedSegments.push({segment:e}),e.isInit()||(this.setMaxSegmentDuration(t,Math.max(i,this.getMaxSegmentDuration(t))),this.updateBufferedRanges(t),this.updatePlaybackTimeRange(e,t)),e.setBufferBlockId(this.id),this.updateMediaTypes(e)},e.prototype.setSegregationCriteria=function(e,t){this.blockStateMap.has(t)||this.initializeBlockStateMapForMimeType(t),this.getBlockState(t).segregationCriteria=e},e.prototype.initializeBlockStateMapForMimeType=function(e){var t={};return this.blockStateMap.set(e,t),t},e.prototype.updateMediaTypeForMimeType=function(e){var t=this.getBlockState(e.mimeType)||this.initializeBlockStateMapForMimeType(e.mimeType);return t.mediaType?(n(e,"codec",function(e){t.mediaType.codec=e}),n(e,"timestampOffset",function(e){t.mediaType.timestampOffset=e}),void n(e,"timescale",function(e){t.mediaType.timescale=e})):void(t.mediaType=e)},e.prototype.getSegregationCriteria=function(e){var t;return null===(t=this.getBlockState(e))||void 0===t?void 0:t.segregationCriteria},e.prototype.updateMediaTypes=function(e){var t=e.getMimeType(),i=this.getMediaType(t);i?(null===i.codec&&(i.codec=e.getCodec()),null==i.timescale&&(i.timescale=e.getTimescale())):(this.blockStateMap.has(t)||this.blockStateMap.set(t,{}),this.getBlockState(t).mediaType={mimeType:t,codec:e.getCodec(),timestampOffset:0,timescale:e.getTimescale()})},e.prototype.getMediaType=function(e){var t,i;return i=null===(t=this.getBlockState(e))||void 0===t?void 0:t.mediaType,null!==i&&void 0!==i?i:null},e.prototype.addMediaType=function(e){a.MimeTypeHelper.isAV(e.mimeType)&&!this.getMediaType(e.mimeType)&&(this.blockStateMap.has(e.mimeType)||this.initializeBlockStateMapForMimeType(e.mimeType),this.getBlockState(e.mimeType).mediaType=e)},e.prototype.removeMediaType=function(e){this.clearSegments(e),this.blockStateMap["delete"](e)},e.prototype.hasMediaType=function(e){var t,i;return i=null===(t=this.blockStateMap)||void 0===t?void 0:t.has(e),null!==i&&void 0!==i&&i},e.prototype.getMediaTypes=function(){return s.getValues(this.blockStateMap).map(function(e){return e.mediaType})},e.prototype.getMediaTypesWithoutSubs=function(){return this.getMediaTypes().filter(function(e){return a.MimeTypeHelper.isAV(e.mimeType)})},e.prototype.removeSegment=function(e){var t=this.cachedSegments.findIndex(function(t){return t.segment===e});if(t>-1){var i=this.cachedSegments[t];this.cachedSegments.splice(t,1),this.updateBufferedRanges(i.segment.getMimeType())}},e.prototype.clearSegments=function(e){var t=this;e?(this.cachedSegments=this.cachedSegments.filter(function(t){return t.segment.getMimeType()!==e}),this.updateBufferedRanges(e)):(this.cachedSegments=[],s.getKeys(this.blockStateMap).forEach(function(e){return t.updateBufferedRanges(e)}))},e.prototype.removeOldSegments=function(e,t){this.cachedSegments=this.cachedSegments.filter(function(i){var n=i.segment,r=n.isInit(),o=n.getMimeType()!==e;return r||o||n.getPlaybackTime()+n.getDuration()>=t}),this.updateBufferedRanges(e)},e.prototype.getBufferedRanges=function(){var e={};return this.blockStateMap.forEach(function(t,i){var n;e[i]=(n=t.bufferedRange,null!==n&&void 0!==n?n:[])}),e},e.prototype.updateBufferedRanges=function(e){var t=this.getAllSegments().filter(function(t){return t.getMimeType()===e&&!t.isInit()});this.blockStateMap.has(e)&&(this.getBlockState(e).bufferedRange=o.BufferRangeHelper.getRangesFromQueue(t,u))},e.prototype.updatePlaybackTimeRange=function(e,t){var i=this.getPlaybackTimeRange(t),n=e.getPlaybackTime(),r=n+e.getDuration();return i?(n<i.start&&(i.start=n),void(r>i.end&&(i.end=r))):void(this.getBlockState(t).playbackTimeRange={start:n,end:r})},e.prototype.getPlaybackTimeRange=function(e){var t,i;return i=null===(t=this.getBlockState(e))||void 0===t?void 0:t.playbackTimeRange,null!==i&&void 0!==i?i:null},e.prototype.getId=function(){return this.id},e.prototype.getPeriodId=function(){return this.periodId},e.prototype.getMinCommonStartTime=function(){return s.getValues(this.blockStateMap).filter(function(e){return e.playbackTimeRange}).map(function(e){return e.playbackTimeRange}).reduce(function(e,t){return Math.max(t.start,e)},-(1/0))},e.prototype.getCommonBufferRanges=function(){return s.getValues(this.blockStateMap).filter(function(e){return e.playbackTimeRange}).map(function(e){return e.playbackTimeRange}).reduce(function(e,t){return{start:Math.max(t.start,e.start),end:Math.min(t.end,e.end)}},{start:-(1/0),end:1/0})},e.prototype.setMaxSegmentDuration=function(e,t){this.blockStateMap.has(e)||this.initializeBlockStateMapForMimeType(e),this.getBlockState(e).maxSegmentDuration=t},e.prototype.getMaxSegmentDuration=function(e){var t;return(null===(t=this.getBlockState(e))||void 0===t?void 0:t.maxSegmentDuration)||0},e.prototype.hasMaxSegmentDuration=function(e){var t;return null!=(null===(t=this.getBlockState(e))||void 0===t?void 0:t.maxSegmentDuration)},e.prototype.hasMaxSegmentDurations=function(){return Boolean(s.getValues(this.blockStateMap).map(function(e){return e.maxSegmentDuration}).find(function(e){return e>=0}))},e.prototype.getMinMaxSegmentDuration=function(){var e=Number.MAX_VALUE;return s.getValues(this.blockStateMap).map(function(e){return e.maxSegmentDuration}).forEach(function(t){return e=t<e?t:e}),e},e.prototype.getAllSegmentsForMimeType=function(e){return this.getAllSegments().filter(function(t){return t.getMimeType()===e})},e.prototype.getAllSegments=function(){return this.cachedSegments.map(function(e){return e.segment})},e.prototype.hasDataSegments=function(e){return this.cachedSegments.some(function(t){return!t.segment.isInit()&&t.segment.getMimeType()===e})},e.prototype.hasSegments=function(){return this.getAllSegments().length>0},e.prototype.getNextSegment=function(){var e=this.cachedSegments.filter(function(e){return!e.pendingRemoval});if(0===e.length)return null;var t=e.find(function(t){return e.filter(function(e){return t.segment.getMimeType()===e.segment.getMimeType()}).some(function(e){return!e.segment.isInit()})});return t?(t.pendingRemoval=!0,t.segment):null},e.prototype.removeLastInitSegment=function(e){var t=this.getAllSegmentsForMimeType(e);if(t.length>0){var i=t[t.length-1];i.isInit()&&this.removeSegment(i)}},e.prototype.getBlockState=function(e){return this.blockStateMap.get(e)},Object.defineProperty(e.prototype,"mediaTypes",{get:function(){var e={};return this.blockStateMap.forEach(function(t,i){e[i]=t.mediaType}),e},enumerable:!0,
configurable:!0}),e}();t.BufferBlock=d},209:function(e,t,i){"use strict";function n(e,t){return Object.keys(e).every(function(i){return t&&t[i]===e[i]})}function r(e){return e.isEncrypted()?p.EncryptionState.Encrypted:p.EncryptionState.Clear}function o(e,t,i){var n=s();return i.every(function(i){var r=i.mimeType;return n.canReuseSourceBuffers(e,t,r)})}function a(e,t){var i=e.getMediaTypes().find(function(e){return e.mimeType===t});return i?i.timescale:0}function s(){return c.getCapabilities().isTizen?S:c.getCapabilities().isLegacyEdge?v:c.getCapabilities()[d.CapabilityKey.isEdge]?y:c.getCapabilities()[d.CapabilityKey.isFirefox]?m:g}function u(e,t,i){var n=e.getSegregationCriteria(i),r=t.getSegregationCriteria(i);return{currentCriteria:n,nextCriteria:r}}Object.defineProperty(t,"__esModule",{value:!0});var d=i(65),c=i(19),l=i(31),h=i(26),p=i(208),f=function(){function e(e){this.requiredMediaTypes=e,this.requiredMediaTypes=e}return e.prototype.isRequiredMimeType=function(e,t){return void 0===t.getPeriodId()||Boolean(this.requiredMediaTypes[t.getPeriodId()]&&this.requiredMediaTypes[t.getPeriodId()][e.getMimeType()])},e.prototype.getSegregationCriteria=function(e){var t,i=r(e),n=h.CodecStringHelper.extractCodec(e.getCodec()),o=e.getPeriodId(),a={encryption:i,codec:n,periodId:o};if(l.isTizen2016()){var s=null===(t=e.getSegmentInfo())||void 0===t?void 0:t.discontinuitySequenceNumber;null!=s&&(a.discontinuityNumber=s)}return a},e.prototype.canAddSegmentToBufferBlock=function(e,t,i){var r=e.getMimeType(),o=t.getSegregationCriteria(r),a=this.isRequiredMimeType(e,t);return o?n(i,o):!(o||!a)&&(!t.getPeriodId()||e.getPeriodId()===t.getPeriodId())},e}();t.Segregation=f,t.areSegregationCriteriaEqual=n,t.canReuseSourceBuffer=o;var g={canReuseSourceBuffers:function(e,t,i){var n,r,o,a,s=u(e,t,i),d=s.currentCriteria,c=s.nextCriteria,l=(null===(n=d)||void 0===n?void 0:n.codec)===(null===(r=c)||void 0===r?void 0:r.codec),h=(null===(o=d)||void 0===o?void 0:o.encryption)===(null===(a=c)||void 0===a?void 0:a.encryption);return l&&h}},m={canReuseSourceBuffers:function(e,t,i){var n,r,o=u(e,t,i),a=o.currentCriteria,s=o.nextCriteria;return(null===(n=a)||void 0===n?void 0:n.codec)===(null===(r=s)||void 0===r?void 0:r.codec)}},S={canReuseSourceBuffers:function(e,t,i){var n=u(e,t,i),r=n.currentCriteria,o=n.nextCriteria,s=r.codec===o.codec&&r.encryption===o.encryption&&r.periodId===o.periodId,d=l.isTizen2016()&&a(e,i)!==a(t,i);return!(l.isTizen2017()||!s||d)}},y={canReuseSourceBuffers:function(e,t,i){var n,r,o,a,s=u(e,t,i),d=s.currentCriteria,c=s.nextCriteria,l=(null===(n=d)||void 0===n?void 0:n.codec)===(null===(r=c)||void 0===r?void 0:r.codec),h=(null===(o=d)||void 0===o?void 0:o.encryption)===p.EncryptionState.Clear,f=(null===(a=c)||void 0===a?void 0:a.encryption)===p.EncryptionState.Clear;return l&&h&&f}},v={canReuseSourceBuffers:function(e,t,i){return!1}}},210:function(e,t,i){"use strict";function n(e,t){if(isNaN(t))return 0;var i=o.toSeconds(Date.now()-e);return i>=t?0:o.toMilliSeconds(t-i)}Object.defineProperty(t,"__esModule",{value:!0});var r=i(11),o=i(4);t.REPRESENTATION_UPDATE_CANCEL="CANCEL";var a=2147483647,s=function(){function e(e){var t=this;this.updateCallbacks=e,this.handlePayloadUpdateError=function(e){t.publishErrorResponse(e),t.clearTimeout()},this.processPayload=function(e){t.success(e),t.clearTimeout(),t._isStopped||t.scheduleUpdate()},this._isStopped=!1}return e.prototype.cancel=function(){this._updateDeferred&&(this._updateDeferred.reject(t.REPRESENTATION_UPDATE_CANCEL),this.updateCallbacks.error(t.REPRESENTATION_UPDATE_CANCEL)),this.clearTimeout()},e.prototype.clearTimeout=function(){window.clearTimeout(this.updateTimeoutId),this.updateTimeoutId=null},e.prototype.stop=function(){null!==this.updateTimeoutId&&(this._isStopped=!0,this.cancel())},e.prototype.start=function(){this._isStopped=!1,this.scheduleUpdate()},e.prototype.scheduleUpdate=function(){this.updateTimeoutId||this._isStopped||this.initializeUpdate()},e.prototype.initializeUpdate=function(){var e=this,t=n(this.getLastReloadTimestamp(),this.getReloadIntervalInSeconds());if(!(t>a)){var i=new r.Deferred,o={wasInvalidated:function(){return i!==e._updateDeferred}};i.promise["catch"](function(){}),this._updateDeferred=i,this.updateTimeoutId=window.setTimeout(function(){return e.payloadUpdate(o)},t)}},e.prototype.payloadUpdate=function(e){var t=this;this.update().then(this.processPayload)["catch"](function(i){e.wasInvalidated()||t.handlePayloadUpdateError(i)})},e.prototype.publishErrorResponse=function(e){this._updateDeferred.reject(e),this.updateCallbacks.error(e)},e.prototype.success=function(e){this._updateDeferred.resolve(e),this.updateCallbacks.success(e)},Object.defineProperty(e.prototype,"isStopped",{get:function(){return this._isStopped},enumerable:!0,configurable:!0}),e.prototype.getPayload=function(){return this._updateDeferred.promise},e}();t.AbstractUpdater=s,t.calculateUpdateDelayInMillis=n},211:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){}return e.PERIOD_COMPLETE={code:"PERIOD_COMPLETE"},e.PERIOD_DROPPED_OUT={code:"PERIOD_DROPPED_OUT"},e}();t.SegmentInfoErrors=n},212:function(e,t,i){"use strict";function n(e,t,i){var n=t.sourceContext.sourceIdentifier,u=t.serviceManager.get(r.ServiceName.ManifestService,n),d=o.ModuleManager.get(a.ModuleName.HLS),c=d.selectors,l=c.getHlsState,h=c.hasInitializedSegmentStartTimes,p=t.serviceManager.get(r.ServiceName.SourceStoreService,n);if(!h(l(p.getState()))){var f=e.getRepresentationId().representationId;u.initializeSegmentStartTimesFromStart(f),s.assignSegmentStartTimesFromHlsPlaylist(i.getCurrentSegmentList().entries,f,u)}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(3),o=i(2),a=i(0),s=i(56);t.initializeHlsSegmentStartTimes=n},213:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e.SetSelectedRepresentationId="@instance/sources/@source/activetracks/setselectedrepresentationid",e.RemoveActiveTrack="@instance/sources/@source/activetracks/remove",e.ClearActiveTracks="@instance/sources/@source/activetracks/clear"}(n=t.ActiveTracksActionType||(t.ActiveTracksActionType={}))},214:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e.SetPlayingPeriodId="@instance/sources/@source/playingTracks/setPlayingPeriodId"}(n=t.PlayingTracksActionKey||(t.PlayingTracksActionKey={}))},215:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e.SetManifest="@instance/manifest/setmanifest",e.SetManifestInitialized="@instance/manifest/setmanifestinitialized",e.RemoveRepresentations="@instance/manifest/removerepresentations",e.UpdateManifest="@instance/manifest/updatemanifest",e.UpdateRepresentation="@instance/manifest/updaterepresentation",e.UpdatePeriodTiming="@instance/manifest/updateperiodtiming",e.AdjustPeriodStartTimes="@instance/manifest/adjustperiodstarttimes",e.SetRepresentationDrmKid="@instance/manifest/setrepresentationdrmkid",e.MarkSegmentAsDownloaded="@instance/manifest/marksegmentasdownloaded",e.SetRepresentationFailedDownload="@instance/manifest/setrepresentationfaileddownload",e.SetRepresentationSegmentIndex="@instance/manifest/setrepresentationsegmentindex",e.SetRepresentationIsLoading="@instance/manifest/setrepresentationisloading",e.SetRepresentationSegmentIndexParsingError="@instance/manifest/setrepresentationsegmentindexparsingerror",e.SetRepresentationAnchorPoint="@instance/manifest/setrepresentationacnhorpoint"}(n=t.ManifestActionType||(t.ManifestActionType={}))},216:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getDrmState=function(e){return e.drm},t.getDrmKeyIdsWithErrors=function(e){var t,i;return i=null===(t=e.drm)||void 0===t?void 0:t.keyIdsWithErrors,null!==i&&void 0!==i?i:[]}},265:function(e,t,i){"use strict";function n(e){return e===g.ADVERTISING_ISSUER_NAME||e===g.ADVERTISING_RESTORE_ISSUER_NAME}function r(e){return Object.keys(k.MediaErrorCode).some(function(t){return t===""+e})}function o(e){var t,i=e.code||(null===(t=e.errorObject)||void 0===t?void 0:t.code),n=e.errorObject||{errorMessage:JSON.stringify(e),code:i},o=r(i),a=o?k.ErrorCodeMap[k.MediaErrorCode[i]]:c.ErrorCode.UNKNOWN;return new l.PlayerError(a,n)}function a(e,t){if(!R.ModuleManager.has(E.ModuleName.RendererMse))return!1;for(var i=R.ModuleManager.get(E.ModuleName.RendererMse).Ranges,n=i.findGaps(e.videoElement.buffered),r=.1,o=!1,a=0;a<n.length;a++){var s=n.end(a)+i.TIME_FUDGE_FACTOR,u=Math.abs(s-t);u<=r&&(o=!0)}return o}var s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},s.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var u,d=i(29),c=i(6),l=i(7),h=i(185),p=i(3),f=i(1),g=i(37),m=i(9),S=i(21),y=i(22),v=i(16),T=i(47),M=i(28),I=i(26),P=i(5),b=i(4),C=i(14),R=i(2),E=i(0),A=i(473),x=i(484),_=i(53),L=i(485),B=i(487),k=i(474),D=i(475),w=i(501),O=i(507),N=i(510),H=i(57),F=i(512),U=i(58);!function(e){e.Unloaded="unloaded",e.Preparing="preparing",e.Loading="loading",e.Loaded="loaded"}(u||(u={}));var j=Object.freeze({id:"auto",bitrate:null}),q=Object.freeze({id:"auto",bitrate:null,width:null,height:null}),V=function(){function e(e){var t=this;this.timeShiftJumpStart=-1,this.timeShiftEstimatedLiveEdge=-1,this.ignoreNextVideoError=!1,this.ended=!1,this.isDvrWindowExceeded=!1,this.controlPermitted=!0,this.lastPlayIssuer="api",this.lastPauseIssuer="api",this.isInitialSeek=!1,this.onPeriodSwitched=function(e,i){t.finishPeriodSwitch(),t.logger.debug("Successfully switched from Period "+e+" to Period "+i);var n={periodId:e},r={periodId:i};t.context.eventHandler.dispatchEvent(f.PlayerEvent.PeriodSwitched,{sourcePeriod:n,targetPeriod:r})},this.onSegmentAvailable=function(e){null!=t.relativeCurrentTimeOffset||e.isInit()||(t.relativeCurrentTimeOffset=t.isLive()?t.calcRelativeCurrentTimeOffsetForLive(e):0)},this.onPlaying=function(){t.isLive()&&t.canResumeLatencyControl()&&t.resumeLatencyControl()},this.videoErrorHandler=function(e){var i=t.isPlaying(),n=function(){i?t.play():t.preload(),t.eventHandler.off(f.PlayerEvent.Error,n)};t.ignoreNextVideoError?t.ignoreNextVideoError=!1:(t.logger.debug("Handling video error: ",e),t.isLive()?t.playerStateService.isPlaying()&&(t.eventHandler.on(f.PlayerEvent.Error,n,!0),t.load(t.currentSource)):(t.unload(),t.eventHandler.fireError(o(e))))},this.controlLiveLatency=function(){var e=t.liveLatencyService.getStatus(t.liveLatencyMode,t.getCommonBufferLevel());t.liveLatencyMode!==e.mode&&(t.context.eventHandler.dispatchEvent(f.PlayerEvent.LatencyModeChanged,{from:t.liveLatencyMode,to:e.mode}),t.liveLatencyMode=e.mode),e.mode===f.LatencyMode.Suspended||t.playerStateService.seekingOrTimeshifting||(e.requiredAction===t.lowLatencyModule.LiveLatencyControlAction.Seek?t.goToLiveEdge():e.requiredAction===t.lowLatencyModule.LiveLatencyControlAction.PlaybackRate&&t.setPlaybackSpeed(1,e.actionParam,!1))},this.onPlaybackStarted=function(){t.playerStateService.stallExit(),t.playerStateService.transitionToPlayingState(t.lastPlayIssuer),t.ended=!1},this.finishPeriodSwitch=function(){(t.playerController&&t.playerController.hasStreamEnded()||t.isReady()&&!t.isPlaying())&&t.playerController.start()},this.onVideoElementPlay=function(){t.playerStateService.transitionToPlayState(!0,t.lastPlayIssuer)},this.onVideoElementPaused=function(){t.logger.insane("video element signaled pause in state: "+t.playerStateService.playbackState),t.playerStateService.transitionToPausedState(!0,t.lastPauseIssuer,!0)},this.mapLangObjectToAudioTrack=function(e){return{id:e.id,lang:e.lang,label:e.label,role:e.role,getQualities:function(){return B.MediaPlayerManifestApiFactory.getAudioQualities(t.manifestService,t.getCurrentPlayingPeriodId(),e.id)}}},this.onVideoElementSeeking=function(e){var i=a(t.context,e.time);if(t.settings.GLOBAL_DISABLE_SEEKING&&!i){var n=Math.abs(e.time-t.lastCurrentTimeUpdate),r=.05;n>r&&(t.logger.debug("Seeking now allowed, seeking back to expected time"),t.context.videoElement.currentTime=t.lastCurrentTimeUpdate)}},this.onVideoTimeupdate=function(e){if(!t.ended){var i=0===t.renderer.getCurrentTime(!0);!t.isPlaying()||t.playerStateService.isSeeking()||t.isStalled()||i||t.handleTimeChanged(t.getCurrentTime())}},this.onContentPlaybackFinished=function(){t.ended=!0},this.onDvrWindowExceeded=function(){t.playerStateService.isPlaying()?t.timeShift(0):t.isDvrWindowExceeded=!0},this.onError=function(e){3001===e.code&&t.unload()},this.fireAudioTracksAdded=function(){for(var e=t.getCurrentTime(),i=0,n=t.getAvailableAudio();i<n.length;i++){var r=n[i];t.context.eventHandler.dispatchEvent(f.PlayerEvent.AudioAdded,{track:r,time:e})}},this.fireAudioTracksRemoved=function(e){for(var i=0,n=t.getAvailableAudio();i<n.length;i++){var r=n[i];t.context.eventHandler.dispatchEvent(f.PlayerEvent.AudioRemoved,{track:r,time:e})}},this.onPeriodSwitch=function(){t.fireAudioTracksRemoved(t.getCurrentTime())},this.onPlaybackSpeedChanged=function(e){t.isLive()&&(t.canResumeLatencyControl()?t.resumeLatencyControl():t.suspendLatencyControl(!1))},this.context=e,this.logger=e.logger,this.config=e.config,this.settings=e.settings,this.renderer=e.renderer,this.eventHandler=e.eventHandler,this.loadState=u.Unloaded,this.context.store.dispatch(S.initializeMetricsForMimeType("default",this.context.settings)),this.playerController=new D.MediaPlayerController(e,this.onPeriodSwitched,this.onSegmentAvailable),R.ModuleManager.has(E.ModuleName.LowLatency)&&(this.lowLatencyModule=R.ModuleManager.get(E.ModuleName.LowLatency)),this.eventHandler.on(f.PlayerEvent.PeriodSwitch,this.onPeriodSwitch),this.eventHandler.on(f.PlayerEvent.PeriodSwitched,this.fireAudioTracksAdded),this.eventHandler.on(f.PlayerEvent.PlaybackSpeedChanged,this.onPlaybackSpeedChanged),this.unsubscribeStorePlayingListener=M.subscribe(this.context.store)(function(e){return T.getIsPlaying(T.getPlayerState(e))},this.onPlaying,function(e,t){return e&&!t})}return e.prototype.createServices=function(e,t){var i=t.serviceManager;this.createSynchronizedTimeService(t),this.createManifestService(t),this.createInitSegmentInfoService(t),this.createManifestLoadingService(t,e),this.createManifestUpdateSchedulingService(t);var n=R.ModuleManager.get(E.ModuleName.ABR).AdaptationService;i.set(p.ServiceName.AdaptationService,new n(t)),i.set(p.ServiceName.TimedMetadataService,new N.TimedMetadataService(t)),i.set(p.ServiceName.SegmentService,new w.SegmentService(t)),i.set(p.ServiceName.HeartbeatService,new A.HeartbeatService(this.playerController),t.sourceContext.sourceIdentifier),this.createSubtitleService(t),this.createLowLatencyService(t)},e.prototype.createSynchronizedTimeService=function(e){var t=e.serviceManager,i=e.sourceContext.sourceIdentifier;if(R.ModuleManager.has(E.ModuleName.DASH)){var n=R.ModuleManager.get(E.ModuleName.DASH);if(!t.has(p.ServiceName.SynchronizedTimeService,i)){var r=new n.SynchronizedTimeService(e,e.sourceContext);t.set(p.ServiceName.SynchronizedTimeService,r,i)}}},e.prototype.createManifestService=function(e){var t=e.serviceManager,i=e.sourceContext.sourceIdentifier;t.has(p.ServiceName.ManifestService,i)?(this.manifestService=t.get(p.ServiceName.ManifestService,i),this.manifestService.restore()):(this.manifestService=new _.ManifestService(e,e.sourceContext),t.set(p.ServiceName.ManifestService,this.manifestService,i))},e.prototype.createInitSegmentInfoService=function(e){var t=e.serviceManager,i=e.sourceContext.sourceIdentifier,n=new O.InitSegmentInfoService(this.manifestService,this.getSourceStoreService());t.set(p.ServiceName.InitSegmentInfoService,n,i)},e.prototype.createManifestLoadingService=function(e,t){var i=e.serviceManager,n=e.sourceContext.sourceIdentifier;if(!i.has(p.ServiceName.ManifestLoadingService,n)){var r=x.createManifestLoadingService(t,e,e.sourceContext);i.set(p.ServiceName.ManifestLoadingService,r,n)}},e.prototype.createManifestUpdateSchedulingService=function(e){var t=e.serviceManager,i=e.sourceContext.sourceIdentifier;if(t.has(p.ServiceName.ManifestUpdateSchedulingService,i))t.get(p.ServiceName.ManifestUpdateSchedulingService,i).restore();else{var n=new L.ManifestUpdateScheduler(e,e.sourceContext);t.set(p.ServiceName.ManifestUpdateSchedulingService,n,i)}},e.prototype.createSubtitleService=function(e){var t=e.serviceManager;if(R.ModuleManager.has(E.ModuleName.Subtitles)){var i=R.ModuleManager.get(E.ModuleName.Subtitles).SubtitleService;t.set(p.ServiceName.SubtitleService,new i(e)),this.subtitleService=t.get(p.ServiceName.SubtitleService)}},e.prototype.createLowLatencyService=function(e){var t=e.serviceManager;R.ModuleManager.has(E.ModuleName.LowLatency)&&(t.set(p.ServiceName.LiveLatencyService,new this.lowLatencyModule.LiveLatencyService(e)),this.liveLatencyService=t.get(p.ServiceName.LiveLatencyService))},e.prototype.disposeServices=function(e){var t,i=this.context.serviceManager;[p.ServiceName.LiveLatencyService,p.ServiceName.SubtitleService,p.ServiceName.TimedMetadataService,p.ServiceName.InitSegmentInfoService].forEach(function(e){return h.disposeService(i,e)});var n=null===(t=this.context.sourceContext)||void 0===t?void 0:t.sourceIdentifier;n&&(h.disposeService(i,p.ServiceName.HeartbeatService,n),e!==g.ADVERTISING_ISSUER_NAME?[p.ServiceName.ManifestService,p.ServiceName.ManifestLoadingService,p.ServiceName.ManifestUpdateSchedulingService,p.ServiceName.SynchronizedTimeService].forEach(function(e){return h.disposeService(i,e,n)}):(i.get(p.ServiceName.ManifestService,n).suspend(),i.get(p.ServiceName.ManifestUpdateSchedulingService,n).suspend()))},e.prototype.calcRelativeCurrentTimeOffsetForLive=function(e){var t=null!=e.getSegmentInfo().wallClockTime?e.getPlaybackTime()-b.toSeconds(e.getSegmentInfo().wallClockTime):0;return this.playerController.getSeekableRange().start+t},e.prototype.play=function(e){return this.lastPlayIssuer=e,this.controlPermitted?this.currentSource?this.playerStateService.isPlaying()?(this.logger.debug("Ignoring play call as play was already triggered or we're already playing"),Promise.resolve()):(this.ended=!1,this.isLive()&&(this.isDvrWindowExceeded||this.getMaxTimeShift()>=0)&&(this.goToLiveEdge(),this.isDvrWindowExceeded=!1),this.playerController.start(),this.playerStateService.transitionToPendingPlayState(!1,e),this.renderer.play()):Promise.resolve():Promise.reject("Play control not permitted")},e.prototype.goToLiveEdge=function(){var e=this;this.settings.ENABLE_SEEK_FOR_LIVE?this.playerStateService.isSeeking()||this.playerController.seek(this.getSeekableRange().end,!0,null,!0):this.playerController.timeShift(0,function(){return e.onTimeShifted()})["catch"](function(){return e.onTimeShiftFailed()})},e.prototype.canResumeLatencyControl=function(){return Boolean(this.liveLatencyService)&&!this.isPaused()&&0===this.getTimeShift()&&1===this.getPlaybackSpeed()&&!this.playerStateService.isTimeShifting()&&!this.playerStateService.isSeeking()},e.prototype.resumeLatencyControl=function(){this.liveLatencyService.resumeControl()},e.prototype.suspendLatencyControl=function(e){void 0===e&&(e=!0);var t=this.liveLatencyMode===f.LatencyMode.Suspended;this.liveLatencyService&&!t&&(this.liveLatencyService.suspendControl(),e&&this.setPlaybackSpeed(1,1,!1))},e.prototype.getCommonBufferLevel=function(){var e=[this.getBufferLevel(m.BufferType.ForwardDuration,m.MediaType.Audio),this.getBufferLevel(m.BufferType.ForwardDuration,m.MediaType.Video)].map(function(e){return e.level}).filter(function(e){return null!==e});return 0===e.length?0:Math.min.apply(Math,e)},e.prototype.preload=function(){this.loadState!==u.Unloaded&&this.playerController&&this.playerController.start()},e.prototype.pause=function(e){this.controlPermitted&&(this.logger.insane("Pause was called via the API"),this.playerStateService.isInitial()||(this.lastPauseIssuer=e,this.isLive()&&this.liveLatencyService&&this.liveLatencyService.isConfigured()&&(this.suspendLatencyControl(),this.controlLiveLatency()),this.playerStateService.isPaused()||this.playerStateService.isStopped()||this.renderer.pause(),this.playerStateService.transitionToPausedState(this.renderer.isPaused(),e)))},e.prototype.mute=function(e){this.isMuted()||(this.renderer.mute(),this.context.eventHandler.dispatchEvent(f.PlayerEvent.Muted,{issuer:e||"api"}))},e.prototype.unmute=function(e){this.isMuted()&&(this.renderer.unmute(),this.context.eventHandler.dispatchEvent(f.PlayerEvent.Unmuted,{issuer:e||"api"}))},e.prototype.seek=function(e,t){var i=this,n=this.config&&this.config.hasOwnProperty("playback"),r=n?this.config.playback:{},o=r.hasOwnProperty("seeking"),a=!o||r.seeking,s=this.isInitialSeek||!this.settings.GLOBAL_DISABLE_SEEKING&&a;if(!s||!this.controlPermitted)return!1;this.ended=!1,this.playerStateService.transitionToSeekingState(e,t,t!==g.STARTUP_ISSUER_NAME);var u=t===g.STARTUP_ISSUER_NAME;return this.playerController.seek(e,u,function(){return i.onSeeked(t)},u),!0},e.prototype.onSeeked=function(e){var t;null===(t=this.playerStateService)||void 0===t?void 0:t.transitionToSeekedState(e!==g.STARTUP_ISSUER_NAME),this.isInitialSeek=!1},e.prototype.handleTimeChanged=function(e){e!==this.lastCurrentTimeUpdate&&(this.context.eventHandler.dispatchEvent(f.PlayerEvent.TimeChanged,{time:e}),this.lastCurrentTimeUpdate=e,this.isLive()&&this.liveLatencyService&&this.liveLatencyService.isConfigured()&&this.controlLiveLatency())},e.prototype.setVolume=function(e,t){var i=this.renderer.getVolume();this.renderer.setVolume(e),i!==e&&this.context.eventHandler.dispatchEvent(f.PlayerEvent.VolumeChanged,{targetVolume:e,sourceVolume:i,issuer:t||"api"})},e.prototype.setAudioQuality=function(e){var t,i=this.getAvailableAudioQualities(),n=this.getAudioQuality();t="auto"===e?j:i.find(function(t){return t.id===e}),t&&n.id!==t.id&&(this.setFixedRepresentation(m.MediaType.Audio,e),this.context.eventHandler.dispatchEvent(f.PlayerEvent.AudioQualityChanged,{sourceQuality:n,sourceQualityId:n.id,targetQuality:t,targetQualityId:t.id}))},e.prototype.getAudioQuality=function(){var e=this.getInitializedMimeTypeFromMediaType(m.MediaType.Audio),t=this.context.serviceManager.get(p.ServiceName.AdaptationService),i=t.isAuto(e),n=t.getCurrentRepresentationId(e);return i||null===n?j:this.getAvailableAudioQualities().find(function(e){return e.id===n.representationId})},e.prototype.setFixedRepresentation=function(e,t){var i=this.getInitializedMimeTypeFromMediaType(e),n=this.context.serviceManager.get(p.ServiceName.AdaptationService);n.setFixedRepresentation(i,t)},e.prototype.setVideoQuality=function(e){var t,i=this.getAvailableVideoQualities(),n=this.getVideoQuality();t="auto"===e?q:i.find(function(t){return t.id===e}),t&&n.id!==t.id&&(this.context.eventHandler.dispatchEvent(f.PlayerEvent.VideoQualityChanged,{sourceQuality:n,sourceQualityId:n.id,targetQuality:t,targetQualityId:t.id}),this.setFixedRepresentation(m.MediaType.Video,e))},e.prototype.getVideoQuality=function(){var e=this.getInitializedMimeTypeFromMediaType(m.MediaType.Video),t=this.context.serviceManager.get(p.ServiceName.AdaptationService),i=t.isAuto(e),n=t.getCurrentRepresentationId(e);return i||null===n?q:this.getAvailableVideoQualities().find(function(e){return e.id===n.representationId})},e.prototype.processSourceContext=function(){var e=this.context.sourceContext;e.source&&e.source.options&&e.source.options.headers&&(this.settings.HTTP_HEADERS=e.source.options.headers)},e.prototype.load=function(e,t,i){var n=this;if("dash"!==e.type&&"hls"!==e.type&&"smooth"!==e.type)return Promise.reject("invalid source");var r=this.getSourceStoreService();if(e.type===m.StreamType.Hls&&R.ModuleManager.has(E.ModuleName.HLS)&&!r.hasReducer("hls")){var o=R.ModuleManager.get(E.ModuleName.HLS);r.addReducer("hls",o.HlsReducer)}Object.keys(F.engineBitmovinSourceReducers).forEach(function(e){r.addReducer(e,F.engineBitmovinSourceReducers[e])}),this.playerStateService=this.context.serviceManager.get(p.ServiceName.PlayerStateService),this.processSourceContext();var a=function(){if(n.loadState===u.Unloaded)return Promise.reject("Unload during load");n.createServices(e,n.context),n.context.sourceContext.source=e.config,n.context.videoElement.eventHandler&&n.context.videoElement.eventHandler.reset(),n.currentSource=e,n.ended=!1,n.isDvrWindowExceeded=!1,n.isInitialSeek=!0,n.logger.debug("setting bitrate boundaries for audio to "+n.settings.MIN_SELECTABLE_AUDIO_BITRATE+" - "+n.settings.MAX_SELECTABLE_AUDIO_BITRATE),n.logger.debug("setting bitrate boundaries for video to "+n.settings.MIN_SELECTABLE_VIDEO_BITRATE+" - "+n.settings.MAX_SELECTABLE_VIDEO_BITRATE),n.liveLatencyService&&(n.liveLatencyMode=f.LatencyMode.Suspended,n.liveLatencyService.reset()),n.renderer.on(C.MediaElementEvent.error,n.videoErrorHandler),n.renderer.on(C.MediaElementEvent.timeupdate,n.onVideoTimeupdate),n.renderer.on(C.MediaElementEvent.seeking,n.onVideoElementSeeking),n.renderer.on(C.MediaElementEvent.playing,n.onPlaybackStarted),n.renderer.on(C.MediaElementEvent.play,n.onVideoElementPlay),n.renderer.on(C.MediaElementEvent.pause,n.onVideoElementPaused),i?n.settings.GLOBAL_DISABLE_SEEKING=i:n.settings.GLOBAL_DISABLE_SEEKING=!1,n.loadState=u.Loading;var t=n.playerController.init(e);return t.then(function(){n.loadState=u.Loaded})},s=Promise.resolve();return this.loadState===u.Loading&&(s=this.unload()),this.playerStateService.reset(),this.loadState=u.Preparing,this.unsubscribeFromStoreStoppedListener=M.subscribe(this.context.store)(function(e){return T.getIsStopped(T.getPlayerState(e))},this.onContentPlaybackFinished,function(e){return e===!0}),this.eventHandler.on(f.PlayerEvent.DVRWindowExceeded,this.onDvrWindowExceeded,!0),this.eventHandler.on(f.PlayerEvent.Error,this.onError,!0),s.then(function(){return n.resolveDrmSystem(e.config)}).then(function(){return n.renderer.ready()}).then(a)},e.prototype.resolveDrmSystem=function(e){var t=this.context.serviceManager.get(p.ServiceName.DrmService);return e&&e.drm&&t?t.resolveDrmSystemEarly(e.drm):Promise.resolve()},e.prototype.getSourceStoreService=function(){return this.context.serviceManager.get(p.ServiceName.SourceStoreService,this.context.sourceContext.sourceIdentifier)},e.prototype.unload=function(e){var t=this;if(this.loadState===u.Unloaded)return Promise.resolve();var i=this.loadState===u.Loaded;this.ended=!1,this.loadState=u.Unloaded,this.ignoreNextVideoError=!0,this.relativeCurrentTimeOffset=null,this.renderer.off(C.MediaElementEvent.error,this.videoErrorHandler),this.renderer.off(C.MediaElementEvent.timeupdate,this.onVideoTimeupdate),this.renderer.off(C.MediaElementEvent.seeking,this.onVideoElementSeeking),this.renderer.off(C.MediaElementEvent.playing,this.onPlaybackStarted),this.renderer.off(C.MediaElementEvent.play,this.onVideoElementPlay),this.renderer.off(C.MediaElementEvent.pause,this.onVideoElementPaused),this.unsubscribeFromStoreStoppedListener(),this.eventHandler.off(f.PlayerEvent.DVRWindowExceeded,this.onDvrWindowExceeded),this.eventHandler.off(f.PlayerEvent.Error,this.onError),this.playerStateService.isPlaying()&&this.renderer.pause(),this.playerStateService.reset();var r=this.context.sourceContext.sourceIdentifier;this.context.serviceManager.has(p.ServiceName.SynchronizedTimeService,r)&&!n(e)&&this.context.serviceManager.get(p.ServiceName.SynchronizedTimeService,r).reset();var o=this.playerController?this.playerController.terminate():Promise.resolve();return o.then(function(){t.currentSource=void 0,t.disposeServices(e),n(e)||t.getSourceStoreService().dispatch(H.clearActiveTracksAction()),i&&t.eventHandler.dispatchEvent(f.PlayerEvent.SourceUnloaded)})},e.prototype.isReady=function(){return this.playerController.isInitialized()},e.prototype.isPlaying=function(){return this.playerStateService.isPlaying()},e.prototype.isPaused=function(){return this.playerStateService.isPaused()},e.prototype.hasEnded=function(){return this.ended},e.prototype.isMuted=function(){return this.renderer.isMuted()},e.prototype.isStalled=function(){return this.playerStateService.isStalled},e.prototype.isLive=function(){return this.manifestService.isLive()},e.prototype.getVolume=function(){return this.renderer.getVolume()},e.prototype.getCurrentTime=function(e){return void 0===e&&(e=m.TimeMode.AbsoluteTime),!this.isLive()&&this.hasEnded()?this.getDuration():e===m.TimeMode.RelativeTime?Math.max(0,this.playerController.getCurrentTime()-this.relativeCurrentTimeOffset):this.playerController.getCurrentTime()},e.prototype.getDuration=function(){return this.manifestService.getDuration()},e.prototype.getAvailableVideoQualities=function(){return this.isReady()?this.manifestService.getVideoRepresentations(this.getCurrentPlayingPeriodId()):[]},e.prototype.getAvailableSegments=function(){return this.isReady()?this.playerController.getAvailableSegments():{}},e.prototype.getAvailableAudioQualities=function(){var e=this.getAudio();if(!this.isReady()||!e)return[];var t=this.manifestService.getAudioRepresentations(this.getCurrentPlayingPeriodId());return t[e.id]?t[e.id]:[]},e.prototype.getDroppedVideoFrames=function(){return this.renderer.getDroppedVideoFrames()},e.prototype.setTargetBufferLevel=function(e,t,i){this.context.bufferSettings.setTargetLevel(e,t,i)},e.prototype.getBufferLevel=function(e,t){var i=this.context.bufferSettings.getTargetLevel(e,t),n={level:null,targetLevel:i,type:e,media:t},r=this.renderer.getCurrentTime(),o=y.getMetricsState(this.context.store.getState()),a=Object.keys(o).find(function(e){return P.MimeTypeHelper.isVideo(e)}),s=Object.keys(o).find(function(e){return P.MimeTypeHelper.isAudio(e)});return t===m.MediaType.Video&&a?n.level=this.playerController.getBufferLevel(a,r,e):t===m.MediaType.Audio&&s&&(n.level=this.playerController.getBufferLevel(s,r,e)),n},e.prototype.getTotalStalledTime=function(){var e=y.getMetricsState(this.context.store.getState());for(var t in e)if(e[t]){var i=y.getMetricsLastEntry(e,t,v.MetricType.StalledSeconds);if(i&&i.value&&!isNaN(i.value))return Math.round(100*i.value)/100}return 0},e.prototype.getInitializedMimeTypeFromMediaType=function(e){var t=y.getMetricsState(this.context.store.getState());return Object.keys(t).find(function(t){return t.includes(e)})},e.prototype.getDownloadedData=function(e){var t=this.getInitializedMimeTypeFromMediaType(e),i=s({},this.getCurrentAdaptationSet(t)),n=s({},this.getCurrentRepresentation(t));return n.id&&(n.id=""+n.id),void 0===n.width&&void 0!==i.width&&(n.width=i.width),n.width=parseInt(""+n.width),void 0===n.height&&void 0!==i.height&&(n.height=i.height),n.height=parseInt(""+n.height),void 0===n.bitrate&&void 0!==i.bitrate&&(n.bitrate=i.bitrate),n.bitrate=parseInt(""+n.bitrate),n.isAuto=this.context.serviceManager.get(p.ServiceName.AdaptationService).isAuto(t),n},e.prototype.getCurrentRepresentation=function(e){if(this.playerController.hasStarted()){var t=y.getMetricsState(this.context.store.getState());if(t[e]){var i=y.getMetricsLastEntry(t,e,v.MetricType.DownloadedRepresentation);return i.value}}return{}},e.prototype.getCurrentAdaptationSet=function(e){if(this.playerController.hasStarted()){var t=y.getMetricsState(this.context.store.getState());if(t[e]){var i=y.getMetricsLastEntry(t,e,v.MetricType.DownloadedAdaptationSet);return i.value}}return{}},e.prototype.getDownloadedVideoData=function(){var e=this.getDownloadedData(m.MediaType.Video),t=!0;return e.hasOwnProperty("isAuto")&&(t=e.isAuto),e&&(e.bitrate||e.id)?{id:e.id,bitrate:e.bitrate,height:e.height,width:e.width,isAuto:t}:{id:"",bitrate:0,height:0,width:0,isAuto:!0}},e.prototype.getDownloadedAudioData=function(){var e=this.getDownloadedData(m.MediaType.Audio),t=!0;return e.hasOwnProperty("isAuto")&&(t=e.isAuto),e&&(e.bitrate||e.id)?{id:e.id,bitrate:e.bitrate,isAuto:t}:{id:"",bitrate:0,isAuto:!0}},e.prototype.getPlaybackVideoData=function(){var e=this.playerController.getPlaybackRepresentation(m.MediaType.Video)||{},t=isNaN(e._height)?0:Number(e._height),i=isNaN(e._width)?0:Number(e._width),n={
id:e._id+"",bitrate:Number(e._bandwidth)||0,height:t,width:i,uid:e.uid};return e._codecs&&(n.codec=I.CodecStringHelper.extractCodecStrings(e._codecs).video),n},e.prototype.getPlaybackAudioData=function(){var e=this.playerController.getPlaybackRepresentation(m.MediaType.Audio)||{},t={id:e._id+"",bitrate:Number(e._bandwidth)};return e._codecs&&(t.codec=I.CodecStringHelper.extractCodecStrings(e._codecs).audio),t},e.prototype.setQueryParameters=function(e){this.settings.QUERY_PARAMETERS=e},e.prototype.clearQueryParameters=function(){this.settings.QUERY_PARAMETERS=void 0},e.prototype.restoreAfterTimeShift=function(e){this.playerStateService.isTimeShifting()&&(this.playerStateService.transitionToTimeShiftedState(e),this.timeShiftEstimatedLiveEdge=-1,this.timeShiftJumpStart=-1),this.isLive()&&(this.canResumeLatencyControl()?this.resumeLatencyControl():this.suspendLatencyControl())},e.prototype.onTimeShiftFailed=function(){this.restoreAfterTimeShift(!1)},e.prototype.onTimeShifted=function(e){this.restoreAfterTimeShift(e!==g.STARTUP_ISSUER_NAME)},e.prototype.getMaxTimeShift=function(){if(this.isLive()&&this.isReady()){var e=this.config.playback&&this.config.playback.timeShift===!1;return e?0:this.playerController.getMaxTimeShift()}},e.prototype.timeShift=function(e,t){var i=this;this.isReady()&&this.getMaxTimeShift()<=0&&(this.playerController.timeShift(e,function(){return i.onTimeShifted(t)})["catch"](function(){return i.onTimeShiftFailed()}),this.timeShiftJumpStart===-1&&(this.timeShiftJumpStart=this.getCurrentTime(),0===this.timeShiftJumpStart&&(this.timeShiftJumpStart=this.playerController.getTimeShiftLiveEdge())),this.timeShiftEstimatedLiveEdge===-1&&(this.timeShiftEstimatedLiveEdge=this.playerController.getTimeShiftLiveEdge()),this.playerStateService.transitionToTimeShiftingState(this.timeShiftJumpStart,this.timeShiftEstimatedLiveEdge+e,t||"api",t!==g.STARTUP_ISSUER_NAME))},e.prototype.getTimeShift=function(){return this.isReady()?this.playerController.getTimeShift():0},e.prototype.addSubtitle=function(e){var t=this;return this.isReady()&&this.subtitleService?Promise.resolve(void 0).then(function(){t.subtitleService.addExternalSubtitle(e)}):Promise.reject(void 0)},e.prototype.removeSubtitle=function(e){this.isReady()&&this.subtitleService&&this.subtitleService.removeSubtitle(e)},e.prototype.enableSubtitle=function(e){return this.isReady()&&this.subtitleService?this.subtitleService.enableSubtitle(e):Promise.resolve(!1)},e.prototype.disableSubtitle=function(e){return this.isReady()&&this.subtitleService?this.subtitleService.disableSubtitle(e):Promise.resolve(!1)},e.prototype.listSubtitles=function(){return this.isReady()&&this.subtitleService&&this.playerController?this.subtitleService.getAvailableSubtitles(this.getCurrentPlayingPeriodId()):[]},e.prototype.setAudio=function(e){var t=this;if(this.isReady()&&this.playerController&&"string"==typeof e){var i=this.getAudio();if(i&&i.id===String(e))return;this.playerController.setAudio(e).then(function(){var e=t.getAudio();e.id!==i.id&&t.context.eventHandler.dispatchEvent(f.PlayerEvent.AudioChanged,{targetAudio:e,sourceAudio:i,time:t.renderer.getCurrentTime()})})["catch"](function(e){t.logger.debug("setAudio failed for lang ",e)})}},e.prototype.getAvailableAudio=function(){return this.isReady()&&this.playerController?this.playerController.getAvailableAudio(this.getCurrentPlayingPeriodId()).map(this.mapLangObjectToAudioTrack):[]},e.prototype.getAudio=function(){if(this.isReady()&&this.playerController){var e=this.playerController.getAudio();if(e)return this.mapLangObjectToAudioTrack(e)}return null},e.prototype.getManifest=function(){var e=this.manifestService.getManifest();if(e)return e._isHls?this.getHlsManifest():e.originalDashManifest},e.prototype.getHlsManifest=function(){return R.ModuleManager.get(E.ModuleName.HLS).selectors.getHlsState(this.getSourceStoreService().getState()).masterPlaylist.string},e.prototype.getBufferedRanges=function(){var e=this.playerController.getBufferedRanges(!0),t=d.BufferRangeHelper.getCommonBufferedRanges(e);return t.map(function(e){return{start:e.getStart(),end:e.getEnd()}})},e.prototype.getSnapshot=function(e,t){if(this.isPlaying()||this.isPaused())return this.renderer.getSnapshotData(e,t)},e.prototype.setPlaybackSpeed=function(e,t,i){void 0===t&&(t=1),void 0===i&&(i=!0),this.renderer.setPlaybackSpeed(e*t),this.playerStateService.setPlaybackSpeed(e,t,i)},e.prototype.getPlaybackSpeed=function(){return this.playerStateService.playbackSpeed},e.prototype.permitControl=function(e){this.controlPermitted=e},e.prototype.getSeekableRange=function(){return this.isLive()&&!this.settings.ENABLE_SEEK_FOR_LIVE||!this.playerController?{start:-1,end:-1}:this.playerController.getSeekableRange()},e.prototype.createManifestApi=function(){return B.MediaPlayerManifestApiFactory.create(this,this.context)},e.prototype.getLatency=function(){return this.liveLatencyService.getLatency()},e.prototype.setTargetLatency=function(e){var t=Math.abs(this.manifestService.getTimeShiftBufferDepthSeconds());e>t&&(e=t,this.logger.debug("Tried to set target latency outside DVR window, corrected to lower bound",t)),this.context.eventHandler.dispatchEvent(f.PlayerEvent.TargetLatencyChanged,{from:this.liveLatencyService.getTargetLatency(),to:e}),this.liveLatencyService.setTargetLatency(e)},e.prototype.getTargetLatency=function(){return this.liveLatencyService.getTargetLatency()},e.prototype.setCatchupConfig=function(e){this.liveLatencyService.setCatchupConfig(e)},e.prototype.getCatchupConfig=function(){return this.liveLatencyService.getCatchupConfig()},e.prototype.setFallbackConfig=function(e){this.liveLatencyService.setFallbackConfig(e)},e.prototype.getFallbackConfig=function(){return this.liveLatencyService.getFallbackConfig()},e.prototype.release=function(e){var t=this;return this.eventHandler.off(f.PlayerEvent.PeriodSwitch,this.onPeriodSwitch),this.eventHandler.off(f.PlayerEvent.PeriodSwitched,this.fireAudioTracksAdded),this.eventHandler.off(f.PlayerEvent.PlaybackSpeedChanged,this.onPlaybackSpeedChanged),this.unsubscribeStorePlayingListener(),this.unload(e).then(function(){return t.playerStateService=null,t.playerController.dispose(),t.playerController=null,t.disposeServices(e),t.renderer.release().then(function(){return t.renderer=null})})},e.prototype.getCurrentPlayingPeriodId=function(){return U.getPlayingPeriodId(this.getSourceStoreService().getState())},e.prototype.updateCallback=function(e){},e.prototype.onFullscreenEnter=function(){},e.prototype.onFullscreenExit=function(){},e.prototype.isAirplayAvailable=function(){return!1},e.prototype.isAirplayActive=function(){return!1},e.prototype.showAirplayTargetPicker=function(){},e}();t.MediaPlayer=V,t.checkIfGapSkip=a},266:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(2),r=i(0),o=function(){function e(){}return e.prototype.getSupportedTechnologies=function(){return n.ModuleManager.has(r.ModuleName.RendererMse)?n.ModuleManager.get(r.ModuleName.RendererMse).technologyChecker.getSupportedTechnologies():[]},e}();t.TechnologyChecker=o},267:function(e,t,i){"use strict";function n(e,t){t[e]||(t[e]={})}function r(e){return e>=Date.now()}Object.defineProperty(t,"__esModule",{value:!0});var o=i(10),a=function(){function e(){this.cache={}}return e.prototype.set=function(e,t,i){var r=o.URLHelper.toFullUrl(e);n(r,this.cache),this.cache[r][t]=i},e.prototype.setExpire=function(e,t){var i=o.URLHelper.toFullUrl(e);n(i,this.cache),this.cache[i].expire=t},e.prototype.get=function(e,t){var i=o.URLHelper.toFullUrl(t),n=this.cache[i];return n&&r(n.expire)?n[e]:void delete this.cache[i]},e.prototype.cacheHttpResponse=function(e,t,i){void 0===i&&(i=1/0),this.set(t,"httpResponse",e),this.setExpire(t,i)},e.prototype.cacheParsedManifest=function(e,t,i){void 0===i&&(i=1/0),this.set(t,"parsedManifest",e),this.setExpire(t,i)},e.prototype.cacheSegmentList=function(e,t,i){void 0===i&&(i=1/0),this.set(t,"segmentList",e),this.setExpire(t,i)},e.prototype.getHttpResponse=function(e){return this.get("httpResponse",e)},e.prototype.getParsedManifest=function(e){return this.get("parsedManifest",e)},e.prototype.getSegmentList=function(e){return this.get("segmentList",e)},e.prototype.clear=function(){this.cache={}},e.prototype.dispose=function(){this.cache=null},e}();t.ManifestCachingService=a},268:function(e,t,i){"use strict";function n(e,t){var i=[];return e.forEach(function(e){return i.push(t(e))}),i}Object.defineProperty(t,"__esModule",{value:!0});var r=i(1),o=i(21),a=i(22),s=i(34),u=i(3),d=i(196),c=function(){function e(){var e=this;this.startOptimization=function(){e.context&&e.context.eventHandler.off(r.PlayerEvent.AdStarted,e.startOptimization),e.prefetchContentSegments(e.segmentInfosToPrefetch),e.segmentInfosToPrefetch=[]}}return e.prototype.updatePlayerContext=function(e){this.mimeTypes=[],this.context=e,this.segmentInfoService=e.segmentInfoService,this.segmentPrefetchingService=e.segmentPrefetchingService},e.prototype.optimizeRestorationAfterUpcomingAdBreak=function(){var e=this,t=d.getPlaybackPosition(this.getSourceState().getState().playback);return this.segmentInfoService.getSegmentInfos(t,this.context.settings.AD_RESTORATION_SEGMENT_PREFETCHING_DURATION).then(function(t){e.addCodecInfo(t),e.segmentInfosToPrefetch=t,e.context&&e.context.eventHandler&&e.context.eventHandler.on(r.PlayerEvent.AdStarted,e.startOptimization)})},e.prototype.getSourceState=function(){return this.context.serviceManager.get(u.ServiceName.SourceStoreService,this.context.sourceContext.sourceIdentifier)},e.prototype.addCodecInfo=function(e){var t=this.context&&this.context.serviceManager,i=this.context.sourceContext.sourceIdentifier;if(t&&this.context.serviceManager.has(u.ServiceName.ManifestService,i)){var n=this.context.serviceManager.get(u.ServiceName.ManifestService,i);e.forEach(function(e){var t=n.getAdaptationSet(e.internalRepresentationId);t&&(e.codec=s.getCodecsFromAdaptationSet(t))})}},e.prototype.prefetchContentSegments=function(e){this.mimeTypes=e.reduce(function(e,t){return e.includes(t.mimeType)||e.push(t.mimeType),e},[]),this.maybeCreateMetrics(),this.segmentPrefetchingService.fetchAll(e)},e.prototype.findMatchingSegmentInfo=function(e,t){var i=this.segmentPrefetchingService.getPrefetchedSegments().get(e);return i?n(i,function(e){return e.segmentInfo}).find(function(e){if(!t)return!0;var i=t.segmentNumber+1,n=Math.round(t.startTime+t.duration),r=e.segmentNumber===i,o=Math.round(e.startTime)===n;return r||o}):null},e.prototype.hasPrefetchedSegment=function(e,t){return!this.context.sourceContext.isAd&&("string"==typeof e&&(e=this.findMatchingSegmentInfo(e,t)),!!e&&Boolean(this.segmentPrefetchingService.getPrefetchedSegment(e)))},e.prototype.getPrefetchedSegment=function(e,t){var i=this,n=this.segmentPrefetchingService.getPrefetchedSegment(e);return this.segmentPrefetchingService.clearPrefetchingQueue(e.mimeType),n&&(this.segmentPrefetchingService.removePrefetchedSegment(e),this.segmentPrefetchingService.setShouldDownloadBeCancelledCallback(e.mimeType,t),n["finally"](function(){i.segmentPrefetchingService&&i.segmentPrefetchingService.removeShouldDownloadBeCancelledCallback(e.mimeType)})),n},e.prototype.getRepresentationForPrefetchedSegment=function(e){var t=this.segmentPrefetchingService.getPrefetchedSegments().get(e);return t?n(t,function(e){return e.segmentInfo.internalRepresentationId}).find(Boolean)||null:null},e.prototype.maybeCreateMetrics=function(){var e=this;if(0!==this.mimeTypes.length&&this.context){var t=a.getMetricsState(this.context.store.getState());this.mimeTypes.forEach(function(i){t[i]||e.context.store.dispatch(o.initializeMetricsForMimeType(i,e.context.settings))})}},e.prototype.dispose=function(){this.context&&this.context.eventHandler.off(r.PlayerEvent.AdStarted,this.startOptimization),this.segmentInfosToPrefetch=[],this.context=null,this.segmentInfoService=null,this.segmentPrefetchingService=null},e}();t.AdRestorationOptimizationService=c},269:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=i(41),o=i(118),a=i(13),s=i(11),u=i(77);!function(e){e.User="user",e.Timeout="timeout"}(n||(n={}));var d=function(){function e(e,t,i){var n=this;this.setProgressListener=function(e){n.progressListener=e},this.onProgress=function(e,t){n.progressListener&&(n.timing.progressTimestamp=o.TimingUtil.getHiResTimestamp(),n.progressListener({totalBytes:e,loadedBytes:t,responseTiming:n.timing}))},this.onSuccess=function(){clearTimeout(n.cancelTimeout)},this.logger=e.logger,this.timeout=i,this.request=t,this.fetching=new s.Deferred,this.bytesReceivedCount=0,this.timing={},this.abortController=new AbortController}return e.prototype.getResponse=function(){return this.load(this.request),this.fetching.promise},e.prototype.cancel=function(e){void 0===e&&(e=n.User),clearTimeout(this.cancelTimeout),this.cancellationReason=e,this.abortController.abort()},e.prototype.load=function(e){var t=this,i={method:e.method,headers:new Headers(e.headers),credentials:e.credentials,signal:this.abortController?this.abortController.signal:void 0};fetch(e.url,i).then(function(e){if(t.timing.headersReceivedTimestamp=o.TimingUtil.getHiResTimestamp(),!e.ok)return void t.onError({error:r.RequestError.Failed,response:t.createHttpResponse(e)});var i=t.createHttpResponse(e);i.body=t.readResponse(e),t.fetching.resolve(i)})["catch"](function(e){t.onError({error:t.getRequestError(e),response:null})}),this.timing.openedTimestamp=o.TimingUtil.getHiResTimestamp(),this.cancelTimeout=setTimeout(function(){return t.cancel(n.Timeout)},this.timeout)},e.prototype.getResponseHeaders=function(e){var t={};return e.headers.forEach(function(e,i){return t[i]=e}),t},e.prototype.createHttpResponse=function(e){return{request:this.request,url:e.url,headers:this.getResponseHeaders(e),status:e.status,statusText:e.statusText}},e.prototype.getRequestError=function(e){return e instanceof DOMException&&e.code===e.ABORT_ERR?this.cancellationReason===n.User?r.RequestError.Canceled:r.RequestError.TimedOut:r.RequestError.Failed},e.prototype.readResponse=function(e){var t=this,i=new u.Stream(this.request.responseType);if(e.body){var n=e.body.getReader(),r=function(){return n.read().then(function(e){var n=e.done,a=e.value;if(n)return t.timing.doneTimestamp=o.TimingUtil.getHiResTimestamp(),void t.onProgress(t.bytesReceivedCount,0);t.bytesReceivedCount+=a.length,t.onProgress(t.bytesReceivedCount,a.length);var s;return s=a instanceof Uint8Array?a.buffer:a,i.add(s),r()})};r().then(function(){i.end(),t.onSuccess()})["catch"](function(e){t.logger.debug("Error reading ReadableStream of fetch request:",e),i.abort(t.getRequestError(e))})}else this.request.responseType===a.HttpResponseType.ARRAYBUFFER&&e.arrayBuffer().then(function(e){i.add(e),i.end(),t.onSuccess()});return i},e.prototype.onError=function(e){clearTimeout(this.cancelTimeout),this.logger.debug("Error performing fetch:",e.error),this.fetching.reject(e)},e}();t.FetchController=d},270:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(155),r=i(500),o=function(){function e(){this.segmentPrefetcher=new r.SegmentPrefetcher(this),this.prefetchedSegments=new Map}return e.prototype.updatePlayerContext=function(e){this.context=e,this.segmentPrefetcher.updateContext(this.context)},e.prototype.setDecrypter=function(e,t){this.segmentPrefetcher.setDecrypter(e,t)},e.prototype.removeDecrypter=function(e){this.segmentPrefetcher.removeDecrypter(e)},e.prototype.getDecrypter=function(e){return this.segmentPrefetcher.getDecrypter(e)},e.prototype.hasMp4Decrypter=function(e){return Boolean(this.getDecrypter(e))},e.prototype.setShouldDownloadBeCancelledCallback=function(e,t){this.segmentPrefetcher.setShouldDownloadBeCancelledCallback(e,t)},e.prototype.removeShouldDownloadBeCancelledCallback=function(e){this.segmentPrefetcher.removeShouldDownloadBeCancelledCallback(e)},e.prototype.fetch=function(e){var t=this;return this.segmentPrefetcher.prefetchSegment(e).then(function(){var i=t.prefetchedSegments.get(e.mimeType).get(n.getSegmentInfoId(e));return i?Promise.resolve(i.loadingPromise):Promise.reject()})},e.prototype.fetchAll=function(e){this.segmentPrefetcher.prefetchSegments(e)},e.prototype.onPrefetch=function(e){var t=e.segmentInfo.mimeType;this.prefetchedSegments.has(t)||this.prefetchedSegments.set(t,new Map),this.prefetchedSegments.get(t).set(n.getSegmentInfoId(e.segmentInfo),e)},e.prototype.hasPrefetchedSegment=function(e){return Boolean(this.findPrefetchedSegment(e))},e.prototype.getPrefetchedSegment=function(e){var t=this.findPrefetchedSegment(e);return t?t.loadingPromise:null},e.prototype.findPrefetchedSegment=function(e){return this.prefetchedSegments.has(e.mimeType)?this.prefetchedSegments.get(e.mimeType).get(n.getSegmentInfoId(e))||null:null},e.prototype.getPrefetchedSegments=function(){return this.prefetchedSegments},e.prototype.removePrefetchedSegment=function(e){this.prefetchedSegments.has(e.mimeType)&&this.prefetchedSegments.get(e.mimeType)["delete"](n.getSegmentInfoId(e))},e.prototype.clearPrefetchingQueue=function(e){this.segmentPrefetcher.clearPrefetchingQueue(e)},e.prototype.reset=function(){this.segmentPrefetcher.reset(),this.prefetchedSegments.clear()},e.prototype.dispose=function(){this.reset(),this.segmentPrefetcher.dispose(),this.segmentPrefetcher=null,this.prefetchedSegments=null},e}();t.SegmentPrefetchingService=o},34:function(e,t,i){"use strict";function n(e,t){return e=h({},e),e.Period=e.Period.map(function(e){if(!e.AdaptationSet)return h({},e);var i=r(e.AdaptationSet),n=i.videoSets,a=i.audioSets,s=i.otherSets,u=o(n,t.video),d={};return a.forEach(function(e){var t=e._lang||"none";d[t]=d[t]||[],d[t].push(e)}),Object.keys(d).forEach(function(e){u=u.concat(o(d[e],t.audio))}),h(h({},e),{AdaptationSet:u.concat(s)})}),e}function r(e){return e.reduce(function(e,t){var i=s(t);return p.MimeTypeHelper.isVideo(i)?e.videoSets.push(t):p.MimeTypeHelper.isAudio(i)?e.audioSets.push(t):e.otherSets.push(t),e},{videoSets:[],audioSets:[],otherSets:[]})}function o(e,t){var i=function(e){for(var i=0;i<t.length;i++)if(0===e.indexOf(t[i]))return i;return t.length+1};return e.sort(function(e,t){var n=i(a(e)),r=i(a(t));return n-r})}function a(e){var t,i;if((null===(i=null===(t=e)||void 0===t?void 0:t._codecs)||void 0===i?void 0:i.length)>0)return e._codecs;if(e.Representation&&e.Representation.length>0){var n=e.Representation[e.Representation.length-1];if(n._codecs)return n._codecs}return""}function s(e){if(e._mimeType)return e._mimeType;if(Array.isArray(e.Representation)){var t=e.Representation.find(function(e){return e._mimeType});if(t)return t._mimeType}return""}function u(e,t){var i=e.Period&&e.Period.length>0;if(!i||0===t.length)return e;var n=e.Period.map(function(e){return d(e,t)}).filter(function(e){return e.AdaptationSet.length>0});return h(h({},e),{Period:n})}function d(e,t){var i=e.AdaptationSet.map(function(i,n){return c(f.createAdaptationSetIdFromMimeTypeAndIndex(e._id,i._mimeType,n),i,t)}).filter(function(e){return e.Representation.length>0});return h(h({},e),{AdaptationSet:i})}function c(e,t,i){var n=t.Representation.filter(function(t){return!i.some(function(i){return i.equals(new g.RepresentationId(e,t._id))})});return h(h({},t),{Representation:n})}function l(e,t){return e.filter(function(e){return p.MimeTypeHelper.isAV(s(e))}).filter(function(e){return t.includes(s(e))})}var h=this&&this.__assign||function(){return h=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},h.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var p=i(5),f=i(43),g=i(44);t.orderAdaptationSetsByCodec=n,t.sortAdaptationSetsByBestCodec=o,t.getCodecsFromAdaptationSet=a,t.getMimeTypeForAdaptationSet=s,t.removeRepresentations=u,t.filterAdaptationSetsBasedOnMimeTypes=l},43:function(e,t,i){"use strict";function n(e,t,i){return new a(e,t+"-"+i)}var r=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var o=i(68),a=function(e){function t(t,i){var n=e.call(this,t)||this;return n._adaptationSetId=i,n}return r(t,e),Object.defineProperty(t.prototype,"adaptationSetId",{get:function(){return this._adaptationSetId},enumerable:!0,configurable:!0}),t.prototype.equals=function(t){return e.prototype.equals.call(this,t)&&this.adaptationSetId===t.adaptationSetId},t.prototype.key=function(){return e.prototype.key.call(this)+"-"+this.adaptationSetId},t}(o.PeriodId);t.AdaptationSetId=a,t.createAdaptationSetIdFromMimeTypeAndIndex=n},44:function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=i(43),o=function(e){function t(t,i){var n=e.call(this,t.periodId,t.adaptationSetId)||this;return n._representationId=i,n}return n(t,e),Object.defineProperty(t.prototype,"representationId",{get:function(){return this._representationId},enumerable:!0,configurable:!0}),t.prototype.equals=function(t){return e.prototype.equals.call(this,t)&&this.representationId===t.representationId},t.prototype.key=function(){return e.prototype.key.call(this)+"-"+this.representationId},t.from=function(e){return e._representationId&&e._adaptationSetId&&e._periodId?new t(new r.AdaptationSetId(e._periodId,e._adaptationSetId),e._representationId):null},t}(r.AdaptationSetId);t.RepresentationId=o},472:function(e,t,i){"use strict";function n(e){var t=c.getMetricsHistoryFromInstanceState(e,"default",l.MetricType.RequestedRepresentations);return t.map(function(e){return e.value})}function r(e,t){return t.some(function(t){return e.some(function(e){return e.equals(t)})})}function o(e,t){return e.getAllRepresentations().filter(function(e){return e.associatedKid&&t.includes(e.associatedKid)}).map(function(e){return e._internalId})}function a(e,t,i){i.setRepresentationDrmKid(t,e)}function s(e,t,i){var n=i.getRepresentationDrmKid(t);return e!==n}Object.defineProperty(t,"__esModule",{value:!0});var u=i(3),d=i(21),c=i(22),l=i(16),h=i(28),p=i(216),f=function(){function e(e,t){var i=this;this.onDownloadedRepresentationExcludedCallback=t,this.onDrmKidsWithErrorsChanged=function(e,t){if(void 0!==e&&void 0!==t){var n=e.filter(function(e){return!t.includes(e)});i.maybeExcludeRepresentations(n)}};var n=e.sourceContext.sourceIdentifier;this.store=e.store,this.logger=e.logger,this.sourceStore=e.serviceManager.get(u.ServiceName.SourceStoreService,n),this.manifestService=e.serviceManager.get(u.ServiceName.ManifestService,n),this.unsubscribeFromStore=h.subscribe(this.sourceStore)(p.getDrmKeyIdsWithErrors,this.onDrmKidsWithErrorsChanged)}return e.prototype.maybeExcludeRepresentations=function(e){var t=o(this.manifestService,e),i=this.store.getState();if(0!==t.length&&void 0!==i){var a=n(i),s=r(a,t);this.logger.debug("Excluding representations due to DRM licenses not being available",t),this.manifestService.excludeRepresentations(t),s&&(this.store.dispatch(d.clearMetricsHistory("default",l.MetricType.RequestedRepresentations)),this.onDownloadedRepresentationExcludedCallback())}},e.prototype.trackSegment=function(e){var t=e.getDrmKid();if(void 0!==t){var i=this.sourceStore.getState(),n=e.getRepresentationId(),r=i?p.getDrmKeyIdsWithErrors(i):[];s(t,n,this.manifestService)&&(a(t,n,this.manifestService),this.maybeExcludeRepresentations(r))}},e.prototype.dispose=function(){this.unsubscribeFromStore()},e}();t.DrmKidErrorHandler=f},473:function(e,t,i){"use strict";function n(e){e.shouldClearSubtitleServiceBuffers()&&e.clearSubtitleServiceBuffers()}function r(e){return e.isLoadingLastPeriod()?(e.areMediaTypesFinalForPlayingPeriod()?e.maybeStop():e.isAVCompletelyLoaded()&&e.signalEndOfStream(),void n(e)):void e.switchLoadingPeriod()}function o(e){var t=e.getActiveMimeTypes(),i=t.length>0;i&&e.requestSegmentsForMimeTypes(t),e.areAllLoadersReady()&&(i?n(e):r(e))}function a(e){e.shouldSuspendHeartbeat()||o(e)}Object.defineProperty(t,"__esModule",{value:!0});var s=250,u=function(){function e(e){this.mediaPlayerController=e,this.heartbeatTimeoutId=-1}return e.prototype.resetHeartbeatTimeout=function(){var e=this;clearTimeout(this.heartbeatTimeoutId),this.heartbeatTimeoutId=window.setTimeout(function(){return e.beat()},s)},e.prototype.beat=function(){this.resetHeartbeatTimeout(),a(this.mediaPlayerController)},Object.defineProperty(e.prototype,"started",{get:function(){return this.heartbeatTimeoutId!==-1},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.beat()},e.prototype.stop=function(){clearTimeout(this.heartbeatTimeoutId),this.heartbeatTimeoutId=-1},e.prototype.dispose=function(){this.stop()},e}();t.HeartbeatService=u},474:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e[e.MEDIA_ERR_NETWORK=2]="MEDIA_ERR_NETWORK",e[e.MEDIA_ERR_DECODE=3]="MEDIA_ERR_DECODE",e[e.MEDIA_ERR_SRC_NOT_SUPPORTED=4]="MEDIA_ERR_SRC_NOT_SUPPORTED"}(n=t.MediaErrorCode||(t.MediaErrorCode={}));var r;!function(e){e[e.MEDIA_ERR_DECODE=1301]="MEDIA_ERR_DECODE",e[e.MEDIA_ERR_NETWORK=1400]="MEDIA_ERR_NETWORK",e[e.MEDIA_ERR_SRC_NOT_SUPPORTED=1204]="MEDIA_ERR_SRC_NOT_SUPPORTED"}(r=t.ErrorCodeMap||(t.ErrorCodeMap={}))},475:function(e,t,i){"use strict";function n(e,t){return!_.areAudioMimeCodecsCompatible({mimeType:e._mimeType,codec:I.getCodecsFromAdaptationSet(e)},{mimeType:t._mimeType,codec:I.getCodecsFromAdaptationSet(t)})}Object.defineProperty(t,"__esModule",{value:!0});var r=i(3),o=i(15),a=i(1),s=i(23),u=i(9),d=i(38),c=i(21),l=i(66),h=i(52),p=i(28),f=i(26),g=i(5),m=i(4),S=i(14),y=i(2),v=i(0),T=i(480),M=i(472),I=i(34),P=i(68),b=i(103),C=i(57),R=i(54),E=i(513),A=i(58),x=i(478),_=i(516),L=function(){function e(e,t,i){var n=this;this.segmentControllerMap={},this.onSegmentAvailable=function(e){var t=e.getMimeType();if(!n.clearBuffersPromise){if(n.drmKidErrorHandler.trackSegment(e),n.shouldDropSegment(e))return void n.context.logger.debug("Dropping segment "+e.getUrl());if(!e.isInit()){var i=n.getTimestampOffset(t),r=n.segmentControllerMap[t];r&&n.isAVMultiplexed(r)&&n.addRequiredMediaTypesForMuxedContent(e.getPeriodId()),n.bufferController.updateMediaType(e.getPeriodId(),{mimeType:t,timestampOffset:i,codec:e.getCodec()})}n.bufferController.addSegment(e).then(function(){n.heartbeatService&&n.heartbeatService.beat()}),n.segmentAvailableCallback(e)}},this.finishPeriodSwitch=function(e){var t=e.targetPeriodId,i=n.getCurrentPlayingPeriodId();n.setCurrentPlayingPeriodId(t);var r=n.getCurrentPlayingPeriod();r&&r.AdaptationSet.forEach(function(e){return n.storeDrmInitDataFromManifest(e)}),n.periodSwitchedCallback(i,t)},this.endStallAtGapHandler=function(){var e=n.bufferController.getBufferedRangesMap(),t=Math.max.apply(Math,Object.values(e).filter(function(e){return e.length>0}).map(function(e){return e[e.length-1].start}));n.seek(t,!1,null,!1,!0)},this.mpdAvailableHandler=function(){n.applyManifestTimings(),n.initialized&&n.updatePeriodInformation(),n.handleDroppedOutPeriods(),n.initializeThumbnails(),n.initialized?n.getAllSegmentControllers().forEach(function(e){return e.updateMpd()}):n.finishInit(),n.context.serviceManager.get(r.ServiceName.TimedMetadataService).parseEventStream()},this.onSegmentRequestFinished=function(e){var t=408;if(e){if(e.success||e.httpStatus===t){var i=n.segmentControllerMap[e.mimeType];i&&n.updateAdaptationLogicData(e,i)}e.success||n.heartbeatService.beat()}},this.onPeriodSwitchHandler=function(){n.isPeriodSwitchHappeningNow=!0},this.onPeriodSwitchedHandler=function(){n.isPeriodSwitchHappeningNow=!1},this.firePlaybackFinishedEvent=function(){return n.getAllSegmentControllers().every(function(e){return e.hasNext()})?void n.logger.debug("ignoring ended event in firePlaybackFinishedEvent as there are more segments available"):n.manifestService.isLastPeriod(n.getCurrentPlayingPeriodId())?void(n.bufferController.hasFutureBufferBlockData()||(n.stop(),n.logger.debug("Stopping buffer controller"),n.bufferController.stop(!0),n.playerStateService.transitionToStoppedState())):void n.logger.debug("ignoring ended event in firePlaybackFinishedEvent as there is a future period")},this.onSeekedHandler=function(){n.lastSeekTarget=n.renderer.getCurrentTime()},this.context=e,this.logger=e.logger,this.settings=e.settings,this.bufferSettings=e.bufferSettings,this.eventHandler=e.eventHandler,this.renderer=e.renderer,this.periodSwitchedCallback=t,this.segmentAvailableCallback=i,this.initialized=!1,this.initPromise=null,this.isPeriodSwitchHappeningNow=!1,this.mimeTypes={},this.lastCurrentTime=0,this.seekCounter=0,this.eosSignaled=!1,this.isSwitchingAudioTrack=!1}return e.prototype.addRequiredMediaTypesForMuxedContent=function(e){this.bufferController.addRequiredMediaType(e,"video/mp4"),this.bufferController.addRequiredMediaType(e,"audio/mp4")},e.prototype.getTimestampOffset=function(e){var t,i,n=this,r=this.segmentControllerMap[e];return!r&&g.MimeTypeHelper.isAV(e)&&(r=Object.keys(this.segmentControllerMap).filter(function(e){return g.MimeTypeHelper.isAV(e)}).map(function(e){return n.segmentControllerMap[e]}).filter(function(e){return n.isAVMultiplexed(e)}).shift()),i=null===(t=r)||void 0===t?void 0:t.getMPDHandler().getTimestampOffset(),null!==i&&void 0!==i?i:0},e.prototype.restorePlaybackPositionAfterDownloadedRepresentationWasExcluded=function(){var e=this,t=this.manifestService.isLive(),i=t?this.getTimeShift():this.renderer.getCurrentTime();t?this.timeShift(i,function(){},!0)["catch"](function(t){return e.context.logger.debug("TimeShift failed",t)}):this.seek(i,!1,null,!1,!1,!0)},e.prototype.onDownloadedRepresentationExcluded=function(){this.restorePlaybackPositionAfterDownloadedRepresentationWasExcluded(),this.context.logger.debug("manifest update interrupted by DRM key status change")},e.prototype.shouldDropSegment=function(e){var t=g.MimeTypeHelper.isSubtitle(e.getMimeType()),i=this.context.sourceContext.technology.streaming===u.StreamType.Hls,n=h.getStartTimeOffset(this.getSourceStore().getState()),r=n+this.manifestService.getDuration(),o=this.isVod()&&e.getPlaybackTime()>=r,a=this.eosSignaled||o,s=this.manifestService.isRepresentationExcluded(e.getRepresentationId());return!t&&!i&&a||s},e.prototype.getSourceStore=function(){return this.context.serviceManager.get(r.ServiceName.SourceStoreService,this.context.sourceContext.sourceIdentifier)},e.prototype.isAVMultiplexed=function(e){var t=f.CodecStringHelper.extractCodecStrings(e.getCodecs());return Boolean(t.video&&t.audio)},e.prototype.getMaxTimeShift=function(){return this.getTimeShiftHandler().getMaxTimeShift()},e.prototype.storeDrmInitDataFromManifest=function(e){if(e){for(var t=this.manifestService.getContentProtectionForAdaptationSet(e),i=[],n=0;n<t.length;n++){var r=t[n];if(r.pssh&&r.pssh.length>0)for(var o=0;o<r.pssh.length;o++)this.logger.debug("adding pssh for "+r.name+": "+r.pssh[o]),i.push({initData:r.psshData[o],initDataStr:r.pssh[o],systemID:r.schemeIdUri,systemIDraw:r.schemeIdUri.replace("urn:uuid:","").replace(/-/g,""),systemName:d.KeySystemKind[r.name.toUpperCase()],kid:[]})}this.renderer.addDrmInitData(i)}},e.prototype.setupEventHandlers=function(){this.eventHandler.on(a.PlayerEvent.PeriodSwitch,this.onPeriodSwitchHandler,!0),this.eventHandler.on(a.PlayerEvent.PeriodSwitched,this.onPeriodSwitchedHandler,!0),this.eventHandler.on(a.PlayerEvent.Seeked,this.onSeekedHandler,!0),this.eventHandler.on(s.InternalEvent.EndStallAtGap,this.endStallAtGapHandler,!0);
},e.prototype.removeEventHandlers=function(){this.eventHandler.off(a.PlayerEvent.PeriodSwitch,this.onPeriodSwitchHandler),this.eventHandler.off(a.PlayerEvent.PeriodSwitched,this.onPeriodSwitchedHandler),this.eventHandler.off(a.PlayerEvent.Seeked,this.onSeekedHandler),this.eventHandler.off(a.PlayerEvent.SegmentRequestFinished,this.onSegmentRequestFinished),this.eventHandler.off(s.InternalEvent.EndStallAtGap,this.endStallAtGapHandler,!0),this.eventHandler.off(s.InternalEvent.FinishPeriodSwitch,this.finishPeriodSwitch,!0)},e.prototype.subscribeToManifestChanges=function(){var e=this.getSourceStore();!this.unsubscribeFromManifestStore&&e&&(this.unsubscribeFromManifestStore=p.subscribe(e)(R.getManifest,this.mpdAvailableHandler,function(e,t){return e.isInitialized&&!t.isInitialized}))},e.prototype.unsubscribeFromManifestChanges=function(){this.unsubscribeFromManifestStore&&(this.unsubscribeFromManifestStore(),this.unsubscribeFromManifestStore=null)},e.prototype.setupControllerForAdaptationSet=function(e){var t=I.getMimeTypeForAdaptationSet(e);if(g.MimeTypeHelper.isAV(t)){this.context.store.dispatch(c.initializeMetricsForMimeType(t,this.context.settings)),this.mimeTypes[t]=I.getCodecsFromAdaptationSet(e);var i=this.getCurrentPlayingPeriodId();this.segmentControllerMap[t]=new b.SegmentController(this.context,this.onSegmentAvailable,t,this.mimeTypes[t],e.isTransmuxingRequired,this.manifestLoader,i),i&&this.storeDrmInitDataFromManifest(e),this.context.segmentInfoService&&this.context.segmentInfoService.setSegmentControllers(Object.values(this.segmentControllerMap))}},e.prototype.setInitialPeriod=function(){var e=this.manifestService.isLive()?this.getInitialPeriodForLive():this.getInitialPeriodForVod();this.currentLoadingPeriodId=e,this.setCurrentPlayingPeriodId(this.currentLoadingPeriodId),this.logger.debug("setting initial period to "+this.currentLoadingPeriodId)},e.prototype.getInitialPeriodForLive=function(){var e=m.toSeconds(Date.now())-this.manifestService.getDesiredDistanceToLiveEdge();return this.manifestService.getPeriodIdForTime(e)},e.prototype.getInitialPeriodForVod=function(){var e=this.context.serviceManager.get(r.ServiceName.StartOffsetService),t=e.getStartOffset(this.context.sourceContext.source);return this.manifestService.getPeriodIdForTime(t)},e.prototype.updatePeriodForTimeshift=function(e,t){var i=this.getCurrentPlayingPeriodId();i||(this.setCurrentPlayingPeriodId(e),this.bufferController.setInitialPeriod(e)),this.currentLoadingPeriodId!==e&&this.switchLoadingPeriodForAllMedia(e),t&&i!==e&&(this.context.logger.debug("Updating current playing period to "+e),this.setCurrentPlayingPeriodId(e))},e.prototype.getCurrentPlayingPeriod=function(){return this.manifestService.findPeriod(this.getCurrentPlayingPeriodId())},e.prototype.updateVideoAndAudioMediaTypes=function(e){var t=e.AdaptationSet.find(function(e){return g.MimeTypeHelper.isVideo(e._mimeType)});t&&this.bufferController.addRequiredMediaType(e._id,t._mimeType);var i=e.AdaptationSet.find(function(e){return g.MimeTypeHelper.isAudio(e._mimeType)});i&&this.bufferController.addRequiredMediaType(e._id,i._mimeType)},e.prototype.updateSubtitleMediaTypes=function(e){var t=this;e.AdaptationSet.filter(function(e){return g.MimeTypeHelper.isSubtitle(e._mimeType)}).forEach(function(i){t.bufferController.addRequiredMediaType(e._id,i._mimeType)})},e.prototype.updateMediaTypes=function(e){this.updateVideoAndAudioMediaTypes(e),this.updateSubtitleMediaTypes(e)},e.prototype.updatePeriodInformation=function(){var e=this;this.manifestService.getAllPeriods().forEach(function(t){e.updateMediaTypes(t),e.bufferController.checkIfEndOfBufferReached(e.settings.END_OF_BUFFER_TOLERANCE)})},e.prototype.finishInit=function(){var e=this;return this.initPromise?this.initPromise:this.initialized===!0||null===this.manifestService.getManifest()?this.initPromise=Promise.resolve():(this.disposeSegmentControllers(),this.mimeTypes={},this.initPromise=this.renderer.ready().then(function(){return e.initializeDependents()}))},e.prototype.disposeSegmentControllers=function(){var e=this;this.segmentControllerMap&&(Object.keys(this.segmentControllerMap).forEach(function(t){return e.segmentControllerMap[t].dispose()}),this.segmentControllerMap={})},e.prototype.createTransmuxer=function(){var e=this;if(y.ModuleManager.has(v.ModuleName.ContainerTS)){var t=y.ModuleManager.get(v.ModuleName.ContainerTS);this.getAllSegmentControllers().filter(function(e){return e.isTransmuxerRequired()}).forEach(function(i){e.transmuxer=e.transmuxer||new t.WebWorkerTransmuxer(e.context),i.setTransmuxer(e.transmuxer)}),this.subtitleService&&this.subtitleService.setTransmuxer(this.transmuxer)}},e.prototype.initializeDependents=function(){this.setupEventHandlers(),this.setInitialPeriod(),this.initializeBufferController(),this.updatePeriodInformation();var e=this.getCurrentPlayingPeriod()||this.manifestService.getFirstPeriod();e&&this.initializeSegmentController(e),this.enableForcedSubtitles(),this.createTransmuxer(),this.initialized=!0},e.prototype.enableForcedSubtitles=function(){var e=this.getAudioSegmentController();if(this.subtitleService&&e){var t=e.getCurrentLangObj().lang;this.subtitleService.enableForcedSubtitle(t)}},e.prototype.initializeSegmentController=function(e){var t,i,n=this,r=(i=null===(t=e)||void 0===t?void 0:t.AdaptationSet,null!==i&&void 0!==i?i:[]);r.forEach(function(e){return n.createSegmentController(e)})},e.prototype.createSegmentController=function(e){var t=I.getMimeTypeForAdaptationSet(e);g.isMediaTypeContained(this.mimeTypes,t)||this.setupControllerForAdaptationSet(e)},e.prototype.initializeBufferController=function(){this.bufferController=new T.BufferController(this.context,this.manifestService.getTotalDuration(),this.getCurrentPlayingPeriodId())},e.prototype.getBufferLevel=function(e,t,i,n){return void 0===n&&(n=!0),this.bufferController?this.bufferController.getOverallBufferLevel(e,t,i,n):0},e.prototype.handleDroppedOutPeriods=function(){var e=this,t=this.getCurrentPlayingPeriodId();if(null!=t||null!=this.currentLoadingPeriodId){var i=!0,n=!0;this.manifestService.getAllPeriods().forEach(function(r){r._id===t&&(i=!1),r._id===e.currentLoadingPeriodId&&(n=!1)}),i?(this.logger.debug("Playing period dropped out of the manifest, timeshifting to current position"),this.switchLoadingPeriodForAllMedia(this.manifestService.getPeriodIdForTime(this.getCurrentTime())),this.timeShift(this.getTimeShift())["catch"](function(t){return e.context.logger.debug("TimeShift failed",t)})):n&&(this.logger.debug("Current loading period ("+this.currentLoadingPeriodId+") dropped out of the manifest, switching to first available one"),this.getAllSegmentControllers().forEach(function(e){return e.invalidateOngoingRequests()}),this.switchLoadingPeriodForAllMedia(this.manifestService.getFirstPeriod()._id))}},e.prototype.initializeThumbnails=function(){var e=this;this.context.serviceManager.maybeCall(r.ServiceName.ThumbnailService,function(t){e.context.sourceContext.source&&e.context.sourceContext.source.thumbnailTrack||t.addThumbnails(e.manifestService.getAllDashThumbnailSources())})},e.prototype.applyManifestTimings=function(){var e=this.manifestService.isLive(),t=this.context.serviceManager.get(r.ServiceName.StartOffsetService),i=this.manifestService.hasSuggestedStartPosition();if(e){var n=this.manifestService.getTimeShiftBufferDepthSeconds();0!==n&&(this.metadataParsedService.expirationTimeInSeconds=n),i&&(t.manifestStartOffset=this.manifestService.getLiveStartOffset(),this.adjustMaximumBufferLevel())}else i&&(t.manifestStartOffset=this.manifestService.getVodStartOffset())},e.prototype.adjustMaximumBufferLevel=function(){var e=Math.abs(this.manifestService.getLiveStartOffset(!1));e=e>0?e:this.manifestService.getMaxSegmentDuration();var t=Math.min(e,this.bufferSettings.getForwardTargetLevel(u.MediaType.Video)),i=Math.min(e,this.bufferSettings.getForwardTargetLevel(u.MediaType.Audio));this.bufferSettings.setMaximumBufferLevel(u.BufferType.ForwardDuration,t,u.MediaType.Video),this.bufferSettings.setMaximumBufferLevel(u.BufferType.ForwardDuration,i,u.MediaType.Audio)},e.prototype.terminate=function(){this.logger.debug("stopping playback"),this.stop(),this.getAllSegmentControllers().forEach(function(e){return e.stop()}),this.bufferController&&this.bufferController.stop(!0),this.transmuxer=o.dispose(this.transmuxer),this.timeshiftHandler=o.dispose(this.timeshiftHandler),this.drmKidErrorHandler=o.dispose(this.drmKidErrorHandler),this.cachedSeekableRange=null,this.renderer.off(S.MediaElementEvent.ended,this.firePlaybackFinishedEvent);var e=this.renderer.shutdown()["catch"](function(){return Promise.resolve()});return this.removeEventHandlers(),this.initialized=!1,this.setCurrentPlayingPeriodId(null),this.mimeTypes=null,this.context.store.dispatch(l.resetDrmKidErrors()),this.manifestService.resetExcludedRepresentations(),this.disposeSegmentControllers(),e},e.prototype.dispose=function(){this.timeshiftHandler=o.dispose(this.timeshiftHandler),this.bufferController=o.dispose(this.bufferController);try{this.removeEventHandlers()}catch(e){}this.unsubscribeFromManifestChanges(),this.disposeSegmentControllers(),this.subtitleService=null,this.heartbeatService=null,this.segmentControllerMap=null,this.settings=null,this.bufferSettings=null,this.eventHandler=null,this.renderer=null,this.mimeTypes=null,this.sourceType=null},e.prototype.acquireServices=function(){var e=this.context.sourceContext.sourceIdentifier;this.manifestService=this.context.serviceManager.get(r.ServiceName.ManifestService,e),this.playerStateService=this.context.serviceManager.get(r.ServiceName.PlayerStateService),this.subtitleService=this.context.serviceManager.get(r.ServiceName.SubtitleService),this.metadataParsedService=this.context.serviceManager.get(r.ServiceName.MetadataParsedService),this.manifestLoader=this.context.serviceManager.get(r.ServiceName.ManifestLoadingService,e),this.heartbeatService=this.context.serviceManager.get(r.ServiceName.HeartbeatService,e),this.manifestUpdateScheduler=this.context.serviceManager.get(r.ServiceName.ManifestUpdateSchedulingService,e)},e.prototype.init=function(e){var t=this,i=this.getSourceStore();return this.setCurrentPlayingPeriodId(null),this.currentLoadingPeriodId=void 0,this.lastCurrentTime=0,this.isAudioCatchingUp=!1,this.context.store.dispatch(l.resetDrmKidErrors()),this.acquireServices(),i&&!this.drmKidErrorHandler&&(this.drmKidErrorHandler=new M.DrmKidErrorHandler(this.context,function(){return t.onDownloadedRepresentationExcluded()})),this.eventHandler.on(s.InternalEvent.FinishPeriodSwitch,this.finishPeriodSwitch,!0),this.sourceType=e.type,this.renderer.on(S.MediaElementEvent.ended,this.firePlaybackFinishedEvent),this.manifestUpdateScheduler.isInitiated()?(this.subscribeToManifestChanges(),this.mpdAvailableHandler(),Promise.resolve()):this.manifestUpdateScheduler.init(e.url.toString()).then(function(){t.subscribeToManifestChanges(),t.mpdAvailableHandler()})},e.prototype.stop=function(){this.logger.debug("Stopping main timer"),this.heartbeatService.stop(),this.initPromise=null,this.eventHandler.off(a.PlayerEvent.SegmentRequestFinished,this.onSegmentRequestFinished),this.unsubscribeFromManifestChanges()},e.prototype.isOneLoaderReady=function(){return this.getAllSegmentControllers().some(function(e){return e.canLoad()})},e.prototype.areAllLoadersReady=function(){return this.getAllSegmentControllers().every(function(e){return e.canLoad()})},e.prototype.isVod=function(){return!this.manifestService.isLive()},e.prototype.shouldStopDownloadWhenPaused=function(){return this.playerStateService.isPaused()&&this.settings.STOP_DOWNLOAD_ON_PAUSE&&this.manifestService.isLive()},e.prototype.shouldWaitForOtherMimeTypeDownload=function(e){var t=Object.keys(this.segmentControllerMap).find(function(t){return g.MimeTypeHelper.isAV(t)&&e!==t});if(!t)return!1;if(this.isAudioCatchingUp)return g.MimeTypeHelper.isAudio(t);var i=this.segmentControllerMap[t];if(t&&!i.hasDownloadError&&i.hasNext()){var n=this.getBufferRelevantTime(),r=this.getCurrentForwardBuffer(e,n),o=this.getCurrentForwardBuffer(t,n),a=this.hasReachedTargetBufferLevel(t,o);return r>o&&!a}return i.getCurrentPeriodId()!==this.segmentControllerMap[e].getCurrentPeriodId()},e.prototype.hasReachedTargetBufferLevel=function(e,t){var i=g.MimeTypeHelper.getMediaType(e),n=this.bufferSettings.getForwardTargetLevel(i);return t>=n},e.prototype.shouldEndOfStreamBeSignaled=function(){var e=this,t=this.getAllSegmentControllers(),i=this.bufferController.hasPendingSegments(),n=t.map(function(e){return e.getMimeType()}),r=t.some(function(e){return e.hasPendingSegments()}),o=n.some(function(t){return e.renderer.isDataBeingAppended(t)});return!r&&!i&&!o},e.prototype.shouldSuspendHeartbeat=function(){return!this.isOneLoaderReady()||this.shouldStopDownloadWhenPaused()||Boolean(this.clearBuffersPromise)||this.isSwitchingAudioTrack},e.prototype.getActiveSegmentControllers=function(){var e=this;return this.getAllSegmentControllers().filter(function(t){return t.canLoad()&&!e.isLoadingPeriodFinished(t)&&!e.shouldWaitForOtherMimeTypeDownload(t.getMimeType())})},e.prototype.getActiveMimeTypes=function(){return this.getActiveSegmentControllers().map(function(e){return e.getMimeType()})},e.prototype.getSegmentControllersForMimeTypes=function(e){return this.getAllSegmentControllers().filter(function(t){return e.includes(t.getMimeType())})},e.prototype.requestSegmentsForMimeTypes=function(e){var t=this;this.getSegmentControllersForMimeTypes(e).forEach(function(e){return t.getNextSegment(e)})},e.prototype.shouldClearSubtitleServiceBuffers=function(){return Boolean(this.subtitleService&&!this.playerStateService.seekingOrTimeshifting)},e.prototype.clearSubtitleServiceBuffers=function(){var e=10;this.subtitleService.clearBuffersUntil(this.renderer.getCurrentTime()-e)},e.prototype.isLoadingLastPeriod=function(){return this.manifestService.isLastPeriod(this.currentLoadingPeriodId)},e.prototype.areMediaTypesFinalForPlayingPeriod=function(){return this.bufferController.areBufferBlockMediaTypesFinal(this.getCurrentPlayingPeriodId())},e.prototype.maybeStop=function(){var e=this.manifestService.isManifestFinalized(),t=this.manifestService.isLastPeriod(this.currentLoadingPeriodId);e&&t&&(this.bufferController.stop(!1),this.shouldEndOfStreamBeSignaled()&&(this.signalEndOfStream(),this.stop()))},e.prototype.isLoadingPeriodFinished=function(e){return!e.hasNext()&&!e.hasPendingSegments(this.currentLoadingPeriodId)},e.prototype.getNextSegment=function(e){if(e.canLoad()){var t=g.MimeTypeHelper.getMediaType(e.getMimeType()),i=this.bufferSettings.getForwardTargetLevel(t),n=this.getCurrentForwardBuffer(e.getMimeType(),this.getBufferRelevantTime());n>=i||(this.context.serviceManager.get(r.ServiceName.AdaptationService).addSample(e.getMimeType(),{bufferTargetLevel:i,bufferLevel:n}),e.hasNext()&&e.getNext())}},e.prototype.getBufferRelevantTime=function(){return this.playerStateService.seekingOrTimeshifting?this.playerStateService.targetPlaybackTime:this.renderer.getCurrentTime()},e.prototype.getCurrentForwardBuffer=function(e,t){return this.getBufferLevel(e,t,u.BufferType.ForwardDuration)},e.prototype.switchLoadingPeriod=function(){if(this.isAudioCatchingUp){var e=this.getAudioSegmentController(),t=e.getCurrentPeriodId(),i=this.manifestService.getNextPeriod(t)._id;this.switchLoadingPeriodForAudio(i),e.getCurrentPeriodId()===this.currentLoadingPeriodId&&(e.isTransmuxerRequired()&&e.getTransmuxer()&&(e.getTransmuxer().dispose(),e.setTransmuxer(this.transmuxer)),this.isAudioCatchingUp=!1,this.logger.debug("The audio SegmentController caught up to the overall loading period again."))}else{var n=this.manifestService.getNextPeriod(this.currentLoadingPeriodId);n&&this.switchLoadingPeriodForAllMedia(n._id)}},e.prototype.switchLoadingPeriodForAllMedia=function(e){var t=this;e!==this.currentLoadingPeriodId&&(this.isAudioCatchingUp=!1,this.prepareLoadingPeriodSwitch(e),this.getAllSegmentControllers().filter(function(t){return t.getCurrentPeriodId()!==e}).forEach(function(i){i.switchPeriod(e),t.storeDrmInitDataFromManifest(i.getAdaptationSetForPeriodId(e))}),this.currentLoadingPeriodId=e)},e.prototype.prepareLoadingPeriodSwitch=function(e){var t=this;this.getRelevantAdaptationSetForPeriodSwitch(e).forEach(function(e){var i=I.getMimeTypeForAdaptationSet(e);t.segmentControllerMap.hasOwnProperty(i)||t.setupControllerForAdaptationSet(e)}),this.resetTransmuxer()},e.prototype.getRelevantAdaptationSetForPeriodSwitch=function(e){var t=this.manifestService.getPeriod(new P.PeriodId(e)).AdaptationSet,i=Object.keys(this.segmentControllerMap);return I.filterAdaptationSetsBasedOnMimeTypes(t,i)},e.prototype.switchLoadingPeriodForAudio=function(e){var t=this.getAudioSegmentController(),i=t.getCurrentPeriodId();t.resetTransmuxer(),t.switchPeriod(e),this.logger.debug("Switched audio loading period from "+i+" to "+e)},e.prototype.isAVCompletelyLoaded=function(){var e=this.getAllSegmentControllers(),t=e.some(function(e){return e.hasPendingSegments()}),i=t||this.bufferController.hasPendingSegments();return this.manifestService.isManifestFinalized()&&!i},e.prototype.getBufferedRanges=function(e){return void 0===e&&(e=!1),this.bufferController.getBufferedRangesMap(this.getCurrentPlayingPeriodId(),e)},e.prototype.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.dispose(),this.transmuxer=null),this.createTransmuxer()},e.prototype.restartBufferController=function(){this.bufferController.hasStopped()&&this.bufferController.restart()},e.prototype.shouldBuffersBeCleared=function(e,t,i){var n=e<this.renderer.getCurrentTime(),r=n&&this.context.settings.CLEAR_BUFFERS_ON_SEEKING_BACKWARDS;return!t&&(!this.bufferController.isInBufferedRange(e)||r)||i},e.prototype.seek=function(e,t,i,n,r,o){var a=this;if(void 0===t&&(t=!1),void 0===n&&(n=!1),void 0===r&&(r=!1),void 0===o&&(o=!1),this.bufferController){this.restartBufferController(),this.seekCounter++;var s=this.seekCounter;this.cancelPotentialOngoingTimeShift();var u=this.manifestService.getPeriodIdForTime(e);this.ensureInitialPeriod(u),this.logger.debug("seek from current period ("+this.getCurrentPlayingPeriodId()+") to target period ("+u+")- seek time in period is: "+e);var d,c;this.bufferController.readyToSeek().then(function(){if(c=a.shouldBuffersBeCleared(e,r,o),d=a.currentLoadingPeriodId!==u&&c,c&&a.bufferController.isBufferAvailable())return a.clearBuffersPromise=a.clearBuffersOnSeek(),a.clearBuffersPromise}).then(function(){if(a.clearBuffersPromise=null,!a.initialized)return a.logger.debug("Aborting seek as MediaPlayerController has been terminated!"),Promise.resolve();a.getAllSegmentControllers().forEach(function(e){return e.setAdaptionLogicStartupPhase()}),d&&a.switchLoadingPeriodForAllMedia(u),c&&a.getAllSegmentControllers().forEach(function(t){return t.seekTo(e)});var n=t?Promise.resolve():a.start();return n.then(function(){a.bufferController.setCurrentTime(e).then(function(t){a.logger.debug("successfully seeked to "+t),a.seekCounter===s&&i?i():i&&a.context.logger.debug("Seek to "+e+" has finished but a newer operation has been started")})["catch"](function(e){a.logger.debug("Failed to set currentTime on seek",e)})})})}},e.prototype.cancelPotentialOngoingTimeShift=function(){this.timeshiftHandler&&this.timeshiftHandler.cancel()},e.prototype.getCurrentPlayingPeriodId=function(){return A.getPlayingPeriodId(this.getSourceStore().getState())},e.prototype.setCurrentPlayingPeriodId=function(e){this.getSourceStore().dispatch(E.setPlayingPeriodId(e))},e.prototype.ensureInitialPeriod=function(e){var t=this;void 0===this.getCurrentPlayingPeriodId()&&(this.logger.debug("current period is undefined, using seek target period "+e),this.setCurrentPlayingPeriodId(e),this.resetTransmuxer(),this.getAllSegmentControllers().forEach(function(e){e.switchPeriod(t.getCurrentPlayingPeriodId()),g.MimeTypeHelper.isAV(e.getMimeType())&&t.storeDrmInitDataFromManifest(e.getCurrentAdaptationSet())}),this.currentLoadingPeriodId=this.getCurrentPlayingPeriodId(),this.bufferController.setInitialPeriod(e))},e.prototype.clearBuffersOnSeek=function(){var e=this;return this.eosSignaled=!1,this.getAllSegmentControllers().forEach(function(e){return e.cancelLoading()}),this.bufferController.setEndOfStream(!1).then(function(){return e.bufferController.clearBuffers()})["catch"](function(){e.logger.debug("Failed to clear buffers on seek, carrying on regardless")})},e.prototype.getAllSegmentControllers=function(){return Object.values(this.segmentControllerMap||{})},e.prototype.getAudioSegmentController=function(){return this.getAllSegmentControllers().find(function(e){return g.MimeTypeHelper.isAudio(e.getMimeType())})},e.prototype.updateAdaptationLogicData=function(e,t){var i=g.MimeTypeHelper.getMediaType(t.getMimeType()),n=this.getBufferLevel(t.getMimeType(),this.renderer.getCurrentTime(),u.BufferType.ForwardDuration),o=this.bufferSettings.getForwardTargetLevel(i),a=e.duration/e.downloadTime;e.isInit||this.context.serviceManager.get(r.ServiceName.AdaptationService).addSample(t.getMimeType(),{bufferTargetLevel:o,bufferLevel:n,downloadRate:a})},e.prototype.signalEndOfStream=function(e){void 0===e&&(e=!0),this.isVod()&&(this.eosSignaled||(this.eosSignaled=!0,this.bufferController.setEndOfStream(!0),e&&this.stop()),this.bufferController.isStarted()&&this.bufferController.stop())},e.prototype.start=function(){var e=this;return this.hasStarted()?Promise.resolve():this.finishInit().then(function(){e.bufferController.hasStreamEnded()&&(e.seek(h.getStartTimeOffset(e.getSourceStore().getState())),e.getAllSegmentControllers().forEach(function(e){return e.resetTransmuxer()})),e.bufferController.isStarted()||e.bufferController.restart(),e.getAllSegmentControllers().filter(function(e){return g.MimeTypeHelper.isAV(e.getMimeType())}).forEach(function(t){return e.storeDrmInitDataFromManifest(t.getCurrentAdaptationSet())}),e.logger.debug("Starting main timer"),e.eosSignaled=!1,e.heartbeatService.start(),e.subscribeToManifestChanges(),e.eventHandler.on(a.PlayerEvent.SegmentRequestFinished,e.onSegmentRequestFinished)})},e.prototype.clearBuffers=function(e){var t=this;return Promise.all(e.map(function(e){return t.bufferController.clearCache(e),t.bufferController.clearBuffer(e)})).then(function(){})},e.prototype.recoverFromImpreciseTimeShiftAfterAudioTrackSwitch=function(e){var t=this;this.manifestService.isLive()&&!this.settings.ENABLE_SEEK_FOR_LIVE&&this.renderer.setCurrentTime(e)["catch"](function(){return t.logger.debug("Could not set currentTime")})},e.prototype.restorePlaybackPositionAfterAudioTrackSwitch=function(e,t){var i=this;return this.bufferController.setEndOfStream(!1).then(function(){var n=i.clearBuffers(e.getSourceBufferTypes());return e.getCurrentPeriodId()!==i.getCurrentPlayingPeriodId()?i.prepareControllerForAudioTrackChange(e):e.getCurrentPeriodId()!==i.currentLoadingPeriodId&&(i.currentLoadingPeriodId=e.getCurrentPeriodId()),e.setAdaptionLogicStartupPhase(),e.seekTo(t),i.start()["catch"](function(){return i.logger.debug("Could not restart stopped MPC after audio track switch")}),n.then(function(){return i.recoverFromImpreciseTimeShiftAfterAudioTrackSwitch(t)})["catch"](function(e){return i.logger.debug("Failed to set currentTime on audio track switch",e)})})},e.prototype.isHlsManifestLoader=function(e){return"hls"===this.sourceType},e.prototype.setAudio=function(e){var t=this.getAvailableAudio(this.getCurrentPlayingPeriodId()),i=t.find(function(t){return t.id===e}),n=this.getAudio();return this.initialized&&i?n&&n.id===e?Promise.reject(n):this.switchAudioTrack(i):Promise.reject(null)},e.prototype.updateAdaptationSet=function(e,t,i){var n=this;return g.MimeTypeHelper.isAudio(t)&&this.isHlsManifestLoader(this.manifestLoader)?this.manifestLoader.updateAdaptationSet(i).then(function(){return n.getAllSegmentControllers().forEach(function(e){return e.updateMpd()})}).then(function(){return e}):Promise.resolve(e)},e.prototype.switchAudioTrack=function(e){var t,i=this;this.isSwitchingAudioTrack=!0;var r=Object.keys(this.segmentControllerMap),o=r.find(g.MimeTypeHelper.isAudio)||r.find(g.MimeTypeHelper.isVideo),a=this.segmentControllerMap[o],s=this.manifestService.getAdaptationSet(e.adaptationSetId),u=Promise.resolve((t={},t[s._mimeType]=null,t));return n(s,a.getCurrentAdaptationSet())&&(o=this.recreateSegmentController(a,o,s),u=this.bufferController.changeBufferType(o,this.mimeTypes[o])),u.then(function(t){return i.updateAdaptationSet(t,o,e.id)}).then(function(t){return i.updateRelevantSegmentControllers(t,e)})["finally"](function(){return i.isSwitchingAudioTrack=!1})},e.prototype.recreateSegmentController=function(e,t,i){var n,r=e.getCurrentAdaptationSet()._internalId;return this.getSourceStore().dispatch(C.removeActiveTrackAction(r)),e.dispose(),this.clearBuffers([t]),delete this.segmentControllerMap[t],delete this.mimeTypes[t],this.setupControllerForAdaptationSet(i),null===(n=this.timeshiftHandler)||void 0===n?void 0:n.updateSegmentControllers(this.segmentControllerMap),i._mimeType},e.prototype.updateRelevantSegmentControllers=function(e,t){var i=this;return Promise.all(Object.keys(e).map(function(e){return i.updateSegmentController(t,e)})).then(function(){})},e.prototype.updateSegmentController=function(e,t){if(this.subtitleService&&this.subtitleService.enableForcedSubtitle(e.lang),this.segmentControllerMap[t].setCurrentLangObj(e),this.segmentControllerMap[t].cancelLoading(),this.hasStarted()||this.eosSignaled){var i=this.getBufferRelevantTime();return this.restorePlaybackPositionAfterAudioTrackSwitch(this.segmentControllerMap[t],i)}return Promise.resolve()},e.prototype.getAudio=function(){if(this.initialized){var e=void 0,t=Object.keys(this.segmentControllerMap).find(function(e){return g.MimeTypeHelper.isAudio(e)});if(t&&(e=this.segmentControllerMap[t].getCurrentLangObj()),!e){var i=Object.keys(this.segmentControllerMap).find(function(e){return g.MimeTypeHelper.isVideo(e)});if(i&&this.segmentControllerMap[i].getSourceBufferTypes()){var n=this.segmentControllerMap[i].getSourceBufferTypes().some(function(e){return g.MimeTypeHelper.isAudio(e)});n&&(e=this.segmentControllerMap[i].getCurrentLangObj())}}return e||null}return null},e.prototype.prepareControllerForAudioTrackChange=function(e){if(this.isAVMultiplexed(e))this.switchLoadingPeriodForAllMedia(this.getCurrentPlayingPeriodId());else{if(this.logger.debug("audio needs to load previous period(s) and catch up to the overall loading period"),e.isTransmuxerRequired()){var t=y.ModuleManager.get(v.ModuleName.ContainerTS);e.setTransmuxer(new t.WebWorkerTransmuxer(this.context))}this.isAudioCatchingUp=!0,this.switchLoadingPeriodForAudio(this.getCurrentPlayingPeriodId())}},e.prototype.getPlaybackRepresentation=function(e){for(var t in this.segmentControllerMap)if(this.segmentControllerMap[t]&&t.includes(e))return this.context.serviceManager.get(r.ServiceName.TimedMetadataService).getPlaybackRepresentation(t);return null},e.prototype.getTimeShift=function(){return this.getTimeShiftHandler().getTimeShift()},e.prototype.getTimeShiftLiveEdge=function(){return this.manifestService.isLive()?this.getTimeShiftHandler().getTimeShiftLiveEdge():0},e.prototype.getTimeShiftHandler=function(){return this.timeshiftHandler||(this.timeshiftHandler=new x.TimeShiftHandler(this.context,this,this.bufferController,this.segmentControllerMap)),this.timeshiftHandler},e.prototype.timeShift=function(e,t,i){return void 0===i&&(i=!1),this.getTimeShiftHandler().timeShift(e,t,i)},e.prototype.getAvailableAudio=function(e){return this.manifestService.getAvailableAudio(e)},e.prototype.hasStreamEnded=function(){return!!this.bufferController&&this.bufferController.hasStreamEnded()},e.prototype.getCurrentTime=function(){return this.isPeriodSwitchHappeningNow?this.lastSeekTarget>-1&&(this.lastCurrentTime=this.lastSeekTarget):this.lastCurrentTime=this.renderer.getCurrentTime(),this.lastSeekTarget=-1,this.lastCurrentTime},e.prototype.getSeekableRange=function(){if(this.manifestService.isLive()){if(this.playerStateService.seekingOrTimeshifting&&this.cachedSeekableRange)return this.cachedSeekableRange;var e=this.getTimeShiftLiveEdge(),t=e+this.getMaxTimeShift();return this.cachedSeekableRange={start:t,end:e}}var i=this.getAllSegmentControllers().find(function(e){return g.MimeTypeHelper.isAV(e.getMimeType())});return i?i.getMPDHandler().getSeekableRange():{start:-1,end:-1}},e.prototype.getAvailableSegments=function(){var e=this,t={};return Object.keys(this.segmentControllerMap).forEach(function(i){t[i]=e.segmentControllerMap[i].getSegmentInfos()}),t},e.prototype.isInitialized=function(){return this.initialized},e.prototype.hasStarted=function(){var e,t;return t=null===(e=this.heartbeatService)||void 0===e?void 0:e.started,null!==t&&void 0!==t&&t},e}();t.MediaPlayerController=L,t.isBufferChangeRequired=n},476:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(0),r=i(43),o=i(267),a=i(34),s=i(44),u=i(265),d=i(268),c=i(269),l=i(103),h=i(155),p=i(56),f=i(270),g=i(77),m=i(57),S=i(78),y=i(156),v=i(58),T=i(266),M={removeActiveTrackAction:m.removeActiveTrackAction,setRepresentationIdAction:m.setRepresentationIdAction,setContainerFormat:S.setContainerFormat},I={getContainerFormat:y.getContainerFormat,getPlayingPeriodId:v.getPlayingPeriodId},P={containerFormat:S.ContainerFormat};t.MseModuleDefinition={name:n.ModuleName.EngineBitmovin,module:{MediaPlayer:u.MediaPlayer,SegmentController:l.SegmentController,technologyChecker:new T.TechnologyChecker,Stream:g.Stream,FetchController:c.FetchController,SegmentInfoService:h.SegmentInfoService,SegmentPrefetchingService:f.SegmentPrefetchingService,AdRestorationOptimizationService:d.AdRestorationOptimizationService,ManifestCachingService:o.ManifestCachingService,SegmentListMPDHandler:p.SegmentListMPDHandler,actions:M,selectors:I,mseModuleTypes:P,AdaptationSetId:r.AdaptationSetId,RepresentationId:s.RepresentationId,getCodecsFromAdaptationSet:a.getCodecsFromAdaptationSet,getMimeTypeForAdaptationSet:a.getMimeTypeForAdaptationSet}},t["default"]=t.MseModuleDefinition},477:function(e,t,i){"use strict";function n(e,t){if(t===a.ContainerFormat.MP4&&r.ModuleManager.has(o.ModuleName.ContainerMP4)){e.store.dispatch(a.setContainerFormat(a.ContainerFormat.MP4));var i=r.ModuleManager.get(o.ModuleName.ContainerMP4);return new i.MP4Parser(e,new i.MP4EncryptionParser(e))}if(t===a.ContainerFormat.WEBM&&r.ModuleManager.has(o.ModuleName.ContainerWebM)){e.store.dispatch(a.setContainerFormat(a.ContainerFormat.WEBM));var n=r.ModuleManager.get(o.ModuleName.ContainerWebM).WebMParser;return new n}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(2),o=i(0),a=i(78);t.createSegmentParser=n},478:function(e,t,i){"use strict";function n(e,t){var i,n,r,o=(r=null===(n=null===(i=e)||void 0===i?void 0:i.timestampRolloverPositions)||void 0===n?void 0:n.next,null!==r&&void 0!==r?r:-1);return o!==-1&&(t>=o||t<=e.timestampRolloverPositions.previous)}Object.defineProperty(t,"__esModule",{value:!0});var r=i(29),o=i(3),a=i(1),s=i(23),u=i(4),d=i(2),c=i(0),l=i(56),h=function(){function e(e,t,i,n){var r=this;this.wasCanceled=!1,this.onManifestUpdateListener=function(){if(r.manifestService.isLive()){var e=r.getActualTimeShift(),t=r.calculateAvailableBufferLength();r.adjustTargetBufferLevel(t),e<-t.minSegmentDuration&&e<r.getMaxTimeShift()&&r.context.eventHandler.dispatchEvent(a.PlayerEvent.DVRWindowExceeded)}},this.onSeek=function(){r.updateInitialTimeShiftContext(!0)},this.onSeeked=function(){var e=r.context.renderer.getCurrentTime(!0),t=e-r.getTimeShiftLiveEdge();r.updateTimeShiftStateAfterSeek(t,e)},this.context=e,this.mediaPlayerController=t,this.bufferController=i,this.segmentControllers=Object.keys(n).map(function(e){return n[e]}),this.manifestService=e.serviceManager.get(o.ServiceName.ManifestService,e.sourceContext.sourceIdentifier),this.logger=e.logger,this.eventHandler=e.eventHandler,this.timeShiftCounter=0,this.isDisposed=!1,this.wasCanceled=!1,this.sourceIdentifier=e.sourceContext.sourceIdentifier,
this.setupEventHandlers()}return e.prototype.calculateLiveEdgeInVideoTime=function(){var e;if(this.initialTimeShiftContext&&!this.initialTimeShiftContext.isOngoing){var t=u.toSeconds(Date.now()-this.initialTimeShiftContext.timestamp);e=this.initialTimeShiftContext.liveEdge+t}else e=this.calculateMpdHandlerLiveEdge();return isFinite(e)||(e=u.toSeconds(Date.now()-this.manifestService.getAvailabilityStartTime())),e},e.prototype.calculateMpdHandlerLiveEdge=function(){var e=this.segmentControllers.map(function(e){return e.getLiveEdgeTime()});return e.reduce(function(e,t){return t<e&&t>=0?t:e},1/0)},e.prototype.updateSegmentControllers=function(e){this.segmentControllers=Object.values(e)},e.prototype.getMaxTimeShift=function(){if(this.manifestService.getManifest()){var e=this.manifestService.getTimeShiftBufferDepthSeconds();return Math.min(e+this.manifestService.getDesiredDistanceToLiveEdge(),0)}return 0},e.prototype.getTimeShiftLiveEdge=function(){return this.calculateLiveEdgeInVideoTime()-this.manifestService.getDesiredDistanceToLiveEdge()},e.prototype.getTimeShift=function(){var e=this.getActualTimeShift();if(this.lastTimeShiftStatus){var t=u.toSeconds(Date.now()-this.lastTimeShiftStatus.completionDate),i=this.mediaPlayerController.getCurrentTime()-this.lastTimeShiftStatus.reachedTime,n=t-i;if(Math.abs(n)<this.context.settings.ACCEPTABLE_TIMESHIFT_INACCURACY)return this.lastTimeShiftStatus.offset}var r=this.getMaxTimeShift();return e<r&&(e=r),e>0&&(e=0),e},e.prototype.getActualTimeShift=function(){return!this.initialTimeShiftContext||this.initialTimeShiftContext.isOngoing?0:this.mediaPlayerController.getCurrentTime()-this.getTimeShiftLiveEdge()},e.prototype.adjustTargetTime=function(e){var t=this.manifestService.getPeriodIdForTime(e),i=!this.manifestService.isLastPeriod(t),n=this.manifestService.isTimeNearPeriodEnd(e,this.context.settings.END_OF_BUFFER_TOLERANCE);if(i&&n){var r=this.manifestService.getNextPeriod(t);this.logger.debug("Timeshift target too close to end of period "+t+", adjusting target from "+e+(" to "+r.start+", i.e. next period's start.")),e=r.start}return e},e.prototype.timeShift=function(e,t,i){var n=this;void 0===i&&(i=!1);var r=this.mediaPlayerController.getCurrentTime(),o=this.calculateTargetTime(e),a=this.manifestService.getPeriodIdForTime(o);this.timeShiftCounter++;var s=this.timeShiftCounter;return this.logger.debug("Performing timeShift to offset "+e+", time: "+r+" -> "+o+", period: "+a),this.wasCanceled=!1,this.mediaPlayerController.updatePeriodForTimeshift(a,!this.initialTimeShiftContext),this.initialTimeShiftContext?this.maybeResetTransmuxerForPtsRollover(o):this.adjustTargetBufferLevel(this.calculateAvailableBufferLength()),e=Math.max(this.getMaxTimeShift(),e),this.timeShiftOnSegmentControllers(a,o,e),this.updateInitialTimeShiftContext(!0),this.maybeClearBuffers(o,i).then(function(){return n.isDisposed||n.wasCanceled?(n.wasCanceled=!1,n.logger.debug("Aborting timeShift as TimeShiftHandler has been terminated or the operation was cancelled!"),Promise.reject("cancelled")):n.bufferController.setCurrentTime(o,a).then(function(i){n.logger.debug("Successful timeShift to "+i+", hit target time with a diff of "+(i-o)),n.updateInitialTimeShiftContext(!1),n.lastTimeShiftStatus={offset:e,completionDate:Date.now(),reachedTime:i},n.timeShiftCounter===s&&t?t():t&&n.context.logger.debug("Timeshift to "+e+" has finished but a newer operation has been started")})["catch"](function(e){n.logger.debug("Failed to set currentTime on timeShift",e)})["finally"](function(){return n.wasCanceled=!1})})},e.prototype.maybeResetTransmuxerForPtsRollover=function(e){var t,i;if(this.manifestService.isHlsManifest()){var r=this.context.serviceManager.get(o.ServiceName.SourceStoreService,this.sourceIdentifier),a=null===(t=d.ModuleManager.get(c.ModuleName.HLS))||void 0===t?void 0:t.selectors.getHlsState(null===(i=r)||void 0===i?void 0:i.getState());n(a,e)&&(this.context.logger.debug("Resetting transmuxer because target is beyond a timestamp rollover"),this.mediaPlayerController.resetTransmuxer())}},e.prototype.cancel=function(){this.context.logger.debug("Cancelling ongoing time shift operation..."),this.wasCanceled=!0},e.prototype.maybeClearBuffers=function(e,t){void 0===t&&(t=!1);var i=this.mediaPlayerController.getBufferedRanges(!1),n=this.mediaPlayerController.getCurrentTime();this.logger.debug("shifting time... from "+n+" to "+e);var o=!r.BufferRangeHelper.isInBufferedRange(i,e);return o=o||e<n,o||t?this.clearBuffers():Promise.resolve()},e.prototype.clearBuffers=function(){var e=this;return this.bufferController.setEndOfStream(!1).then(function(){return e.bufferController.clearBuffers()})["catch"](function(){return e.logger.debug("Failed to clear buffers on timeShift, carrying on regardless")})},e.prototype.timeShiftOnSegmentControllers=function(e,t,i){var n=this.manifestService.isLastPeriod(e),r=!n&&this.manifestService.hasMultiplePeriods(),o=i;r&&(o=this.getTimeShiftOffsetWithinPeriod(t,this.manifestService.getManifest().Period),this.logger.debug("timeShift, targetPeriod "+e+", offsetWithinTargetPeriod "+o)),this.segmentControllers.forEach(function(e){return e.timeShift(o,t)})},e.prototype.calculateTargetTime=function(e){var t=this.manifestService.getDesiredDistanceToLiveEdge(),i=this.calculateLiveEdgeInVideoTime(),n=i+(e-t);return this.manifestService.hasMultiplePeriods()&&(n=this.adjustTargetTime(n)),n},e.prototype.getTimeShiftOffsetWithinPeriod=function(e,t){for(var i=0,n=this.manifestService.getFirstPeriod(),r=n?n.start:0,o=0;o<t.length;o++){var a=this.manifestService.getPeriodDuration(t[o]._id,t);if(i+=a,i===1/0)return 0;var s=r+i;if(s>e){if(o<t.length-1)return e-s;for(var u=0,d=0;d<o;d++)u+=this.manifestService.getPeriodDuration(t[d]._id,t);return Math.min(-(a-(e-(r+u))),0)}}return 0},e.prototype.calculateAvailableBufferLength=function(){var e=this,t=this.segmentControllers.map(function(e){return e.getMPDHandler()}),i=1/0,n=Math.max.apply(Math,t.map(function(t){return i=Math.min(i,t.getSegmentDuration()),t instanceof l.SegmentListMPDHandler?t.getSegmentDuration()*e.context.settings.LIVE_SEGMENT_LIST_START_INDEX_OFFSET:0})),r=Math.min.apply(Math,t.map(function(e){return Math.abs(e.getActualTimeShiftBufferDepth())})),o=r-n;return{minSegmentDuration:i,bufferDepth:o}},e.prototype.adjustTargetBufferLevel=function(e){this.context.bufferSettings.setStreamBoundary({minimumBufferLength:e.minSegmentDuration,streamDuration:e.bufferDepth})},e.prototype.updateTimeShiftStateAfterSeek=function(e,t){this.lastTimeShiftStatus={completionDate:Date.now(),reachedTime:t,offset:e},this.updateInitialTimeShiftContext(!1)},e.prototype.updateInitialTimeShiftContext=function(e){(!this.initialTimeShiftContext||!e&&this.initialTimeShiftContext.isOngoing)&&(this.initialTimeShiftContext={timestamp:Date.now(),liveEdge:this.calculateLiveEdgeInVideoTime(),isOngoing:e})},e.prototype.setupEventHandlers=function(){this.eventHandler.on(a.PlayerEvent.Seek,this.onSeek,!0),this.eventHandler.on(a.PlayerEvent.Seeked,this.onSeeked,!0),this.eventHandler.on(s.InternalEvent.MPDUpdated,this.onManifestUpdateListener,!0)},e.prototype.removeEventHandlers=function(){this.eventHandler.off(a.PlayerEvent.Seek,this.onSeek),this.eventHandler.off(a.PlayerEvent.Seeked,this.onSeeked),this.eventHandler.off(s.InternalEvent.MPDUpdated,this.onManifestUpdateListener)},e.prototype.dispose=function(){this.removeEventHandlers(),this.isDisposed=!0},e}();t.TimeShiftHandler=h},479:function(e,t,i){"use strict";function n(e,t){return!(!e||!t)&&e===t}Object.defineProperty(t,"__esModule",{value:!0}),t.areBufferBlocksEqual=n},480:function(e,t,i){"use strict";var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},n.apply(this,arguments)},r=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var n=Array(e),r=0,t=0;t<i;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)n[r]=o[a];return n};Object.defineProperty(t,"__esModule",{value:!0});var o=i(29),a=i(6),s=i(7),u=i(3),d=i(15),c=i(1),l=i(23),h=i(9),p=i(38),f=i(21),g=i(22),m=i(16),S=i(120),y=i(19),v=i(31),T=i(122),M=i(11),I=i(5),P=i(4),b=i(14),C=i(216),R=i(86),E=i(479),A=i(481),x=i(482),_=i(483),L=i(209),B=function(){function e(e,t,i){var n=this;this.currentBufferBlockSwitchPromise=null,this.startupPlaybackTime=null,this.isAlreadyStarted=!1,this.isStartup=!0,this.finishPlayback=!1,this.hasStreamEndedInternal=!1,this.activeInitSegments={},this.bufferMaxSizeChangedSubscriptionMap={},this.onRendererReady=function(){n.finishPlayback||n.renderer.setDuration(n.totalDuration),n.shouldSendLicenseRequestsImmediately()&&n.setupDRM()},this.onRendererSetupFailed=function(e){n.context.logger.debug("Renderer setup failed with",e)},this.onBufferChanged=function(e){n.cachedBufferedRanges=null,n.cachedRendererRanges=null;var t=n.getRendererRangesFromStore(e),i=t[0];i&&n.bufferStartTimes.set(e,i.start)},this.onVideoElementTimeUpdate=function(){var e=n.context.serviceManager.get(u.ServiceName.PlayerStateService),t=Date.now()-n.lastBufferClearingTimestamp>n.minimalBackwardBufferClearingInterval;!t&&e.isPlaying()||n.checkBackwardBufferLevel(),n.checkIfEndOfBufferReached(n.settings.END_OF_BUFFER_TOLERANCE)},this.onVideoElementEnded=function(){if(!n.isSwitchingBufferBlock){var e=Boolean(n.segmentStore.getNextBufferBlock(n.currentPlayingBufferBlockId));if(e){var t=n.renderer.getCurrentTime(!0);n.tryToSwitchBufferBlock(t)}}},this.onVideoElementStalled=function(){n.checkIfEndOfBufferReached(n.settings.END_OF_BUFFER_RECOVERY_TOLERANCE)},this.context=e,this.logger=e.logger,this.settings=e.settings,this.bufferSettings=e.bufferSettings,this.eventHandler=e.eventHandler,this.renderer=e.renderer,this.manifestService=e.serviceManager.get(u.ServiceName.ManifestService,e.sourceContext.sourceIdentifier),this.segmentStore=new _.SegmentStore;var r=this.context.serviceManager.get(u.ServiceName.PlayerStateService);this.bufferStallingService=new A.BufferStallingService(r,this.logger,this.context.eventHandler,this.context.renderer),this.currentPlayingPeriodId=i,this.lastPlayingPeriodId=null,this.totalDuration=t,this.seekTarget=null,this.delayedBufferBlockSwitchContext=null,this.currentPlayingBufferBlockId=_.INITIAL_BUFFER_BLOCK_ID,this.isSwitchingBufferBlock=!1,this.bufferStartTimes=new Map,this.dataSegmentsPushedMap=new Map,this.isEndOfStreamReached=!1,this.lastBufferClearingTimestamp=0,this.minimalBackwardBufferClearingInterval=P.toMilliSeconds(this.context.settings.MINIMAL_BACKWARD_BUFFER_CLEARING_INTERVAL),this.discontinuitySequenceNumbers=new Map,this.periodSwitchMonitor=x.createPeriodSwitchMonitor(),this.drmConfigValidPromise=Promise.resolve(null),this.renderer.ready().then(this.onRendererReady)["catch"](this.onRendererSetupFailed)}return e.prototype.getDrmConfig=function(){return C.getDrmState(this.getSourceStore().getState())},Object.defineProperty(e.prototype,"isCurrentlyStalled",{get:function(){return this.bufferStallingService.isRendererStalling()},enumerable:!0,configurable:!0}),e.prototype.shouldSendLicenseRequestsImmediately=function(){var e=this.getDrmConfig();return null!=e&&e.immediateLicenseRequest},e.prototype.createSourceBuffers=function(e){var t=this,i=Promise.resolve();return this.bufferCreationDeferred=new M.Deferred,this.isStartup||(i=this.renderer.shutdown(!0)),this.activeInitSegments={},this.bufferCreationDeferred.resolve(i.then(function(){return t.renderer.ready()}).then(function(){return t.clearBufferMaxSizeChangedSubscription(),e.forEach(function(e){var i=e.mimeType,n=t.addMimeTypeAndCodec(i,e.codec);n||(t.logger.debug("Could not create source buffer for "+i),t.context.store.dispatch(f.removeMetricsForMimeType(i))),t.subscribeToBufferMaxSizeChanged(i)}),t.currentRendererMediaTypes=e.filter(function(e){return I.MimeTypeHelper.isAV(e.mimeType)}),t.setupDRM(),Promise.resolve(t.currentRendererMediaTypes.length)})),this.bufferCreationDeferred.promise["catch"](function(e){return t.logger.warn(e)}).then(function(){t.bufferCreationDeferred=null}),this.bufferCreationDeferred.promise},e.prototype.subscribeToBufferMaxSizeChanged=function(e){var t=this;this.bufferMaxSizeChangedSubscriptionMap[e]=this.getSourceStore().subscribe(function(){return t.adjustMaxBufferLevels(e)},R.hasBufferMaxSizeChanged(e))},e.prototype.unsubscribeFromBufferMaxSizeChanged=function(e){var t=this.bufferMaxSizeChangedSubscriptionMap[e];t&&(t(),delete this.bufferMaxSizeChangedSubscriptionMap[e])},e.prototype.setupDRM=function(){var e=this,t=this.getDrmConfig(),i=null!=t&&Object.keys(t).length>0;if(i){var r=n(n({},this.context.sourceContext.source),{drm:t}),o=this.manifestService.getDRMCapabilitiesForPeriod(this.currentPlayingPeriodId),a=Object.keys(p.KeySystemMap).some(function(e){return r.drm.hasOwnProperty(e)});a&&(this.drmConfigValidPromise=this.renderer.setDrmConfig(t,o),this.drmConfigValidPromise["catch"](function(){e.logger.warn("Could not initialize renderer with given DRM config")}))}},e.prototype.getSourceStore=function(){return this.context.serviceManager.get(u.ServiceName.SourceStoreService,this.context.sourceContext.sourceIdentifier)},e.prototype.addSegment=function(e){var t=this;this.logger.insane("adding segment to cache for period "+e.getPeriodId()+" with playback time "+e.getPlaybackTime()+"\n      and mime type "+e.getMimeType()),this.segmentStore.addSegment(e),this.cachedBufferedRanges=null;var i=this.segmentStore.getBufferBlockForSegment(e);if(this.segmentStore.areBufferBlockMediaTypesFinal(e.getPeriodId())){if(this.delayedBufferBlockSwitchContext&&!this.segmentStore.canSwitchToBufferBlock(this.delayedBufferBlockSwitchContext.time,i))return Promise.resolve();var n=Promise.resolve();if(this.delayedBufferBlockSwitchContext)n=this.tryToSwitchBufferBlock(this.delayedBufferBlockSwitchContext.time);else if(this.isSwitchingBufferBlock||this.currentRendererMediaTypes||this.bufferCreationDeferred)this.bufferCreationDeferred&&(n=this.bufferCreationDeferred.promise);else{var r=i.getMediaTypes();n=this.createSourceBuffers(r)}return n.then(function(){return t.renderer.ready().then(function(){return t.processSegmentCache()})})}return Promise.resolve()},e.prototype.clearBackwardBuffer=function(e,t){var i=this,n=I.MimeTypeHelper.isAudio(e)?h.MediaType.Audio:h.MediaType.Video,r=this.bufferSettings.getBackwardTargetLevel(n),o=this.segmentStore.getBufferBlock(this.currentPlayingBufferBlockId);if(this.segmentStore.removeOldSegments(e,t-r),this.cachedBufferedRanges=null,!o||!o.hasMaxSegmentDuration(e))return Promise.resolve();var a=o.getMaxSegmentDuration(e)+1,s=t-Math.max(a,r);return s<this.bufferStartTimes.get(e)?Promise.resolve():(this.lastBufferClearingTimestamp=Date.now(),this.renderer.removeData(e,0,s)["catch"](function(t){return i.logger.debug("Error clearing "+e+" backward buffer:",t)}).then(function(){i.cachedRendererRanges=null,i.cachedBufferedRanges=null}))},e.prototype.getRendererRangesFromStore=function(e){var t=R.getBufferState(this.getSourceStore().getState());return R.getRendererBufferedRanges(t,e)},e.prototype.checkBackwardBufferLevel=function(){var e=this;if(!this.isEndOfStreamReached&&!this.isSwitchingBufferBlock){var t=this.renderer.getCurrentTime(),i=this.segmentStore.getBufferBlock(this.currentPlayingBufferBlockId),n=this.segmentStore.getSmallestMaxSegmentDuration(i);n>0&&(this.minimalBackwardBufferClearingInterval=P.toMilliSeconds(n/2)),this.bufferStartTimes.forEach(function(i,n){var r=I.MimeTypeHelper.isAudio(n)?h.MediaType.Audio:h.MediaType.Video,o=e.bufferSettings.getBackwardTargetLevel(r);t-o>i&&e.clearBackwardBuffer(n,t)["catch"](function(t){e.context.logger.debug("Could not clear backward buffer",t)})})}},e.prototype.setEndOfStream=function(e){return this.isEndOfStreamReached=e,this.renderer.setEndOfStream(e)},e.prototype.adjustMaxBufferLevels=function(e){var t=R.getBufferMaxSize(R.getBufferState(this.getSourceStore().getState()),e);if(this.logger.debug("Exceeded quota for "+e+" with "+t+" seconds of data in the buffers"),!this.context.settings.NO_QUOTA_EXCEEDED_ADJUSTMENT){var i=this.renderer.getCurrentTime(),n=this.segmentStore.getSmallestSafeBufferSize(i,e);this.bufferSettings.adjustMaxBufferLevels(n,e,t)}},e.prototype.processSegmentCache=function(){var e=this;return this.isStartup?this.isStartupThresholdReached()?(this.updateTimestampOffsets(),this.pushSegmentsToRenderer(1/0).then(function(){return e.endStartupPhase()})):Promise.resolve():this.pushSegmentsToRenderer(1/0)},e.prototype.addSegmentsFromCacheToRenderer=function(e,t){var i=this;if(!this.segmentStore)return Promise.resolve();var n=this.segmentStore.getAllSegmentsFromBufferBlock(e),r=n.hasNext(),a=r&&n.next();return a?(this.segmentStore.removeSegment(a),a.getPeriodId()!==this.currentPlayingPeriodId&&this.eventHandler.dispatchEvent(c.PlayerEvent.PeriodSwitch,{sourcePeriod:{periodId:this.currentPlayingPeriodId},targetPeriod:{periodId:a.getPeriodId()}}),this.addDataSegmentToRenderer(a)["catch"](function(e){i.logger.warn("Could not add segment to renderer mimeType: "+a.getMimeType()+",\n        playbackTime: "+a.getPlaybackTime(),e)}).then(function(){i.dataSegmentsPushedMap.set(a.getMimeType(),!a.isInit());var n=o.BufferRangeHelper.getTotalCommonBufferLength(i.getOverallBufferedRangesMap(i.currentPlayingPeriodId));return i.currentPlayingPeriodId=a.getPeriodId(),i.cachedRendererRanges=null,i.cachedBufferedRanges=null,!i.isSwitchingBufferBlock||n<t?i.addSegmentsFromCacheToRenderer(e,t):Promise.resolve()})):Promise.resolve()},e.prototype.dispatchFinishPeriodSwitchEvent=function(){this.currentPlayingPeriodId!==this.lastPlayingPeriodId&&(this.lastPlayingPeriodId&&this.eventHandler.dispatchEvent(l.InternalEvent.FinishPeriodSwitch,{targetPeriodId:this.currentPlayingPeriodId},!0),this.lastPlayingPeriodId=this.currentPlayingPeriodId)},e.prototype.pushSegmentsToRenderer=function(e){var t=this,i=this.segmentStore.getBufferBlock(this.currentPlayingBufferBlockId);return this.addSegmentsFromCacheToRenderer(i,e).then(function(){t.isRestartThresholdReached()&&!t.isClearingBuffers&&t.endStalling(),t.isLoadingNextBufferBlock(t.currentPlayingBufferBlockId)&&!t.segmentStore.hasSegmentsForBufferBlock(i)?(t.logger.debug("Finished loading Period: "+t.currentPlayingPeriodId+", signaling EOS"),t.currentBufferBlockSwitchPromise&&t.isSwitchingBufferBlock?(t.logger.debug("delaying EOS signal until ongoing period switch is completed"),t.currentBufferBlockSwitchPromise.then(function(){t.setEndOfStream(!0).then(function(){return t.dispatchFinishPeriodSwitchEvent()})})):t.setEndOfStream(!0).then(function(){return t.dispatchFinishPeriodSwitchEvent()})):t.dispatchFinishPeriodSwitchEvent()})},e.prototype.updateTimestampOffsets=function(){var e=this;this.currentRendererMediaTypes.forEach(function(t){e.renderer.setTimestampOffset(t.mimeType,-t.timestampOffset)})},e.prototype.checkIfEndOfBufferReached=function(e){var t=this.renderer.getEndOfBufferTime();if(null===t)this.renderer.isPaused()||this.startStalling();else{var i=t-e,n=this.renderer.getCurrentTime(!0);i<=n?this.handleEndOfBuffer(e):this.manifestService.isLive()&&0===n&&!this.isSwitchingBufferBlock&&this.handleEndOfBuffer(e)}},e.prototype.resetCurrentTimeOnSegment=function(){var e,t=!0;this.dataSegmentsPushedMap.forEach(function(i,n){I.MimeTypeHelper.isVideo(n)&&(t=i,e=n)}),t||(this.context.videoElement.currentTime=this.context.videoElement.currentTime,this.dataSegmentsPushedMap.set(e,!0))},e.prototype.handleEndOfBuffer=function(e){if(!this.isSwitchingBufferBlock){var t=this.isAtEndOfBufferBlock(e),i=this.segmentStore.getNextBufferBlock(this.currentPlayingBufferBlockId),n=Boolean(i);if(t&&n){var r=this.renderer.getCurrentTime(!0),o=i.getMinCommonStartTime(),a=isFinite(o)&&o>=r?o:r;this.tryToSwitchBufferBlock(a)}else this.getRemainingTime()>0&&!this.finishPlayback&&(this.startStalling(),this.resetCurrentTimeOnSegment())}},e.prototype.isAtEndOfBufferBlock=function(e){var t=this.segmentStore.getBufferBlock(this.currentPlayingBufferBlockId);return!t.getNextSegment()||this.isLoadingNextBufferBlock(t.getId())},e.prototype.isLoadingNextBufferBlock=function(e){if(!this.segmentStore)return!1;var t=this.segmentStore.getNextBufferBlock(e);return t&&this.segmentStore.hasDataSegmentsForBufferBlock(t)},e.prototype.readyToSeek=function(){return this.currentBufferBlockSwitchPromise?(this.logger.debug("Awaiting ongoing buffer block switch before seek"),this.currentBufferBlockSwitchPromise.then(function(){})["catch"](function(){})):Promise.resolve()},e.prototype.setCurrentTime=function(e,t){var i=this,n=t||this.manifestService.getPeriodIdForTime(e),r=this.segmentStore.getBufferBlockForPlaybackTime(e),o=this.segmentStore.getBufferBlock(this.currentPlayingBufferBlockId),a=Boolean(!r||r.getId()!==o.getId());return this.isStartup&&(this.currentPlayingPeriodId=n),this.seekTarget=e,this.isStartup||this.isInBufferedRange(e,n)||this.startStalling(),a?r?this.tryToSwitchBufferBlock(e):this.delayBufferBlockSwitch(e):(this.delayedBufferBlockSwitchContext=null,this.renderer.setCurrentTime(e).then(function(e){return i.endStallingAfterSeek(e)}))},e.prototype.endStallingAfterSeek=function(e){return this.seekTarget=null,this.isRestartThresholdReached()&&this.endStalling(),Promise.resolve(e)},e.prototype.tryToSwitchBufferBlock=function(e){var t,i=this,n=function(){};this.isSwitchingBufferBlock=!0,null!==this.delayedBufferBlockSwitchContext&&(e=null!==e&&void 0!==e?e:this.delayedBufferBlockSwitchContext.time,n=this.delayedBufferBlockSwitchContext.resolve);var r=this.manifestService.getPeriodIdForTime(e),o=this.segmentStore.getTargetBufferBlock(e,r);return(null===(t=this.segmentStore)||void 0===t?void 0:t.canSwitchToBufferBlock(e,o))?this.currentBufferBlockSwitchPromise=this.setEndOfStream(!1).then(function(){return i.delayedBufferBlockSwitchContext=null}).then(function(){return i.clearRendererBuffers()}).then(function(){return i.switchOrRestoreBufferBlock(r,o,e)}).then(function(e){return n(e),e})["catch"](function(t){return i.logger.debug("Buffer block switch failed",t),e})["finally"](function(){return i.currentBufferBlockSwitchPromise=null}):this.delayBufferBlockSwitch(e)},e.prototype.switchOrRestoreBufferBlock=function(e,t,i){return this.shouldSwitchBufferBlock(e,t)?this.switchBufferBlock(i,t):this.restorePlayback(i,t)},e.prototype.delayBufferBlockSwitch=function(e){var t=this,i=this.renderer.getCurrentTime(),n=this.segmentStore.getAvailablePositionForTime(e,i);return new Promise(function(e){return t.delayedBufferBlockSwitchContext={time:n,resolve:e}})},e.prototype.shouldSwitchBufferBlock=function(e,t){var i,n=e===(null===(i=t)||void 0===i?void 0:i.getPeriodId()),r=E.areBufferBlocksEqual(t,this.segmentStore.getBufferBlock(this.currentPlayingBufferBlockId));return!n||!r||y.getCapabilities().isLegacyEdge||v.isTizen2017()},e.prototype.restorePlayback=function(e,t){var i=this;return this.updateTimestampOffsets(),this.isEndOfStreamReached=!1,this.currentPlayingBufferBlockId=t.getId(),this.segmentStore.deleteOldBufferBlocks(t.getId()),this.pushSegmentsToRenderer(1/0).then(function(){return i.setCurrentTimeOnRenderer(e)}).then(function(e){return i.isSwitchingBufferBlock=!1,i.isCurrentlyStalled||i.renderer.play()["catch"](function(e){i.logger.debug("play call failed with reason: "+e)}),i.endStallingAfterSeek(e)})},e.prototype.isPeriodSwitchSafe=function(e,t,i){var n,r;return(null===(n=e)||void 0===n?void 0:n.getPeriodId())===(null===(r=t)||void 0===r?void 0:r.getPeriodId())||this.currentRendererMediaTypes.length===i.length&&this.periodSwitchMonitor.isPeriodSwitchSafe(t.getPeriodId())},e.prototype.shouldRecreateSourceBuffers=function(e,t){var i=this.segmentStore.getBufferBlock(this.currentPlayingBufferBlockId);return!this.isPeriodSwitchSafe(i,e,t)||!i||!L.canReuseSourceBuffer(i,e,t)},e.prototype.switchBufferBlock=function(e,t){var i=this;this.logger.debug("Switching buffer block for time "+e);var n=t.getMediaTypesWithoutSubs(),r=this.maybeRecreateSourceBuffers(t,n);return this.currentRendererMediaTypes=n,r.then(function(){return i.restorePlayback(e,t)}).then(function(e){return i.pushSegmentsToRenderer(1/0)["catch"](function(){return i.context.logger.debug("Could not push segment into renderer")}),e})},e.prototype.maybeRecreateSourceBuffers=function(e,t){return this.shouldRecreateSourceBuffers(e,t)?(this.logger.debug("recreating the buffers with types",t),this.createSourceBuffers(t)):Promise.resolve(0)},e.prototype.setCurrentTimeOnRenderer=function(e){var t=this.delayedBufferBlockSwitchContext;return this.delayedBufferBlockSwitchContext=null,this.renderer.setCurrentTime(e).then(function(e){return t&&t.resolve&&t.resolve(e),e})},e.prototype.addMimeTypeAndCodec=function(e,t,i){if(void 0===i&&(i=!1),!I.MimeTypeHelper.isAV(e))return!0;var n=this.renderer.addBuffer(e,t);if(n){var r=g.getMetricsState(this.context.store.getState());this.subscribeToBufferChanges(),r[e]||this.context.store.dispatch(f.initializeMetricsForMimeType(e,this.context.settings)),i||this.context.store.dispatch(f.addMetricsValue(e,m.MetricType.StalledSeconds,0))}return n},e.prototype.setInitialPeriod=function(e){this.currentPlayingPeriodId=e},e.prototype.getLowestBufferLevel=function(e,t){var i=this;if(!this.currentRendererMediaTypes)return 0;var n=this.currentRendererMediaTypes.map(function(e){return e.mimeType}),r=n.map(function(n){return i.getOverallBufferLevel(n,e,h.BufferType.ForwardDuration,t)});return r.length>0?Math.min.apply(Math,r):0},e.prototype.isStartupThresholdReached=function(){var e=Math.abs(this.manifestService.getTimeShiftBufferDepthSeconds()),t=this.bufferSettings.getForwardTargetLevel();0!==e&&(t=Math.min(t,e));var i=Math.min(this.settings.STARTUP_THRESHOLD,t-this.settings.STARTUP_THRESHOLD_DELTA),n=this.getLowestBufferLevel();return n>=i||n>=this.getRemainingTime()},e.prototype.getInitialPlaybackTime=function(){if(this.startupPlaybackTime)return this.startupPlaybackTime;var e=this.getCurrentTimeRespectingTarget();if(!this.currentRendererMediaTypes)return e;if(this.isInBufferedRange(e))return this.startupPlaybackTime=e;var t=this.getPlaybackTimesFromSegments();return t.some(function(e){return null===e})?e:this.startupPlaybackTime=Math.max.apply(Math,t)},e.prototype.getPlaybackTimesFromSegments=function(){var e=this,t=this.currentRendererMediaTypes.map(function(e){return e.mimeType});return t.map(function(t){var i=e.segmentStore.getBufferBlock(e.currentPlayingBufferBlockId),n=new T.FilterIterator(e.segmentStore.getAllSegmentsFromBufferBlock(i,t),function(e){return!e.isInit()});return n.hasNext()?n.next().getPlaybackTime():null})},e.prototype.getRemainingTime=function(){return this.manifestService.isLive()?1/0:this.renderer.getDuration()-this.getCurrentTimeRespectingTarget()},e.prototype.endStartupPhase=function(){if(this.isStartup){var e=Date.now(),t=g.getMetricsState(this.context.store.getState()),i=g.getMetricsLastEntry(t,"default",m.MetricType.StartTime).value,n=P.toSeconds(e-i);this.context.store.dispatch(f.addMetricsValue("default",m.MetricType.StartupTimeSeconds,n)),isNaN(n)||this.logger.debug("start up time: "+n),this.isStartup=!1,this.endStalling()}},e.prototype.resetCurrentTimeInBufferedRange=function(e){var t=this.renderer.getCurrentTime(!0);e.isInit()&&I.MimeTypeHelper.isVideo(e.getMimeType())&&this.isCurrentlyStalled&&o.BufferRangeHelper.isInBufferedRange(this.getBufferedRangesMap(this.manifestService.getPeriodIdForTime(t)),t)&&(this.context.videoElement.currentTime=this.context.videoElement.currentTime)},e.prototype.processDrmInitData=function(e){var t=this;e.getDrmInitData().filter(function(e){var t;return(null===(t=e.kid)||void 0===t?void 0:t.length)>0}).forEach(function(i){return t.manifestService.setRepresentationDrmKid(e.getRepresentationId(),i.kid[0])})},e.prototype.addDataSegmentToRenderer=function(e){var t=this,i=I.MimeTypeHelper.extractContentType(e.getMimeType()),n=this.activeInitSegments[i]!==e.getInitSegment();if(n){var r=e.getInitSegment();return this.activeInitSegments[i]=r,Promise.all([r,e].map(function(e){return t.addSegmentToRenderer(e)})).then()}return this.addSegmentToRenderer(e)},e.prototype.addSegmentToRenderer=function(e){var t=this;return e.hasDrmInitData()&&this.processDrmInitData(e),this.drmConfigValidPromise["catch"](function(i){return e.isEncrypted()?(t.context.eventHandler.fireError(new s.PlayerError(a.ErrorCode.DRM_NO_KEY_SYSTEM)),Promise.reject("DRMConfig failure")):void t.logger.debug("Problem ensuring segment, error:",i)}).then(function(){return t.resetCurrentTimeInBufferedRange(e),t.maybeSetTimestampOffsetOnDiscontinuity(e),t.renderer.appendData(e)["catch"](function(e){t.logger.debug("could not append data to renderer",e)})})},e.prototype.maybeSetTimestampOffsetOnDiscontinuity=function(e){if(!e.isInit()){var t=e.getSegmentInfo().discontinuitySequenceNumber,i=e.getMimeType(),n=this.discontinuitySequenceNumbers.get(i),r=t!==n;r&&(isFinite(e.getPresentationTimeOffset())&&this.renderer.setTimestampOffset(i,-e.getPresentationTimeOffset()),this.discontinuitySequenceNumbers.set(i,t))}},e.prototype.isRestartThresholdReached=function(){if(!this.bufferSettings)return!1;var e=this.bufferSettings.getForwardTargetLevel(),t=Math.min(this.settings.RESTART_THRESHOLD,e-this.settings.RESTART_THRESHOLD_DELTA,this.getRemainingTime());return this.getLowestBufferLevel()>=t},e.prototype.isAllowedToStall=function(){return!this.isStartup&&!this.isSwitchingBufferBlock},e.prototype.startStalling=function(){this.isAllowedToStall()&&this.bufferStallingService.startStalling()},e.prototype.endStalling=function(){if(!this.isSwitchingBufferBlock){var e=this.getCurrentTimeRespectingTarget(),t=this.getLowestBufferLevel(e,!1),i=this.getLowestBufferLevel(e,!0),n=t>=this.settings.RESTART_THRESHOLD,r=t>=this.getRemainingTime()||this.finishPlayback,o=i>t;this.bufferStallingService.endStalling(n,r,o)}},e.prototype.getCurrentTimeRespectingTarget=function(){return null!=this.seekTarget?this.seekTarget:this.renderer.getCurrentTime()},e.prototype.getCurrentPlayingBufferBlockId=function(){return this.segmentStore.getCurrentBufferBlockId()},e.prototype.hasPendingSegments=function(e){return e=e||this.getCurrentPlayingBufferBlockId(),this.segmentStore.getFutureBufferBlocks(e).some(function(e){return e.hasSegments()})},e.prototype.getOverallBufferLevel=function(e,t,i,n){void 0===t&&(t=this.renderer.getCurrentTime()),void 0===i&&(i=h.BufferType.ForwardDuration),void 0===n&&(n=!0),this.isStartup&&(t=this.getInitialPlaybackTime());var r=this.getBufferedRangesMap()[e];return r&&0!==r.length?(r=n?o.BufferRangeHelper.mergeRanges(r.concat(o.BufferRangeHelper.findGapsInRanges(r)),this.settings.GAP_TOLERANCE):r.filter(function(e){return e.start<=t&&t<=e.end}),o.BufferRangeHelper.getBufferLevel(r,t,i)):0},e.prototype.hasFutureCommonBuffer=function(e){return void 0===e&&(e=this.renderer.getCurrentTime()),o.BufferRangeHelper.getCommonBufferedRanges(this.getBufferedRangesMap()).some(function(t){return t.getEnd()>e})},e.prototype.getBufferedRangesMap=function(e,t){return void 0===e&&(e=this.currentPlayingPeriodId),void 0===t&&(t=!0),e?t?this.cachedBufferedRanges&&this.cachedBufferedRanges.periodId===e?this.cachedBufferedRanges.ranges:this.getOverallBufferedRangesMap(e):this.cachedRendererRanges&&this.cachedRendererRanges.periodId===e?this.cachedRendererRanges.ranges:this.getRendererRangesMap(e):{}},e.prototype.getRendererRangesMap=function(e){var t=this,i=this.segmentStore.getMediaTypes(e).map(function(e){return e.mimeType}).filter(function(e){return I.MimeTypeHelper.isAV(e)}).reduce(function(e,i){return e[i]=t.getRendererRangesFromStore(i),e},{});return this.cachedRendererRanges={periodId:e,ranges:i},i},e.prototype.getOverallBufferedRangesMap=function(e){var t=this,i=this.segmentStore.getBufferBlock(this.currentPlayingBufferBlockId),n={};if(i){var a=this.segmentStore.getBufferedRangesFromBufferBlocks();Object.keys(a).forEach(function(e){n[e]=r(a[e]);var i=t.getRendererRangesFromStore(e);n[e]=o.BufferRangeHelper.mergeRanges((n[e]||[]).concat(i),t.settings.GAP_TOLERANCE);
})}return this.cacheBufferedRangesForPeriod(e,n),n},e.prototype.cacheBufferedRangesForPeriod=function(e,t){var i=Object.keys(t);i.length>0&&i.every(function(e){return t[e].length>0})&&(this.cachedBufferedRanges={periodId:e,ranges:t})},e.prototype.hasFutureBufferBlockData=function(){return Boolean(this.segmentStore.getNextBufferBlock(this.currentPlayingBufferBlockId))||this.isSwitchingBufferBlock},e.prototype.isInBufferedRange=function(e,t){var i=t||this.manifestService.getPeriodIdForTime(e);return o.BufferRangeHelper.isInBufferedRange(this.getBufferedRangesMap(i),e)},e.prototype.isStarted=function(){return this.isAlreadyStarted},e.prototype.hasStreamEnded=function(){return this.hasStreamEndedInternal},e.prototype.unsubscribeFromBufferChanges=function(){void 0!==this.unsubscribeFromRendererBufferChanges&&(this.unsubscribeFromRendererBufferChanges(),this.unsubscribeFromRendererBufferChanges=void 0)},e.prototype.subscribeToBufferChanges=function(){var e=this;this.unsubscribeFromBufferChanges(),this.unsubscribeFromRendererBufferChanges=S.subscribeToRendererBufferChanges(this.getSourceStore(),function(t){return e.onBufferChanged(t)})},e.prototype.stop=function(e){void 0===e&&(e=!1),this.finishPlayback=!0,this.isAlreadyStarted=!1,this.isStartup=!1,e?(this.renderer.end(),this.hasStreamEndedInternal=!0,this.logger.debug("stopped playback"),this.renderer.off(b.MediaElementEvent.stalled,this.onVideoElementStalled),this.renderer.off(b.MediaElementEvent.waiting,this.onVideoElementStalled),this.renderer.off(b.MediaElementEvent.ended,this.onVideoElementEnded),this.renderer.off(b.MediaElementEvent.timeupdate,this.onVideoElementTimeUpdate),this.eventHandler.off(l.InternalEvent.CurrentTimeNotAdvancing,this.onVideoElementStalled),this.unsubscribeFromBufferChanges(),this.clearBufferMaxSizeChangedSubscription(),this.dataSegmentsPushedMap.clear()):this.endStalling()},e.prototype.hasStopped=function(){return this.finishPlayback},e.prototype.clearBufferMaxSizeChangedSubscription=function(){var e=this;Object.keys(this.bufferMaxSizeChangedSubscriptionMap).forEach(function(t){return e.unsubscribeFromBufferMaxSizeChanged(t)})},e.prototype.restart=function(){this.finishPlayback=!1,this.isAlreadyStarted||(this.isAlreadyStarted=!0,this.renderer.on(b.MediaElementEvent.stalled,this.onVideoElementStalled),this.renderer.on(b.MediaElementEvent.waiting,this.onVideoElementStalled),this.renderer.on(b.MediaElementEvent.ended,this.onVideoElementEnded),this.renderer.on(b.MediaElementEvent.timeupdate,this.onVideoElementTimeUpdate),this.eventHandler.on(l.InternalEvent.CurrentTimeNotAdvancing,this.onVideoElementStalled,!0),this.subscribeToBufferChanges()),this.hasStreamEndedInternal=!1},e.prototype.dispose=function(){this.stop(!0),this.renderer=null,this.eventHandler=null,this.settings=null,this.bufferSettings=null,this.eventHandler=null,this.segmentStore=null,this.activeInitSegments=null,this.currentRendererMediaTypes=null,this.clearBufferMaxSizeChangedSubscription(),this.drmConfigValidPromise=null,this.bufferStallingService=d.dispose(this.bufferStallingService)},e.prototype.changeBufferType=function(e,t){var i,n,r,o,a=this,s=null===(n=this.currentRendererMediaTypes)||void 0===n?void 0:n.find(function(t){return I.MimeTypeHelper.getMediaType(t.mimeType)===I.MimeTypeHelper.getMediaType(e)});return s&&(this.currentRendererMediaTypes.splice(this.currentRendererMediaTypes.indexOf(s),1),this.currentRendererMediaTypes.push({mimeType:e,codec:t,timestampOffset:0}),this.unsubscribeFromBufferMaxSizeChanged(s.mimeType)),this.subscribeToBufferMaxSizeChanged(e),this.segmentStore.changeMediaType(e,null===(r=s)||void 0===r?void 0:r.mimeType),this.bufferStartTimes["delete"](null===(o=s)||void 0===o?void 0:o.mimeType),this.activeInitSegments={},s?this.renderer.changeBufferType(e,t)["finally"](function(){return a.subscribeToBufferChanges()}):Promise.resolve((i={},i[e]=t,i))},e.prototype.addRequiredMediaType=function(e,t){this.segmentStore.addRequiredMediaType(e,t)},e.prototype.updateMediaType=function(e,t){this.segmentStore.updateMediaType(e,t)},e.prototype.areMediaTypesFinal=function(e){return this.segmentStore.areBufferBlockMediaTypesFinal(e)},e.prototype.areBufferBlockMediaTypesFinal=function(e){return this.segmentStore.areBufferBlockMediaTypesFinal(e)},e.prototype.clearCache=function(e){this.segmentStore.clearSegments(e),this.cachedBufferedRanges=null},e.prototype.clearBuffers=function(){var e=this;this.isClearingBuffers=!0,this.startStalling(),this.clearCache();var t=this.clearRendererBuffers();return t["finally"](function(){return e.isClearingBuffers=!1}),t},e.prototype.clearRendererBuffers=function(){var e=this;if(!this.isBufferAvailable())return Promise.resolve();var t=this.currentRendererMediaTypes.map(function(t){return e.clearBuffer(t.mimeType)});return Promise.all(t).then(function(){})},e.prototype.clearBuffer=function(e){var t=this;return this.renderer.removeData(e)["catch"](function(i){return t.logger.debug("Error clearing "+e+" buffer:",i)}).then(function(){t.cachedRendererRanges=null,t.cachedBufferedRanges=null})},e.prototype.isBufferAvailable=function(){return Boolean(this.currentRendererMediaTypes&&Object.keys(this.currentRendererMediaTypes).length)},e}();t.BufferController=B},481:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(23),r=i(48),o=i(19),a=function(){function e(e,t,i,n){this.playerStateService=e,this.logger=t,this.eventHandler=i,this.renderer=n}return e.prototype.startStalling=function(){this.isRendererStalling()||(this.logger.debug("Stalling playback"),this.logger.insane("Video element stall started in state: "+this.playerStateService.playbackState),this.playerStateService.setIsRendererStalling(!0),this.playerStateService.isPlaying()&&(this.logger.insane("Call pause on renderer"),this.renderer.pause()))},e.prototype.endStalling=function(e,t,i){var a=this;if(this.isRendererStalling()){var s=this.playerStateService.seekingOrTimeshifting;if(!e&&!t&&!s&&i)return this.logger.insane("Ending stall at the gap - dispatch EndStallAtGap"),void this.eventHandler.dispatchEvent(n.InternalEvent.EndStallAtGap,{},!0);this.logger.debug("Unstalling playback"),this.playerStateService.setIsRendererStalling(!1);var u=[r.PlaybackState.Play,r.PlaybackState.Playing].includes(this.playerStateService.playbackState);u&&(!s&&o.getCapabilities().isChromium&&(this.logger.insane("Resetting current time before unstalling"),this.renderer.setCurrentTime(this.renderer.getCurrentTime())),this.logger.insane("Call play on renderer"),this.renderer.play()["catch"](function(e){a.logger.insane("Play failed with reason: "+e)}))}},e.prototype.isRendererStalling=function(){return this.playerStateService.getIsRendererStalling()},e.prototype.dispose=function(){this.logger=null,this.playerStateService=null,this.renderer=null,this.eventHandler=null},e}();t.BufferStallingService=a},482:function(e,t,i){"use strict";function n(){var e=o.getCapabilities();return e[r.CapabilityKey.isWebOS]?new a:{isPeriodSwitchSafe:function(){return!0}}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(65),o=i(19);t.createPeriodSwitchMonitor=n;var a=function(){function e(){}return e.prototype.isPeriodSwitchSafe=function(){return!1},e}()},483:function(e,t,i){"use strict";function n(e){return e.map(function(e){return{range:e.getCommonBufferRanges(),block:e}}).sort(function(e,t){return e.range.start-t.range.start})}function r(e,t){return t.reduce(function(t,i){return i.range.start>=e?Math.min(i.range.start,t):t},1/0)}function o(e,t){return t.reduce(function(t,i){return i.range.end<=e?Math.max(i.range.start,t):t},-(1/0))}var a=this&&this.__assign||function(){return a=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},a.apply(this,arguments)},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var n=Array(e),r=0,t=0;t<i;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)n[r]=o[a];return n};Object.defineProperty(t,"__esModule",{value:!0});var u=i(122),d=i(5),c=i(208),l=i(209);t.INITIAL_BUFFER_BLOCK_ID=0;var h=.01,p=function(){function e(){this.requiredMediaTypes={},this.delayedMediaTypeToUpdate={},this.delayedMediaTypeToSet={};var e=new c.BufferBlock(t.INITIAL_BUFFER_BLOCK_ID);this.requiredMediaTypes={},this.segregation=new l.Segregation(this.requiredMediaTypes),this.bufferBlocks=[e]}return e.prototype.getBufferedRangesFromBufferBlocks=function(){var e=this.getCurrentBufferBlockId(),t=this.getFutureBufferBlocks(e),i={};return t.forEach(function(e){var t=e.getBufferedRanges();Object.keys(t).forEach(function(e){i[e]?i[e]=s(i[e],t[e]):i[e]=t[e]})}),i},e.prototype.getBufferBlockByPeriodId=function(e){return this.bufferBlocks.find(function(t){return t.getPeriodId()===e})},e.prototype.hasSegmentsForBufferBlock=function(e){return this.getAllSegmentsFromBufferBlock(e).hasNext()},e.prototype.hasDataSegmentsForBufferBlock=function(e){var t=Object.keys(e.mediaTypes).filter(function(e){return d.MimeTypeHelper.isAV(e)});return t.every(function(t){return e.hasDataSegments(t)})},e.prototype.getTargetBufferBlock=function(e,t){return this.getBufferBlockForPlaybackTime(e)||this.getBufferBlockByPeriodId(t)||this.getClosestFutureBufferBlock(e)},e.prototype.canSwitchToBufferBlock=function(e,t){if(!t)return!1;var i=this.areBufferBlockMediaTypesFinal(t.getPeriodId(),e),n=this.hasDataSegmentsForBufferBlock(t);return n&&i},e.prototype.areBufferBlockMediaTypesFinal=function(e,t){var i,n=this;if(void 0!==t&&(i=this.getBufferBlockForPlaybackTime(t)),i||(i=this.getBufferBlockByPeriodId(e)),!i||!i.mediaTypes||0===Object.keys(i.mediaTypes).length)return!1;if(void 0===this.requiredMediaTypes[e])return!1;var r=Object.keys(i.mediaTypes),o=Object.keys(this.requiredMediaTypes[e]).filter(function(e){return d.MimeTypeHelper.isAV(e)});return o.every(function(t){var i;return r.includes(t)&&(null===(i=n.requiredMediaTypes[e][t])||void 0===i?void 0:i.codec)})},e.prototype.addRequiredMediaType=function(e,t){var i=this.getBufferBlockByPeriodId(e);if(this.requiredMediaTypes[e]||(this.requiredMediaTypes[e]={}),this.requiredMediaTypes[e][t]||(this.requiredMediaTypes[e][t]={mimeType:t,codec:null,timestampOffset:0}),i){var n=i.mediaTypes[t];n||i.addMediaType({mimeType:t,codec:null,timestampOffset:0})}else this.delayedMediaTypeToSet[e]||(this.delayedMediaTypeToSet[e]={}),this.delayedMediaTypeToSet[e][t]={mimeType:t,codec:null,timestampOffset:0}},e.prototype.changeMediaType=function(e,t){var i=this,n=Object.keys(this.requiredMediaTypes);n.forEach(function(n){var r=t;t||(r=Object.keys(i.requiredMediaTypes[n]).find(function(t){return d.MimeTypeHelper.getMediaType(t)===d.MimeTypeHelper.getMediaType(e)})),i.removeRequiredMediaType(n,r),i.addRequiredMediaType(n,e)})},e.prototype.removeRequiredMediaType=function(e,t){if(this.requiredMediaTypes[e]){delete this.requiredMediaTypes[e][t];var i=this.getBufferBlockByPeriodId(e);i&&i.removeMediaType(t)}this.delayedMediaTypeToSet[e]&&delete this.delayedMediaTypeToSet[e][t]},e.prototype.updateRequiredMediaTypes=function(e,t){var i;if(this.requiredMediaTypes[e]){var n=this.requiredMediaTypes[e][t.mimeType];this.requiredMediaTypes[e][t.mimeType]=a(a({},n),t)}else this.requiredMediaTypes[e]=(i={},i[t.mimeType]=t,i)},e.prototype.updateMediaType=function(e,t){var i,n;this.updateRequiredMediaTypes(e,t);var r=this.getBufferBlockByPeriodId(e);(null===(n=r)||void 0===n?void 0:n.hasMediaType(t.mimeType))?r.updateMediaTypeForMimeType(t):this.delayedMediaTypeToUpdate[e]=a(a({},this.delayedMediaTypeToUpdate[e]||{}),(i={},i[t.mimeType]=t,i))},e.prototype.findBestMatchingBufferBlockForSegment=function(e,t){var i,a=this;if(1===this.bufferBlocks.length&&this.segregation.canAddSegmentToBufferBlock(e,this.bufferBlocks[0],t))return this.bufferBlocks[0];var s=[],u=[];this.bufferBlocks.forEach(function(i){a.segregation.canAddSegmentToBufferBlock(e,i,t)?s.push(i):u.push(i)});var d=n(s),c=n(u),l=e.getPlaybackTime(),h=d.find(function(e){var t=o(e.range.start,c),i=r(e.range.end,c);return t<=l&&l<=i});return null===(i=h)||void 0===i?void 0:i.block},e.prototype.addSegment=function(e){var t=this.segregation.getSegregationCriteria(e),i=this.findBestMatchingBufferBlockForSegment(e,t);i||(i=this.createNewBufferBlock(),this.bufferBlocks.push(i)),i.addSegment(e),i.getSegregationCriteria(e.getMimeType())||i.setSegregationCriteria(t,e.getMimeType());var n=e.getPeriodId(),r=e.getMimeType();this.delayedMediaTypeToSet[n]&&this.delayedMediaTypeToSet[n][r]&&(this.addRequiredMediaType(n,r),delete this.delayedMediaTypeToSet[n][r]),this.delayedMediaTypeToUpdate[n]&&this.delayedMediaTypeToUpdate[n][r]&&(this.updateMediaType(n,this.delayedMediaTypeToUpdate[n][r]),delete this.delayedMediaTypeToUpdate[n][r])},e.prototype.getNewBufferBlockId=function(){var e=this.bufferBlocks[this.bufferBlocks.length-1];return e?e.getId()+1:t.INITIAL_BUFFER_BLOCK_ID},e.prototype.createNewBufferBlock=function(){var e=this.getNewBufferBlockId();return new c.BufferBlock(e)},e.prototype.getMediaTypes=function(e){var t=this;return e&&this.requiredMediaTypes[e]?Object.keys(this.requiredMediaTypes[e]).map(function(i){return t.requiredMediaTypes[e][i]}):[]},e.prototype.getAllBufferBlocks=function(){return this.bufferBlocks},e.prototype.getCurrentBufferBlockId=function(){var e,i,n=this.bufferBlocks[0];return i=null===(e=n)||void 0===e?void 0:e.getId(),null!==i&&void 0!==i?i:t.INITIAL_BUFFER_BLOCK_ID},e.prototype.deleteOldBufferBlocks=function(e){this.bufferBlocks=this.bufferBlocks.filter(function(t){return t.getId()>=e&&t.getAllSegments().length>0})},e.prototype.getActiveBufferBlock=function(){var e;return e=this.getBufferBlock(this.getCurrentBufferBlockId()),null!==e&&void 0!==e?e:null},e.prototype.getBufferBlock=function(e){return this.bufferBlocks.find(function(t){return t.getId()===e})},e.prototype.getBufferBlockForSegment=function(e){return this.getBufferBlock(e.getBufferBlockId())},e.prototype.getBufferBlockForPlaybackTime=function(e){var t=this,i=this.bufferBlocks.filter(function(i){var n=0===e?t.getSmallestMaxSegmentDuration(i)-h:h,r=Object.keys(i.mediaTypes).filter(function(e){return d.MimeTypeHelper.isAV(e)});return r.every(function(t){var r,o;return(null===(r=i.getPlaybackTimeRange(t))||void 0===r?void 0:r.start)<=e+n&&(null===(o=i.getPlaybackTimeRange(t))||void 0===o?void 0:o.end)>=e})});return i[i.length-1]},e.prototype.getClosestFutureBufferBlock=function(e){return this.bufferBlocks.find(function(t){var i=Object.keys(t.mediaTypes);return i.every(function(i){var n;return(null===(n=t.getPlaybackTimeRange(i))||void 0===n?void 0:n.start)>=e})})},e.prototype.getNextSegment=function(){var e,t;return t=null===(e=this.getActiveBufferBlock())||void 0===e?void 0:e.getNextSegment(),null!==t&&void 0!==t?t:null},e.prototype.removeSegment=function(e){var t=this.getBufferBlockForSegment(e);t&&t.removeSegment(e)},e.prototype.getAllSegmentsFromBufferBlock=function(e,t){if(!e)return u.EmptyIterator.getInstance();var i=e.getAllSegments();return t?new u.FilterIterator(new u.ArrayIterator(i),function(e){return e.getMimeType()===t}):new u.ArrayIterator(i)},e.prototype.getNextBufferBlock=function(e){var t=this.bufferBlocks.find(function(t){return t.getId()>e});return null!==t&&void 0!==t?t:null},e.prototype.getFutureBufferBlocks=function(e){return this.bufferBlocks.filter(function(t){return t.getId()>=e})},e.prototype.removeOldSegments=function(e,t){this.bufferBlocks.forEach(function(i){return i.removeOldSegments(e,t)})},e.prototype.clearSegments=function(e){this.bufferBlocks.forEach(function(t){return t.clearSegments(e)})},e.prototype.getSmallestMaxSegmentDuration=function(e){var t=Boolean(e)&&e.hasMaxSegmentDurations();return t?e.getMinMaxSegmentDuration():-1},e.prototype.getSmallestSafeBufferSize=function(e,t){var i,n=this.getBufferBlockForPlaybackTime(e);return(null===(i=n)||void 0===i?void 0:i.hasMaxSegmentDuration(t))?n.getMaxSegmentDuration(t)+1:1},e.prototype.getAvailablePositionForTime=function(e,t){var i=e;if(t&&e>t){var n=this.getBufferBlockForPlaybackTime(e);n||(n=this.getClosestFutureBufferBlock(e),n&&(i=n.getMinCommonStartTime()))}return i},e}();t.SegmentStore=p},484:function(e,t,i){"use strict";function n(e,t,i){switch(e.type){case a.StreamType.Dash:var n=s.ModuleManager.get(u.ModuleName.DASH).MPDLoader;return new n(t,i);case a.StreamType.Hls:var d=s.ModuleManager.get(u.ModuleName.HLS).M3u8Loader;return new d(t,i);case a.StreamType.Smooth:var c=s.ModuleManager.get(u.ModuleName.Smooth).SmoothStreamingLoader;return new c(t,i);default:throw new o.PlayerError(r.ErrorCode.SOURCE_INVALID)}}Object.defineProperty(t,"__esModule",{value:!0});var r=i(6),o=i(7),a=i(9),s=i(2),u=i(0);t.createManifestLoadingService=n},485:function(e,t,i){"use strict";function n(e){var t;return e._requestTimestamp+h.toMilliSeconds((t=e._updateInterval,null!==t&&void 0!==t?t:1/0))>Date.now()}var r=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),o=this&&this.__decorate||function(e,t,i,n){var r,o=arguments.length,a=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,i,n);else for(var s=e.length-1;s>=0;s--)(r=e[s])&&(a=(o<3?r(a):o>3?r(t,i,a):r(t,i))||a);return o>3&&a&&Object.defineProperty(t,i,a),a};Object.defineProperty(t,"__esModule",{value:!0});var a=i(3),s=i(23),u=i(62),d=i(48),c=i(28),l=i(183),h=i(4),p=i(49),f=i(486),g=i(488),m=function(e){function t(t,i){var n=e.call(this,{onSuspend:function(){return n.onSuspend()},onRestore:function(){return n.onRestore()}})||this;n.initiated=!1,n.trackUpdaters={},n.selectActiveTracks=function(e){var t;return null===(t=e)||void 0===t?void 0:t.activeTracks},n.handleActiveTracksChange=function(e){e&&n.manifestService.isHlsManifest()&&n.updateTracks(e)},n.selectPlaybackState=function(e){return e.player&&e.player.playbackState},n.handlePlaybackStateChange=function(e){e&&(e===d.PlaybackState.Paused?n.stop():e===d.PlaybackState.Playing&&n.start())},n.updatedRepresentation=function(e){n.updateAdaptationSetInManifest(e),n.updateManifest(n.manifestService.getManifest())["catch"](function(){n.logger.debug("Updating the manifest failed")})},n.representationUpdateError=function(e){n.logger.debug("Rejection while updating the representation",e)},n.updateManifest=function(e){return n.manifestService.updateManifest(e).then(function(){return n.publishUpdatedManifest(e)})},n.manifestDownloadError=function(){n.logger.debug("Error while loading manifest")},n.context=t,n.sourceContext=i;var r=n.sourceContext.sourceIdentifier;return n.manifestService=t.serviceManager.get(a.ServiceName.ManifestService,r),n.manifestLoader=t.serviceManager.get(a.ServiceName.ManifestLoadingService,r),n.store=t.store,n.sourceStore=t.serviceManager.get(a.ServiceName.SourceStoreService,r),n.eventHandler=t.eventHandler,n.logger=t.logger,n.unsubscribeFromActiveTrackChanges=n.subscribeToActiveTrackChanges(),n.unsubscribeFromPausePlayingChanges=n.subscribeToPausePlayingChanges(t),n}return r(t,e),t.prototype.subscribeToActiveTrackChanges=function(){var e=this;return c.subscribe(this.sourceStore)(function(t){return e.selectActiveTracks(t)},this.handleActiveTracksChange)},t.prototype.updateTracks=function(e){this.processNewActiveTrack(e),this.removeDeactivatedTrackUpdaters(e)},t.prototype.processNewActiveTrack=function(e){var t=this;Object.keys(e).forEach(function(i){t.updateTrackUpdater(e[i].selectedRepresentationId)})},t.prototype.removeDeactivatedTrackUpdaters=function(e){var t=this;Object.keys(this.trackUpdaters).filter(function(t){return!Object.keys(e).includes(t)}).forEach(function(e){t.trackUpdaters[e].stop(),delete t.trackUpdaters[e]})},t.prototype.subscribeToPausePlayingChanges=function(e){return c.subscribe(this.store)(this.selectPlaybackState,this.handlePlaybackStateChange,function(){return e.settings.STOP_DOWNLOAD_ON_PAUSE})},t.prototype.updateTrackUpdater=function(e){var t=this.manifestService.getRepresentationById(e),i=e.adaptationSetId;if(this.trackUpdaters[i]){if(!this.trackUpdaters[i].getRepresentation()._internalId.equals(e)){var n=this.trackUpdaters[i];n.setRepresentation(t)}}else this.trackUpdaters[t._internalId.adaptationSetId]=this.initializeTrackUpdater(t)},t.prototype.updateLinkedRepresentation=function(e){var t,i=this.trackUpdaters[e._internalId.adaptationSetId];null===(t=i)||void 0===t?void 0:t.setRepresentation(e)},t.prototype.initializeTrackUpdater=function(e){var t=new g.RepresentationUpdater(e,this.manifestLoader,{success:this.updatedRepresentation,error:this.representationUpdateError});return t.start(),t},t.prototype.updateAdaptationSetInManifest=function(e){this.sourceStore.dispatch(p.updateRepresentationAction(e))},t.prototype.init=function(e){var t=this;return this.manifestLoader.load(e).then(function(e){return t.updateManifest(e).then(function(){t.initiated=!0,t.manifestService.isLive()&&!t.manifestService.isHlsManifest()&&t.scheduleManifestReloading(e)})})},t.prototype.scheduleManifestReloading=function(e){this.manifestUpdater=new f.ManifestUpdater(this.manifestLoader,e,{success:this.updateManifest,error:this.manifestDownloadError}),this.manifestUpdater.start()},t.prototype.publishUpdatedManifest=function(e){this.eventHandler.dispatchEvent(s.InternalEvent.MPDUpdated,{manifest:e},!0)},t.prototype.waitForRepUpdate=function(e){if(0===Object.keys(this.trackUpdaters).length)return Promise.resolve();var t=this.manifestService.getRepresentationById(e);return n(t)?Promise.resolve():this.trackUpdaters[e.adaptationSetId].updateRepresentation().then(function(){})},t.prototype.stop=function(){Object.values(this.trackUpdaters).forEach(function(e){return e.stop()}),this.manifestUpdater&&this.manifestUpdater.stop()},t.prototype.start=function(){Object.values(this.trackUpdaters).filter(function(e){return e.isStopped}).forEach(function(e){e.start()}),this.manifestUpdater&&this.manifestUpdater.isStopped&&this.manifestUpdater.start()},t.prototype.onSuspend=function(){this.unsubscribeFromPausePlayingChanges()},t.prototype.onRestore=function(){this.unsubscribeFromPausePlayingChanges=this.subscribeToPausePlayingChanges(this.context)},t.prototype.isInitiated=function(){return this.initiated},t.prototype.dispose=function(){this.unsubscribeFromActiveTrackChanges(),this.unsubscribeFromPausePlayingChanges(),this.stop(),this.manifestUpdater=null,this.trackUpdaters=null,e.prototype.dispose.call(this)},o([u.trackPerformance("ManifestUpdateScheduler.init",!0)],t.prototype,"init",null),t}(l.Suspendable);t.ManifestUpdateScheduler=m},486:function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=i(210),o=i(90),a=function(e){function t(t,i,n){var r=e.call(this,n)||this;return r.manifestLoader=t,r.manifest=i,r}return n(t,e),t.prototype.getUpdatedManifest=function(){return this.getPayload()},t.prototype.update=function(){var e=this;return this.manifestLoader.load(this.manifest._currentLoadingUrl).then(function(t){return e.manifest=t,t})},t.prototype.getReloadIntervalInSeconds=function(){return o.getMinimumUpdatePeriodInSeconds(this.manifest)},t.prototype.getLastReloadTimestamp=function(){return this.manifest._requestTimestamp},t}(r.AbstractUpdater);t.ManifestUpdater=a},487:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),r=i(1),o=i(68),a=function(){function e(){}return e.create=function(t,i){var r=i.serviceManager.get(n.ServiceName.ManifestService,i.sourceContext.sourceIdentifier);return new(function(){function i(){r.isHlsManifest()?this.hls=e.createHlsApi(r):r.isSmoothManifest()||(this.dash=e.createDashApi(t,r))}return i}())},e.createDashApi=function(t,i){return new(function(){function n(){}return n.prototype.getPeriod=function(){var n=i.getPeriodIdForTime(t.getCurrentTime()),r=i.getPeriod(new o.PeriodId(n));return r?e.createPeriodApi(i,r):null},n.prototype.listPeriods=function(){return i.getAllPeriods().map(function(t){return e.createPeriodApi(i,t)})},n}())},e.createHlsApi=function(t){return new(function(){function i(){this.properties=t.getHlsTags()}return i.prototype.getVideoTracks=function(){return e.getVideoTracks(t,t.getFirstPeriod()._id)},i.prototype.getAudioTracks=function(){return e.getAudioTracks(t,t.getFirstPeriod()._id)},i.prototype.getTextTracks=function(){return e.getTextTracks(t,t.getFirstPeriod()._id)},i}())},e.createPeriodApi=function(t,i){return new(function(){function n(){this.id=i._id,this.properties={},i._id&&(this.properties.id=i._id),i._start&&(this.properties.start=i._start),i._duration&&(this.properties.duration=i._duration)}return n.prototype.getVideoTracks=function(){return e.getVideoTracks(t,this.id)},n.prototype.getAudioTracks=function(){return e.getAudioTracks(t,this.id)},n.prototype.getTextTracks=function(){return e.getTextTracks(t,this.id)},n.prototype.getMetadata=function(){return e.getMetadata(t,this.id)},n}())},e.getAudioTracks=function(t,i){return t.getAvailableAudio(i,!1).map(function(n){var r={id:n.id,label:n.label,lang:n.lang,getQualities:function(){return e.getAudioQualities(t,i,n.id)}};return n.role&&(r.role=n.role),r})},e.getVideoTracks=function(t,i){return t.getAvailableVideo(i).map(function(n){var r={id:n.id,label:n.label,getQualities:function(){return e.getVideoQualities(t,i)}};return n.role&&(r.role=n.role),r})},e.getTextTracks=function(e,t){return e.getAvailableSubtitles(t)},e.getMetadata=function(e,t){return e.getEventStreamEvents(e.findPeriod(t)).map(function(e){return{type:r.MetadataType.EVENT_STREAM,payload:e.data,start:e.startTime,end:e.endTime}})},e.getAudioQualities=function(e,t,i){var n=e.getAudioRepresentations(t);return n[i]||[]},e.getVideoQualities=function(e,t){return e.getVideoRepresentations(t)},e}();t.MediaPlayerManifestApiFactory=a},488:function(e,t,i){"use strict";var n=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}();Object.defineProperty(t,"__esModule",{value:!0});var r=i(210),o=function(e){function t(t,i,n){var r=e.call(this,n)||this;return r.representation=t,r.manifestLoader=i,r}return n(t,e),t.prototype.getRepresentation=function(){return this.representation},t.prototype.setRepresentation=function(e){this.representation._internalId.equals(e._internalId)||this.cancel(),this.representation=e,this.scheduleUpdate()},t.prototype.updateRepresentation=function(){return this.getPayload()},t.prototype.update=function(){var e=this;return this.manifestLoader.updateRepresentation(this.representation).then(function(t){if(e.representation._id!==t._id)throw r.REPRESENTATION_UPDATE_CANCEL;return e.representation=t,t})},t.prototype.getReloadIntervalInSeconds=function(){var e;return this.representation._requestTimestamp?(e=this.representation._updateInterval,null!==e&&void 0!==e?e:1/0):0},t.prototype.getLastReloadTimestamp=function(){return this.representation._requestTimestamp?this.representation._requestTimestamp:0},t}(r.AbstractUpdater);t.RepresentationUpdater=o},489:function(e,t,i){"use strict";function n(e,t){return new r.UrlInitSegmentProvider(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var r=i(503);t.createInitSegmentProvider=n},49:function(e,t,i){"use strict";function n(e){return S.createAction(y.ManifestActionType.SetManifest,{manifest:e})}function r(e){return S.createAction(y.ManifestActionType.SetManifestInitialized,{isInitialized:e})}function o(e){return S.createAction(y.ManifestActionType.RemoveRepresentations,{representationIds:e})}function a(e){return S.createAction(y.ManifestActionType.UpdateManifest,e)}function s(e){return S.createAction(y.ManifestActionType.UpdateRepresentation,e)}function u(e,t){return S.createAction(y.ManifestActionType.UpdatePeriodTiming,{periodId:e,timing:t})}function d(e){return S.createAction(y.ManifestActionType.AdjustPeriodStartTimes,{offset:e})}function c(e,t){return S.createAction(y.ManifestActionType.SetRepresentationDrmKid,{representationId:e,associatedKid:t})}function l(e,t){return S.createAction(y.ManifestActionType.MarkSegmentAsDownloaded,{adaptationSetId:e,segment:t})}function h(e){return S.createAction(y.ManifestActionType.SetRepresentationFailedDownload,{representationId:e})}function p(e,t){return S.createAction(y.ManifestActionType.SetRepresentationSegmentIndex,{representationId:e,segmentIndex:t})}function f(e,t){return S.createAction(y.ManifestActionType.SetRepresentationIsLoading,{representationId:e,isLoading:t})}function g(e,t){return S.createAction(y.ManifestActionType.SetRepresentationSegmentIndexParsingError,{representationId:e,segmentIndexParsingError:t})}function m(e,t){return S.createAction(y.ManifestActionType.SetRepresentationAnchorPoint,{representationId:e,anchorPoint:t})}Object.defineProperty(t,"__esModule",{value:!0});var S=i(24),y=i(215);t.setManifestAction=n,t.setManifestInitializedAction=r,t.removeRepresentationsAction=o,t.updateManifestAction=a,t.updateRepresentationAction=s,t.updatePeriodTimingAction=u,t.adjustPeriodStartTimes=d,t.setRepresentationDrmKidAction=c,t.markSegmentAsDownloadedAction=l,t.setRepresentationFailedDownloadAction=h,t.setRepresentationSegmentIndexAction=p,t.setRepresentationIsLoadingAction=f,t.setRepresentationSegmentIndexParsingErrorAction=g,t.setRepresentationAnchorPointAction=m},490:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(15),r=i(489),o=function(){function e(e,t){this.context=e,this.provider=r.createInitSegmentProvider(e,t)}return e.prototype.getSegment=function(e){return this.provider.getSegment(e)},e.prototype.hasCachedSegment=function(e){return Boolean(this.getCachedSegment(e))},e.prototype.getCachedSegment=function(e){return this.provider.getCachedSegment(e)},e.prototype.removeCachedSegments=function(e){this.provider.removeCachedSegments(e)},e.prototype.dispose=function(){this.provider=n.dispose(this.provider)},e}();t.InitSegmentService=o},491:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(){this.storedInitSegments=new Map}return e.prototype.handleSegment=function(e){e.isInit()?this.storeInitSegment(e):this.setStoredInitSegment(e)},e.prototype.storeInitSegment=function(e){this.storedInitSegments.set(e.getRepresentationId().key(),e)},e.prototype.setStoredInitSegment=function(e){if(!e.getInitSegment()){var t=this.storedInitSegments.get(e.getRepresentationId().key());e.setInitSegment(t)}},e.prototype.clear=function(){this.storedInitSegments.clear()},e.prototype.dispose=function(){this.clear()},e}();t.InitSegmentStore=n},492:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(6),r=i(7),o=i(17),a=i(13),s=function(){function e(e){this.context=e,this.settings=e.settings,this.loader=new o.DefaultContentLoader(this.context,{maxRetries:this.settings.MAX_RETRIES,retryDelay:this.settings.RETRY_DELAY,requestType:a.HttpRequestType.KEY_HLS_AES})}return e.prototype.hasWithCredentials=function(){var e=this.context.sourceContext.source&&this.context.sourceContext.source.hasOwnProperty("options"),t=e&&this.context.sourceContext.source.options,i=t&&t.hasOwnProperty("withCredentials")&&t.withCredentials,n=t&&t.hasOwnProperty("hlsWithCredentials")&&t.hlsWithCredentials;
return Boolean(i)||Boolean(n)},e.prototype.load=function(e){var t=this;return this.loader.load(e,a.HttpRequestMethod.GET,a.HttpResponseType.ARRAYBUFFER,null,null,this.hasWithCredentials()).then(function(e){return e.body})["catch"](function(e){return t.context.eventHandler.fireError(new r.PlayerError(n.ErrorCode.DRM_FAILED_LICENSE_REQUEST,{statusCode:e.status,statusText:e.statusText})),Promise.reject(e)})},e.prototype.isLoading=function(){return this.loader.isLoading()},e.prototype.dispose=function(){this.loader&&"function"==typeof this.loader.dispose&&this.loader.dispose(),this.loader=null,this.settings=null},e}();t.KeyLoader=s},493:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=20,r=function(){function e(e){void 0===e&&(e=n),this.CAPACITY=e,this.keys=[]}return e.prototype.get=function(e){var t=this.keys.find(function(t){return t.uri===e});return t?t.buffer:null},e.prototype.put=function(e,t){this.keys.push({uri:e,buffer:t}),this.keys.length>this.CAPACITY&&this.keys.shift()},e.prototype.dispose=function(){this.keys=null},e}();t.KeyStore=r},494:function(e,t,i){"use strict";function n(e,t){return e.config.tweaks.segmentLoaderArgs?e.config.tweaks.segmentLoaderArgs:{maxRetries:e.settings.MAX_CDN_RETRIES,requestType:r(t),disableDownloadTimeout:!0,resetRetriesWhenOffline:!0}}function r(e){return u.MimeTypeHelper.isVideo(e)?s.HttpRequestType.MEDIA_VIDEO:u.MimeTypeHelper.isAudio(e)?s.HttpRequestType.MEDIA_AUDIO:u.MimeTypeHelper.isSubtitle(e)?s.HttpRequestType.MEDIA_SUBTITLES:u.MimeTypeHelper.isUnknown(e)?s.HttpRequestType.INTERNAL:s.HttpRequestType.UNKNOWN}function o(e,t){var i=e.config.tweaks.segmentLoader;return i&&"function"==typeof i?new i(t):new a.DefaultContentLoader(e,t)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(17),s=i(13),u=i(5);t.getLoaderConfig=n,t.getLoader=o},495:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(6),r=i(3),o=i(1),a=i(2),s=i(0),u=i(56),d=function(){function e(){}return e.createInstance=function(e,t,i,d,c){void 0===d&&(d="0");var l=e.serviceManager.get(r.ServiceName.ManifestService,e.sourceContext.sourceIdentifier),h=null;if(l.hasAdaptationSets(d)){var p=l.findAdaptationSet(d,t,c);if(!p)return e.logger.debug("Did not find adaptation set for mime type ["+t+"] in period "+d),null;var f=p.Representation&&p.Representation[0],g=f&&f.SegmentTemplate?f.SegmentTemplate:p.SegmentTemplate;if(g)if(l.isSmoothManifest()){var m=a.ModuleManager.get(s.ModuleName.Smooth),S=m.createSmoothSegmentTemplateMPDHandler();h=new S(e,t,i)}else if(g[0].SegmentTimeline){var y=a.ModuleManager.get(s.ModuleName.DASH);h=new y.SegmentTimelineMPDHandler(e)}else{var y=a.ModuleManager.get(s.ModuleName.DASH);h=new y.SegmentTemplateMPDHandler(e)}else if(f.SegmentList)h=new u.SegmentListMPDHandler(e);else if(f.SegmentBase){var v=a.ModuleManager.get(s.ModuleName.DASH);h=new v.SegmentBaseMPDHandler(e)}else h=null,e.eventHandler.fireEvent(o.PlayerEvent.Error,{code:n.ErrorCode.SOURCE_MANIFEST_INVALID})}return h},e}();t.MPDHandlerFactory=d},496:function(e,t,i){"use strict";function n(e,t,i,n){e.eventHandler.dispatchEvent(c.PlayerEvent.Warning,new u.PlayerWarning(d.WarningCode.PLAYBACK_DECODE_RETRIES_EXCEEDED)),e.eventHandler.fireError(r(e,t,i,n))}function r(e,t,i,n){if(0===i)return t&&t===l.RequestError.TimedOut?new s.PlayerError(a.ErrorCode.NETWORK_SEGMENT_DOWNLOAD_TIMEOUT):new s.PlayerError(a.ErrorCode.NETWORK_ERROR);e.logger.debug(t);var r={message:t};return n.url&&(r.segment=o(n)),new s.PlayerError(a.ErrorCode.NETWORK_ERROR,r)}function o(e){var t=e.url,i=e.mimeType,n=e.codec;return{url:t,mimeType:i,codec:n}}Object.defineProperty(t,"__esModule",{value:!0});var a=i(6),s=i(7),u=i(20),d=i(18),c=i(1),l=i(41);t.throwDownloadError=n},497:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(10),r=function(){function e(){}return e.findSegmentInfoOfRepresentation=function(t,i){if(i.SegmentList){var n=i.SegmentList[0].SegmentURL,r=t.getUrl(),o=n.find(function(t){var n=e.getSegmentInfoUrl(t,i);return n===r});if(o)return o}return null},e.findHlsRepresentationForSegment=function(t,i){for(var n=!1,r=0;r<i.Representation.length;r++){var o=i.Representation[r],a=o.SegmentList[0].SegmentURL,s=void 0;for(s=0;s<a.length;s++){var u=a[s],d=e.getSegmentInfoUrl(u,o);if(d===t.getUrl()){n=!0;break}}if(n)return{representation:o,index:s}}return null},e.getSegmentInfoUrl=function(e,t){var i=e._media;return n.URLHelper.isUrlAbsolute(i)||(i=n.URLHelper.concatUrlParts(t.BaseURL[0],i)),i},e}();t.SegmentInfoProvider=r},498:function(e,t,i){"use strict";function n(e,t){var i=c.MimeTypeHelper.extractContentType(e);return t&&"number"==typeof t[i]?Math.max(f,t[i]):f}function r(e){var t,i,n,r;return a(null===(i=null===(t=e)||void 0===t?void 0:t.drm)||void 0===i?void 0:i.clearkey)||o(null===(r=null===(n=e)||void 0===n?void 0:n.drm)||void 0===r?void 0:r.clearkey)}function o(e){var t;return Boolean(null===(t=e)||void 0===t?void 0:t.LA_URL)}function a(e){var t;return(null===(t=e)||void 0===t?void 0:t.length)>0}Object.defineProperty(t,"__esModule",{value:!0});var s=i(21),u=i(22),d=i(16),c=i(5),l=i(2),h=i(0),p=i(126),f=1,g=function(){function e(e,t){this.context=e,this.mimeType=t.mimeType,this.loaders=[],this.shouldDownloadBeCancelledCallback=t.shouldDownloadBeCancelledCallback,this.createLoaders(n(this.mimeType,e.settings.SEGMENT_LOADER_POOL_SIZE)),this.attachDecrypter()}return e.prototype.createLoaders=function(e){for(var t=0;t<e;t++)this.loaders.push(new p.SegmentLoader(this.context,this.mimeType,this.shouldDownloadBeCancelledCallback))},e.prototype.getDecrypter=function(e){if(this.context.segmentPrefetchingService&&this.context.segmentPrefetchingService.hasMp4Decrypter(this.mimeType))return this.context.segmentPrefetchingService.getDecrypter(this.mimeType);var t=l.ModuleManager.get(h.ModuleName.Crypto).createDecrypter,i=a(e.drm.clearkey)?e.drm.clearkey:[];return t(this.context,this.mimeType,i)},e.prototype.getClearKeyLoader=function(e){var t=l.ModuleManager.get(h.ModuleName.Crypto).ClearKeyLoader;return new t(this.context,e)},e.prototype.attachDecrypter=function(){var e=this.context.sourceContext.source,t=r(e)?this.getDecrypter(e):null;if(t&&(this.loaders.forEach(function(e){return e.attachDecrypter(t)}),this.context.segmentPrefetchingService&&this.context.segmentPrefetchingService.setDecrypter(t,this.mimeType),o(e.drm.clearkey))){var i=this.getClearKeyLoader(e.drm.clearkey);this.loaders.forEach(function(e){return e.attachClearKeyLoader(i)})}},e.prototype.isLoading=function(){return this.loaders.some(function(e){return e.isLoading()})},e.prototype.isFreeLoaderAvailable=function(){return this.loaders.some(function(e){return!e.isLoading()})},e.prototype.updateRequestedRepresentationMetric=function(e){var t=u.getMetricsHistoryFromInstanceState(this.context.store.getState(),"default",d.MetricType.RequestedRepresentations),i=t?t.map(function(e){return e.value}):[];i.includes(e)||this.context.store.dispatch(s.addMetricsValue("default",d.MetricType.RequestedRepresentations,e))},e.prototype.load=function(e){var t=this.loaders.find(function(e){return!e.isLoading()});return t?(this.updateRequestedRepresentationMetric(e.internalRepresentationId),this.context.logger.debug("Loading "+e.url+" with loader "+this.loaders.indexOf(t)),t.load(e)):(this.context.logger.debug("Failed to load segment. No free loader!",e.url),Promise.reject(null))},e.prototype.cancelLoading=function(){var e=this;return Promise.all(this.loaders.map(function(e){return e.isLoading()&&e.cancelLoading(),Promise.resolve(e.getCurrentLoadPromise())})).then(function(){})["catch"](function(t){e.context&&e.context.logger.debug("Error while loading a segment ",t)})},e.prototype.getLoadingPeriodIds=function(){return this.loaders.flatMap(function(e){return e.getAllLoadingPeriodIds()})},e.prototype.dispose=function(){this.cancelLoading(),this.loaders.forEach(function(e){return e.dispose()}),this.loaders=null,this.context=null},e}();t.SegmentLoaderPool=g,t.getLoaderPoolSize=n},499:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),r=i(1),o=i(21),a=i(16),s=i(5),u=i(89),d=i(34),c=i(90),l=i(212),h=i(91),p=i(103),f=i(497),g=i(56),m="SegmentPreProcessor",S=function(){function e(e,t,i,r,o,a,s,u){this.context=e,this.mimeType=t,this.onDataAvailableCallback=i,this.hls=r,this.initSegmentStore=o,this.segmentUnavailabilityHandler=a,this.timestampOffsetService=s,this.segmentParser=u,this.isKeyframeRecoveryOngoing=!1,this.downloadRepresentationId=null;var d=e.sourceContext.sourceIdentifier;this.manifestService=this.context.serviceManager.get(n.ServiceName.ManifestService,d),this.playerStateService=this.context.serviceManager.get(n.ServiceName.PlayerStateService)}return Object.defineProperty(e.prototype,"logger",{get:function(){return this.context.logger},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventHandler",{get:function(){return this.context.eventHandler},enumerable:!0,configurable:!0}),e.prototype.isSubtitleSegment=function(e){return s.MimeTypeHelper.isSubtitle(e.getMimeType())},e.prototype.setHlsTimelineTracker=function(e){this.hlsTimelineTracker=e},e.prototype.setMpdHandler=function(e){this.mpdHandler=e},e.prototype.cacheOrCallOnSegmentAvailable=function(e,t,i,n,r,o,a,s){var u,d=this,c=this.hasHlsTimelineGap(t.find(function(e){return p.isSegmentOfMainStream(e,d.hls)}),i,r);c.hasGap?c.couldHandle?u=!1:c.couldHandle||(u=!0,this.hlsTimelineTracker.reset()):u=!0;var l=function(e){o=e,a(e)},h=function(e){r=e,s(e)};u?t.forEach(function(t){var a=e.metadata[e.transmuxedSegments.indexOf(t)],s=d.onSegmentAvailable(t,a,i,n,r,o,l,h);s||n.cacheSegment(e.originalSegment)}):c.hasGap&&c.gapSizeSec>0&&n.cacheSegment(e.originalSegment)},e.prototype.onSegmentAvailable=function(e,t,i,r,o,a,s,c){var h=this,f=this.hls.isTransmuxingRequired,g=this.manifestService.getAdaptationSet(i),S=d.getCodecsFromAdaptationSet(g),y=this.mpdHandler.preProcessAvailableSegment(e,t,{codec:S,periodId:e.getPeriodId()});y&&y.additionalSegment&&this.onSegmentAvailable(y.additionalSegment,null,i,r,o,a,s,c),this.initSegmentStore.handleSegment(e);var v=!0,T=e.getSegmentInfo(),M="onSegmentAvailable "+e.getMimeType();if(this.segmentUnavailabilityHandler.downloadSuccess(e.isInit()),e.isInit()&&(M+=" init"),this.logger.debug(M+" segment ["+e.getUrl()+"]"),this.segmentParser&&!f&&!u.TextSegmentAnalyzer.isPlainTextPayload(e.getData())){var I=isNaN(this.mpdHandler.getTimestampOffset())||0===this.mpdHandler.getTimestampOffset();if(this.manifestService.isHlsManifest()&&!e.isInit()&&I&&l.initializeHlsSegmentStartTimes(e,this.context,this.mpdHandler),this.timestampOffsetService.maybeAdjustTimestampOffsetAtDiscontinuityChange(e,this.mpdHandler),this.segmentParser.parseSegment(e),this.manifestService.isHlsManifest()&&!this.isCorrectSegment(e,i,o,r))return}if(this.isSubtitleSegment(e)&&this.manifestService.isHlsManifest()&&this.timestampOffsetService.maybeAdjustTimestampOffsetAtDiscontinuityChange(e,this.mpdHandler),this.manifestService.isHlsManifest()&&!e.isInit()&&this.manifestService.initSegmentStartTimesFromReferenceSegment(e),this.manifestService.isHlsManifest()&&this.manifestService.markSegmentAsDownloaded(i,e),f&&this.hls.possiblyDependentSegments&&a&&!o&&p.isSegmentOfMainStream(e,this.hls)&&!this.isKeyframeRecoveryOngoing&&(this.logger.debug("Just switched playlists, isIndependentlyDecodable? "+e.isIndependentlyDecodable()+" "+("("+e.getMimeType()+", "+e.getUrl()+")")),!e.isIndependentlyDecodable()&&this.mpdHandler.getIndex()>0&&(this.logger.debug("Started keyframe recovery"),this.mpdHandler.setIndex(this.mpdHandler.getIndex()-2),v=!1,this.hls.discardNextSegment=!0,this.isKeyframeRecoveryOngoing=!0)),!v)return!1;this.context.serviceManager.get(n.ServiceName.TimedMetadataService).onSegmentAvailable({segment:e,extractedMetadata:t,isSegmentOfMainStream:p.isSegmentOfMainStream(e,this.hls),presentationTimeOffset:this.mpdHandler.getTimestampOffset()}),this.context.serviceManager.maybeCall(n.ServiceName.SubtitleService,function(i){var n;i.handleClosedCaptions(h.mpdHandler,e,null===(n=t)||void 0===n?void 0:n.closedCaptions,f,S)}),e.isInit()?s(!0):(a&&p.isSegmentOfMainStream(e,this.hls)&&s(!1),this.logger.debug("["+m+"]["+this.mimeType+"]: playbackTimeForSegment="+e.getPlaybackTime()+" "+e.getUrl()));var P=T&&!T.internalRepresentationId.equals(this.downloadRepresentationId);return p.isSegmentOfMainStream(e,this.hls)&&P&&(this.triggerOnDownloadQualityChanged(this.mimeType,this.downloadRepresentationId,T.internalRepresentationId),this.updateDownloadedRepresentation(e),this.downloadRepresentationId=T.internalRepresentationId),p.isSegmentOfMainStream(e,this.hls)&&(this.hlsTimelineTracker&&!e.isInit()&&this.hlsTimelineTracker.trackPlaybackTime(e),this.isKeyframeRecoveryOngoing&&(this.isKeyframeRecoveryOngoing=!1),c(!1)),e.isInit()||this.onDataAvailableCallback(e),v},e.prototype.updateDownloadedRepresentation=function(e){var t=e.getSegmentInfo(),i={id:t.representationId,bitrate:t.bitrate,width:t.width,height:t.height};this.context.store.dispatch(o.addMetricsValue(this.mimeType,a.MetricType.DownloadedRepresentation,i))},e.prototype.triggerOnDownloadQualityChanged=function(e,t,i){var n;if(s.MimeTypeHelper.isVideo(e))n=r.PlayerEvent.VideoDownloadQualityChanged;else{if(!s.MimeTypeHelper.isAudio(e))return;n=r.PlayerEvent.AudioDownloadQualityChanged}var o=c.representationToQuality(this.manifestService.getRepresentationById(t),e),a=c.representationToQuality(this.manifestService.getRepresentationById(i),e);this.eventHandler.dispatchEvent(n,{targetQuality:a,targetQualityId:a.id,sourceQuality:o,sourceQualityId:o?o.id:null})},e.prototype.hasHlsTimelineGap=function(e,t,i){var n={hasGap:!1};if(e&&this.manifestService.isHlsManifest()&&!this.isSubtitleSegment(e)&&!i&&p.isSegmentOfMainStream(e,this.hls)&&this.hlsTimelineTracker&&!this.playerStateService.seekingOrTimeshifting){var r=f.SegmentInfoProvider.findHlsRepresentationForSegment(e,this.manifestService.getAdaptationSet(t));if(r&&(n=this.hlsTimelineTracker.checkForTimelineGap(e,r.representation,r.index),n.hasGap)){this.logger.debug("Encountered timeline gap ("+n.gapSizeSec+"), just loaded "+e.getUrl());var o=this.mpdHandler instanceof g.SegmentListMPDHandler&&this.mpdHandler.getCurrentSegmentList().entries&&this.mpdHandler.getCurrentSegmentList().entries[n.correctedIndex];if(o&&h.areSegmentsIdentical(e.getSegmentInfo(),o))return n.hasGap=!1,n;o&&o.hasDownloadFailed?n.couldHandle=!1:this.mpdHandler.setIndex(n.correctedIndex)}}return n},e.prototype.isCorrectSegment=function(e,t,i,n){var r=this.hasHlsTimelineGap(e,t,i);return!r.hasGap||(r.couldHandle?(this.isSegmentInTheFuture(r)&&n.cacheSegment(e),!1):(this.hlsTimelineTracker.reset(),!0))},e.prototype.isSegmentInTheFuture=function(e){return e.gapSizeSec>0},e.prototype.dispose=function(){this.downloadRepresentationId=null,this.hlsTimelineTracker=null,this.manifestService=null,this.playerStateService=null,this.context=null,this.onDataAvailableCallback=null,this.hls=null,this.initSegmentStore=null,this.segmentUnavailabilityHandler=null,this.timestampOffsetService=null,this.segmentParser=null,this.mpdHandler=null},e}();t.SegmentPreProcessor=S},500:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(35),r=i(126),o=function(){function e(e){var t=this;this.processSegmentInfoQueue=function(e){var i=t.segmentInfoQueue.get(e);i&&0!==i.length&&t.chainSegmentPrefetch(i.shift()).then(function(){return t.processSegmentInfoQueue(e)})},this.segmentInfoQueue=new n.ArrayMap,this.prefetchPromiseChainMap=new Map,this.decrypterMap=new Map,this.segmentLoaderMap=new Map,this.segmentPrefetchHandler=e,this.shouldDownloadBeCancelledCallbackMap=new Map}return e.prototype.updateContext=function(e){this.context=e},e.prototype.setShouldDownloadBeCancelledCallback=function(e,t){this.shouldDownloadBeCancelledCallbackMap.set(e,t)},e.prototype.removeShouldDownloadBeCancelledCallback=function(e){this.shouldDownloadBeCancelledCallbackMap["delete"](e)},e.prototype.setDecrypter=function(e,t){this.decrypterMap.set(t,e),this.segmentLoaderMap.has(t)&&this.segmentLoaderMap.get(t).attachDecrypter(e)},e.prototype.removeDecrypter=function(e){this.decrypterMap["delete"](e)},e.prototype.getDecrypter=function(e){return this.decrypterMap.get(e)},e.prototype.prefetchSegment=function(e){return this.chainSegmentPrefetch(e)},e.prototype.prefetchSegments=function(e){var t=this;e.forEach(function(e){return t.segmentInfoQueue.add(e.mimeType,e)}),this.segmentInfoQueue.keys.forEach(function(e){return t.processSegmentInfoQueue(e)})},e.prototype.chainSegmentPrefetch=function(e){var t=this,i=this.getPrefetchPromiseChain(e.mimeType).then(function(){return t.fetchSegment(e)}).then(function(){})["catch"](function(){});return this.prefetchPromiseChainMap.set(e.mimeType,i),i},e.prototype.fetchSegment=function(e){var t=this,i=this.getLoader(e),n=i.load(e).then(function(e){return e.read()}).then(function(e){return e.value});return this.segmentPrefetchHandler.onPrefetch({segmentInfo:e,loadingPromise:n}),n["catch"](function(i){t.context&&t.context.logger.debug("segment prefetching failed for",e,"with",i)}),n},e.prototype.getPrefetchPromiseChain=function(e){return this.prefetchPromiseChainMap.has(e)||this.prefetchPromiseChainMap.set(e,Promise.resolve()),this.prefetchPromiseChainMap.get(e)},e.prototype.getLoader=function(e){return this.segmentLoaderMap.has(e.mimeType)||this.segmentLoaderMap.set(e.mimeType,this.createLoader(e)),this.segmentLoaderMap.get(e.mimeType)},e.prototype.createLoader=function(e){this.prefetchPromiseChainMap.set(e.mimeType,Promise.resolve());var t=new r.SegmentLoader(this.context,e.mimeType,this.createDownloadCancelCallbackFunction(e),(!0));return t.attachDecrypter(this.decrypterMap.get(e.mimeType)),t},e.prototype.createDownloadCancelCallbackFunction=function(e){var t=this;return function(i){var n=e.mimeType,r=t.segmentLoaderMap.get(n),o=r?r.getCurrentLoadingSegmentInfo():null,a=o?o.internalRepresentationId:e.internalRepresentationId;return!(!t.shouldDownloadBeCancelledCallbackMap||!t.shouldDownloadBeCancelledCallbackMap.has(n))&&t.shouldDownloadBeCancelledCallbackMap.get(n)(i,a)}},e.prototype.clearPrefetchingQueue=function(e){this.segmentInfoQueue["delete"](e)},e.prototype.reset=function(){this.segmentLoaderMap.forEach(function(e){return e.dispose()}),this.shouldDownloadBeCancelledCallbackMap.clear(),this.segmentLoaderMap.clear(),this.decrypterMap.clear()},e.prototype.dispose=function(){this.reset(),this.context=null,this.segmentLoaderMap=null,this.shouldDownloadBeCancelledCallbackMap=null},e}();t.SegmentPrefetcher=o},501:function(e,t,i){"use strict";function n(e){var t=new d.Stream;return t.add(e),t.end(),t}Object.defineProperty(t,"__esModule",{value:!0});var r=i(15),o=i(5),a=i(490),s=i(91),u=i(498),d=i(77),c=function(){function e(e){var t=this;this.context=e,this.disposeSegmentManager=function(e){t.segmentManagerMap.has(e)&&(t.segmentManagerMap.get(e).dispose(),t.segmentManagerMap["delete"](e))},this.segmentManagerMap=new Map}return e.prototype.getSegmentManagerKey=function(e,t){var i=void 0===t?{}:t,n=i.id,r=i.lang;return o.MimeTypeHelper.isSubtitle(e)?[e,n,r].filter(Boolean).join("-"):e},e.prototype.add=function(e,t,i){var n=this.get(e.mimeType,i);return n||(n=this.createSegmentManager(e),this.segmentManagerMap.set(this.getSegmentManagerKey(e.mimeType,i),n)),n},e.prototype.createSegmentManager=function(e){return new l(this.context,e)},e.prototype.get=function(e,t){return this.segmentManagerMap.get(this.getSegmentManagerKey(e,t))},e.prototype.disposeOfType=function(e,t){this.disposeSegmentManager(this.getSegmentManagerKey(e,t))},e.prototype.dispose=function(){this.segmentManagerMap.forEach(function(e){return e.dispose()}),this.segmentManagerMap.clear()},e}();t.SegmentService=c;var l=function(){function e(e,t){this.context=e,this.loaderPool=new u.SegmentLoaderPool(e,t),this.initSegmentService=new a.InitSegmentService(e,this.loaderPool),this.cache=new s.SegmentCache(e.settings.MAX_NUM_CACHED_SEGMENTS),this.sequence=Promise.resolve(null)}return e.prototype.getSegment=function(e){var t=e.isInitSegment?this.getInitSegment(e):this.getDataSegment(e);return this.sequence=this.sequence["catch"](function(){}).then(function(){return t}),this.sequence},e.prototype.getInitSegment=function(e){return this.initSegmentService.getSegment(e).then(n)},e.prototype.getDataSegment=function(e){return this.hasCachedSegment(e)?(this.context.logger.debug("Returning segment from cache for URL: "+e.url),Promise.resolve(n(this.getCachedSegment(e)))):this.loaderPool.load(e)},e.prototype.isLoading=function(e){return e?this.loaderPool.getLoadingPeriodIds().includes(e):this.loaderPool.getLoadingPeriodIds().length>0},e.prototype.canLoad=function(){return this.loaderPool.isFreeLoaderAvailable()},e.prototype.cacheSegment=function(e){this.cache.add(e)},e.prototype.hasCachedSegment=function(e){return Boolean(this.getCachedSegment(e))},e.prototype.getCachedSegment=function(e){return e.isInitSegment?this.initSegmentService.getCachedSegment(e):this.cache.get(e)},e.prototype.removeCachedInitSegments=function(e){this.initSegmentService.removeCachedSegments(e)},e.prototype.clearCache=function(e){void 0===e&&(e=!0),e&&this.initSegmentService.removeCachedSegments(function(){return!0}),this.cache.clear()},e.prototype.cancel=function(){return this.loaderPool.cancelLoading()},e.prototype.dispose=function(){this.cancel(),this.clearCache(!1),this.loaderPool=r.dispose(this.loaderPool),this.initSegmentService=r.dispose(this.initSegmentService)},e}();t.SegmentManager=l},502:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(3),r=i(2),o=i(0),a=function(){function e(e,t){this.context=e,this.mimeType=t,this.discontinuityNumbers=new Map;var i=e.sourceContext.sourceIdentifier;this.sourceStore=e.serviceManager.get(n.ServiceName.SourceStoreService,i)}return Object.defineProperty(e.prototype,"logger",{get:function(){return this.context.logger},enumerable:!0,configurable:!0}),e.prototype.maybeAdjustTimestampOffsetAtDiscontinuityChange=function(e,t){var i=e.getSegmentInfo().discontinuitySequenceNumber;if(null!=i&&!e.isInit()){var n=this.discontinuityNumbers.get(e.getMimeType())!==i,r=isNaN(t.getTimestampOffset());(n||r)&&this.adjustTimestampOffset(e,i,t),this.discontinuityNumbers.set(e.getMimeType(),i)}},e.prototype.adjustTimestampOffset=function(e,t,i){var n=r.ModuleManager.get(o.ModuleName.HLS),a=n.selectors,s=a.getHlsState,u=a.getPresentationTimeOffset,d=s(this.sourceStore.getState()),c=u(d,String(t)),l=this.calculateEncodedPlaybackTime(e),h=l.encodedPlaybackTime,p=l.shouldUpdatePlaybackTime;null==c&&(c=this.calculatePresentationTimeOffset(e,h,t,i)),this.logger.debug("["+this.mimeType+"], discontinuity: "+t+" adjusting PTO to "+c+" on segment "+e.getUrl()),i.setTimestampOffset(c),e.getSegmentInfo().presentationTimeOffset=c,e.setPresentationTimeOffset(c),p&&e.setPlaybackTime(h-c)},e.prototype.calculatePresentationTimeOffset=function(e,t,i,n){null==e.getSegmentInfo().startTime&&(this.logger.debug("["+e.getMimeType()+"] no startTime when trying to calculate the PTO for "+i),n.extrapolateStartTimesFromDiscontinuityStarts(e));var a=t-e.getSegmentInfo().startTime,s=r.ModuleManager.get(o.ModuleName.HLS);return this.sourceStore.dispatch(s.actions.setPresentationTimeOffset(String(i),a)),this.logger.debug("["+e.getMimeType()+"] set PTO for discontinuity "+i+" to "+a),a},e.prototype.calculateEncodedPlaybackTime=function(e){var t=r.ModuleManager.get(o.ModuleName.ContainerMP4,!1),i=!0,n=t?t.parsePlaybackTime(e,this.logger):e.getBaseMediaDecodeTime()/e.getTimescale();return isNaN(n)&&(n=e.getPlaybackTime(),i=!1),{encodedPlaybackTime:n,shouldUpdatePlaybackTime:i}},e.prototype.dispose=function(){this.discontinuityNumbers=null,this.context=null,this.sourceStore=null},e}();t.TimestampOffsetService=a},503:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(21),r=i(16),o=i(91),a=function(){function e(e,t){this.context=e,this.loaderPool=t,this.cache=new o.SegmentCache(1/0)}return e.prototype.getSegment=function(e){var t=this,i=this.cache.get(e),n=i?Promise.resolve(i):this.loadSegment(e);return n.then(function(e){return i||t.cacheSegment(e),e})},e.prototype.loadSegment=function(e){return this.loaderPool.load(e).then(function(e){return e.read()}).then(function(t){if(!t.value)throw new Error("SegmentStream error "+e.url);return t.value})},e.prototype.cacheSegment=function(e){this.cache.add(e),this.context.store.dispatch(n.addMetricsValue(e.getMimeType(),r.MetricType.CachedInitSegments,{internalRepId:e.getSegmentInfo().internalRepresentationId}))},e.prototype.getCachedSegment=function(e){return this.cache.get(e)},e.prototype.removeCachedSegments=function(e){this.cache.remove(e)},e.prototype.dispose=function(){this.cache.clear()},e}();t.UrlInitSegmentProvider=a},504:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e.Aborted="aborted",e.ParallelRead="parallelread"}(n=t.StreamReadError||(t.StreamReadError={}))},505:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n;!function(e){e.Open="open",e.Ended="ended",e.Aborted="aborted"}(n=t.StreamState||(t.StreamState={}))},506:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(1),r=function(){function e(e){var t=this;this.context=e,this.onSeek=function(){t.seekStarted=!0},this.onSeeked=function(){var e=t.context.internalPlayer.getCurrentTime();Object.values(t.delayedSegmentPlaybackData).forEach(function(i){e>=i.playbackTime&&i.playbackTime+i.duration>=e&&t.maybeFirePeriodSwitchEvents(i)}),t.delayedSegmentPlaybackData={}},this.currentDiscontinuityNumbers={},this.delayedSegmentPlaybackData={},this.seekStarted=!1,this.context.eventHandler.on(n.PlayerEvent.Seek,this.onSeek,!0),this.context.eventHandler.on(n.PlayerEvent.Seeked,this.onSeeked,!0)}return e.prototype.onSegmentAvailable=function(e){if(!e.isInit()){var t=e.getMimeType(),i=e.getSegmentInfo();this.currentDiscontinuityNumbers[t]?this.seekStarted&&(this.delayedSegmentPlaybackData[e.getMimeType()]={mimeType:e.getMimeType(),discontinuitySequenceNumber:i.discontinuitySequenceNumber,playbackTime:i.startTime,duration:e.getDuration()},this.seekStarted=!1):this.currentDiscontinuityNumbers[t]={discontinuitySequenceNumber:i.discontinuitySequenceNumber,startTime:i.startTime||0}}},e.prototype.maybeFirePeriodSwitchEvents=function(e){var t=e.mimeType,i=e.discontinuitySequenceNumber,r=e.playbackTime;if(null!=i&&this.currentDiscontinuityNumbers[t]){var o=this.currentDiscontinuityNumbers[t].discontinuitySequenceNumber;o!==i&&(this.shouldFirePeriodSwitchEvent(t,i,r)&&(this.context.eventHandler.dispatchEvent(n.PlayerEvent.PeriodSwitch),this.context.eventHandler.dispatchEvent(n.PlayerEvent.PeriodSwitched,{sourcePeriod:{periodId:String(o)},targetPeriod:{periodId:String(i)}})),this.currentDiscontinuityNumbers[t]={discontinuitySequenceNumber:i,startTime:r})}},e.prototype.shouldFirePeriodSwitchEvent=function(e,t,i){var n=this,r=Object.keys(this.currentDiscontinuityNumbers).filter(function(t){return t!==e}),o=!0;return r.forEach(function(e){var r=n.currentDiscontinuityNumbers[e];if(r.discontinuitySequenceNumber===t){var a=Math.abs(i-r.startTime);a<1&&(o=!1)}}),o},e.prototype.dispose=function(){this.context.eventHandler.off(n.PlayerEvent.Seek,this.onSeek),this.context.eventHandler.off(n.PlayerEvent.Seeked,this.onSeeked)},e}();t.DiscontinuityMonitor=r},507:function(e,t,i){"use strict";function n(e){var t,i=o().initSegmentInfoSourceDetectors,n=o().initSegmentInfoProviders,r=a(e);return i.isInitializationStringNode(r)?t=n.provideSegmentInfoFromInitializationProperty(r,e):i.isInitializationNode(r)?t=n.provideSegmentInfoFromInitializationNodeProperty(r,e):i.isIndexRangeNode(r)&&(t=n.provideSegmentInfoFromIndexRangeProperty(r,e)),t}function r(){return s.ModuleManager.get(u.ModuleName.HLS)}function o(){return s.ModuleManager.get(u.ModuleName.DASH)}function a(e){var t,i,n;return(null===(t=e.SegmentTemplate)||void 0===t?void 0:t.length)&&e.SegmentTemplate[0]||(null===(i=e.SegmentList)||void 0===i?void 0:i.length)&&e.SegmentList[0]||(null===(n=e.SegmentBase)||void 0===n?void 0:n.length)&&e.SegmentBase[0]}Object.defineProperty(t,"__esModule",{value:!0});var s=i(2),u=i(0),d=function(){function e(e,t){this.manifestService=e,this.sourceStore=t}return e.prototype.dispose=function(){},e.prototype.getInitSegmentInfo=function(e,t){var i=this.manifestService.getRepresentationById(t);return this.manifestService.isHlsManifest()?r().provideSegmentInfoForHls(this.sourceStore.getState(),i,e):n(i)},e}();t.InitSegmentInfoService=d},508:function(e,t,i){"use strict";function n(e,t){var i=r(e,t),n=a(e,t),o=e.discontinuitySequenceNumber===t.discontinuitySequenceNumber;return i&&n&&o}function r(e,t){var i=o(e),n=o(t);return i.some(function(e){return n.includes(e)})}function o(e){return[e.uri||e.url,e.mediaURL].filter(Boolean)}function a(e,t){var i=s(e),n=s(t);return null==i?null==n:i.start===n.start&&i.end===n.end}function s(e){var t=e.byterange;return t?{start:t.offset,end:t.offset+t.length}:e.byteRange}Object.defineProperty(t,"__esModule",{value:!0}),t.isIdenticalSegmentEntry=n,t.matchesByteRange=a},509:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(10),r=function(){function e(e){this.triedRepsForCurrentSegment={},this.wasQualitySwitched=!1,this.context=e}return e.prototype.downloadSuccess=function(e){return this.wasQualitySwitched&&e?void(this.wasQualitySwitched=!1):void(this.triedRepsForCurrentSegment={})},e.prototype.getNextLowerNotTriedQuality=function(e,t){for(var i=[],n=0;n<e.length&&!e[n]._internalId.equals(t);n++)this.triedRepsForCurrentSegment[e[n]._id]||i.push(e[n]);return i.length>0?i[i.length-1]._internalId:null},e.prototype.getNextHigherNotTriedQuality=function(e,t){for(var i=!1,n=0;n<e.length;n++)if(e[n]._internalId.equals(t))i=!0;else if(i&&!this.triedRepsForCurrentSegment[e[n]._id])return e[n]._internalId;return null},e.prototype.switchQuality=function(e,t){this.triedRepsForCurrentSegment[t.representationId]=!0;var i=this.getNextLowerNotTriedQuality(e,t);return i||(i=this.getNextHigherNotTriedQuality(e,t)),i?(this.wasQualitySwitched=!0,i):(this.context.logger.log("no quality left, all tried"),null)},e.prototype.switchBaseURL=function(e){var t=e.availableBaseURLs,i=e.lastUsedBaseURLIndex+1;return i%=t.length,i===e.firstUsedBaseURLIndex?(this.context.logger.log("no base url left, all tried"),null):(e.lastUsedBaseURLIndex=i,e.baseURL=t[i],e.url=n.URLHelper.concatBaseUrlWithPartial(e.baseURL,e.mediaURL),e)},e.prototype.shouldTryAlternatives=function(e){return e>=400&&e<=599||0===e},e}();t.SegmentUnavailabilityHandler=r},510:function(e,t,i){"use strict";function n(e,t,i){for(var n=t,r=i;n>=0;)e[n]._playbackTime=r,r-=e[n]._duration,n--;for(n=t+1,r=i+e[t]._duration;n<e.length;)e[n]._playbackTime=r,r+=e[n]._duration,n++}function r(e){return e.metadata&&e.metadata.length>0&&e.metadata[0].type===c.MetadataType.CUSTOM}function o(e){var t=e.getSegmentInfo();return{uid:e.getUid(),url:e.getUrl(),mimeType:e.getMimeType(),playbackTime:e.getPlaybackTime(),presentationTimestamp:e.getBaseMediaDecodeTime()/e.getTimescale(),duration:e.getDuration(),mediaInfo:e.getMediaInfo(),wallClockTime:t.wallClockTime,discontinuitySequenceNumber:t.discontinuitySequenceNumber}}function a(e){var t=o(e),i=e.getSegmentInfo();return i.dateTime&&(t.dateTime=i.dateTime),i.representationId&&(t.representationId=i.representationId),t}var s=this&&this.__assign||function(){return s=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},s.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var u=i(3),d=i(15),c=i(1),l=i(187),h=i(116),p=i(21),f=i(22),g=i(16),m=i(5),S=i(44),y=i(506),v=function(){function e(e){var t,i=this;this.context=e,this.onGenericMetadataAvailable=function(e){
if(e.hasOwnProperty("metadata")){var t={metadataType:e.metadataType.toUpperCase(),metadata:e.metadata};(e.start||0===e.start)&&(t.start=e.start),e.end&&(t.end=e.end),i.context.eventHandler.dispatchEvent(c.PlayerEvent.Metadata,t)}},this.inbandMetadataCallback=function(e){e&&e.hasOwnProperty("metadataType")&&i.context.eventHandler.dispatchEvent(c.PlayerEvent.Metadata,{metadataType:e.metadataType,metadata:e.metadata})},this.onSegmentPlayback=function(e){var t=e.metadata.event;i.currentlyPlayedSegment[t.mimeType]=t,i.discontinuityMonitor.maybeFirePeriodSwitchEvents(t),i.previousRepresentationIds[t.mimeType]&&i.previousRepresentationIds[t.mimeType].id===t.representationId||i.handlePlaybackInfo(t),i.playbackRepresentationId[t.mimeType]=S.RepresentationId.from(e.metadata.representationId),i.context.eventHandler.dispatchEvent(c.PlayerEvent.SegmentPlayback,t)},this.previousRepresentationIds={},this.playbackRepresentationId={},this.currentlyPlayedSegment={},this.manifestService=this.context.serviceManager.get(u.ServiceName.ManifestService,e.sourceContext.sourceIdentifier);var n=(t={},t[h.TimedMetadataType.InBand]=this.inbandMetadataCallback,t[h.TimedMetadataType.SegmentPlayback]=this.onSegmentPlayback,t[h.TimedMetadataType.Manifest]=this.onGenericMetadataAvailable,t[h.TimedMetadataType.EventStream]=this.onGenericMetadataAvailable,t[h.TimedMetadataType.DateRange]=this.onGenericMetadataAvailable,t[h.TimedMetadataType.CustomTag]=this.onGenericMetadataAvailable,t);this.metadataService=new l.MetadataService(e,n),this.discontinuityMonitor=new y.DiscontinuityMonitor(e)}return e.prototype.onSegmentAvailable=function(e){var t,i=this,n=e.segment,s=e.extractedMetadata,u=e.isSegmentOfMainStream,d=e.presentationTimeOffset;if(u){t=a(n);var c=n.getSegmentInfo();c.metadata&&c.metadata.forEach(function(e){i.processSegmentInfoMetadata(e,t,n.getPeriodId())}),r(c)&&this.handleCustomMetadata(c),this.handleId3Metadata(s,d,n.getPeriodId())}else t=o(n);this.registerSegmentPlaybackEvent(n,t),n.getInbandEvents().forEach(function(e){i.processInbandEvent(e,n.getPeriodId())}),this.discontinuityMonitor.onSegmentAvailable(n)},e.prototype.registerSegmentPlaybackEvent=function(e,t){if(!e.isInit()){var i=e.getSegmentInfo(),n=e.getMimeType(),r={_periodId:i.internalRepresentationId.periodId,_adaptationSetId:i.internalRepresentationId.adaptationSetId,_representationId:i.internalRepresentationId.representationId},o={metadata:{event:t,representationId:r,mimeType:n}};this.metadataService.addToTimeline(h.TimedMetadataType.SegmentPlayback,t.playbackTime,o);var a=f.getMetricsState(this.context.store.getState());a[n]||this.context.store.dispatch(p.initializeMetricsForMimeType(n,this.context.settings)),this.context.store.dispatch(p.addMetricsValue(n,g.MetricType.SegmentInformation,{bitrate:8*e.getNetworkRequestSize()/e.getDuration(),duration:e.getDuration(),playbackTime:i.startTime||e.getPlaybackTime(),representationId:e.getRepresentationId()}))}},e.prototype.parseEventStream=function(){var e=this;this.manifestService.getAllPeriods().forEach(function(t){e.manifestService.getEventStreamEvents(t).forEach(function(i){e.processEventStreamEvent(i,t)})})},e.prototype.processEventStreamEvent=function(e,t){var i={metadataType:c.MetadataType.EVENT_STREAM,metadata:e.data,start:e.startTime,end:e.endTime},n=this.metadataService.addToMetadataParsedService(h.TimedMetadataType.EventStream,e.startTime,s(s({},i),{data:e.data}),t._id);n&&this.metadataService.addToTimeline(h.TimedMetadataType.EventStream,e.startTime,i)},e.prototype.getPlaybackRepresentation=function(e){var t=this.context.serviceManager.get(u.ServiceName.ManifestService,this.context.sourceContext.sourceIdentifier),i=s({},t.getRepresentationById(this.playbackRepresentationId[e]));return i&&this.currentlyPlayedSegment[e]&&(i.uid=this.currentlyPlayedSegment[e].uid),i},e.prototype.handlePlaybackInfo=function(e){var t,i;m.MimeTypeHelper.isAudio(e.mimeType)?(t=c.PlayerEvent.AudioPlaybackQualityChanged,i={id:e.representationId,bitrate:parseFloat(e.mediaInfo.bitrate)}):m.MimeTypeHelper.isVideo(e.mimeType)&&(t=c.PlayerEvent.VideoPlaybackQualityChanged,i={id:e.representationId,bitrate:parseFloat(e.mediaInfo.bitrate),width:parseFloat(e.mediaInfo.width),height:parseFloat(e.mediaInfo.height)}),t&&this.context.eventHandler.dispatchEvent(t,{targetQuality:i,sourceQuality:this.previousRepresentationIds[e.mimeType]||null}),this.previousRepresentationIds[e.mimeType]=i},e.prototype.processDateRangeEvent=function(e,t){var i={metadataType:c.MetadataType.DATERANGE,metadata:e.data,start:e.startTime,end:e.endTime},n=this.metadataService.addToMetadataParsedService(h.TimedMetadataType.DateRange,e.startTime,s(s({},i),{data:e.data}),t);n&&this.metadataService.addToTimeline(h.TimedMetadataType.DateRange,e.startTime,i)},e.prototype.addSegmentToMetadataParsedService=function(e,t){var i=this;e.forEach(function(e){if(e._metadata&&e._playbackTime){var n={metadataType:c.MetadataType.CUSTOM,metadata:e._metadata,data:e._metadata,start:e._playbackTime,end:e._playbackTime+e._duration};i.metadataService.addToMetadataParsedService(h.TimedMetadataType.CustomTag,e._playbackTime,n,t)}})},e.prototype.handleId3Metadata=function(e,t,i){var n=this;e&&Array.isArray(e.id3)&&e.id3.length>0&&e.id3.forEach(function(e){n.publishId3Metadata(e,t,i)})},e.prototype.publishId3Metadata=function(e,t,i){var n=e.presentationTime-t,r={metadataType:c.MetadataType.ID3,metadata:e.data,start:n},o=this.metadataService.addToMetadataParsedService(h.TimedMetadataType.InBand,n,s(s({},r),{data:e.data}),i);o&&this.metadataService.addToTimeline(h.TimedMetadataType.InBand,n,r)},e.prototype.handleCustomMetadata=function(e){var t=this,i=this.manifestService.getRepresentationById(e.internalRepresentationId);i.SegmentList[0].SegmentURL.forEach(function(r,o){r._media===e.url&&(r._playbackTime||n(i.SegmentList[0].SegmentURL,o,e.startTime),t.metadataService.addToTimeline(h.TimedMetadataType.CustomTag,e.startTime,{metadataType:c.MetadataType.CUSTOM,metadata:r._metadata,start:e.startTime,end:e.startTime+e.duration}))}),this.addSegmentToMetadataParsedService(i.SegmentList[0].SegmentURL,e.periodId)},e.prototype.processInbandEvent=function(e,t){var i=e.presentationTime,n={metadataType:c.MetadataType.EMSG,metadata:e,start:i},r=this.metadataService.addToMetadataParsedService(h.TimedMetadataType.InBand,i,s(s({},n),{data:e}),t);r&&this.metadataService.addToTimeline(h.TimedMetadataType.InBand,i,n)},e.prototype.processSegmentInfoMetadata=function(e,t,i){var n=e.type;if(n===c.MetadataType.CUSTOM)t.EXPERIMENTAL=t.EXPERIMENTAL||{},t.EXPERIMENTAL.hlsAttributes=t.EXPERIMENTAL.hlsAttributes||[],t.EXPERIMENTAL.hlsAttributes=t.EXPERIMENTAL.hlsAttributes.concat(e.attributes);else{var r=void 0;r=/^CUE-(IN|OUT(-CONT)?)$/.test(n)?c.MetadataType.CUETAG:c.MetadataType[e.type];var o={metadataType:r,metadata:e,start:t.playbackTime},a=this.metadataService.addToMetadataParsedService(h.TimedMetadataType.Manifest,t.playbackTime,s(s({},o),{data:e}),i);a&&this.metadataService.addToTimeline(h.TimedMetadataType.Manifest,t.playbackTime,o)}},e.prototype.dispose=function(){this.metadataService=d.dispose(this.metadataService),this.manifestService=null,this.discontinuityMonitor=d.dispose(this.discontinuityMonitor),this.context=null},e}();t.TimedMetadataService=v},511:function(e,t,i){"use strict";var n,r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},r.apply(this,arguments)},o=this&&this.__rest||function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var r=0,n=Object.getOwnPropertySymbols(e);r<n.length;r++)t.indexOf(n[r])<0&&Object.prototype.propertyIsEnumerable.call(e,n[r])&&(i[n[r]]=e[n[r]]);return i};Object.defineProperty(t,"__esModule",{value:!0});var a=i(25),s=i(213),u={},d=function(e,t){return r(r({},e),t)},c=function(e,t){var i=t.adaptationSetId.adaptationSetId,n=(e[i],o(e,["symbol"==typeof i?i:i+""]));return r({},n)};t.ActiveTracksReducer=a["default"]({},(n={},n[s.ActiveTracksActionType.SetSelectedRepresentationId]=function(e,t){var i=t.payload;return d(e,i)},n[s.ActiveTracksActionType.RemoveActiveTrack]=function(e,t){var i=t.payload;return c(e,i)},n[s.ActiveTracksActionType.ClearActiveTracks]=function(){return u},n))},512:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(511),r=i(156),o=i(514),a=i(58),s=i(515);t.engineBitmovinSourceReducers={manifest:o.ManifestReducer,activeTracks:n.ActiveTracksReducer,playingTracks:a.PlayingTracksReducer,containerFormat:r.ContainerFormatReducer,buffer:s.BufferReducer}},513:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(24),r=i(214);t.setPlayingPeriodId=function(e){return n.createAction(r.PlayingTracksActionKey.SetPlayingPeriodId,e)}},514:function(e,t,i){"use strict";function n(e,t){return t.payload.manifest||e}function r(e,t){return y(y({},e),{isInitialized:t.payload.isInitialized})}function o(e,t){return 0===t.payload.representationIds.length?e:I.removeRepresentations(e,t.payload.representationIds)}function a(e,t){return t.payload.offset?y(y({},e),{Period:e.Period.map(function(e){return y(y({},e),{start:e.start+t.payload.offset})})}):e}function s(e,t){if(!e.Period)return e;var i=t.periodId,n=t.timing,r=e.Period.findIndex(function(e){return e._id===i});if(r<0)return e;var o=v(e.Period);return o[r]=y(y({},o[r]),n),y(y({},e),{Period:o})}function u(e,t){return y(y({},e),t)}function d(e,t){var i,n,r,o=t,a=o._internalId;if(!e.Period)return e;var s=e.Period.findIndex(function(e){return e._id===a.periodId}),u=null===(i=e.Period[s])||void 0===i?void 0:i.AdaptationSet.findIndex(function(e){return e._internalId.equals(a)}),d=null===(r=null===(n=e.Period[s])||void 0===n?void 0:n.AdaptationSet[u])||void 0===r?void 0:r.Representation.findIndex(function(e){return e._internalId.equals(a)}),c=y({},e);c.Period=v(c.Period),c.Period[s]=y({},c.Period[s]);var l=c.Period[s];l.AdaptationSet=v(l.AdaptationSet),l.AdaptationSet[u]=y({},l.AdaptationSet[u]);var h=l.AdaptationSet[u];return h.Representation=v(h.Representation),h.Representation[d]=o,c}function c(e,t){var i,n=t.payload,r=n.representationId,o=n.associatedKid,a=function(e){return e._internalId.equals(r)&&!e.associatedKid?o:e.associatedKid};return y(y({},e),{Period:null===(i=e.Period)||void 0===i?void 0:i.map(function(e){var t;return y(y({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return y(y({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(e){return y(y({},e),{associatedKid:a(e)})})})})})})})}function l(e,t){var i,n=t.payload,r=n.adaptationSetId,o=n.segment,a=function(e,t){var i=e._media;return M.URLHelper.isUrlAbsolute(i)||(i=M.URLHelper.concatUrlParts(t.BaseURL[0],i)),i===o.getUrl()};return y(y({},e),{Period:null===(i=e.Period)||void 0===i?void 0:i.map(function(e){var t;return y(y({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return e._internalId.equals(r)?y(y({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(e){var t;return y(y({},e),{SegmentList:null===(t=e.SegmentList)||void 0===t?void 0:t.map(function(t){var i;return y(y({},t),{SegmentURL:null===(i=t.SegmentURL)||void 0===i?void 0:i.map(function(t){return y(y({},t),{downloaded:a(t,e)})})})})})})}):y({},e)})})})})}function h(e,t){var i,n=t.payload.representationId,r=function(e){return!!e._internalId.equals(n)||e.hasFailedToLoad};return y(y({},e),{Period:null===(i=e.Period)||void 0===i?void 0:i.map(function(e){var t;return y(y({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return y(y({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(e){return y(y({},e),{hasFailedToLoad:r(e)})})})})})})})}function p(e,t){var i,n=t.payload,r=n.representationId,o=n.isLoading,a=function(e){return e._internalId.equals(r)?o:e.isLoading};return y(y({},e),{Period:null===(i=e.Period)||void 0===i?void 0:i.map(function(e){var t;return y(y({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return y(y({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(e){return y(y({},e),{isLoading:a(e)})})})})})})})}function f(e,t){var i,n=t.payload,r=n.representationId,o=n.segmentIndex,a=function(e){return e._internalId.equals(r)?o:e.segmentIndex};return y(y({},e),{Period:null===(i=e.Period)||void 0===i?void 0:i.map(function(e){var t;return y(y({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return y(y({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(e){return y(y({},e),{segmentIndex:a(e)})})})})})})})}function g(e,t){var i,n=t.payload,r=n.representationId,o=n.segmentIndexParsingError,a=function(e){return e._internalId.equals(r)?o:e.segmentIndexParsingError};return y(y({},e),{Period:null===(i=e.Period)||void 0===i?void 0:i.map(function(e){var t;return y(y({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return y(y({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(e){return y(y({},e),{segmentIndexParsingError:a(e)})})})})})})})}function m(e,t){var i,n=t.payload,r=n.representationId,o=n.anchorPoint,a=function(e){return e._internalId.equals(r)?o:e.anchorPoint};return y(y({},e),{Period:null===(i=e.Period)||void 0===i?void 0:i.map(function(e){var t;return y(y({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(e){var t;return y(y({},e),{Representation:null===(t=e.Representation)||void 0===t?void 0:t.map(function(e){return y(y({},e),{anchorPoint:a(e)})})})})})})})}var S,y=this&&this.__assign||function(){return y=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},y.apply(this,arguments)},v=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var n=Array(e),r=0,t=0;t<i;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)n[r]=o[a];return n};Object.defineProperty(t,"__esModule",{value:!0});var T=i(25),M=i(10),I=i(34),P=i(215);t.ManifestReducer=T["default"]({},(S={},S[P.ManifestActionType.SetManifest]=n,S[P.ManifestActionType.SetManifestInitialized]=r,S[P.ManifestActionType.RemoveRepresentations]=o,S[P.ManifestActionType.UpdateManifest]=function(e,t){var i=t.payload;return u(e,i)},S[P.ManifestActionType.UpdateRepresentation]=function(e,t){var i=t.payload;return d(e,i)},S[P.ManifestActionType.AdjustPeriodStartTimes]=a,S[P.ManifestActionType.UpdatePeriodTiming]=function(e,t){var i=t.payload;return s(e,i)},S[P.ManifestActionType.SetRepresentationDrmKid]=c,S[P.ManifestActionType.MarkSegmentAsDownloaded]=l,S[P.ManifestActionType.SetRepresentationFailedDownload]=h,S[P.ManifestActionType.SetRepresentationIsLoading]=p,S[P.ManifestActionType.SetRepresentationSegmentIndex]=f,S[P.ManifestActionType.SetRepresentationSegmentIndexParsingError]=g,S[P.ManifestActionType.SetRepresentationAnchorPoint]=m,S))},515:function(e,t,i){"use strict";function n(e,t){var i,n=t.payload;return a(a({},e),(i={},i[n.mimeType]=a(a({},e[n.mimeType]),{rendererRanges:n.ranges}),i))}function r(e,t){var i,n=t.payload;return a(a({},e),(i={},i[n.mimeType]=a(a({},e[n.mimeType]),{maxBufferSize:n.maxBufferSize}),i))}var o,a=this&&this.__assign||function(){return a=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},a.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=i(25),u=i(195),d={};t.BufferReducer=s["default"](d,(o={},o[u.BufferActionType.SetBufferMaxSize]=r,o[u.BufferActionType.SetRendererRanges]=n,o))},516:function(e,t,i){"use strict";function n(e,t){return e.mimeType===t.mimeType&&r.CodecStringHelper.canSwitchBetweenAudioCodecs(e.codec,t.codec)}Object.defineProperty(t,"__esModule",{value:!0});var r=i(26);t.areAudioMimeCodecsCompatible=n},517:function(e,t,i){"use strict";function n(e){var t=[];return e.forEach(function(e){t.push(e)}),t}function r(e){var t=[];return e.forEach(function(e,i){t.push(i)}),t}Object.defineProperty(t,"__esModule",{value:!0}),t.getValues=n,t.getKeys=r},53:function(e,t,i){"use strict";function n(e){return null==e.Period?[]:e.Period.filter(function(e){return e.AdaptationSet&&e.AdaptationSet.length>0}).reduce(function(e,t){return e.concat(t.AdaptationSet)},[]).filter(function(e){return e.ContentProtection&&e.ContentProtection.length>0}).flatMap(function(e){return e.ContentProtection}).filter(function(e){return null!=e.laurl&&e.laurl.length>0}).flatMap(function(e){return e.laurl.map(function(t){return E(E({},t),{drmType:N.DRMSchemeIDURIs[e._schemeIdUri]})})}).filter(function(e){return null!=e.drmType}).map(function(e){var t;return t={},t[e.drmType]={LA_URL:e._licenseUrl},t})}function r(e,t,i){var n=e.find(function(e){return e._lang&&t.lang&&e._lang===t.lang}),r=e.find(function(e){return t.adaptationSetId&&e._internalId.equals(t.adaptationSetId)});return r=r||e.find(function(e){return t.id===e._internalId.adaptationSetId}),i?n||r:r||n}function o(e){var t;return e=E({},e),e.Period=null===(t=e.Period)||void 0===t?void 0:t.map(function(e){var t;return E(E({},e),{AdaptationSet:null===(t=e.AdaptationSet)||void 0===t?void 0:t.map(function(t,i){var n,r=J.createAdaptationSetIdFromMimeTypeAndIndex(e._id,t._mimeType,i);return E(E({},t),{_internalId:r,_periodId:e._id,Representation:null===(n=t.Representation)||void 0===n?void 0:n.map(function(e){return E(E({},e),{_internalId:new ee.RepresentationId(r,e._id)})})})})})}),e}function a(e){if(Q.ModuleManager.has(W.ModuleName.DRM)){var t=Q.ModuleManager.get(W.ModuleName.DRM).ContentProtectionHelper.getFirstKeyId;u(e,function(e){for(var i=t(e.ContentProtection),n=0;e.Representation&&n<e.Representation.length;n++){var r=e.Representation[n];(i||r.ContentProtection)&&(r.associatedKid=r.ContentProtection&&t(r.ContentProtection)||i)}})}}function s(e,t){e.Period.flatMap(function(e){var t,i;return i=null===(t=e)||void 0===t?void 0:t.AdaptationSet,null!==i&&void 0!==i?i:[]}).flatMap(function(e){var t,i;return i=null===(t=e)||void 0===t?void 0:t.Representation,null!==i&&void 0!==i?i:[]}).forEach(function(e){t.has(e._internalId.key())&&(e.associatedKid=t.get(e._internalId.key()))})}function u(e,t){for(var i=0;e.Period&&i<e.Period.length;i++)for(var n=e.Period[i],r=0;n.AdaptationSet&&r<n.AdaptationSet.length;r++)t(n.AdaptationSet[r])}function d(e,t){if(!e||!e.length)return null;if(t<e[0].start)return e[0];var i=e[e.length-1];return t>=i.start?i:c(e,t)||i}function c(e,t){for(var i=0;i<e.length-1;i++){var n=e[i].start+e[i].duration;if(t>=e[i].start&&t<n)return e[i];if(t>=n&&t<e[i+1].start)return e[i+1]}}function l(e,t){return void 0===t&&(t=-(1/0)),e.reduce(function(e,i){return i._bandwidth>=t?Math.min(e,i._bandwidth):e},1/0)}function h(e,t,i){void 0===e&&(e=[]),void 0===i&&(i=function(){return!0});var n=e.filter(i),r=null,o=-(1/0);return n.forEach(function(e){e._bandwidth>o&&e._bandwidth<=t&&(o=e._bandwidth,r=e)}),r||n[0]}function p(e,t){return void 0===e&&(e=[]),e.find(function(e){return e._internalId.equals(t)})}function f(e,t,i){var n,r=i?"videoCodecPriority":"audioCodecPriority";return(null===(n=t)||void 0===n?void 0:n.options)&&t.options[r]?t.options[r]:e.playback&&e.playback[r]?e.playback&&e.playback[r]:[]}function g(e,t){return{video:f(e,t,!0),audio:f(e,t,!1)}}function m(e,t){return e&&t?e.Period.find(function(e){return e._id===t}):null}function S(e){var t;return(null===(t=e)||void 0===t?void 0:t.Period[0])||null}function y(e,t,i,n){if(void 0===n&&(n=!1),0===e.length)return null;var o;return i&&(o=r(e,i,n)),o?o:(t&&(o=e.find(function(e){var i=Boolean(e._lang);return!!i&&(e._lang.includes(t)||t.includes(e._lang))})),o||e[0])}function v(e,t){return e.AdaptationSet.filter(function(e){return e._mimeType===t||e.Representation.find(function(e){return e._mimeType===t})})}function T(e,t){var i;if(!Q.ModuleManager.has(W.ModuleName.HLS))return null;var n=Q.ModuleManager.get(W.ModuleName.HLS).selectors,r=n.getHlsState,o=n.getDefaultLanguages,a=r(t),s=a?o(a):null;if(!s)return null;var u=null===(i=z.MimeTypeHelper.getMediaType(e))||void 0===i?void 0:i.toUpperCase();return u?s[u]:null}function M(e,t){return T(e,t)||navigator.language||navigator.userLanguage}function I(e){var t=X.getCodecsFromAdaptationSet(e);if(!t||0===t.length)return null;var i=q.CodecStringHelper.extractCodecStrings(t),n=e._mimeType.split("/")[0];return i[n]?q.CodecStringHelper.extractCodec(i[n]):null}function P(e,t){var i=[],n=[];return e.Period.forEach(function(e){var r=t.getDRMCapabilitiesFromPeriod(e);i=i.concat(r[0]),n=n.concat(r[1])}),{audioCapabilities:i,videoCapabilities:n}}function b(e,t,i){var n=function(e){return e.contentType},r=t.audioCapabilities.map(n),o=t.videoCapabilities.map(n);e.Period.forEach(function(e){e.AdaptationSet=e.AdaptationSet.filter(function(t){return t.Representation=t.Representation.filter(function(n){var a,s=e.ContentProtection||t.ContentProtection,u=(null===(a=s)||void 0===a?void 0:a.length)>0,d=C(n,r,o);if(u&&!d){var c=Z.getContentTypeFromMimeTypeAndCodecs(n._mimeType,n._codecs);i.debug("Representation not supported by MediaKeySystem ("+c)}return!u||d}),!z.MimeTypeHelper.isAV(t._mimeType)||t.Representation.length>0})})}function C(e,t,i){var n=e._mimeType,r=e._codecs,o=Z.getContentTypeFromMimeTypeAndCodecs(n,r);return z.MimeTypeHelper.isAudio(n)?t.includes(o):!z.MimeTypeHelper.isVideo(n)||i.includes(o)}var R=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function n(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(n.prototype=i.prototype,new n)}}(),E=this&&this.__assign||function(){return E=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},E.apply(this,arguments)},A=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var n=Array(e),r=0,t=0;t<i;t++)for(var o=arguments[t],a=0,s=o.length;a<s;a++,r++)n[r]=o[a];return n};Object.defineProperty(t,"__esModule",{value:!0});var x=i(6),_=i(7),L=i(3),B=i(15),k=i(1),D=i(115),w=i(23),O=i(82),N=i(85),H=i(66),F=i(121),U=i(183),j=i(8),q=i(26),V=i(67),z=i(5),K=i(4),Q=i(2),W=i(0),G=i(49),Y=i(54),J=i(43),X=i(34),Z=i(90),$=i(68),ee=i(44),te="Outdated",ie=function(e){function t(t,i){var n=e.call(this,{onRestore:function(){return n.onRestore()}})||this;n.lastManifestUpdateId=0,n.dispatchQualityRemovedEvent=function(e){var t=n.getAdaptationSet(e._internalId);if(t){var i=function(t){n.context.eventHandler.dispatchEvent(t,{quality:{id:e._id,bitrate:e._bandwidth}})};z.MimeTypeHelper.isAudio(t._mimeType)?i(k.PlayerEvent.AudioQualityRemoved):z.MimeTypeHelper.isVideo(t._mimeType)&&i(k.PlayerEvent.VideoQualityRemoved)}},n.copyRequiredPropertiesToRepresentations=function(e){(e.Representation||[]).forEach(function(t){e._codecs&&!t._codecs&&(t._codecs=e._codecs),e._width&&!t._width&&(t._width=e._width),e._height&&!t._height&&(t._height=e._height)}),delete e.SegmentTemplate},n.context=t,n.sourceContext=i,n.settings=t.settings,n.excludedRepresentations=[];var r=n.sourceContext.sourceIdentifier;return n.synchronizedTimeService=t.serviceManager.get(L.ServiceName.SynchronizedTimeService,r),n.sourceStore=t.serviceManager.get(L.ServiceName.SourceStoreService,r),n}return R(t,e),Object.defineProperty(t.prototype,"mpdExtractor",{get:function(){return this._mpdExtractor||(this._mpdExtractor=new Z.MPDExtractor(this.context,this.sourceContext)),this._mpdExtractor},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"manifest",{get:function(){var e;return Y.getManifest(null===(e=this.sourceStore)||void 0===e?void 0:e.getState())},enumerable:!0,configurable:!0}),t.prototype.setManifest=function(e){this.sourceStore.dispatch(G.setManifestAction(this.preProcessManifest(e)))},t.prototype.updateManifest=function(e){var t=this;this.lastManifestUpdateId++;var i=this.lastManifestUpdateId;return this.synchronizeWithTimeserver(e).then(function(){return t.ensureStillSameOperation(i),t.adjustManifestToKeySystemSupport(e)}).then(function(){t.ensureStillSameOperation(i),t.reinitializeAndUpdateManifest(e),t.context&&t.context.eventHandler&&t.context.eventHandler.dispatchEvent(w.InternalEvent.MPDUpdated,{manifest:e},!0)})["catch"](function(e){if(e!==te)throw e;t.context.logger.debug("Skipping manifest update, since a newer manifest is available")})},t.prototype.ensureStillSameOperation=function(e){if(e!==this.lastManifestUpdateId)throw te},t.prototype.adjustManifestToKeySystemSupport=function(e){var t,i,n=this,r=(i=null===(t=this.context.serviceManager.get(L.ServiceName.DrmService))||void 0===t?void 0:t.getUsedOrEarlyResolvedKeySystemUid(),null!==i&&void 0!==i?i:null);if(!r||!e.Period||!this.context.serviceManager.has(L.ServiceName.DrmDetectorService))return Promise.resolve();var o=this.context.serviceManager.get(L.ServiceName.DrmDetectorService),a=P(e,this.mpdExtractor),s=a.audioCapabilities,u=a.videoCapabilities;return o.getSupportedCapabilities(r,s,u).then(function(t){return b(e,t,n.context.logger)})},t.prototype.reinitializeAndUpdateManifest=function(e){if(this.disposeMpdExtractor(),e.isInitialized=!1,this.setManifest(e),this.isLive()&&this.context){var t=this.isHlsManifest()?this.getFirstPeriod().start:K.toSeconds(this.getAvailabilityStartTime());this.sourceStore.dispatch(F.setStartTimeOffset(t))}this.mpdExtractor.adjustPeriodStartTimes();var i=this.parseStreamDuration();D.maybeFireDurationChangedEvent(this.parsedDuration,i,this.context.eventHandler),this.parsedDuration=i,this.setManifestInitialized(!0)},t.prototype.excludeRepresentations=function(e){var t=this,i=e.map(function(e){return t.getRepresentationById(e)}).filter(function(e){return Boolean(e)});return this.setManifestInitialized(!1),this.excludedRepresentations=j.ArrayHelper.union(this.excludedRepresentations,e),this.sourceStore.dispatch(G.removeRepresentationsAction(this.excludedRepresentations)),this.manifest.Period.length?(this.disposeMpdExtractor(),i.forEach(this.dispatchQualityRemovedEvent),void this.setManifestInitialized(!0)):void this.context.eventHandler.dispatchEvent(k.PlayerEvent.Error,new _.PlayerError(x.ErrorCode.SOURCE_ERROR,null,"No playable track left"))},t.prototype.isRepresentationExcluded=function(e){return this.excludedRepresentations.some(function(t){return t.equals(e)})},t.prototype.resetExcludedRepresentations=function(){this.excludedRepresentations=[]},t.prototype.onRestore=function(){this.setPlayerDRM(this.getManifest()),this.sourceStore.dispatch(G.setManifestAction(o(this.getManifest())))},t.getSupplementalProperties=function(e,t){return!e.SupplementalProperty||e.SupplementalProperty.length<=0?null:e.SupplementalProperty.filter(function(e){return e._schemeIdUri===t})},t.prototype.findMatchingSwitchableAdaptationSets=function(e,t,i){var n=i&&i.length>0;if(!n&&!this.settings.ADAPTATION_SET_SWITCHING_WITHOUT_SUPPLEMENTAL_PROPERTY)return null;var r=[],o=e._group,a=I(e);return n&&i.forEach(function(e){return r.push(e._value)}),this.settings.ADAPTATION_SET_SWITCHING_WITHOUT_SUPPLEMENTAL_PROPERTY&&t.forEach(function(e){r.includes(e._id)||r.push(e._id)}),t.filter(function(t){if(!r.includes(t._id)||t._id===e._id)return!1;var i=t._group===o,n=t._mimeType===e._mimeType,s=I(t)===a,u=t._lang===e._lang;return n&&s&&i&&u})},t.prototype.getSwitchableAdaptationSets=function(e){var i=this;return e.AdaptationSet?e.AdaptationSet.reduce(function(n,r){var o=t.getSupplementalProperties(r,"urn:mpeg:dash:adaptation-set-switching:2016"),a=i.findMatchingSwitchableAdaptationSets(r,e.AdaptationSet,o);return a&&0!==a.length?j.ArrayHelper.addAndMergeIntersects(n,A([r],a)):n},[]):[]},t.mergeAdaptationSetProperties=function(e,t,i){var n=e.hasOwnProperty(i),r=t.hasOwnProperty(i);(n||r)&&(n?r||(t[i]=[]):e[i]=[],e[i]=e[i].concat(t[i]))},t.prototype.getAdaptationSetPropertyValues=function(e,t){return e.filter(function(e){return e.hasOwnProperty(t)}).map(function(e){return e[t]})},t.prototype.updateAdaptationSetMinMaxValues=function(e,t){var i=[e].concat(t),n=this.getAdaptationSetPropertyValues(i,"_minWidth"),r=this.getAdaptationSetPropertyValues(i,"_maxWidth"),o=this.getAdaptationSetPropertyValues(i,"_minHeight"),a=this.getAdaptationSetPropertyValues(i,"_maxHeight"),s=this.getAdaptationSetPropertyValues(i,"_minBandwidth"),u=this.getAdaptationSetPropertyValues(i,"_maxBandwidth");n.length>0&&(e._minWidth=Math.min.apply(null,n)),r.length>0&&(e._maxWidth=Math.max.apply(null,r)),o.length>0&&(e._minHeight=Math.min.apply(null,o)),a.length>0&&(e._maxHeight=Math.max.apply(null,a)),s.length>0&&(e._minBandwidth=Math.min.apply(null,s)),u.length>0&&(e._maxBandwidth=Math.max.apply(null,u))},t.prototype.mergeAdaptationSets=function(e,i){i.forEach(this.copyRequiredPropertiesToRepresentations);var n=i.shift();i.forEach(function(e){["Representation","ContentComponent","ContentProtection","SupplementalProperty"].forEach(function(i){return t.mergeAdaptationSetProperties(n,e,i)})}),this.updateAdaptationSetMinMaxValues(n,i),e.AdaptationSet=e.AdaptationSet.filter(function(e){return!i.includes(e)})},t.prototype.mergeSwitchableAdaptationSets=function(e){var t=this;return e.Period.forEach(function(e){t.getSwitchableAdaptationSets(e).forEach(function(i){t.mergeAdaptationSets(e,i)})}),e},t.getFirstKeyId=function(e){if(!e||0===e.length)return null;var t=e.find(function(e){return"cenc"===e.name});if(t&&t.defaultKid)return t.defaultKid;var i=e.find(function(e){return e.kids&&e.kids.length>0});return i?i.kids[0]:null},t.prototype.setRepresentationDrmKid=function(e,t){this.sourceStore.dispatch(G.setRepresentationDrmKidAction(e,t))},t.prototype.getRepresentationDrmKid=function(e){var t;return null===(t=this.getRepresentationById(e))||void 0===t?void 0:t.associatedKid},t.prototype.setManifestInitialized=function(e){this.sourceStore.dispatch(G.setManifestInitializedAction(e))},t.prototype.setPlayerDRM=function(e){var t=this.sourceContext.source.drm,i=n(e),r={};i.length>0&&(r=E({},i[0])),null!=t&&Object.keys(t).length>0&&Object.keys(t).forEach(function(e){r[e]=null!=r[e]?E(E({},r[e]),t[e]):t[e]}),this.addDrmServiceAndSetDrmConfig(r);var o=Object.keys(r).length>0?H.setManifestDrm(r):H.resetManifestDrm();this.sourceStore.dispatch(o)},t.prototype.addDrmServiceAndSetDrmConfig=function(e){var t=Q.ModuleManager.has(W.ModuleName.DRM)&&Object.keys(e).length>0&&!this.context.serviceManager.has(L.ServiceName.DrmService);if(t){var i=Q.ModuleManager.get(W.ModuleName.DRM).DrmService;this.context.serviceManager.set(L.ServiceName.DrmService,new i(this.context))}this.context.serviceManager.maybeCall(L.ServiceName.DrmService,function(t){t.isDrmConfigSet()||t.setDrmConfig(e)})},t.prototype.getPreviousRepDrmKidAssociation=function(){var e=new Map;return this.getAllRepresentations().filter(function(e){return e._internalId&&e.associatedKid}).forEach(function(t){return e.set(t._internalId.key(),t.associatedKid)}),e},t.prototype.preProcessManifest=function(e){var t=this.getPreviousRepDrmKidAssociation();return e=X.removeRepresentations(e,this.excludedRepresentations),e.Period.length?(e=X.orderAdaptationSetsByCodec(e,g(this.context.config,this.sourceContext.source)),a(e),e=this.mergeSwitchableAdaptationSets(e),Q.ModuleManager.has(W.ModuleName.Envivio)&&(e=Q.ModuleManager.get(W.ModuleName.Envivio).fixSegmentTimelineLiveStream(e)),this.isSuspended()||this.setPlayerDRM(e),e=o(e),s(e,t),e):(this.context.eventHandler.dispatchEvent(k.PlayerEvent.Error,new _.PlayerError(x.ErrorCode.SOURCE_ERROR,null,"No playable track left")),
null)},t.prototype.parseStreamDuration=function(){if(this.mpdExtractor){var e=NaN,t=this.mpdExtractor.getDuration();return t&&(this.cachedDurationString&&this.cachedDurationString===t?e=this.cachedDuration:(e=V.DurationConverter.getDurationInSec(t),this.cachedDurationString=t,this.cachedDuration=e)),isNaN(e)&&this.isLive()?1/0:e}return 0},t.prototype.getDuration=function(){return this.parsedDuration},t.prototype.isLive=function(){return!!this.manifest&&this.mpdExtractor.isLive()},t.prototype.getAvailabilityStartTime=function(){return this.mpdExtractor.getAvailabilityStartTime()},t.prototype.getAvailabilityEndTime=function(){return this.mpdExtractor.getAvailabilityEndTime()},t.prototype.isAvailabilityEndTimeExceeded=function(){var e=this.getAvailabilityEndTime();return e&&Date.now()>e.getTime()},t.prototype.findPeriod=function(e){return m(this.manifest,e)},t.prototype.getAllPeriods=function(){return this.manifest&&this.manifest.Period?this.manifest.Period:[]},t.prototype.getPeriod=function(e){return e?this.findPeriod(e.periodId):null},t.prototype.isSmoothManifest=function(){return this.manifest.originalFormat&&"smooth"===this.manifest.originalFormat.format},t.prototype.isLanguageAvailable=function(e,t,i){var n=m(this.manifest,e)||S(this.manifest);return v(n,t).some(function(e){var t=e._lang&&i.lang&&e._lang===i.lang,n=i.adaptationSetId&&e._internalId.equals(i.adaptationSetId);return t||n})},t.prototype.findAdaptationSet=function(e,t,i,n){void 0===n&&(n=!1);var r=m(this.manifest,e)||S(this.manifest),o=v(r,t),a=M(t,this.sourceStore.getState()),s=y(o,a,i,n);return s||this.context.logger.debug("No AdaptationSet found to match mime type "+t),s},t.prototype.getManifest=function(){return this.manifest},t.prototype.getAvailableAudio=function(e,t){return this.mpdExtractor.getAvailableAudio(e,t)},t.prototype.getAvailableVideo=function(e){return this.mpdExtractor.getAvailableVideo(e)},t.prototype.getAvailableSubtitles=function(e){return this.mpdExtractor.getAvailableSubtitles(e)},t.prototype.getClosedCaptionLabels=function(e){return this.mpdExtractor.getClosedCaptionLabels(e)},t.prototype.getVideoRepresentations=function(e){return this.mpdExtractor.getVideoQualities(e)},t.prototype.getAudioRepresentations=function(e){return this.mpdExtractor.getAudioQualities(e)},t.prototype.getPeriodDuration=function(e,t){return this.mpdExtractor.getPeriodDuration(e,t||this.getManifest().Period)},t.prototype.hasMultiplePeriods=function(){return this.manifest&&this.manifest.Period&&this.manifest.Period.length>1},t.prototype.hasSinglePeriod=function(){return this.manifest&&this.manifest.Period&&1===this.manifest.Period.length},t.prototype.getTimeShiftBufferDepthSeconds=function(){return this.mpdExtractor.getTimeShiftBufferDepthSeconds()},t.prototype.getRequestTimestamp=function(){return this.mpdExtractor.getRequestTimestamp()},t.prototype.getMediaPresentationDuration=function(){var e=V.DurationConverter.getDurationInSec(this.manifest._mediaPresentationDuration);return isNaN(e)?0:e},t.prototype.calculateCumulativePeriodDuration=function(e){for(var t=0,i=0,n=this.manifest.Period;i<n.length;i++){var r=n[i];if(r._id===e)break;t+=this.getPeriodDuration(r._id)}return this.isLive()?K.toSeconds(Date.now()-this.getAvailabilityStartTime())-t:t},t.prototype.getMinimumUpdatePeriod=function(){return Z.getMinimumUpdatePeriodInSeconds(this.manifest)},t.prototype.getContentProtectionForAdaptationSet=function(e){return Z.MPDExtractor.getContentProtectionForAdaptationSet(e)},t.prototype.getLangObjectFromAdaptationSet=function(e,t){return this.mpdExtractor.getLangObjectFromAdaptationSet(e,t)},t.prototype.toSubtitleTrack=function(e,t){return this.mpdExtractor.toSubtitleTrack(e,t)},t.prototype.getDRMCapabilitiesForPeriod=function(e){return this.mpdExtractor.getDRMCapabilitiesForPeriod(e)},t.prototype.hasManifestTypeChanged=function(e){return!(!this.manifest||this.manifest._type===e)&&(this.context.logger.log("Manifest has just changed from "+this.manifest._type+" to "+e),!0)},t.prototype.getPeriodIdForTime=function(e){var t=this.manifest.Period;return 1===t.length?t[0]._id:d(t,e)._id},t.prototype.dispose=function(){this.disposeMpdExtractor(),e.prototype.dispose.call(this)},t.prototype.disposeMpdExtractor=function(){this._mpdExtractor=B.dispose(this.mpdExtractor)},t.prototype.getTotalDuration=function(){var e=0;if(this.settings.ENABLE_SEEK_FOR_LIVE&&this.isLive())e=this.manifest.Period.reduce(function(e,t){return e+t.duration},0);else{var t=this.getLastPeriod(),i=t.start||V.DurationConverter.getDurationInSec(t._start)||0,n=this.mpdExtractor.getPeriodDuration(t._id);e=i+n}return 0===e&&this.isLive()&&(e=1/0),e},t.prototype.getFirstPeriod=function(){return S(this.manifest)},t.prototype.getLastPeriod=function(){return this.manifest.Period&&this.manifest.Period.length>0?this.manifest.Period[this.manifest.Period.length-1]:null},t.prototype.isLastPeriod=function(e){return e===this.getLastPeriod()._id},t.prototype.isManifestFinalized=function(){return!this.isLive()},t.prototype.isFirstPeriod=function(e){return this.getFirstPeriod()._id===e},t.prototype.isHlsManifest=function(){return this.getManifest()._isHls},t.prototype.getHlsTags=function(){if(!this.isHlsManifest())return null;var e=Q.ModuleManager.get(W.ModuleName.HLS).selectors,t=e.getHlsState,i=e.getCustomTags,n=t(this.sourceStore.getState());return i(n)},t.prototype.isMimeTypePartOfPeriod=function(e,t){var i=this.getPeriod(new $.PeriodId(t)),n=i?i.AdaptationSet:[];return n.some(function(t){return t._mimeType===e})},t.prototype.getNextPeriod=function(e){if(this.manifest)for(var t=this.findPeriod(e),i=this.manifest.Period.indexOf(t),n=i+1;n<this.manifest.Period.length;n++){var r=this.manifest.Period[n];if(r&&!r.droppedOut)return r}return null},t.prototype.getEventStreamEvents=function(e){return this.mpdExtractor.getEventStreamEvents(e)},t.prototype.hasAdaptationSets=function(e){var t=this.manifest;if(t&&t.Period){var i=t.Period.find(function(t){return t._id===e});return Boolean(i&&i.AdaptationSet)}return!1},t.prototype.synchronizeWithTimeserver=function(e){var t=this,i=[],n=0;if(this.synchronizedTimeService){var r=this.context.config&&this.context.config.live;return r&&r.synchronization&&r.synchronization.length>0?i=r.synchronization.map(function(e){switch(e.method){case O.LiveSynchronizationMethod.HttpHead:return{schemeIdUri:"urn:mpeg:dash:utc:http-head:2014",value:e.serverUrl};case O.LiveSynchronizationMethod.HttpXsDate:return{schemeIdUri:"urn:mpeg:dash:utc:http-xsdate:2014",value:e.serverUrl};case O.LiveSynchronizationMethod.HttpIso:return{schemeIdUri:"urn:mpeg:dash:utc:http-iso:2014",value:e.serverUrl};default:return t.context.logger.debug("No valid time synchronization configuration entry provided"),null}}).filter(function(e){return null!==e}):e&&e.UTCTiming&&e.UTCTiming.length>0&&(i=i.concat(e.UTCTiming),n=e._downloadTime),this.synchronizedTimeService.synchronizeWithServer(i,n).then(function(e){t.context.logger.debug("successfully synchronized to server time - drift: "+K.toSeconds(e)+"s")})["catch"](function(){t.context.logger.debug("Player clock synchronization failed")})}return Promise.resolve()},t.prototype.getAdaptationSet=function(e){if(!e)return null;var t=this.getPeriod(e);return t&&t.AdaptationSet?t.AdaptationSet.find(function(t){return t._internalId.equals(e)}):null},t.prototype.getRepresentationById=function(e){var t=this.getAdaptationSet(e);return t?p(t.Representation,e):null},t.prototype.representationExists=function(e){return Boolean(this.getRepresentationById(e))},t.prototype.getLowestBandwidthOfAdaptationSet=function(e){return this.findLowestPossibleBandwidth(e,-(1/0))},t.prototype.findLowestPossibleBandwidth=function(e,t){void 0===t&&(t=-(1/0));var i=this.getAdaptationSet(e);return i?l(i.Representation,t):1/0},t.prototype.getMatchingRepresentationByBandwidth=function(e,t,i){void 0===i&&(i=function(){return!0});var n=this.getAdaptationSet(e);return n?h(n.Representation,t,i):null},t.prototype.getAllRepresentations=function(){return this.getAllPeriods().flatMap(function(e){var t;return(null===(t=e.AdaptationSet)||void 0===t?void 0:t.flatMap(function(e){return e.Representation}))||[]})},t.prototype.getRepresentation=function(e,t){return this.getRepresentationById(new ee.RepresentationId(e,t))},t.prototype.getAllAdaptationSets=function(){return this.getAllPeriods().flatMap(function(e){return e.AdaptationSet})},t.prototype.getAllImageAdaptationSets=function(){return this.getAllAdaptationSets().filter(function(e){return e._mimeType.includes("image")&&"image"===e._contentType})},t.prototype.getAllDashThumbnailSources=function(){var e=this;return this.getAllImageAdaptationSets().map(function(t){var i=e.findPeriod(t._internalId.periodId),n=i.start,r=i.duration;return{adaptationSet:t,timing:{startTime:n,duration:r}}})},t.prototype.getAdaptationSetIndex=function(e){var t=this.findPeriod(e.periodId);return t&&t.AdaptationSet&&0!==t.AdaptationSet.length?t.AdaptationSet.findIndex(function(t){return t._internalId.equals(e)}):-1},t.prototype.markSegmentAsDownloaded=function(e,t){this.sourceStore.dispatch(G.markSegmentAsDownloadedAction(e,t))},t.prototype.getAvailableBaseURLsForRepresentation=function(e){var t=this.getAdaptationSet(e);if(void 0===e||!t)return[];for(var i=[],n=t.Representation,r=0;r<n.length;r++)if(n[r]._internalId.equals(e)&&n[r].BaseURL&&n[r].BaseURL.length>0){i=n[r].BaseURL;break}for(var o=[],r=0;r<i.length;r++)o.push(i[r].url);return o},t.prototype.findDownloadedHlsRepresentation=function(e){var t=this.getAdaptationSet(e);return t?t.Representation.find(function(e){return e._hls&&Boolean(e._hls.requestTimestamp)}):null},t.prototype.isManifestFetchRequired=function(e){if(!this.isHlsManifest())return!1;var t=Date.now(),i=this.getRepresentationById(e),n=Boolean(i.SegmentList)&&i.SegmentList.length>0,r=n&&Boolean(i.SegmentList[0].SegmentURL),o=r?i.SegmentList[0].SegmentURL.length:0,a=!r||o>0,s=i._requestTimestamp||t,u=t-s,d=this.isLive()&&u>=this.getMinimumUpdatePeriod();return!a||d},t.prototype.hasSelfInitialisingSegments=function(){var e=this.manifest.Period,t=e.map(function(e){return e.AdaptationSet}).reduce(function(e,t){return e.concat(t)},[]),i=t.map(function(e){return e.Representation}).reduce(function(e,t){return e.concat(t)},[]);return i.some(function(e){var t=Boolean(e.SegmentList)&&e.SegmentList.length>0,i=t?e.SegmentList:[],n=Boolean(e.SegmentBase)&&e.SegmentBase.length>0,r=Boolean(e.SegmentTemplate)&&e.SegmentTemplate.length>0,o=r?e.SegmentTemplate:[];return!(e.init||n||i.some(function(e){return Boolean(e.init)})||o.some(function(e){return Boolean(e._initialization)}))})},t.prototype.getAvailabilityTimeComplete=function(e){var t=this.getRepresentationById(e),i=t.SegmentList||t.SegmentBase||t.SegmentTemplate;return!(i&&i[0]&&i[0]._availabilityTimeComplete)||JSON.parse(i[0]._availabilityTimeComplete)},t.prototype.isSegmentInfoLoaded=function(e){var t=this.getRepresentationById(e);return!!t&&!(!t.segmentIndex&&!t.segmentIndexParsingError)},t.prototype.isPrecedingPeriod=function(e,t){if(!(e&&t&&this.manifest&&this.manifest.Period))return!1;var i=this.manifest.Period.findIndex(function(t){return t._id===e}),n=this.manifest.Period.findIndex(function(e){return e._id===t});return i>=0&&n>=0&&n<i},t.prototype.getMaxSegmentDuration=function(){var e=V.DurationConverter.getDurationInSec(this.manifest._maxSegmentDuration);return isNaN(e)?0:e},t.prototype.getDesiredDistanceToLiveEdge=function(){var e=Boolean(this.context.config.live&&this.context.config.live.lowLatency);return e?this.context.config.live.lowLatency.targetLatency:this.context.bufferSettings.getForwardTargetLevel()+this.settings.LIVE_EDGE_DISTANCE},t.prototype.hasSuggestedStartPosition=function(){return this.manifest.hasOwnProperty("_startOffset")},t.prototype.getVodStartOffset=function(){return Math.max(0,Math.min(this.manifest._startOffset,this.getDuration()-this.settings.SEEK_TO_END_OFFSET))},t.prototype.getLiveStartOffset=function(e){void 0===e&&(e=!0);var t=this.manifest._startOffset;return t-=Math.abs(this.getTimeShiftBufferDepthSeconds()),e&&(t+=this.getDesiredDistanceToLiveEdge(),t=Math.min(0,t)),t},t.prototype.getPublishTime=function(){return this.manifest._publishTime},t.prototype.initSegmentStartTimesFromReferenceSegment=function(e){var t=Q.ModuleManager.get(W.ModuleName.HLS);this.sourceStore.dispatch(t.actions.initSegmentStartTimesFromReferenceSegment(e))},t.prototype.initializeSegmentStartTimesFromStart=function(e){var t=Q.ModuleManager.get(W.ModuleName.HLS),i=t.selectors,n=i.getHlsState,r=i.getPlaylistStartTime,o=i.hasPlaylist,a=n(this.sourceStore.getState()),s=o(a,e);if(s){var u=r(a,e);this.sourceStore.dispatch(t.actions.initSegmentStartTimes(e,0,u))}},t.prototype.hasSegmentStartTimeForHlsRepresentation=function(e){var t=Q.ModuleManager.get(W.ModuleName.HLS).selectors,i=t.getHlsState,n=t.hasSegmentStartTimesForPlaylist;return n(i(this.sourceStore.getState()),e)},t.prototype.getStartTimeForHlsSegment=function(e,t){var i=Q.ModuleManager.get(W.ModuleName.HLS).selectors,n=i.getHlsState,r=i.getStartTimeForSegment;return r(n(this.sourceStore.getState()),e,t)},t.prototype.isTimeNearPeriodEnd=function(e,t){for(var i=this.getAllPeriods(),n=0,r=i;n<r.length;n++){var o=r[n],a=o.start,s=a+this.getPeriodDuration(o._id,i);if(e>=a&&e<=s)return s-e<=t}return!1},t}(U.Suspendable);t.ManifestService=ie,t.initializeInternalIds=o,t.addDrmKidsToRepresentations=a,t.iterateAdaptationSets=u,t.getNearestPeriodForTime=d,t.findLowestPossibleBandwidthFromRepresentations=l,t.getMatchingRepresentationByBandwidth=h,t.getRepresentationById=p,t.getCodecPriorities=g,t.findAdaptationSet=y,t.findAdaptationSetsForMimeType=v,t.getPreferredLanguage=M,t.getCodecOfAdaptationSetMimeType=I},54:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getManifest=function(e){var t;return null===(t=e)||void 0===t?void 0:t.manifest}},56:function(e,t,i){"use strict";function n(e,t){for(var i=e[0].discontinuitySequenceNumber,n=1;n<e.length;n++){var o=e[n].discontinuitySequenceNumber;if(o!==i){var a=r(t,o);if(null!=a)return{index:n,discontinuityStartTime:a}}}return null}function r(e,t){var i=e[String(t)];return i&&i.startTime>0?i.startTime:(i=e[String(t-1)],i&&i.endTime>0?i.endTime:null)}function o(e,t,i){if(e.length&&i.hasSegmentStartTimeForHlsRepresentation(t)){var n,r=null!=e[0].startTime;r?n=d.findIndexFromEnd(e,function(e){return null!=e.startTime})+1:(e[0].startTime=i.getStartTimeForHlsSegment(t,e[0]),n=1);var o=function(e,t){return t.startTime=e.startTime+e.duration};d.forEachFromIndex(e,n,o)}}var a=this&&this.__assign||function(){return a=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},a.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var s=i(3),u=i(52),d=i(8),c=i(67),l=i(4),h=i(10),p=i(12),f=i(2),g=i(0),m=i(508),S=i(211),y=i(125),v=function(){function e(e){this.context=e,this.sourceContext=e.sourceContext,this.settings=e.settings,this.logger=e.logger,this.manifestService=e.serviceManager.get(s.ServiceName.ManifestService,this.sourceContext.sourceIdentifier),this.distanceToListStartSeconds=0,this.segmentListMap={},this.timestampOffset=NaN}return e.prototype.createSegmentListEntry=function(e){if(!e)return null;var t={isInitSegment:!1,url:e._media,downloaded:!1,startTime:e._expectedPlaybackTime};return["_key","_duration","_dateTime","_metadata","_byteRange","_init","_discontinuitySequenceNumber"].filter(function(t){return e.hasOwnProperty(t)}).forEach(function(i){return t[i.substr(1)]=e[i]}),t},e.prototype.removeDroppedOutSegmentsFromList=function(e,t,i){if(t.SegmentURL.length<1)return e.entries=[],void(e.totalDuration=0);for(var n=this.createSegmentListEntry(t.SegmentURL[0]),r=0,o=0;o<e.entries.length;o++){var a=e.entries[o];if(m.isIdenticalSegmentEntry(a,n))break;r+=a.duration,e.entries.splice(o,1),o--,this.manifestService.isLive()&&this.currentRepresentationId.equals(i)&&this.rewindOneSegment()}e.totalDuration-=r},e.prototype.addNewSegmentsToList=function(e,t){for(var i=[],n=e.entries[e.entries.length-1],r=0,o=t.SegmentURL.length-1;o>=0;o--){var a=this.createSegmentListEntry(t.SegmentURL[o]);if(n&&m.isIdenticalSegmentEntry(n,a))break;isNaN(a.duration)&&(a.duration=e.maximumSegmentDuration),a.duration/=e.timescale,r+=a.duration,i.unshift(a)}e.totalDuration+=r,e.entries=e.entries.concat(i)},e.prototype.updateSegmentList=function(e,t){var i,n,r=t.SegmentList,a=t._internalId.representationId;e.timescale=1,e.maximumSegmentDuration=1,e.startNumber=1;for(var s=function(s){var d=r[s];d.hasOwnProperty("_duration")&&(e.maximumSegmentDuration=Number(d._duration)),["_timescale","_startNumber","_presentationTimeOffset"].filter(function(e){return d.hasOwnProperty(e)}).forEach(function(t){return e[t.substr(1)]=d[t]});var c=(n=null===(i=f.ModuleManager.get(g.ModuleName.DASH,!1))||void 0===i?void 0:i.initSegmentInfoSourceDetectors.isInitializationNode,null!==n&&void 0!==n?n:T);c(d)?e.init=f.ModuleManager.get(g.ModuleName.DASH,!1).initSegmentInfoProviders.provideSegmentInfoFromInitializationNodeProperty(d,t):delete e.init,d.hasOwnProperty("SegmentURL")&&(u.removeDroppedOutSegmentsFromList(e,d,t._internalId),u.addNewSegmentsToList(e,d),u.manifestService.isHlsManifest()?o(e.entries,a,u.manifestService):u.assignSegmentStartTimesForDash(e,t._internalId))},u=this,d=0;d<r.length;d++)s(d)},e.prototype.assignSegmentStartTimesForDash=function(e,t){var i=this.getMinStartTime(t),n=0;e.entries.forEach(function(e){e.startTime=i+n,n+=e.duration})},e.prototype.extrapolateStartTimesFromDiscontinuityStarts=function(e){var t=this.getCurrentSegmentList().entries,i=f.ModuleManager.get(g.ModuleName.HLS).selectors,r=i.getHlsState,o=i.getDiscoSequenceTimings,a=i.getPlaylistStartTime,s=o(r(this.getSourceStateService().getState())),u=n(t,s);if(!u){var d=a(r(this.getSourceStateService().getState()),e.getRepresentationId().representationId);u={index:0,discontinuityStartTime:d},this.logger.debug("Could not find matching discontinuity start times for "+(e.getSegmentInfo().discontinuitySequenceNumber+" using playlist startTime: "+d))}this.logger.debug("Aligning segments of "+e.getRepresentationId().representationId+" to discontinuity start "+(u.discontinuityStartTime+" of "+e.getSegmentInfo().discontinuitySequenceNumber)),t[u.index].startTime=u.discontinuityStartTime;for(var c=u.index-1;c>=0;c--)t[c].startTime=t[c+1].startTime-t[c+1].duration;for(var c=u.index+1;c<t.length;c++)t[c].startTime=t[c-1].startTime+t[c-1].duration},e.prototype.getSourceStateService=function(){return this.context.serviceManager.get(s.ServiceName.SourceStoreService,this.context.sourceContext.sourceIdentifier)},e.prototype.getListIndexForSegmentByUrl=function(e,t){var i=-1,n=this.segmentListMap[t.key()];if(n)for(var r=n.entries,o=0;o<r.length;o++)if(m.isIdenticalSegmentEntry(r[o],e)){i=o;break}return i},e.prototype.populateSegmentListMap=function(e){var t=this,i=this.manifestService.getAdaptationSet(e);i.Representation.forEach(function(e){var i=t.segmentListMap[e._internalId.key()];if(i||(i=t.initializeSegmentList(e._internalId.key())),e.hasOwnProperty("SegmentList")&&(t.updateSegmentList(i,e),f.ModuleManager.has(g.ModuleName.DASH))){var n=f.ModuleManager.get(g.ModuleName.DASH).initSegmentInfoSourceDetectors.isInitializationNode;if(!i.hasOwnProperty("init")&&e.hasOwnProperty("SegmentBase")&&e.SegmentBase&&n(e.SegmentBase[0])){var r=f.ModuleManager.get(g.ModuleName.DASH).initSegmentInfoProviders.provideSegmentInfoFromInitializationNodeProperty;i.init=r(e.SegmentBase[0],e)}}})},e.prototype.selectNewRepresentationId=function(){var e,t=this,i=this.context.serviceManager.get(s.ServiceName.SourceStoreService,this.sourceContext.sourceIdentifier),n=null===(e=i.getState().activeTracks)||void 0===e?void 0:e[this.adaptationSetId.adaptationSetId];if(n&&n.selectedRepresentationId.periodId===this.adaptationSetId.periodId)return n.selectedRepresentationId;if(this.currentRepresentationId){var r=this.manifestService.getRepresentation(this.adaptationSetId,this.currentRepresentationId.representationId);if(r)return r._internalId}var o=function(e){return t.isSegmentInfoLoaded(e._internalId)},a=this.getMatchingRepresentationByBandwidth(o)||this.getMatchingRepresentationByBandwidth();return a._internalId},e.prototype.getMatchingRepresentationByBandwidth=function(e){return this.manifestService.getMatchingRepresentationByBandwidth(this.adaptationSetId,this.getCurrentBandwidth(),e)},e.prototype.shouldUpdateRepresentation=function(){var e=this.adaptationSetId.equals(this.currentRepresentationId),t=!this.currentRepresentationId||Boolean(this.manifestService.getRepresentationById(this.currentRepresentationId));return!this.currentRepresentationId||!e||!t},e.prototype.setAdaptationSetId=function(e){this.adaptationSetId=e,this.populateSegmentListMap(this.adaptationSetId);var t,i=this.manifestService.isLive(),n=0;this.shouldUpdateRepresentation()&&(this.currentRepresentationId=this.selectNewRepresentationId());var r=this.segmentListMap[this.currentRepresentationId.key()];if(r||(r=this.initializeSegmentList(this.currentRepresentationId.key())),r&&i&&r.entries&&r.entries.length>0){var o=r.entries.length-1;this.listIndex>o&&(n=this.listIndex-o),this.listIndex=Math.min(o,this.listIndex||0),this.listIndex=Math.max(0,this.listIndex),t=r.entries[this.listIndex]}if(this.listIndex=this.listIndex||0,i&&(this.distanceToListStartSeconds=this.getSegmentDuration()*this.settings.LIVE_SEGMENT_LIST_START_INDEX_OFFSET),!i)return void this.resolvePendingSegmentInfoRequests();if(t&&r){var a=this.getListIndexForSegmentByUrl(t,this.currentRepresentationId);a>=0?this.listIndex=a+n:this.reset()}else this.reset();var s=this.checkForSegmentInfoError();s?this.rejectPendingSegmentInfoRequest(s):this.resolvePendingSegmentInfoRequests()},e.prototype.initializeSegmentList=function(e){var t={totalDuration:0,entries:[],startNumber:0,init:null,maximumSegmentDuration:1,timescale:1};return this.segmentListMap[e]=t,t},e.prototype.getCurrentBandwidth=function(){var e=0,t=this.getCurrentRepresentation();return t&&(e=t._bandwidth),e},e.prototype.checkForSegmentInfoError=function(){var e=this.manifestService.getPeriod(this.currentRepresentationId);if(Boolean(e)&&!this.hasNext()){if(e.droppedOut)return S.SegmentInfoErrors.PERIOD_DROPPED_OUT;if(!this.manifestService.isLastPeriod(this.currentRepresentationId.periodId))return S.SegmentInfoErrors.PERIOD_COMPLETE}return null},e.prototype.reset=function(){this.settings.ENABLE_SEEK_FOR_LIVE?this.listIndex=0:this.timeShift(0)},e.prototype.setRepresentationId=function(e){var t,i,n=this.manifestService.getRepresentationById(e),r=null===(t=this.getCurrentSegmentList())||void 0===t?void 0:t.entries[this.listIndex];if(n){var o=void 0===this.currentRepresentationId,a=this.currentRepresentationId;if(this.currentRepresentationId=e,this.manifestService.isLive()&&n._hls)if(o)this.reset();else if(this.settings.HLS_SYNC_VIA_MEDIA_SEQUENCE){var s=this.manifestService.getRepresentationById(a),u=s._hls.mediaSequence+this.listIndex;this.listIndex=u-n._hls.mediaSequence,this.listIndex=Math.max(this.listIndex,0)}else if(null!=(null===(i=r)||void 0===i?void 0:i.startTime)&&!isNaN(r.startTime)){var d=this.getIndexForTime(r.startTime);null===d||isNaN(d)||(this.listIndex=this.adaptListIndexToCorrectIndex(d,r.startTime))}return!0}return!1},e.prototype.adaptListIndexToCorrectIndex=function(e,t){var i=this.getCurrentSegmentList().entries,n=[i[e],i[e+1]];if(e===i.length-1||n.some(function(e){return!e.startTime}))return e;var r=n.map(function(e){return Math.abs(e.startTime-t)}),o=Math.min.apply(this,r);return e+r.indexOf(o)},e.prototype.getInitSegmentInfo=function(){var e=this.getCurrentSegmentList();if(!e)return null;if(e.init)return e.init.presentationTimeOffset=this.getTimestampOffset(),e.init;if(this.listIndex<e.entries.length&&this.listIndex>-1){var t=a({},e.entries[this.listIndex]);if(t.init){var i=t.init;return i.isInitSegment=!0,i}}return null},e.prototype.getNextSegmentInfo_=function(){var e=this.getCurrentSegmentList();if(e&&this.listIndex<e.entries.length&&this.listIndex>-1){var t=e.entries[this.listIndex];return t.isInitSegment=!1,t.presentationTimeOffset=this.getTimestampOffset(),this.listIndex++,t}return null},e.prototype.getNextSegmentInfo=function(){var e=this.getNextSegmentInfo_();return e?Promise.resolve(e):this.queueSegmentInfoRequest()},e.prototype.getSegmentInfos=function(){var e=this,t=this.listIndex,i=this.manifestService.getTotalDuration(),n={},r=this.manifestService.getAdaptationSet(this.adaptationSetId);if(r){var o=this.getSeekableRange().end-this.getSeekableRange().start,a=r.Representation[0].BaseURL[0].url;r.Representation.forEach(function(r){var s,u,d=e.segmentListMap[r._internalId.key()],c=e.manifestService.isLive();c?(s=t-o/e.getSegmentDuration(),u=t):(s=0,u=parseInt(s+o/e.getSegmentDuration())-1);for(var p=0,f=[],g=s;g<=u;g++){var m=f.length;f[m]={};var S=void 0;if(d.entries.length&&(S=d.entries[m].url),"string"==typeof S){var y=h.URLHelper.concatBaseUrlWithPartial(a,S);f[m].url=h.URLHelper.appendQueryParametersToUrl(y,e.settings.QUERY_PARAMETERS)}f[m].duration=e.getSegmentDuration(),c?(p=e.settings.ENABLE_SEEK_FOR_LIVE?e.getExpectedPresentationTime(g):l.toSeconds(Date.now()-e.manifestService.getAvailabilityStartTime())-i,t++):(f[m].startTime=p,p+=f[m].duration),n[r._id]=f}})}return n},e.prototype.getSubtitleUrl=function(){return this.manifestService.getAvailableSubtitles(this.adaptationSetId.periodId)[0].url},e.prototype.getStartNumber=function(){var e=this.getCurrentSegmentList();return e?e.startNumber:1},e.prototype.getSegmentDuration=function(){var e=this,t=this.getCurrentSegmentList();if(t)return t&&t.entries.length>0?t.totalDuration/t.entries.length:t.maximumSegmentDuration;var i=this.manifestService.getAdaptationSet(this.adaptationSetId);if(i){var n=Object.keys(this.segmentListMap).map(function(t){return e.segmentListMap[t]}).find(function(e){return null!==e});if(n)return n.maximumSegmentDuration}return 1},e.prototype.seekTo=function(e){e>-1&&(this.listIndex=this.getIndexForTime(e))},e.prototype.isSegmentInfoLoadable=function(){var e=this.getCurrentPeriod();return!e.droppedOut},e.prototype.hasNext=function(){if(!this.isSegmentInfoLoaded(this.currentRepresentationId))return this.isSegmentInfoLoadable();if(this.currentRepresentationId){var e=this.listIndex<this.getCurrentSegmentList().entries.length;if(this.manifestService.isHlsManifest()){if(this.manifestService.isLastPeriod(this.currentRepresentationId.periodId)){var t=f.ModuleManager.get(g.ModuleName.HLS).selectors,i=t.getHlsState,n=t.getEndlist,r=n(i(this.getSourceStateService().getState()));return!r||e&&r}return e}return e}return!0},e.prototype.setTimestampOffset=function(e,t){void 0===t&&(t=1),this.timestampOffset=e/t},e.prototype.getTimestampOffset=function(){if(!isNaN(this.timestampOffset))return this.timestampOffset;var e=this.getCurrentPeriod(),t=0;if(this.currentRepresentationId){var i=this.getCurrentSegmentList();i&&!isNaN(i.presentationTimeOffset)&&(t=i.presentationTimeOffset/i.timescale)}return e&&!this.manifestService.isHlsManifest()&&(t-=e.start),t},e.prototype.getIndex=function(){return this.listIndex},e.prototype.setIndex=function(e){return"number"!=typeof e?void this.logger.debug("Tried to set index at MPDHandler with parameter not being a number!"):e<0?(this.logger.debug("Tried to set index at MPDHandler to value smaller 0. Setting to 0."),void(this.listIndex=0)):void(this.listIndex=e)},e.prototype.queueSegmentInfoRequest=function(){var e=this;return this.pendingSegmentInfoRequest?Promise.reject("fail"):new Promise(function(t,i){e.pendingSegmentInfoRequest={resolve:t,reject:i}})},e.prototype.resolvePendingSegmentInfoRequests=function(){if(this.pendingSegmentInfoRequest){var e=this.getNextSegmentInfo_();e?(this.pendingSegmentInfoRequest.resolve(e),this.pendingSegmentInfoRequest=null):this.manifestService.isLive()||this.hasNext()||this.pendingSegmentInfoRequest.reject("eos")}},e.prototype.rejectPendingSegmentInfoRequest=function(e){this.pendingSegmentInfoRequest&&(this.pendingSegmentInfoRequest.reject(e),this.pendingSegmentInfoRequest=null)},e.prototype.getLiveEdgeIndex=function(){var e=this.manifestService.isLastPeriod(this.currentRepresentationId.periodId),t=this.getCurrentSegmentList();if(!e)return t.entries.length-1;if(t){var i=t.entries.length,n=this.manifestService.getDesiredDistanceToLiveEdge(),r=void 0;for(r=i;p.Util.roundValue(n,2)>0&&r>0;r--)n-=t.entries[r-1].duration||this.getSegmentDuration();return Math.max(0,r)}return 0},e.prototype.timeShift=function(e,t,i){if(this.manifestService.isLive()){this.logger.debug("Calculating timeShift index based on offset "+e+" "+(i?"and targetTime "+i:""));var n=this.listIndex,r=i&&this.hasStartTimes()?this.getIndexForTime(i):void 0;0===e?(this.listIndex=null!==r&&void 0!==r?r:this.getLiveEdgeIndex(),this.logger.debug("timeShift changes index from "+n+" to "+this.listIndex+" [back to live edge]")):(this.listIndex=null!==r&&void 0!==r?r:Math.max(0,this.getLiveEdgeIndex()+Math.floor(e/this.getSegmentDuration())),this.logger.debug("timeShift changes index from "+n+" to "+this.listIndex))}},e.prototype.hasStartTimes=function(){return this.getCurrentSegmentList().entries[0].startTime>=0},e.prototype.updateRepresentation=function(e){return Promise.resolve(e)},e.prototype.isSegmentInfoLoaded=function(e){if(void 0===e&&(e=this.currentRepresentationId),!e)return!1;var t=this.segmentListMap[e.key()],i=this.manifestService.getRepresentationById(e);return!(!t||!i)&&t.entries.length>0},e.prototype.rewindOneSegment=function(){return this.listIndex--,!(this.listIndex<0)||(this.logger.debug("List array index is smaller than 0, probably a discontinuity. Using 0."),this.listIndex=0,!1)},e.prototype.getCurrentPeriod=function(){return this.manifestService.getPeriod(this.currentRepresentationId)},e.prototype.getExpectedPresentationTime=function(e){var t=0,i=this.getCurrentPeriod().start;t=this.manifestService.hasSinglePeriod()?this.getSeekableRange().start:i;var n=this.getCurrentSegmentList(),r=n.entries.slice(0,e),o=r.reduce(function(e,t){return e+t.duration},0);return t+o},e.prototype.getCurrentRepresentation=function(){return this.manifestService.getRepresentationById(this.currentRepresentationId)},e.prototype.getCurrentSegmentList=function(){return this.currentRepresentationId?this.segmentListMap[this.currentRepresentationId.key()]:null},e.prototype.findListIndexWithoutSegmentStartTimes=function(e,t){if(!this.adaptationSetId)return 0;for(var i=this.manifestService.getPeriod(this.adaptationSetId),n=i?i.start:0,r=e.entries.length,o=0,a=n;a<=t&&o<r;o++)a+=e.entries[o].duration;return Math.max(o-1,0)},e.prototype.getIndexForTime=function(e){var t=this.getCurrentSegmentList();if(!t||0===t.entries.length)return 0;var i=this.getMinStartTime(),n=Math.max(i,e),r=t.totalDuration/t.entries.length,o=y.findSegmentIndexForTime(t.entries,n,r);return null!==o?o:this.findListIndexWithoutSegmentStartTimes(t,n)},e.prototype.getMinStartTime=function(e){void 0===e&&(e=this.currentRepresentationId);var t=this.manifestService.hasSinglePeriod()?this.getSeekableRange().start:this.manifestService.getPeriod(e).start;return this.manifestService.isFirstPeriod(e.periodId)&&(t+=this.distanceToListStartSeconds),t},e.prototype.getLiveEdgeTime=function(){var e=this.manifestService.getLastPeriod();return e?e.start+c.DurationConverter.getDurationInSec(e._duration):1/0},e.prototype.getActualTimeShiftBufferDepth=function(){return this.manifestService.getTimeShiftBufferDepthSeconds()},e.prototype.getSeekableRange=function(){var e={start:0,end:0},t=this.manifestService.getTotalDuration();if(!this.manifestService.isLive())return e.start=u.getStartTimeOffset(this.getSourceStateService().getState()),e.end=t,e;var i=this.manifestService.getTimeShiftBufferDepthSeconds(),n=l.toSeconds(this.manifestService.getRequestTimestamp()-this.manifestService.getAvailabilityStartTime());if(e.start=Math.max(n+i,0),e.end=Math.max(n,0),
f.ModuleManager.has(g.ModuleName.HLS)&&this.manifestService.isHlsManifest()){var r=f.ModuleManager.get(g.ModuleName.HLS).selectors,o=r.getHlsState,a=r.getPlaylistType;"EVENT"===a(o(this.getSourceStateService().getState()))?(e.start=0,e.end=t):e.start+=this.distanceToListStartSeconds}return e.end-=this.manifestService.getDesiredDistanceToLiveEdge(),e},e.prototype.getPendingSegmentInfoRequest=function(){return this.pendingSegmentInfoRequest},e.prototype.setPendingSegmentInfoRequest=function(e){this.pendingSegmentInfoRequest=e},e.prototype.preProcessAvailableSegment=function(e,t,i){return null},e.prototype.dispose=function(){this.settings=null,this.manifestService=null,this.adaptationSetId=null,this.currentRepresentationId=null,this.manifestService=null,this.pendingSegmentInfoRequest=null,this.segmentListMap=null},e}();t.SegmentListMPDHandler=v;var T=function(){return!1};t.assignSegmentStartTimesFromHlsPlaylist=o},57:function(e,t,i){"use strict";function n(e){var t;return a.createAction(s.ActiveTracksActionType.SetSelectedRepresentationId,(t={},t[e.adaptationSetId]={selectedRepresentationId:e},t))}function r(e){return a.createAction(s.ActiveTracksActionType.RemoveActiveTrack,{adaptationSetId:e})}function o(){return a.createAction(s.ActiveTracksActionType.ClearActiveTracks)}Object.defineProperty(t,"__esModule",{value:!0});var a=i(24),s=i(213);t.setRepresentationIdAction=n,t.removeActiveTrackAction=r,t.clearActiveTracksAction=o},58:function(e,t,i){"use strict";var n,r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,i=1,n=arguments.length;i<n;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},r.apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0});var o=i(25),a=i(214),s={playingPeriodId:null};t.getPlayingPeriodId=function(e){return e.playingTracks.playingPeriodId},t.PlayingTracksReducer=o["default"](s,(n={},n[a.PlayingTracksActionKey.SetPlayingPeriodId]=function(e,t){var i=t.payload;return r(r({},e),{playingPeriodId:i})},n))},68:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this._periodId=e}return Object.defineProperty(e.prototype,"periodId",{get:function(){return this._periodId},enumerable:!0,configurable:!0}),e.prototype.equals=function(e){return e&&this.periodId===e.periodId},e.prototype.key=function(){return this.periodId},e}();t.PeriodId=n},77:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i(11),r=i(504),o=i(505),a=function(){function e(e){var t=this;this.resolveDeferredRead=function(){t.deferredRead&&!t.isEmpty()&&(t.deferredRead.resolve({done:!1,value:t.chunks.shift()}),t.deferredRead=null)},this.state=o.StreamState.Open,this.chunks=[],this.dataType=e,this.deferredEnded=new n.Deferred,this.deferredEnded.promise["catch"](function(){})}return e.prototype.getType=function(){return this.dataType},e.prototype.add=function(e){this.state===o.StreamState.Open&&(this.chunks.push(e),this.resolveDeferredRead())},e.prototype.read=function(){if(this.deferredRead)return Promise.reject({name:r.StreamReadError.ParallelRead});if(this.state===o.StreamState.Ended&&this.isEmpty())return Promise.resolve({done:!0});if(this.state===o.StreamState.Aborted)return Promise.reject({name:r.StreamReadError.Aborted,message:this.getError()});this.deferredRead=new n.Deferred;var e=this.deferredRead.promise;return this.resolveDeferredRead(),e},e.prototype.end=function(){this.state===o.StreamState.Open&&(this.state=o.StreamState.Ended,this.deferredRead&&this.isEmpty()&&(this.deferredRead.resolve({done:!0}),this.deferredRead=null),this.deferredEnded.resolve())},e.prototype.abort=function(e){if(this.state===o.StreamState.Open){this.state=o.StreamState.Aborted,this.error=e;var t={name:o.StreamState.Aborted,message:this.getError()};this.deferredRead&&(this.deferredRead.reject(t),this.deferredRead=null),this.deferredEnded.reject(t)}},e.prototype.transform=function(t,i,n){var r=this,o=new e(this.dataType),a=function(){r.read().then(function(e){var n=e.done,r=e.value;if(n)i&&i(),o.end();else{var s=t(r);s&&o.add(s),a()}})["catch"](function(e){n?o.abort(n(e)):o.abort(e)})};return a(),o},e.prototype.isEmpty=function(){return 0===this.chunks.length},e.prototype.getError=function(){return this.error||null},e}();t.Stream=a},78:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n,r=i(24);!function(e){e.MP4="mp4",e.TS="ts",e.WEBM="webm"}(n=t.ContainerFormat||(t.ContainerFormat={}));var o;!function(e){e.SetContainerFormat="@instance/sources/@source/containerformat"}(o=t.ContainerFormatActionKey||(t.ContainerFormatActionKey={})),t.setContainerFormat=function(e){return r.createAction(o.SetContainerFormat,e)}},90:function(e,t,i){"use strict";function n(e){return 0===e.indexOf("_")?e.substring(1):e}function r(e,t,i){return void 0===i&&(i=[]),Object.keys(e).filter(function(e){return 0===i.length||i.indexOf(e)>-1}).forEach(function(i){t[n(i)]=e[i]}),t}function o(e,t,i){if(!e)return null;var n={id:e._id?String(e._id):null,bitrate:e._bandwidth||0},r=S.CodecStringHelper.extractCodecStrings(e._codecs||i);return u(e,t)?a(n,e,r):s(e,t)?d(n,e,r):(n.label=e._label||c(n.bitrate),n)}function a(e,t,i){return i.audio&&(e.codec=i.audio),e.label=t._label||c(e.bitrate),e}function s(e,t){return v.MimeTypeHelper.isVideo(t)}function u(e,t){return v.MimeTypeHelper.isAudio(t)}function d(e,t,i){e.width=t._width||0,e.height=t._height||0,i.video&&(e.codec=i.video),t.hasOwnProperty("_frameRate")&&(e.frameRate=t._frameRate);var n=c(e.bitrate);return e.width&&e.height&&(n=e.width+"x"+e.height+", "+n),e.label=t._label||n,e}function c(e){return Math.round(e/1e3)+"kbps"}function l(e,t){return Boolean(e.role&&e.role.some(function(e){return["forced_subtitle"].includes(e.value)}))||Boolean(t._hls&&t._hls.isForced)}function h(e){return null==e._minimumUpdatePeriod?1/0:y.DurationConverter.getDurationInSec(e._minimumUpdatePeriod)}function p(e,t){return e+'; codecs="'+t+'"'}Object.defineProperty(t,"__esModule",{value:!0});var f=i(3),g=i(9),m=i(52),S=i(26),y=i(67),v=i(5),T=i(4),M=i(12),I=i(2),P=i(0),b=i(49),C=i(54),R=function(){function e(e,t){var i=this;this.isLive=function(){return"dynamic"===i.getMpd()._type},this.context=e,this.sourceContext=t,this.settings=e.settings,this.adjustedPeriodStartTimes=!1,this.synchronizedTimeService=e.serviceManager.get(f.ServiceName.SynchronizedTimeService,this.sourceContext.sourceIdentifier),this.sourceStore=e.serviceManager.get(f.ServiceName.SourceStoreService,this.sourceContext.sourceIdentifier)}return e.prototype.getMpd=function(){return C.getManifest(this.sourceStore.getState())},e.prototype.getPeriods=function(){return this.getMpd().Period},e.prototype.getAdaptationSets=function(e){var t=this.getPeriods().find(function(t){return t._id===e});return t?t.AdaptationSet:[]},e.prototype.adjustPeriodStartTimes=function(){if(!this.adjustedPeriodStartTimes&&!this.getMpd()._isHls){var e=this.isLive()?T.toSeconds(this.getAvailabilityStartTime()):m.getStartTimeOffset(this.sourceStore.getState());this.sourceStore.dispatch(b.adjustPeriodStartTimes(e)),this.adjustedPeriodStartTimes=!0}},e.prototype.getAvailabilityStartTime=function(){return this.isLive()&&this.getMpd()._availabilityStartTime?M.Util.getUtcDate(this.getMpd()._availabilityStartTime).getTime()-this.getTimeDifference():0},e.prototype.getAvailabilityEndTime=function(){if(this.getMpd().hasOwnProperty("_availabilityEndTime")){var e=M.Util.getUtcDate(this.getMpd()._availabilityEndTime).getTime();return new Date(e-this.getTimeDifference())}return null},e.prototype.getTimeDifference=function(){return this.synchronizedTimeService?this.synchronizedTimeService.getTimeDifference():0},e.prototype.getType=function(){return this.getMpd()._type},e.prototype.getDuration=function(){return this.getMpd()._mediaPresentationDuration},e.prototype.getRequestTimestamp=function(){return this.getMpd()._requestTimestamp},e.isValueWithinBounds=function(e,t,i){return!e||e>=t&&e<=i},e.prototype.isAllowedVideoQuality=function(t){var i=e.isValueWithinBounds(t.width,this.settings.MIN_SELECTABLE_VIDEO_WIDTH,this.settings.MAX_SELECTABLE_VIDEO_WIDTH),n=e.isValueWithinBounds(t.height,this.settings.MIN_SELECTABLE_VIDEO_HEIGHT,this.settings.MAX_SELECTABLE_VIDEO_HEIGHT),r=e.isValueWithinBounds(t.bitrate,this.settings.MIN_SELECTABLE_VIDEO_BITRATE,this.settings.MAX_SELECTABLE_VIDEO_BITRATE);return i&&n&&r},e.prototype.isAllowedAudioQuality=function(t){return e.isValueWithinBounds(t.bitrate,this.settings.MIN_SELECTABLE_AUDIO_BITRATE,this.settings.MAX_SELECTABLE_AUDIO_BITRATE)},e.prototype.getAllowedQualities=function(e,t){var i=this;if(!e)return[];var n=t.filter(function(t){return v.MimeTypeHelper.isVideo(e)&&i.isAllowedVideoQuality(t)||v.MimeTypeHelper.isAudio(e)&&i.isAllowedAudioQuality(t)});return n.length<1&&t.length>0?t:n},e.prototype.getQualityForAdaptationSet=function(e){if(!e)return[];var t=e.Representation.map(function(t){return o(t,e._mimeType,e._codecs)});return this.settings.EXCLUDE_DISALLOWED_REPRESENTATIONS&&(t=this.getAllowedQualities(e._mimeType,t)),t},e.prototype.getAudioQualities=function(e){var t=this,i=this.getValidPeriodId(e),n=this.getAdaptationSets(i);return n.reduce(function(e,i){return i._mimeType&&v.MimeTypeHelper.isAudio(i._mimeType)&&(e[i._internalId.adaptationSetId]=t.getQualityForAdaptationSet(i)),e},{})},e.prototype.getVideoQualities=function(e){var t=this.getValidPeriodId(e),i=this.getAdaptationSets(t).find(function(e){return e._mimeType&&v.MimeTypeHelper.isVideo(e._mimeType)});return i?this.getQualityForAdaptationSet(i):[]},e.prototype.getLangObjectFromAdaptationSet=function(e,t,i){var n={id:null,lang:null,adaptationSetId:null,kind:null,label:"off",url:null},o=e._mimeType&&e._mimeType.indexOf(t)>-1,a=i&&e._mimeType.indexOf(i)>-1;return v.MimeTypeHelper.isSubtitle(t)&&(n.kind="subtitle"),e.Role&&e.Role.length>0&&(n.role=e.Role.map(function(e){return r(e,{})})),(o||a)&&(r(e,n,["_lang","_isFragmented"]),n.lang=n.lang||"und",n.label=e._label||n.lang,n.adaptationSetId=e._internalId,n.id=e._internalId.adaptationSetId),n},e.prototype.toSubtitleTrack=function(e,t,i){var n=this.getLangObjectFromAdaptationSet(e,t,i),r={id:n.id,lang:n.lang,kind:n.kind,isFragmented:n.isFragmented,enabled:!1,label:n.label};return null!=n.role&&(r.role=n.role),r.forced=l(r,e.Representation[0]),r},e.prototype.getAvailableSubtitles=function(e){var t=this,i=0;return e=this.getValidPeriodId(e),this.getAdaptationSets(e).filter(function(e){return v.MimeTypeHelper.isSubtitle(e._mimeType)}).map(function(e){var n=t.toSubtitleTrack(e,"application","text"),r=n.id;return r||(i++,n.id="sub_"+i),n})},e.prototype.getClosedCaptionLabels=function(e){return e=this.getValidPeriodId(e),this.getAdaptationSets(e).filter(function(e){return e.ClosedCaptionLabels}).flatMap(function(e){return Object.keys(e.ClosedCaptionLabels).map(function(t){var i=e.ClosedCaptionLabels[t];return{id:t,kind:"captions",lang:i.lang||"unknown",label:i.label||"Captions ("+t+")"}})})},e.prototype.getAvailableAudio=function(e,t){var i=this;void 0===t&&(t=!0);var n=this.getValidPeriodId(e),r=this.getAdaptationSets(n),o=0,a=r.filter(function(e){return v.MimeTypeHelper.isAudio(e._mimeType)}).map(function(e){var t=i.getLangObjectFromAdaptationSet(e,g.MediaType.Audio);return t&&"off"!==t.label?(t.id||(t.id="audio_"+o,o++),t):null});if(t){var s=r.find(function(e){return v.MimeTypeHelper.isVideo(e._mimeType)});if(s&&s.ContentComponent){var u=s.ContentComponent.filter(function(e){return e._contentType===g.MediaType.Audio}).map(function(e){return{id:e._id,lang:e._lang,label:e._id}});a=a.concat(u)}}return a.filter(function(e){return e})},e.prototype.getAvailableVideo=function(e){var t=this.getValidPeriodId(e),i=this.getAdaptationSets(t),n=i.find(function(e){return v.MimeTypeHelper.isVideo(e._mimeType)});return n?[this.getLangObjectFromAdaptationSet(n,g.MediaType.Video)]:[]},e.getContentProtectionForManifestElement=function(e){var t,i;return(null===(i=null===(t=e)||void 0===t?void 0:t.ContentProtection)||void 0===i?void 0:i.length)&&I.ModuleManager.has(P.ModuleName.DRM)?I.ModuleManager.get(P.ModuleName.DRM).ContentProtectionHelper.parseContentProtectionDescriptors(e.ContentProtection):[]},e.getContentProtectionForAdaptationSet=function(t){for(var i=[],n=0;n<t.Representation.length;n++)i=i.concat(e.getContentProtectionForManifestElement(t.Representation[n]));return i=i.concat(e.getContentProtectionForManifestElement(t))},e.prototype.getTimeShiftBufferDepthSeconds=function(){if(this.isLive()){var e=this.getMpd()._timeShiftBufferDepth,t=T.toSeconds(Date.now()-this.getAvailabilityStartTime());return e===Number.NEGATIVE_INFINITY?-t:Math.max(e,-t)}return 0},e.getCurrentAndSuccessorPeriod=function(e,t){for(var i=[null,0,null],n=i[0],r=i[1],o=i[2];r<e.length;r++)if(e[r]._id===t){n=e[r],o=e[r+1]||null;break}return[n,o]},e.prototype.getPeriodDuration=function(t,i){i=i||this.getMpd().Period;var n=e.getCurrentAndSuccessorPeriod(i,t),r=n[0],o=n[1];if(r&&r._duration)return y.DurationConverter.getDurationInSec(r._duration);if(r&&r.start&&o&&o.start)return o.start-r.start;if(this.getMpd()._mediaPresentationDuration){var a=y.DurationConverter.getDurationInSec(this.getMpd()._mediaPresentationDuration);if(!isNaN(a))return a}return Number.POSITIVE_INFINITY},e.prototype.getDRMCapabilitiesForPeriod=function(e){e=this.getValidPeriodId(e);var t=this.getMpd().Period.find(function(t){return t._id===e});return this.getDRMCapabilitiesFromPeriod(t)},e.prototype.getDRMCapabilitiesFromPeriod=function(t){for(var i=[],n=[],r=0,o=t.AdaptationSet;r<o.length;r++){var a=o[r],s=a._mimeType,u=e.getMimeTypeCodecStringForAdaptationSet(a);v.MimeTypeHelper.isVideo(s)?n=n.concat(u):v.MimeTypeHelper.isAudio(s)&&(i=i.concat(u))}return[i,n]},e.prototype.dispose=function(){this.settings=null},e.getMimeTypeCodecStringForAdaptationSet=function(t){for(var i=[],n=0,r=t.Representation;n<r.length;n++){var o=r[n],a=e.getAttributeFromRepresentationOrAdaptationSet("_codecs",o,t),s=t._mimeType;if(t._mimeType&&a){var u=p(s,a);i.push({contentType:u})}}return i},e.getAttributeFromRepresentationOrAdaptationSet=function(e,t,i){return t.hasOwnProperty(e)&&t[e]?t[e]:i.hasOwnProperty(e)&&i[e]?i[e]:null},e.prototype.getValidPeriodId=function(e){var t=this.getPeriods();if(t.find(function(t){return t._id===e}))return e;var i=t[t.length-1]._id;return this.context.logger.debug("Period "+e+" not available - return last period ("+i+")"),i},e.prototype.getEventStreamEvents=function(e){var t=this;return e&&e.EventStream?e.EventStream.filter(function(e){return null!==e.Event}).flatMap(function(i){var n=Number(i._timescale)||1;return t.mapToEventStreamEvent(e.start,i,n)}):[]},e.prototype.mapToEventStreamEvent=function(e,t,i){var n=this;return t.Event.map(function(t){var r={},o=t._presentationTime||0;if(r.startTime=o/i+e,t._duration){var a=t._duration/i;r.endTime=r.startTime+a}else r.endTime=r.startTime;return r.data=n.getEventData(t),r})},e.prototype.getEventData=function(e){var t,i=/<event[^>]*>(.*)(<\/event>|\/>)/g.exec(e.rawXmlRepresentation);i&&i.length>1&&(t=i[1]);var n={};return Object.getOwnPropertyNames(e).filter(function(e){var t=["_presentationTime","_duration","__text"].some(function(t){return t===e});return!t&&0===e.lastIndexOf("_",0)}).forEach(function(t){n[t.substring(1,t.length)]=e[t]}),{properties:n,content:t}},e.prototype.getPeriodById=function(e){return this.getMpd().Period.find(function(t){return t._id===e})},e}();t.MPDExtractor=R,t.stripUnderscorePrefix=n,t.applyProperties=r,t.representationToQuality=o,t.getMinimumUpdatePeriodInSeconds=h,t.getContentTypeFromMimeTypeAndCodecs=p},91:function(e,t,i){"use strict";function n(e,t){var i=e.isInitSegment?["url","periodId","byteRange"]:["url","periodId","byteRange","discontinuitySequenceNumber"];return i.every(function(i){return"object"==typeof e[i]?o.compareValues(e[i],t[i]):e[i]===t[i]})}Object.defineProperty(t,"__esModule",{value:!0});var r=i(8),o=i(92),a=function(){function e(e){this.maxSize=Math.max(0,e),this.cache=[]}return e.prototype.contains=function(e){return this.cache.some(function(t){return n(e.getSegmentInfo(),t.getSegmentInfo())})},e.prototype.maintainCacheSize=function(e){return 0===e?void(this.cache=[]):void(this.cache=this.cache.slice(-e))},e.prototype.add=function(e){this.contains(e)||(this.cache.push(e),this.maintainCacheSize(this.maxSize))},e.prototype.get=function(e){return this.cache.find(function(t){return n(e,t.getSegmentInfo())})},e.prototype.clear=function(){this.maintainCacheSize(0)},e.prototype.remove=function(e){this.cache=this.cache.filter(r.invert(e))},e.prototype.getCapacity=function(){return this.maxSize},e.prototype.getCachedCount=function(){return this.cache.length},e.prototype.getCachedSegments=function(){return this.cache.slice(0)},e}();t.SegmentCache=a,t.areSegmentsIdentical=n},92:function(e,t,i){"use strict";function n(e,t,i){return!e&&!t||!(e&&!t||!e&&t)&&(i||Object.keys(e)).every(function(i){return e[i]===t[i]})}Object.defineProperty(t,"__esModule",{value:!0}),t.compareValues=n}},[476])});
})();
