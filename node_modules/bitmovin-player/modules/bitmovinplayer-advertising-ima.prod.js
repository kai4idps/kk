/**************************************************************************** 
 * Copyright (C) 2021, Bitmovin, Inc., All Rights Reserved 
 * 
 * This source code and its use and distribution, is subject to the terms 
 * and conditions of the applicable license agreement. 
 * 
 * Bitmovin Player Version 8.60.0 
 * 
 ****************************************************************************/
(function() {
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["advertising-ima"]=t():(e.bitmovin=e.bitmovin||{},e.bitmovin.player=e.bitmovin.player||{},e.bitmovin.player["advertising-ima"]=t())}(this,function(){return webpackJsonpbitmovin_player__name_([28],{142:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a;!function(e){e.None="none",e.Vast="vast",e.VastAndVmap="vastandvmap"}(a=t.ImaPassthroughMode||(t.ImaPassthroughMode={}))},143:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a;!function(e){e[e.FAILED_TO_REQUEST_IMA_SDK=103]="FAILED_TO_REQUEST_IMA_SDK",e[e.FAILED_TO_REQUEST_ADS=1005]="FAILED_TO_REQUEST_ADS",e[e.VAST_ASSET_NOT_FOUND=1007]="VAST_ASSET_NOT_FOUND",e[e.VAST_EMPTY_RESPONSE=1009]="VAST_EMPTY_RESPONSE",e[e.UNKNOWN_AD_RESPONSE=1010]="UNKNOWN_AD_RESPONSE",e[e.UNSUPPORTED_LOCALE=1011]="UNSUPPORTED_LOCALE",e[e.ADS_REQUEST_NETWORK_ERROR=1012]="ADS_REQUEST_NETWORK_ERROR",e[e.INVALID_AD_TAG=1013]="INVALID_AD_TAG",e[e.STREAM_INITIALIZATION_FAILED=1020]="STREAM_INITIALIZATION_FAILED",e[e.ASSET_FALLBACK_FAILED=1021]="ASSET_FALLBACK_FAILED",e[e.INVALID_ARGUMENTS=1101]="INVALID_ARGUMENTS",e[e.AUTOPLAY_DISALLOWED=1205]="AUTOPLAY_DISALLOWED"}(a=t.ImaModuleErrorCode||(t.ImaModuleErrorCode={}))},232:function(e,t,i){"use strict";function a(e){for(var t=[],i=1;i<arguments.length;i++)t[i-1]=arguments[i];e&&"function"==typeof e&&e.apply(void 0,t)}function r(){return[100,404,google.ima.AdError.ErrorCode.COMPANION_REQUIRED_ERROR,google.ima.AdError.ErrorCode.FAILED_TO_REQUEST_ADS,google.ima.AdError.ErrorCode.NONLINEAR_DIMENSIONS_ERROR,google.ima.AdError.ErrorCode.UNKNOWN_AD_RESPONSE,google.ima.AdError.ErrorCode.UNKNOWN_ERROR,google.ima.AdError.ErrorCode.VAST_ASSET_NOT_FOUND,google.ima.AdError.ErrorCode.VAST_EMPTY_RESPONSE,google.ima.AdError.ErrorCode.VAST_LINEAR_ASSET_MISMATCH,google.ima.AdError.ErrorCode.VAST_LOAD_TIMEOUT,google.ima.AdError.ErrorCode.VAST_MALFORMED_RESPONSE,google.ima.AdError.ErrorCode.VAST_NO_ADS_AFTER_WRAPPER,google.ima.AdError.ErrorCode.VAST_SCHEMA_VALIDATION_ERROR,google.ima.AdError.ErrorCode.VAST_TOO_MANY_REDIRECTS,google.ima.AdError.ErrorCode.VAST_TRAFFICKING_ERROR,google.ima.AdError.ErrorCode.VAST_UNSUPPORTED_VERSION,google.ima.AdError.ErrorCode.VAST_WRAPPER_ERROR,1012]}function n(e,t){return e.scheduleTime-e.preloadOffset-(t.scheduleTime-t.preloadOffset)}function o(e){var t=l({},e);return Object.keys(t).forEach(function(e){var i=t[e],a="number"==typeof i,r=i&&"object"==typeof i,n=r&&!Object.keys(i).some(function(e){return Boolean(i[e])});(a&&i<0||!a&&!i||n)&&delete t[e]}),t}function s(e){var t=e.getAd(),i={adTitle:t.getTitle(),adSystem:{name:t.getAdSystem()},mimeType:t.getContentType(),bitrate:t.getVastMediaBitrate&&t.getVastMediaBitrate()>0?t.getVastMediaBitrate():-1,wrapperAdIds:t.getWrapperAdIds(),adDescription:t.getDescription(),advertiser:{name:t.getAdvertiserName()},apiFramework:t.getApiFramework(),creative:{id:t.getCreativeId(),adId:t.getCreativeAdId(),universalAdId:{idRegistry:t.getUniversalAdIdRegistry(),value:t.getUniversalAdIdValue()}},dealId:t.getDealId(),minSuggestedDuration:t.isLinear()?P.NON_SKIPPABLE_IDENTIFIER:t.getMinSuggestedDuration(),survey:{uri:t.getSurveyUrl()},traffickingParameters:t.getTraffickingParameters()};return o(i)}var d=this&&this.__extends||function(){var e=function(t,i){return(e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var i in t)t.hasOwnProperty(i)&&(e[i]=t[i])})(t,i)};return function(t,i){function a(){this.constructor=t}e(t,i),t.prototype=null===i?Object.create(i):(a.prototype=i.prototype,new a)}}(),l=this&&this.__assign||function(){return l=Object.assign||function(e){for(var t,i=1,a=arguments.length;i<a;i++){t=arguments[i];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},l.apply(this,arguments)},c=this&&this.__spreadArrays||function(){for(var e=0,t=0,i=arguments.length;t<i;t++)e+=arguments[t].length;for(var a=Array(e),r=0,t=0;t<i;t++)for(var n=arguments[t],o=0,s=n.length;o<s;o++,r++)a[r]=n[o];return a};Object.defineProperty(t,"__esModule",{value:!0});var u=i(30),h=i(1),A=i(11),g=i(87),p=i(122),v=i(4),m=i(12),f=i(61),E=i(97),y=i(168),k=i(109),T=i(71),P=i(36),S=i(39),I=i(171),C=i(142),b=i(143),R="advertising-ima",M=250,B=function(e){function t(t,i){var r=e.call(this,t,i)||this;return r.onAdsManagerLoaded=function(e){r.adsRenderingSettings.restoreCustomPlaybackStateOnAdBreakComplete=!1,r.adsRenderingSettings.loadVideoTimeout=r.adVideoLoadTimeout,r.adsManager=e.getAdsManager(r.player.getVideoElement(),r.adsRenderingSettings),r.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,r.onContentPauseRequested),r.adsManager.addEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,r.onContentResumeRequested),r.adsManager.addEventListener(google.ima.AdEvent.Type.STARTED,r.onStarted),r.adsManager.addEventListener(google.ima.AdEvent.Type.LOADED,r.onLoaded),r.adsManager.addEventListener(google.ima.AdEvent.Type.SKIPPED,r.onSkipped),r.adsManager.addEventListener(google.ima.AdEvent.Type.COMPLETE,r.onComplete),r.adsManager.addEventListener(google.ima.AdEvent.Type.PAUSED,r.onPaused),r.adsManager.addEventListener(google.ima.AdEvent.Type.RESUMED,r.onResumed),r.adsManager.addEventListener(google.ima.AdEvent.Type.CLICK,r.onClicked),r.adsManager.addEventListener(google.ima.AdEvent.Type.DURATION_CHANGE,r.onDurationChange),r.adsManager.addEventListener(google.ima.AdEvent.Type.FIRST_QUARTILE,r.onFirstQuartile),r.adsManager.addEventListener(google.ima.AdEvent.Type.MIDPOINT,r.onMidpoint),r.adsManager.addEventListener(google.ima.AdEvent.Type.THIRD_QUARTILE,r.onThirdQuartile),r.adsManager.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,r.onAdError),r.adsManager.addEventListener(google.ima.AdEvent.Type.INTERACTION,r.onAdInteraction),a(r.config.onAdsManagerAvailable,r.adsManager),r.adsManager.init(r.playerContainer.clientWidth,r.playerContainer.clientHeight,google.ima.ViewMode.NORMAL),r.adsManager.setVolume(r.player.getVolume()/100),r.getActiveAdBreak()?r.onAdBreakLoaded(r.getActiveAdBreak()):r.handleMissingAdBreak()},r.onAdError=function(e){var t,i=r.getActiveAdBreak(),a=e.getError(),n=a.getInnerError(),o=a.getErrorCode(),s=null!=n&&Boolean(n.getErrorCode),d=s?n:null;return i?(null===(t=r.adPlaybackApiPromise)||void 0===t?void 0:t.then(function(){return f.pingVmapTrackingUrls(i.trackingEvents,k.VmapTrackingEventType.Error)}),o!==google.ima.AdError.ErrorCode.VAST_EMPTY_RESPONSE||r.adPlaybackApiPromise||(f.pingVmapTrackingUrls(i.trackingEvents,k.VmapTrackingEventType.BreakStart),f.pingVmapTrackingUrls(i.trackingEvents,k.VmapTrackingEventType.Error),f.pingVmapTrackingUrls(i.trackingEvents,k.VmapTrackingEventType.BreakEnd)),d&&d.getErrorCode()===google.ima.AdError.ErrorCode.AUTOPLAY_DISALLOWED?(r.hasContentStarted||(r.schedulableAdBreaks=[i].concat(r.queuedAdBreaks,r.schedulableAdBreaks),r.queuedAdBreaks=[]),void r.emitAdError(d)):r.waterfallingErrorCodes.includes(a.getErrorCode())?void r.tryNextFallbackAdTag(i).then(function(e){if(e.manifest)r.passAdBreakToIma(i,f.AdManifestHelper.toDataUri(e.manifest),!0);else{if(i.passthroughMode===C.ImaPassthroughMode.None)return Promise.reject();r.passAdBreakToIma(i,null,!0)}})["catch"](function(){return r.emitAdError(a)}):void r.emitAdError(a)):void r.emitAdError(a)},r.onContentPauseRequested=function(e){var t=r.adPlaybackApiPromise?r.resetActiveAdPlaybackApi(!1):Promise.resolve();t.then(function(){var t=l({},r.getActiveAdBreak());if(delete t.isScheduled,!t){var i=r.player.getVideoElement().currentTime;t={tag:null,id:m.Util.generateUniqueId(),position:String(i),scheduleTime:i}}r.adPlaybackApiPromise=r.player.requestAdPlayback(t),r.adPlaybackReporterPromise=r.adPlaybackApiPromise.then(function(e){return e.requestReporter()}),r.adPlaybackApiPromise.then(function(){return f.pingVmapTrackingUrls(t.trackingEvents,k.VmapTrackingEventType.BreakStart)});var a=e.getAd();r.adjustAdContainer(a.isLinear(),a.getWidth(),a.getHeight())})},r.onContentResumeRequested=function(){var e,t=r.getActiveAdBreak();r.isFallbackAd&&(r.isFallbackAd=!1,t&&delete t.currentFallbackIndex),null===(e=r.adPlaybackApiPromise)||void 0===e?void 0:e.then(function(){var e;return f.pingVmapTrackingUrls(null===(e=t)||void 0===e?void 0:e.trackingEvents,k.VmapTrackingEventType.BreakEnd)}),r.activeAdBreak=null,r.isAdPlaying=!1,r.adContainer.style.display="none",r.adPlaybackApiPromise?r.adPlaybackApiPromise.then(function(e){r.queuedAdBreaks.length>0?r.playAdBreak(r.queuedAdBreaks.shift()):(e.done(),r.adPlaybackApiPromise=null,r.maybeResolveAdBreaks())}):r.maybeResolveAdBreaks()},r.onLoaded=function(e){r.adPlaybackApiPromise&&r.isPreviousAdPlaybackApiActive&&r.resetActiveAdPlaybackApi(!e.getAd().isLinear())},r.onStarted=function(e){r.hasError||(r.adjustAdContainer(e.getAd().isLinear(),e.getAd().getWidth(),e.getAd().getHeight()),r.activeAd||r.initializeActiveAd(e),r.config&&r.config.companionAdContainers&&r.displayCompanionAds(r.config.companionAdContainers(),e),r.activeAd.isLinear?r.onLinearAdStarted(e):r.onNonLinearAdStarted(e))},r.triggerTimeUpdate=function(){if(r.adPlaybackReporterPromise){var e=r.currentTime();e!==r.lastKnownAdPlaybackTime&&e>0&&r.adPlaybackReporterPromise.then(function(t){return t.timeupdate(e)}),r.lastKnownAdPlaybackTime=e}},r.onSkipped=function(){r.resetActiveAd(),r.adPlaybackReporterPromise&&r.adPlaybackReporterPromise.then(function(e){return e.skipped()})},r.onComplete=function(){r.resetActiveAd(),r.adPlaybackReporterPromise&&(r.adPlaybackReporterPromise.then(function(e){return e.done()}),r.adPlaybackReporterPromise=r.adPlaybackApiPromise.then(function(e){return e.requestReporter()}))},r.onPaused=function(){r.isAdPlaying=!1,r.adPlaybackReporterPromise.then(function(e){return e.paused(r.currentTime())})},r.onResumed=function(){r.isAdPlaying=!0,r.adPlaybackReporterPromise.then(function(e){return e.resumed(r.currentTime())})},r.onClicked=function(){var e=r.activeAd?r.activeAd.clickThroughUrl:null;r.player.adClicked(e)},r.onAdInteraction=function(e){var t;r.player.adInteraction(h.AdInteractionType.Vpaid,null===(t=e.getAdData())||void 0===t?void 0:t.id)},r.onDurationChange=function(e){r.currentDuration=e.getAd().getDuration()},r.onFirstQuartile=function(){r.player.onQuartile(h.AdQuartile.FIRST_QUARTILE)},r.onMidpoint=function(){r.player.onQuartile(h.AdQuartile.MIDPOINT)},r.onThirdQuartile=function(){r.player.onQuartile(h.AdQuartile.THIRD_QUARTILE)},r.schedulableAdBreaks=[],r.unschedulableAdBreaks=[],r.queuedAdBreaks=[],r.persistentAdBreaks=[],r.currentScheduleTime=0,r.activeAdBreak=null,r.activeAd=null,r.adVideoLoadTimeout=i.videoLoadTimeout,r.waterfallingErrorCodes=[],r.hasError=!1,r.isUsingCustomAdContainer=!1,r.isImaSdkAvailable=!1,r.scheduleAdBreaks=Promise.resolve(null),r.isAdPlaying=!1,r.isFallbackAd=!1,r.isPreviousAdPlaybackApiActive=!1,r.config.placeholders=l(l({},E.adTagPlaceholderDefaults),r.config.placeholders),r.initializeImaSdkDeferred=new A.Deferred,r.loadImaSdkPromise=p.FileLoader.getInstance().loadScript(i.sdkUrl),r.loadImaSdkPromise.then(function(){r.createDomStructure(),r.initialize(),r.isImaSdkAvailable=!0})["catch"](function(){r.player.onError(b.ImaModuleErrorCode.FAILED_TO_REQUEST_IMA_SDK,"could not load the IMA SDK"),r.isImaSdkAvailable=!1,r.initializeImaSdkDeferred.resolve()}),r}return d(t,e),t.prototype.createDomStructure=function(){"function"==typeof this.config.adContainer&&(this.adContainer=this.config.adContainer(),this.adContainer instanceof HTMLElement?this.isUsingCustomAdContainer=!0:this.player.onError(S.VastErrorCode.UNDEFINED_ERROR,"AdvertisingConfig.adContainer was defined but did not provide a valid HTMLElement.")),this.isUsingCustomAdContainer||(this.adContainer=g.DOMHelper.createTag("div",{"class":u.Environment.idPrefix+"ima-container"},{height:"100%",width:"100%",display:"none",border:"none",overflow:"hidden",position:"absolute",top:"0"}),this.playerContainer=this.player.getVideoElement().parentElement,this.playerContainer.appendChild(this.adContainer)),a(this.config.onAdContainerAvailable,this.adContainer)},t.prototype.initialize=function(){google.ima.settings.setPlayerType("bitmovin-player"),google.ima.settings.setNumRedirects(25),google.ima.settings.setCookiesEnabled(this.config.withCredentials),a(this.config.beforeInitialization,google.ima.settings),this.adsRenderingSettings=new google.ima.AdsRenderingSettings,this.config.allowedUiElements&&(this.adsRenderingSettings.uiElements=this.config.allowedUiElements),this.adDisplayContainer=new google.ima.AdDisplayContainer(this.adContainer,this.player.getVideoElement()),this.adDisplayContainer.initialize(),this.adsLoader=new google.ima.AdsLoader(this.adDisplayContainer),this.adsLoader.addEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),this.adsLoader.addEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded),this.waterfallingErrorCodes=r(),this.initializeImaSdkDeferred.resolve()},t.prototype.handleMissingAdBreak=function(){this.adPlaybackApiPromise&&this.resetActiveAdPlaybackApi(),this.passthroughDownloadTime=null},t.prototype.emitAdError=function(e){this.player.onError(e.getErrorCode(),e.getMessage(),this.getActiveAdBreak()),this.resetActiveAd(),this.hasError=!0,this.activeAdBreak=null,this.queuedAdBreaks.length>0?this.playAdBreak(this.queuedAdBreaks.shift()):(this.maybeResolveAdBreaks(),this.resetActiveAdPlaybackApi())},t.prototype.maybeResolveAdBreaks=function(){this.finishAllAdBreaksForPosition&&(this.finishAllAdBreaksForPosition.resolve(),this.finishAllAdBreaksForPosition=null)},t.prototype.onAdBreakLoaded=function(e){this.adPlaybackApiPromise&&(this.isPreviousAdPlaybackApiActive=!0),e.passthroughMode!==C.ImaPassthroughMode.None&&this.fireMetadataLoadedEventForPassthroughMode(e),this.passthroughDownloadTime=null,e.hasOwnProperty("ads")||(e.ads=[]),this.maybePlayLoadedAdBreak(e)},t.prototype.fireMetadataLoadedEventForPassthroughMode=function(e){var t="number"==typeof e.currentFallbackIndex&&e.currentFallbackIndex>=0?e.fallbackTags[e.currentFallbackIndex]:e.tag,i=this.passthroughDownloadTime&&t.type!==T.AdTagType.VMAP?{downloadTime:v.toSeconds(Date.now()-this.passthroughDownloadTime)}:null;this.player.metadataLoaded(e,i)},t.prototype.maybePlayLoadedAdBreak=function(e){this.config.strategy.shouldPlayAdBreak(e)?this.adsManager.start():(this.activeAdBreak=null,this.queuedAdBreaks.length>0?this.playAdBreak(this.queuedAdBreaks.shift()):(this.isPreviousAdPlaybackApiActive&&this.resetActiveAdPlaybackApi(),this.maybeResolveAdBreaks()))},t.prototype.initializeActiveAd=function(e){var t=this.getActiveAdBreak();if(t&&t.ads){var i=e.getAd().getAdId(),a=t.ads.find(function(e){return e.id===i});a&&(this.activeAd=a)}if(this.activeAd=this.activeAd||{id:e.getAd().getAdId()},this.activeAd.isLinear=e.getAd().isLinear(),1===Object.keys(e.getAd()).length){var r=e.getAd()[Object.keys(e.getAd())[0]].clickThroughUrl;r&&(this.activeAd.clickThroughUrl=r)}e.getAd().getMediaUrl()&&(this.activeAd.mediaFileUrl=e.getAd().getMediaUrl())},t.prototype.onLinearAdStarted=function(e){var t=this,i=e.getAd().getSkipTimeOffset();this.currentDuration=e.getAd().getDuration(),this.currentDuration===-1&&(this.currentDuration=null),this.activeAd.width=e.getAd().getVastMediaWidth(),this.activeAd.height=e.getAd().getVastMediaHeight(),this.activeAd.duration=this.currentDuration,this.activeAd.skippable=i!==P.NON_SKIPPABLE_IDENTIFIER,this.activeAd.data=s(e),this.activeAd.skippable&&(this.activeAd.skippableAfter=i),this.getActiveAdBreak()&&!this.getActiveAdBreak().ads.includes(this.activeAd)&&this.getActiveAdBreak().ads.push(this.activeAd),this.isAdPlaying=!0,this.adPlaybackReporterPromise.then(function(e){e.started(t.activeAd),t.triggerTimeUpdateInterval=window.setInterval(t.triggerTimeUpdate,M)})},t.prototype.onNonLinearAdStarted=function(e){this.queuedAdBreaks.length>0?this.playAdBreak(this.queuedAdBreaks.shift()):(this.activeAd.width=e.getAd().getWidth(),this.activeAd.height=e.getAd().getHeight(),this.activeAd.data=s(e),this.getActiveAdBreak()&&!this.getActiveAdBreak().ads.includes(this.activeAd)&&this.getActiveAdBreak().ads.push(this.activeAd),this.player.overlayAdStarted(this.activeAd),this.finishAllAdBreaksForPosition&&(this.finishAllAdBreaksForPosition.resolve(),this.finishAllAdBreaksForPosition=null)),this.activeAdBreak=null},t.prototype.adjustAdContainer=function(e,t,i){this.adContainer.style.display="block",this.isUsingCustomAdContainer||(e?(this.adContainer.style.width="100%",this.adContainer.style.height="100%",this.adContainer.style.top="0",this.adContainer.style.bottom="",this.adContainer.style.left="",this.adContainer.style.right="",this.adContainer.style.marginLeft="",this.adContainer.style.marginRight=""):(this.adContainer.style.width=t+"px",this.adContainer.style.height=i+"px",this.adContainer.style.top="",this.adContainer.style.bottom=P.DEFAULT_OVERLAY_AD_BOTTOM_POSITION,this.adContainer.style.left="0",this.adContainer.style.right="0",this.adContainer.style.marginLeft="auto",this.adContainer.style.marginRight="auto")),this.adjustImaIframe(e,t,i)},t.prototype.adjustImaIframe=function(e,t,i){var a=this.adContainer.firstElementChild;a&&(e?(a.style.width="100%",a.style.height="100%"):(a.style.width=t+"px",a.style.height=i+"px"));var r=a.getElementsByTagName("iframe")[0];r&&(e?(r.style.width="100%",r.style.height="100%"):(r.style.width=t+"px",r.style.height=i+"px"))},t.prototype.displayCompanionAds=function(e,t){var i=this,a=new google.ima.CompanionAdSelectionSettings;a.resourceType=google.ima.CompanionAdSelectionSettings.ResourceType.STATIC,a.creativeType=google.ima.CompanionAdSelectionSettings.CreativeType.IMAGE,a.sizeCriteria=google.ima.CompanionAdSelectionSettings.SizeCriteria.IGNORE,e.forEach(function(e){var r=e.clientWidth,n=e.clientHeight,o=t.getAd().getCompanionAds(r,n,a);if("innerHTML"in e&&o.length>0){var s=o[0];i.activeAd.hasOwnProperty("companionAds")||(i.activeAd.companionAds=[]),i.activeAd.companionAds.push({width:s.getWidth(),height:s.getHeight()}),e.innerHTML=s.getContent()}})},t.prototype.resetActiveAdPlaybackApi=function(e){if(void 0===e&&(e=!0),!this.adPlaybackApiPromise)return Promise.resolve();var t=this.adPlaybackApiPromise.then(function(t){return t.done(e)});return this.adPlaybackApiPromise=null,this.isPreviousAdPlaybackApiActive=null,t},t.prototype.resetActiveAd=function(){this.activeAd&&this.activeAd.companionAds&&this.config.companionAdContainers().forEach(function(e){return e.innerHTML=""}),clearInterval(this.triggerTimeUpdateInterval),this.hasError=!1,this.triggerTimeUpdateInterval=null,this.activeAd=null,this.isAdPlaying=!1,this.lastKnownAdPlaybackTime=null},t.prototype.onTimeChanged=function(e){var t=this;if(!this.isLinearAdActive()){this.hasContentStarted=!0,this.currentScheduleTime=e;var i=this.schedulableAdBreaks.filter(function(t){return t.preloadOffset&&!t.vastResponse&&t.scheduleTime-t.preloadOffset<=e}),a=this.schedulableAdBreaks.filter(function(t){return t.scheduleTime<=e&&!t.isScheduled});i.forEach(function(e){return t.loadAdBreak(e)}),a.forEach(function(e){return t.loadAdBreak(e).then(function(){t.schedulableAdBreaks.includes(e)&&t.playAdBreak(e)})})}},t.prototype.resetPlaybackStatus=function(e){this.schedulableAdBreaks.forEach(function(t){return t.scheduleTime>=e&&(t.isScheduled=!1)})},t.prototype.onSeek=function(e,t){this.resetPlaybackStatus(t);var i=this.schedulableAdBreaks.filter(function(e){return e.scheduleTime<=t});if(this.schedulableAdBreaks=this.schedulableAdBreaks.filter(function(e){return!i.includes(e)}),i.length>0){var a=this.config.strategy.shouldPlaySkippedAdBreaks(c(i),e,t);i=i.filter(function(e){return!e.discardAfterPlayback||a.includes(e)}),i.forEach(function(e){return e.isScheduled=!0}),a.forEach(function(e){var t=i.findIndex(function(t){return t===e});t>-1&&(i[t].isScheduled=!1)}),this.schedulableAdBreaks=i.concat(this.schedulableAdBreaks)}},t.prototype.onResize=function(e,t,i){if(this.adsManager&&(!this.activeAd||this.activeAd.isLinear)){var a=i?google.ima.ViewMode.FULLSCREEN:google.ima.ViewMode.NORMAL;this.adsManager.resize(e,t,a)}},t.prototype.onVolumeChanged=function(e){this.adsManager&&this.adsManager.setVolume(e/100)},t.prototype.beforeContent=function(){var e=this;return this.storeAdBreaks(this.unschedulableAdBreaks.splice(0,this.unschedulableAdBreaks.length)),this.loadImaSdkPromise.then(function(){return e.isImaSdkAvailable?(e.deInitialize(),e.initialize(),e.scheduleAdBreaks["catch"](function(){}).then(function(){return e.playAllAdBreaksForOffset("pre")})):Promise.resolve()})},t.prototype.afterContent=function(){var e=this;return this.isImaSdkAvailable?(this.activeAd&&!this.activeAd.isLinear&&(this.resetActiveAd(),this.activeAdBreak=null,this.adsManager.stop()),this.adsLoader.contentComplete(),this.playAllAdBreaksForOffset("post").then(function(){return e.resetPlaybackStatus(0)})):Promise.resolve()},t.prototype.isValidPassthroughMode=function(e){return Object.keys(C.ImaPassthroughMode).some(function(t){return e===C.ImaPassthroughMode[t]})},t.prototype.preProcessAdConfig=function(e){e.fallbackTags&&e.fallbackTags.length>0&&(e.fallbackTags=e.fallbackTags.filter(function(e){return!!e.url})),this.isValidPassthroughMode(e.passthroughMode)||(e.passthroughMode=C.ImaPassthroughMode.Vast);var t=e;return t.position?t.position=String(t.position).toLowerCase():t.position=P.DEFAULT_AD_BREAK_POSITION,"number"!=typeof t.preloadOffset&&(t.preloadOffset=P.DEFAULT_PRELOAD_OFFSET),t},t.prototype.validateAdTag=function(e){return e.tag?e.tag.url?Object.keys(T.AdTagType).some(function(t){return e.tag.type===T.AdTagType[t]})?void 0:"The provided ad tag type is invalid":"No ad tag url was provided":"No ad tag was provided"},t.prototype.getAdBreaksFromAdBreakConfigs=function(e){return e.map(function(e){var t=l(l({},e.publicAdBreakConfig),{isScheduled:!1});return e.trackingEvents&&(t.trackingEvents=e.trackingEvents),t})},t.prototype.schedule=function(e){var t=this;return this.scheduleAdBreaks=this.initializeImaSdkDeferred.promise.then(function(){if(!t.isImaSdkAvailable)return Promise.reject("The IMA SDK was not loaded and initialized properly");var i=t.validateAdTag(e);if(i)return Promise.reject(i);var a=t.preProcessAdConfig(e);return t.extractSchedulableAdBreakConfigs(a).then(function(i){if(0===i.length&&a.fallbackTags&&a.fallbackTags.length>0)return a.tag=a.fallbackTags.shift(),t.schedule(a);var r=t.getAdBreaksFromAdBreakConfigs(i);r.forEach(function(t){return t.discardAfterPlayback=e.discardAfterPlayback!==!1});var n=t.storeAdBreaks(r),o=c(n.map(function(e){var t=l({},e);return delete t.isScheduled,t}));return Promise.resolve(o)})})},t.prototype.storeAdBreaks=function(e){var t=this,i=[];e.forEach(function(e){var a=t.player.parsePosition(e.position);isNaN(a)?t.unschedulableAdBreaks.push(e):(e.scheduleTime=a,i.push(e))});var a=i.filter(function(e){return e.persistent});return this.schedulableAdBreaks=this.schedulableAdBreaks.concat(i),this.persistentAdBreaks=this.persistentAdBreaks.concat(a),this.schedulableAdBreaks.sort(n),this.persistentAdBreaks.sort(n),i},t.prototype.extractSchedulableAdBreakConfigs=function(e){var t=this;return new Promise(function(i){if(e.tag.type===T.AdTagType.VMAP&&e.passthroughMode!==C.ImaPassthroughMode.VastAndVmap){var a=e.tag.url;e.tag.url=t.applyAdTagPlaceholders(e.tag.url),I.VmapExtractor.extractAdBreakConfigs(e).then(function(r){var n=r.adBreakConfigs,o=n.filter(function(e){var i=t.player.parsePosition(e.publicAdBreakConfig.position);return isNaN(i)||i>=t.currentScheduleTime});e.tag.url=a,t.player.metadataLoaded(e,r.downloadTiming),i(o)})["catch"](function(r){e.tag.url=a,r?t.player.onError(r.code,null,e):t.player.onError(S.VastErrorCode.UNDEFINED_ERROR,null,e),i([])})}else i([{publicAdBreakConfig:e}])})},t.prototype.playAllAdBreaksForOffset=function(e){var t=this;return this.initializeImaSdkDeferred.promise.then(function(){if(!t.isImaSdkAvailable)return Promise.resolve();var i;i="post"===e?t.schedulableAdBreaks.filter(function(t){return t.position.includes(e)||t.scheduleTime===1/0}):t.schedulableAdBreaks.filter(function(t){return t.position.includes(e)||0===t.scheduleTime});var a=Promise.resolve();return i.length>0&&(t.finishAllAdBreaksForPosition=new A.Deferred,a=t.finishAllAdBreaksForPosition.promise,i.forEach(function(e){return t.loadAdBreak(e).then(function(){return t.playAdBreak(e)})})),a})},t.prototype.loadAdBreak=function(e,t){var i=this,a=e.tag;if(t&&(e.vastResponse=null,a=t),e.vastResponse&&!t)return e.vastResponse;var r=this.applyAdTagPlaceholders(a.url);return e.passthroughMode!==C.ImaPassthroughMode.None?e.vastResponse=Promise.resolve({}):e.vastResponse=f.AdManifestHelper.downloadVastManifest(r).then(function(t){var a=t.manifest,r={manifest:f.AdManifestHelper.xmlToString(a)};return f.AdManifestHelper.parseAdVerifications(a).then(function(a){return a&&a.length>0&&(e.ads=[],a.forEach(function(t){t.verifications&&t.verifications.length>0&&e.ads.push({id:t.id,verifications:t.verifications})})),i.player.metadataLoaded(e,t.downloadTiming),Promise.resolve(r)})})["catch"](function(t){return i.tryNextFallbackAdTag(e)["catch"](function(){return delete e.currentFallbackIndex,t?i.player.onError(t.code,null,e):i.player.onError(S.VastErrorCode.UNDEFINED_ERROR,null,e),Promise.resolve({})})}),e.vastResponse},t.prototype.tryNextFallbackAdTag=function(e){return"number"!=typeof e.currentFallbackIndex?e.currentFallbackIndex=0:e.currentFallbackIndex++,e.fallbackTags&&e.fallbackTags[e.currentFallbackIndex]?this.loadAdBreak(e,e.fallbackTags[e.currentFallbackIndex]):Promise.reject()},t.prototype.playAdBreak=function(e){var t=this;this.schedulableAdBreaks.includes(e)&&e.discardAfterPlayback&&this.schedulableAdBreaks.splice(this.schedulableAdBreaks.indexOf(e),1),this.initializeImaSdkDeferred.promise.then(function(){if(t.isImaSdkAvailable){if(t.activeAdBreak&&!e.isScheduled)return e.isScheduled=!0,void t.queuedAdBreaks.push(e);t.activeAd&&!t.activeAd.isLinear&&t.adsManager&&(t.adsManager.stop(),t.resetActiveAd()),t.activeAdBreak=e,e.vastResponse&&e.vastResponse.then(function(i){e.isScheduled=!0,i.manifest?t.passAdBreakToIma(e,f.AdManifestHelper.toDataUri(i.manifest)):t.passAdBreakToIma(e)})}})},t.prototype.getUrlFromAdBreak=function(e){var t,i,a,r;return r=null===(a=null===(i=null===(t=e)||void 0===t?void 0:t.fallbackTags)||void 0===i?void 0:i[e.currentFallbackIndex])||void 0===a?void 0:a.url,null!==r&&void 0!==r?r:e.tag.url},t.prototype.passAdBreakToIma=function(e,t,i){var a=t||this.getUrlFromAdBreak(e);a&&this.requestAds(a,i)},t.prototype.requestAds=function(e,t){var i=new google.ima.AdsRequest,a=e,r="data:text/xml,",n=a.indexOf(r);0===n?i.adsResponse=decodeURIComponent(a.substring(r.length)):i.adTagUrl=this.applyAdTagPlaceholders(e),this.playerContainer&&(i.linearAdSlotWidth=this.playerContainer.clientWidth,i.linearAdSlotHeight=this.playerContainer.clientHeight,i.nonLinearAdSlotWidth=this.playerContainer.clientWidth),i.nonLinearAdSlotHeight=150,this.isFallbackAd=t,this.passthroughDownloadTime=Date.now(),this.adsLoader.requestAds(i)},t.prototype.applyAdTagPlaceholders=function(e){var t=this,i={playbackTime:String(this.player.getVideoElement().currentTime),height:String(this.playerContainer.clientHeight),width:String(this.playerContainer.clientWidth),domain:encodeURIComponent(document.location.hostname),page:encodeURIComponent(document.location.href),referrer:encodeURIComponent(document.referrer),random:Math.floor(1e7+9e7*Math.random()).toString(),timestamp:String(Date.now())};return Object.keys(this.config.placeholders).forEach(function(a){t.config.placeholders[a].forEach(function(t){e=e.replace(t,i[a])})}),e},t.prototype.list=function(){var e=c(this.queuedAdBreaks.map(function(e){return l({},e)}),this.schedulableAdBreaks.map(function(e){return l({},e)}));return e.forEach(function(e){return delete e.isScheduled}),e},t.prototype.getActiveAdBreak=function(){return this.activeAdBreak},t.prototype.getActiveAd=function(){return this.activeAd},t.prototype.isLinearAdActive=function(e){return!!this.activeAd&&(e?Boolean(this.activeAd.isLinear)&&this.isAdPlaying:Boolean(this.activeAd.isLinear))},t.prototype.discardAdBreak=function(e){e&&(this.activeAdBreak&&this.activeAdBreak.id===e&&(this.onSkipped(),this.activeAdBreak=null,this.adsManager.stop()),this.schedulableAdBreaks=this.schedulableAdBreaks.filter(function(t){return t.id!==e}),this.queuedAdBreaks=this.queuedAdBreaks.filter(function(t){return t.id!==e}))},t.prototype.currentTime=function(){return!isFinite(this.currentDuration)||!this.adsManager||this.adsManager.getRemainingTime()<0?NaN:this.currentDuration-this.adsManager.getRemainingTime()},t.prototype.duration=function(){return isFinite(this.currentDuration)?this.currentDuration:0},t.prototype.pause=function(){this.adsManager&&this.adsManager.pause()},t.prototype.resume=function(){this.adsManager&&this.adsManager.resume()},t.prototype.skip=function(){this.adsManager&&(this.adsManager.skip(),this.activeAd&&!this.activeAd.isLinear&&(this.adsManager.stop(),this.adContainer.style.display="none",this.resetActiveAd()))},t.prototype.getModuleInfo=function(){return{name:R,version:u.Environment.VERSION_NUMBER}},t.prototype.deInitialize=function(){var e=this.schedulableAdBreaks,t=this.unschedulableAdBreaks;this.reset(!1),this.schedulableAdBreaks=e,this.unschedulableAdBreaks=t,this.cleanUpImaSdk(),this.initializeImaSdkDeferred=new A.Deferred},t.prototype.reset=function(e){void 0===e&&(e=!0),this.adPlaybackApiPromise=null,this.adPlaybackReporterPromise=null,this.getActiveAdBreak()&&this.adsManager.stop(),this.resetActiveAd(),this.schedulableAdBreaks=this.persistentAdBreaks,this.queuedAdBreaks=[],this.currentScheduleTime=0,this.currentDuration=null,this.activeAdBreak=null,this.hasContentStarted=!1,this.isFallbackAd=!1,this.isPreviousAdPlaybackApiActive=!1,this.passthroughDownloadTime=null,e&&(this.scheduleAdBreaks=Promise.resolve(null))},t.prototype.cleanUpImaSdk=function(){this.adsLoader&&(this.adsLoader.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),this.adsLoader.removeEventListener(google.ima.AdsManagerLoadedEvent.Type.ADS_MANAGER_LOADED,this.onAdsManagerLoaded),this.adsLoader.destroy(),this.adsLoader=null),this.adsManager&&(this.adsManager.removeEventListener(google.ima.AdEvent.Type.CONTENT_PAUSE_REQUESTED,this.onContentPauseRequested),this.adsManager.removeEventListener(google.ima.AdEvent.Type.CONTENT_RESUME_REQUESTED,this.onContentResumeRequested),this.adsManager.removeEventListener(google.ima.AdEvent.Type.STARTED,this.onStarted),this.adsManager.removeEventListener(google.ima.AdEvent.Type.LOADED,this.onLoaded),this.adsManager.removeEventListener(google.ima.AdEvent.Type.SKIPPED,this.onSkipped),this.adsManager.removeEventListener(google.ima.AdEvent.Type.COMPLETE,this.onComplete),this.adsManager.removeEventListener(google.ima.AdEvent.Type.PAUSED,this.onPaused),this.adsManager.removeEventListener(google.ima.AdEvent.Type.RESUMED,this.onResumed),this.adsManager.removeEventListener(google.ima.AdEvent.Type.CLICK,this.onClicked),this.adsManager.removeEventListener(google.ima.AdEvent.Type.DURATION_CHANGE,this.onDurationChange),this.adsManager.removeEventListener(google.ima.AdEvent.Type.FIRST_QUARTILE,this.onFirstQuartile),this.adsManager.removeEventListener(google.ima.AdEvent.Type.MIDPOINT,this.onMidpoint),this.adsManager.removeEventListener(google.ima.AdEvent.Type.THIRD_QUARTILE,this.onThirdQuartile),this.adsManager.removeEventListener(google.ima.AdErrorEvent.Type.AD_ERROR,this.onAdError),this.adsManager.removeEventListener(google.ima.AdEvent.Type.INTERACTION,this.onAdInteraction),this.adsManager.destroy(),this.adsManager=null),this.adDisplayContainer&&(this.adDisplayContainer.destroy(),this.adDisplayContainer=null),this.adsRenderingSettings=null},t.prototype.dispose=function(){this.resetActiveAd(),this.cleanUpImaSdk(),this.playerContainer&&this.playerContainer.removeChild(this.adContainer),
this.adContainer=null,this.activeAdBreak=null,this.activeAd=null},t.imaMarker=function(){},t}(y.AdvertisingModule);t.ImaModule=B,t.collectAdData=s},375:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(0),r=i(142);t.ImaPassthroughMode=r.ImaPassthroughMode;var n=i(232),o=i(143);t.ImaModuleErrorCode=o.ImaModuleErrorCode,t.AdvertisingImaModuleDefinition={name:a.ModuleName.Advertising,module:function(){return n.ImaModule},dependencies:[a.ModuleName.AdvertisingCore],exports:{ImaModuleErrorCode:o.ImaModuleErrorCode,ImaPassthroughMode:r.ImaPassthroughMode}},t["default"]=t.AdvertisingImaModuleDefinition}},[375])});
})();
